{"version":3,"sources":["../node_modules/peerjs-js-binarypack/lib/bufferbuilder.js","../node_modules/peerjs-js-binarypack/lib/binarypack.js","../node_modules/webrtc-adapter/src/js/utils.js","../node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","../node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","../node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","../node_modules/sdp/sdp.js","../node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","../node_modules/webrtc-adapter/src/js/edge/getusermedia.js","../node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/edge/edge_shim.js","../node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","../node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","../node_modules/webrtc-adapter/src/js/safari/safari_shim.js","../node_modules/webrtc-adapter/src/js/common_shim.js","../node_modules/webrtc-adapter/src/js/adapter_factory.js","../node_modules/webrtc-adapter/src/js/adapter_core.js","adapter.ts","supports.ts","util.ts","../node_modules/eventemitter3/index.js","logger.ts","enums.ts","socket.ts","negotiator.ts","baseconnection.ts","mediaconnection.ts","encodingQueue.ts","dataconnection.ts","api.ts","peer.ts","exports.ts","node_modules/immediate/lib/browser.js","node_modules/uuid/lib/rng-browser.js","node_modules/uuid/lib/bytesToUuid.js","node_modules/uuid/v1.js","node_modules/uuid/v4.js","node_modules/uuid/index.js","node_modules/spark-md5/spark-md5.js","node_modules/vuvuzela/index.js","node_modules/argsarray/index.js","node_modules/pouchdb/node_modules/inherits/inherits_browser.js","../../../AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/events/events.js","../../../AppData/Roaming/npm/node_modules/parcel-bundler/node_modules/process/browser.js","node_modules/pouchdb/lib/index-browser.es.js","js/MasterStore.js","js/masterIndex.js","../../../AppData/Roaming/npm/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","match","length","parseInt","wrapPeerConnectionEvent","window","eventNameToWrap","wrapper","RTCPeerConnection","proto","prototype","nativeAddEventListener","addEventListener","nativeEventName","cb","apply","arguments","wrappedCallback","e","modifiedEvent","_eventMap","nativeRemoveEventListener","removeEventListener","unwrappedCb","Object","defineProperty","get","set","enumerable","configurable","disableLog","bool","Error","disableWarnings","log","console","deprecated","oldMethod","newMethod","warn","detectBrowser","navigator","result","browser","version","mozGetUserMedia","userAgent","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","RTCIceGatherer","mediaDevices","supportsUnifiedPlan","RTCRtpTransceiver","isObject","val","toString","call","compactObject","data","keys","reduce","accumulator","key","isObj","value","isEmptyObject","undefined","assign","walkStats","stats","base","resultSet","has","id","forEach","name","endsWith","filterStats","track","outbound","streamStatsType","filteredResult","Map","trackStats","type","trackIdentifier","push","trackStat","trackId","logging","utils","shimGetUserMedia","browserDetails","constraintsToChrome_","c","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","slice","oc","mix","advanced","concat","shimConstraints_","constraints","func","JSON","parse","stringify","audio","remap","obj","a","b","video","face","facingMode","getSupportedFacingModeLies","matches","getSupportedConstraints","enumerateDevices","then","devices","dev","filter","d","kind","find","some","label","toLowerCase","includes","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","getUserMedia","onSuccess","onError","bind","origGetUserMedia","cs","stream","getAudioTracks","getVideoTracks","getTracks","stop","DOMException","Promise","reject","shimGetDisplayMedia","getSourceId","getDisplayMedia","sourceId","widthSpecified","width","heightSpecified","height","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","error","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","transceiver","receiver","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","getReceivers","event","Event","streams","dispatchEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","pc","dtmf","_dtmf","createDTMFSender","_pc","getSenders","_senders","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","origRemoveStream","removeStream","s","RTCRtpSender","origGetSenders","senders","shimGetStats","origGetStats","getStats","selector","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","map","resolve","shimSenderReceiverGetStats","RTCRtpReceiver","origGetReceivers","receivers","srcElement","MediaStreamTrack","err","shimAddTrackRemoveTrackWithNative","getLocalStreams","_shimmedLocalStreams","streamId","alreadyExists","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","signalingState","t","oldStream","method","nativeMethod","methodObj","args","isLegacyCall","description","desc","replaceInternalStreamId","origSetLocalDescription","setLocalDescription","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","RTCIceCandidate","nativeAddIceCandidate","addIceCandidate","candidate","fixNegotiationNeeded","target","filterIceServers","iceServers","edgeVersion","hasTurn","server","urls","url","isString","validTurn","startsWith","SDPUtils","require","fixStatsType","inboundrtp","outboundrtp","candidatepair","writeMediaSection","caps","dtlsRole","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","i","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","Math","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","makeError","code","NotSupportedError","InvalidAccessError","TypeError","OperationError","module","exports","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","trackEvent","setTimeout","_dispatchEvent","config","_eventTarget","document","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceConnectionState","connectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getRemoteStreams","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","enabled","_createIceGatherer","sdpMLineIndex","shift","writable","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","evt","sdpMid","cand","component","ufrag","usernameFragment","serializedCandidate","writeCandidate","parseCandidate","toJSON","sections","getMediaSections","getDescription","join","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","sessionpart","splitSections","mediaSection","parseRtpParameters","isIceLite","matchPrefix","isRejected","rejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","default","getCapabilities","codec","isNewTrack","nativeTrack","sid","item","close","newState","states","closed","checking","connected","completed","disconnected","failed","new","connecting","createOffer","numAudioTracks","numVideoTracks","offerOptions","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","createAnswer","mediaSectionsInOffer","localTrack","reducedSize","candidateString","trim","senderOrReceiver","promises","all","allStats","results","ortcObjectName","nativeGetstats","nativeStats","mapStats","methods","catch","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","shimReplaceTrack","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","test","rid","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","getParameters","setParameters","shimCreateOffer","origCreateOffer","finally","shimCreateAnswer","origCreateAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","index","tracks","shimRemoteStreamsAPI","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","successCallback","failureCallback","options","promise","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","hasOwnProperty","generateCertificate","shimTrackEventTransceiver","shimCreateOfferLegacy","audioTransceiver","getTransceivers","setDirection","videoTransceiver","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","shimMaxMessageSize","_sctp","sctpInDescription","sdpSemantics","mLine","parseMLine","isFirefox","maxMessageSize","getRemoteFirefoxVersion","canSendMMS","remoteIsFirefox","canSendMaxMessageSize","remoteMMS","getMaxMessageSize","Number","POSITIVE_INFINITY","sctp","shimSendThrowTypeError","origCreateDataChannel","createDataChannel","dataChannel","wrapDcSend","channel","dc","origDataChannelSend","size","byteLength","readyState","shimConnectionState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","removeAllowExtmapMixed","nativeSRD","line","adapterFactory","shimChrome","shimFirefox","shimEdge","shimSafari","adapter","commonShim","chromeShim","browserShim","firefoxShim","edgeShim","safariShim","R","Reflect","ReflectApply","Function","ReflectOwnKeys","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","ProcessEmitWarning","warning","NumberIsNaN","isNaN","EventEmitter","init","_events","_eventsCount","_maxListeners","defaultMaxListeners","arg","getPrototypeOf","create","setMaxListeners","n","$getMaxListeners","that","getMaxListeners","emit","doError","events","er","context","handler","len","listeners","arrayClone","_addListener","listener","prepend","m","existing","newListener","unshift","warned","w","String","emitter","count","addListener","on","prependListener","onceWrapper","fired","removeListener","wrapFn","_onceWrap","wrapped","once","prependOnceListener","list","position","originalListener","spliceOne","off","removeAllListeners","_listeners","unwrap","evlistener","unwrapListeners","rawListeners","listenerCount","eventNames","arr","copy","Array","pop","ret","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","clearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","array","title","env","argv","versions","noop","binding","cwd","chdir","dir","umask","mangle","unmangle","substring","Map$1","_store","mangled","delete","res","Set$1","isArray","add","supportsMapAndSet","Symbol","Set","prop","species","ExportedSet","ExportedMap","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","targetArray","Uint8Array","sourceArray","cloneBinaryObject","webkitSlice","funcToString","objectCtorString","isPlainObject","Ctor","constructor","newObject","Date","toISOString","called","toPromise","self","usedCB","fulfill","resp","callback","mesg","logApiCall","logArgs","origCallback","responseArgs","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","pick","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","numDocs","numDone","perDocResults","collapseResultsAndFinish","info","checkDone","gotResult","docIndex","allRequests","nextBatch","upTo","batch","processBatch","offset","docId","docIdx","docRequests","docOpts","open_revs","rev","formatResult","param","hasLocal","localStorage","setItem","getItem","hasLocalStorage","Changes","attachBrowserEvents","dbName","inprogress","eventFunction","changesOpts","changes","seq","since","cancelled","onChange","notifyLocalWindows","notify","guardedConsole","randomNumber","maxTimeout","ratio","random","range","defaultBackOff","explainError","status","str","to","nextSource","nextKey","$inject_Object_assign","PouchError","reason","UNAUTHORIZED","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","NOT_OPEN","UNKNOWN_ERROR","BAD_ARG","INVALID_REQUEST","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","DB_MISSING","IDB_ERROR","WSQ_ERROR","LDB_ERROR","FORBIDDEN","INVALID_REV","FILE_EXISTS","MISSING_STUB","INVALID_URL","createError","CustomPouchError","generateErrorFromResponse","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","isRemote","_remote","ee","parseDesignDocFunctionName","parts","normalizeDesignDocFunctionName","normalized","qName","qParser","parser","parseUri","exec","encoded","decodeURIComponent","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","Builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","builder","append","getBlob","binaryStringToArrayBuffer","bin","buf","charCodeAt","binStringToBluffer","binString","b64ToBluffer","b64","arrayBufferToBinaryString","buffer","binary","bytes","fromCharCode","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","global","setImmediate","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","Md5","next","loadNextChunk","done","destroy","stringMd5","hash","deterministic_revs","clonedDoc","uuidV4","v4","_rev_tree","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","node","tree","ids","branches","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","comparator","low","high","insertSorted","pathToTree","path","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parent","parentIdx","elements","elementsLen","el","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","l","Changes$1","tryCatchInChangeListener","pending","lastSeq","onDestroy","cancel","isCancelled","validateChanges","processChange","changeList","style","_conflicts","PouchDB","_changesFilterPlugin","validate","doChanges","continuous","live","update_seq","normalize","shouldFilter","descending","limit","newPromise","_changes","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","aStart","_revisions","bStart","computeHeight","edges","prnt","rev$$1","from","edge","allDocsKeysParse","skip","doNextCompaction","task","_compactionQueue","last_seq","_compact","attachmentNameError","AbstractPouchDB","post","bulkDocs","_putLocal","_removeLocal","force","transformForceOptionToNewEditsOption","putDoc","oldRevId","oldRevNum","newRevNum","newRevId","new_edits","_put","putAttachment","attachmentId","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","missing","addToMissing","revId","processDoc","missingForId","_getRevisionTree","missingObj","compactDocument","revTree","candidates","_doCompaction","compact","return_docs","row","onComplete","deltaFunc","_getLocal","finishOpenRevs","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","hashFoundAtRevPos","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","incompatibleOpt","_allDocs","_close","_info","db_name","auto_compaction","_type","attachmentError","_bulkDocs","registerDependentDatabase","dependentDb","depDB","__opts","dependentDbs","usePrefix","use_prefix","destroyDb","_destroy","localDoc","deletedMap","trueName","TaskQueue","execute","fail","ready","parseAdapter","adapters","preferredAdapters","adapterName","prepareForDestruction","onDestroyed","from_constructor","onClosed","prefixedName","backend","_adapter","valid","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","onConstructorRef","onConstructorUnref","dbList","onConstructorDestroyed","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","fields","current","ch","combinationFields","isCombinationalField","field","getKey","getValue","mergeAndedSelectors","selectors","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","mergeAndedSelectorsNested","isAndInSelector","isAnd","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","origKey","k","indexify","numToIndexableString","toIndexableString","objKey","zero","parseNumber","originalIdx","num","neg","numAsString","magAsString","magnitude","stack","metaStack","lastMetaElement","element","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magForComparison","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","bFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","matchCominationalSelector","matchSelector","userOperator","userValue","orMatchers","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","filterName","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","filterFun","filters","applyChangesFilterPlugin","toObject","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","digest","preprocessBlob","md5","preprocessAttachment","preprocessAttachments","docInfos","docv","overallErr","docInfo","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","newRevIsDeleted","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","insertDoc","resultsIdx","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","vuvuzela","safeJsonStringify","json","idbError","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","cursor","openCursor","only","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","mode","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","startTransaction","txnResult","onabort","ontimeout","oncomplete","updateDocCountIfReady","verifyAttachments","fetchExistingDocs","onAllDocsProcessed","idbProcessDocs","revs_limit","docCount","numFetched","readMetadata","verifyAttachment","finish","digests","filename","attErr","isUpdate","hasAttachments","writeAttachments","finishDoc","afterPutDoc","revsToDelete","metadataToStore","metaDataReq","afterPutMetadata","afterPutDocError","preventDefault","stopPropagation","getKeyReq","putReq","insertAttachmentMappings","collectResults","attachmentSaved","saveAttachment","attsAdded","attsToAdd","newAtt","runBatchedCursor","keyRange","batchSize","onBatch","useGetAll","getAll","getAllKeys","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","continuePseudoCursor","lastKey","newKeyRange","upper","upperOpen","lowerBound","onCursor","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","inclusive_end","keyRangeError","onTxnComplete","docIdRevIndex","updateSeq","getMaxUpdateSeq","maxKey","fetchDocAsynchronously","onGetDoc","allDocsInner","batchValues","batchValue","batchKeys","onResultsReady","returnVal","total_rows","checkBlobSupport","blob$$1","matchedChrome","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","runAction","runCallback","runNext","docIds","numResults","docIdsToMetadata","winningDocs","metadatas","processMetadataAndWinningDoc","winningDoc","filtered","onBatchDone","fetchWinningDocAndMetadata","onGetMetadata","docIdRev","objectStores","cachedDBs","blobSupportPromise","openReqList","IdbPouch","thisCallback","createSchema","createObjectStore","keyPath","autoIncrement","createIndex","unique","addDeletedOrLocalIndex","createLocalStoreSchema","migrateLocalStore","localStore","local","seqCursor","addAttachAndSeqStore","migrateAttsAndSeqs","digestMap","migrateMetadata","decodeMetadataCompat","fetchMetadataSeq","metadataSeq","onGetMetadataSeq","instanceId","idb_bulkDocs","reqOpts","idb_get","attachId","attachment","blobData","idb_info","doc_count","idb_attachment_format","idb_allDocs","idbChanges","oldRev","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","pool","promiseFactories","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","getHost","user","password","auth","username","genDBUrl","genUrl","pathDel","host","paramsToStr","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","ourFetch","headers","credentials","nAuth","token","unescape","now","fetchFun","adapterFun$$1","setup","fetchJSON","v","setupPromise","skip_setup","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","encodeAttachmentId","fetchAllAttachments","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","leftToFetch","feed","seq_interval","param_name","controller","lastFetchedSeq","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","viewSignature","cachedViews","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","coerceOptions","group_level","checkPositiveInteger","number","checkQueryParseError","startkeyName","endkeyName","group","optionName","httpQuery","MAX_URL_LENGTH","keysAsString","customQuery","_query","customViewCleanup","_viewCleanup","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","processKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","saveKeyValues","seqDocId","listOfDocsToPersist","docsToPersist","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","reduceView","shouldGroup","groups","lvl","last","groupKey","reduceTry","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","httpViewCleanup","localViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","queryPromised","createViewPromise","stale","abstractQuery","abstractViewCleanup","viewCleanup","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","getBuiltIn","reduceFunString","origMap","builtIn","abstract","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRevs","missingRev","getDocs","resultDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","hasConflicts","fetchRevisionOneDocs","getRevisionOneDocs","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","getCheckpoint","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","sessionId","props","rest","floor","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","backoffTimeSet","current_back_off","removeBackOffSetter","removeBackOffTimeSet","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","batches","currentBatch","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","repId","checkpointer","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getDiffs","getBatchDocs","got","startNextBatch","processPendingBatch","abortReplication","immediate$$1","fatalError","end_time","onChangesComplete","onChangesError","abortChanges","_abortChanges","startChanges","_addedListeners","Replication","_readyCalled","cleanup","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","targetPouch","Sync","sync","canceled","optsPush","optsPull","pull","pushPaused","pullPaused","pullChange","pushChange","pushDenied","pullDenied","pushActive","pullActive","removed","removeAll","isChange","isDenied","isPaused","isActive","addOneListener","out","success","replication","replicateMethods","other","AudioContext","merger","createChannelMerger","audioRecorder","WebAudioRecorder","pouch","connect","destination","recorder","AppStore","onPouchUpdate","numPeers","couchData","leftUser","ratingAudience","ratingWatson","rightUser","songName","karaokeUrl","audioStream","peer","Peer","conn","alert","mediaConn","createMediaStreamSource","splitter","createChannelSplitter","isRecording","cancelRecording","startRecording","store","OVERLAY_ID","OldModule","bundle","Module","moduleName","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","isParcelRequire","WebSocket","hostname","location","ws","onmessage","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","parcelRequire","generated","js","clear","hmrApply","hmrAcceptRun","reload","onclose","removeErrorOverlay","overlay","createErrorOverlay","appendChild","getElementById","createElement","stackTrace","innerText","innerHTML","getParents","modules","parents","dep","deps","cache"],"mappings":"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A,OAAS,CACpB,KAAI,EAAA,KACJ,KAAI,EAAA,MAGN,QAAA,QAAe,EAAA,KAET,OAAQ,OAAS,QAAA,OAEjB,OAAQ,KAAO,EAAA;;;;;ACZrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA,IAAIO,CAAC,GAAG,OAAOC,OAAP,KAAmB,QAAnB,GAA8BA,OAA9B,GAAwC,IAAhD;AACA,IAAIC,YAAY,GAAGF,CAAC,IAAI,OAAOA,CAAC,CAACjrB,KAAT,KAAmB,UAAxB,GACfirB,CAAC,CAACjrB,KADa,GAEf,SAASmrB,YAAT,CAAsBtZ,MAAtB,EAA8B3G,QAA9B,EAAwCmF,IAAxC,EAA8C;AAC9C,SAAO+a,QAAQ,CAACzrB,SAAT,CAAmBK,KAAnB,CAAyB0C,IAAzB,CAA8BmP,MAA9B,EAAsC3G,QAAtC,EAAgDmF,IAAhD,CAAP;AACD,CAJH;AAMA,IAAIgb,cAAJ;;AACA,IAAIJ,CAAC,IAAI,OAAOA,CAAC,CAACK,OAAT,KAAqB,UAA9B,EAA0C;AACxCD,EAAAA,cAAc,GAAGJ,CAAC,CAACK,OAAnB;AACD,CAFD,MAEO,IAAI7qB,MAAM,CAAC8qB,qBAAX,EAAkC;AACvCF,EAAAA,cAAc,GAAG,SAASA,cAAT,CAAwBxZ,MAAxB,EAAgC;AAC/C,WAAOpR,MAAM,CAAC+qB,mBAAP,CAA2B3Z,MAA3B,EACJ5L,MADI,CACGxF,MAAM,CAAC8qB,qBAAP,CAA6B1Z,MAA7B,CADH,CAAP;AAED,GAHD;AAID,CALM,MAKA;AACLwZ,EAAAA,cAAc,GAAG,SAASA,cAAT,CAAwBxZ,MAAxB,EAAgC;AAC/C,WAAOpR,MAAM,CAAC+qB,mBAAP,CAA2B3Z,MAA3B,CAAP;AACD,GAFD;AAGD;;AAED,SAAS4Z,kBAAT,CAA4BC,OAA5B,EAAqC;AACnC,MAAItqB,OAAO,IAAIA,OAAO,CAACI,IAAvB,EAA6BJ,OAAO,CAACI,IAAR,CAAakqB,OAAb;AAC9B;;AAED,IAAIC,WAAW,GAAG7C,MAAM,CAAC8C,KAAP,IAAgB,SAASD,WAAT,CAAqBzoB,KAArB,EAA4B;AAC5D,SAAOA,KAAK,KAAKA,KAAjB;AACD,CAFD;;AAIA,SAAS2oB,YAAT,GAAwB;AACtBA,EAAAA,YAAY,CAACC,IAAb,CAAkBppB,IAAlB,CAAuB,IAAvB;AACD;;AACD0U,MAAM,CAACC,OAAP,GAAiBwU,YAAjB,EAEA;;AACAA,YAAY,CAACA,YAAb,GAA4BA,YAA5B;AAEAA,YAAY,CAAClsB,SAAb,CAAuBosB,OAAvB,GAAiC3oB,SAAjC;AACAyoB,YAAY,CAAClsB,SAAb,CAAuBqsB,YAAvB,GAAsC,CAAtC;AACAH,YAAY,CAAClsB,SAAb,CAAuBssB,aAAvB,GAAuC7oB,SAAvC,EAEA;AACA;;AACA,IAAI8oB,mBAAmB,GAAG,EAA1B;AAEAzrB,MAAM,CAACC,cAAP,CAAsBmrB,YAAtB,EAAoC,qBAApC,EAA2D;AACzDhrB,EAAAA,UAAU,EAAE,IAD6C;AAEzDF,EAAAA,GAAG,EAAE,YAAW;AACd,WAAOurB,mBAAP;AACD,GAJwD;AAKzDtrB,EAAAA,GAAG,EAAE,UAASurB,GAAT,EAAc;AACjB,QAAI,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,GAAG,CAAjC,IAAsCR,WAAW,CAACQ,GAAD,CAArD,EAA4D;AAC1D,YAAM,IAAIhH,UAAJ,CAAe,oGAAoGgH,GAApG,GAA0G,GAAzH,CAAN;AACD;;AACDD,IAAAA,mBAAmB,GAAGC,GAAtB;AACD;AAVwD,CAA3D;;AAaAN,YAAY,CAACC,IAAb,GAAoB,YAAW;AAE7B,MAAI,KAAKC,OAAL,KAAiB3oB,SAAjB,IACA,KAAK2oB,OAAL,KAAiBtrB,MAAM,CAAC2rB,cAAP,CAAsB,IAAtB,EAA4BL,OADjD,EAC0D;AACxD,SAAKA,OAAL,GAAetrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAf;AACA,SAAKL,YAAL,GAAoB,CAApB;AACD;;AAED,OAAKC,aAAL,GAAqB,KAAKA,aAAL,IAAsB7oB,SAA3C;AACD,CATD,EAWA;AACA;;;AACAyoB,YAAY,CAAClsB,SAAb,CAAuB2sB,eAAvB,GAAyC,SAASA,eAAT,CAAyBC,CAAzB,EAA4B;AACnE,MAAI,OAAOA,CAAP,KAAa,QAAb,IAAyBA,CAAC,GAAG,CAA7B,IAAkCZ,WAAW,CAACY,CAAD,CAAjD,EAAsD;AACpD,UAAM,IAAIpH,UAAJ,CAAe,kFAAkFoH,CAAlF,GAAsF,GAArG,CAAN;AACD;;AACD,OAAKN,aAAL,GAAqBM,CAArB;AACA,SAAO,IAAP;AACD,CAND;;AAQA,SAASC,gBAAT,CAA0BC,IAA1B,EAAgC;AAC9B,MAAIA,IAAI,CAACR,aAAL,KAAuB7oB,SAA3B,EACE,OAAOyoB,YAAY,CAACK,mBAApB;AACF,SAAOO,IAAI,CAACR,aAAZ;AACD;;AAEDJ,YAAY,CAAClsB,SAAb,CAAuB+sB,eAAvB,GAAyC,SAASA,eAAT,GAA2B;AAClE,SAAOF,gBAAgB,CAAC,IAAD,CAAvB;AACD,CAFD;;AAIAX,YAAY,CAAClsB,SAAb,CAAuBgtB,IAAvB,GAA8B,SAASA,IAAT,CAAcroB,IAAd,EAAoB;AAChD,MAAI+L,IAAI,GAAG,EAAX;;AACA,OAAK,IAAIoE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxU,SAAS,CAACd,MAA9B,EAAsCsV,CAAC,EAAvC,EAA2CpE,IAAI,CAAC7L,IAAL,CAAUvE,SAAS,CAACwU,CAAD,CAAnB;;AAC3C,MAAImY,OAAO,GAAItoB,IAAI,KAAK,OAAxB;AAEA,MAAIuoB,MAAM,GAAG,KAAKd,OAAlB;AACA,MAAIc,MAAM,KAAKzpB,SAAf,EACEwpB,OAAO,GAAIA,OAAO,IAAIC,MAAM,CAACjiB,KAAP,KAAiBxH,SAAvC,CADF,KAEK,IAAI,CAACwpB,OAAL,EACH,OAAO,KAAP,CAT8C,CAWhD;;AACA,MAAIA,OAAJ,EAAa;AACX,QAAIE,EAAJ;AACA,QAAIzc,IAAI,CAAClR,MAAL,GAAc,CAAlB,EACE2tB,EAAE,GAAGzc,IAAI,CAAC,CAAD,CAAT;;AACF,QAAIyc,EAAE,YAAY7rB,KAAlB,EAAyB;AACvB;AACA;AACA,YAAM6rB,EAAN,CAHuB,CAGb;AACX,KARU,CASX;;;AACA,QAAI9d,GAAG,GAAG,IAAI/N,KAAJ,CAAU,sBAAsB6rB,EAAE,GAAG,OAAOA,EAAE,CAAClkB,OAAV,GAAoB,GAAvB,GAA6B,EAArD,CAAV,CAAV;AACAoG,IAAAA,GAAG,CAAC+d,OAAJ,GAAcD,EAAd;AACA,UAAM9d,GAAN,CAZW,CAYA;AACZ;;AAED,MAAIge,OAAO,GAAGH,MAAM,CAACvoB,IAAD,CAApB;AAEA,MAAI0oB,OAAO,KAAK5pB,SAAhB,EACE,OAAO,KAAP;;AAEF,MAAI,OAAO4pB,OAAP,KAAmB,UAAvB,EAAmC;AACjC7B,IAAAA,YAAY,CAAC6B,OAAD,EAAU,IAAV,EAAgB3c,IAAhB,CAAZ;AACD,GAFD,MAEO;AACL,QAAI4c,GAAG,GAAGD,OAAO,CAAC7tB,MAAlB;AACA,QAAI+tB,SAAS,GAAGC,UAAU,CAACH,OAAD,EAAUC,GAAV,CAA1B;;AACA,SAAK,IAAIxY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwY,GAApB,EAAyB,EAAExY,CAA3B,EACE0W,YAAY,CAAC+B,SAAS,CAACzY,CAAD,CAAV,EAAe,IAAf,EAAqBpE,IAArB,CAAZ;AACH;;AAED,SAAO,IAAP;AACD,CA1CD;;AA4CA,SAAS+c,YAAT,CAAsBvb,MAAtB,EAA8BvN,IAA9B,EAAoC+oB,QAApC,EAA8CC,OAA9C,EAAuD;AACrD,MAAIC,CAAJ;AACA,MAAIV,MAAJ;AACA,MAAIW,QAAJ;;AAEA,MAAI,OAAOH,QAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAInW,SAAJ,CAAc,qEAAqE,OAAOmW,QAA1F,CAAN;AACD;;AAEDR,EAAAA,MAAM,GAAGhb,MAAM,CAACka,OAAhB;;AACA,MAAIc,MAAM,KAAKzpB,SAAf,EAA0B;AACxBypB,IAAAA,MAAM,GAAGhb,MAAM,CAACka,OAAP,GAAiBtrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAA1B;AACAxa,IAAAA,MAAM,CAACma,YAAP,GAAsB,CAAtB;AACD,GAHD,MAGO;AACL;AACA;AACA,QAAIa,MAAM,CAACY,WAAP,KAAuBrqB,SAA3B,EAAsC;AACpCyO,MAAAA,MAAM,CAAC8a,IAAP,CAAY,aAAZ,EAA2BroB,IAA3B,EACY+oB,QAAQ,CAACA,QAAT,GAAoBA,QAAQ,CAACA,QAA7B,GAAwCA,QADpD,EADoC,CAIpC;AACA;;AACAR,MAAAA,MAAM,GAAGhb,MAAM,CAACka,OAAhB;AACD;;AACDyB,IAAAA,QAAQ,GAAGX,MAAM,CAACvoB,IAAD,CAAjB;AACD;;AAED,MAAIkpB,QAAQ,KAAKpqB,SAAjB,EAA4B;AAC1B;AACAoqB,IAAAA,QAAQ,GAAGX,MAAM,CAACvoB,IAAD,CAAN,GAAe+oB,QAA1B;AACA,MAAExb,MAAM,CAACma,YAAT;AACD,GAJD,MAIO;AACL,QAAI,OAAOwB,QAAP,KAAoB,UAAxB,EAAoC;AAClC;AACAA,MAAAA,QAAQ,GAAGX,MAAM,CAACvoB,IAAD,CAAN,GACTgpB,OAAO,GAAG,CAACD,QAAD,EAAWG,QAAX,CAAH,GAA0B,CAACA,QAAD,EAAWH,QAAX,CADnC,CAFkC,CAIlC;AACD,KALD,MAKO,IAAIC,OAAJ,EAAa;AAClBE,MAAAA,QAAQ,CAACE,OAAT,CAAiBL,QAAjB;AACD,KAFM,MAEA;AACLG,MAAAA,QAAQ,CAAChpB,IAAT,CAAc6oB,QAAd;AACD,KAVI,CAYL;;;AACAE,IAAAA,CAAC,GAAGf,gBAAgB,CAAC3a,MAAD,CAApB;;AACA,QAAI0b,CAAC,GAAG,CAAJ,IAASC,QAAQ,CAACruB,MAAT,GAAkBouB,CAA3B,IAAgC,CAACC,QAAQ,CAACG,MAA9C,EAAsD;AACpDH,MAAAA,QAAQ,CAACG,MAAT,GAAkB,IAAlB,CADoD,CAEpD;AACA;;AACA,UAAIC,CAAC,GAAG,IAAI3sB,KAAJ,CAAU,iDACEusB,QAAQ,CAACruB,MADX,GACoB,GADpB,GAC0B0uB,MAAM,CAACvpB,IAAD,CADhC,GACyC,aADzC,GAEE,0CAFF,GAGE,gBAHZ,CAAR;AAIAspB,MAAAA,CAAC,CAAC/pB,IAAF,GAAS,6BAAT;AACA+pB,MAAAA,CAAC,CAACE,OAAF,GAAYjc,MAAZ;AACA+b,MAAAA,CAAC,CAACtpB,IAAF,GAASA,IAAT;AACAspB,MAAAA,CAAC,CAACG,KAAF,GAAUP,QAAQ,CAACruB,MAAnB;AACAssB,MAAAA,kBAAkB,CAACmC,CAAD,CAAlB;AACD;AACF;;AAED,SAAO/b,MAAP;AACD;;AAEDga,YAAY,CAAClsB,SAAb,CAAuBquB,WAAvB,GAAqC,SAASA,WAAT,CAAqB1pB,IAArB,EAA2B+oB,QAA3B,EAAqC;AACxE,SAAOD,YAAY,CAAC,IAAD,EAAO9oB,IAAP,EAAa+oB,QAAb,EAAuB,KAAvB,CAAnB;AACD,CAFD;;AAIAxB,YAAY,CAAClsB,SAAb,CAAuBsuB,EAAvB,GAA4BpC,YAAY,CAAClsB,SAAb,CAAuBquB,WAAnD;;AAEAnC,YAAY,CAAClsB,SAAb,CAAuBuuB,eAAvB,GACI,SAASA,eAAT,CAAyB5pB,IAAzB,EAA+B+oB,QAA/B,EAAyC;AACvC,SAAOD,YAAY,CAAC,IAAD,EAAO9oB,IAAP,EAAa+oB,QAAb,EAAuB,IAAvB,CAAnB;AACD,CAHL;;AAKA,SAASc,WAAT,GAAuB;AACrB,MAAI9d,IAAI,GAAG,EAAX;;AACA,OAAK,IAAIoE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxU,SAAS,CAACd,MAA9B,EAAsCsV,CAAC,EAAvC,EAA2CpE,IAAI,CAAC7L,IAAL,CAAUvE,SAAS,CAACwU,CAAD,CAAnB;;AAC3C,MAAI,CAAC,KAAK2Z,KAAV,EAAiB;AACf,SAAKvc,MAAL,CAAYwc,cAAZ,CAA2B,KAAK/pB,IAAhC,EAAsC,KAAKgqB,MAA3C;AACA,SAAKF,KAAL,GAAa,IAAb;AACAjD,IAAAA,YAAY,CAAC,KAAKkC,QAAN,EAAgB,KAAKxb,MAArB,EAA6BxB,IAA7B,CAAZ;AACD;AACF;;AAED,SAASke,SAAT,CAAmB1c,MAAnB,EAA2BvN,IAA3B,EAAiC+oB,QAAjC,EAA2C;AACzC,MAAI7R,KAAK,GAAG;AAAE4S,IAAAA,KAAK,EAAE,KAAT;AAAgBE,IAAAA,MAAM,EAAElrB,SAAxB;AAAmCyO,IAAAA,MAAM,EAAEA,MAA3C;AAAmDvN,IAAAA,IAAI,EAAEA,IAAzD;AAA+D+oB,IAAAA,QAAQ,EAAEA;AAAzE,GAAZ;AACA,MAAImB,OAAO,GAAGL,WAAW,CAACjlB,IAAZ,CAAiBsS,KAAjB,CAAd;AACAgT,EAAAA,OAAO,CAACnB,QAAR,GAAmBA,QAAnB;AACA7R,EAAAA,KAAK,CAAC8S,MAAN,GAAeE,OAAf;AACA,SAAOA,OAAP;AACD;;AAED3C,YAAY,CAAClsB,SAAb,CAAuB8uB,IAAvB,GAA8B,SAASA,IAAT,CAAcnqB,IAAd,EAAoB+oB,QAApB,EAA8B;AAC1D,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAInW,SAAJ,CAAc,qEAAqE,OAAOmW,QAA1F,CAAN;AACD;;AACD,OAAKY,EAAL,CAAQ3pB,IAAR,EAAciqB,SAAS,CAAC,IAAD,EAAOjqB,IAAP,EAAa+oB,QAAb,CAAvB;AACA,SAAO,IAAP;AACD,CAND;;AAQAxB,YAAY,CAAClsB,SAAb,CAAuB+uB,mBAAvB,GACI,SAASA,mBAAT,CAA6BpqB,IAA7B,EAAmC+oB,QAAnC,EAA6C;AAC3C,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAInW,SAAJ,CAAc,qEAAqE,OAAOmW,QAA1F,CAAN;AACD;;AACD,OAAKa,eAAL,CAAqB5pB,IAArB,EAA2BiqB,SAAS,CAAC,IAAD,EAAOjqB,IAAP,EAAa+oB,QAAb,CAApC;AACA,SAAO,IAAP;AACD,CAPL,EASA;;;AACAxB,YAAY,CAAClsB,SAAb,CAAuB0uB,cAAvB,GACI,SAASA,cAAT,CAAwB/pB,IAAxB,EAA8B+oB,QAA9B,EAAwC;AACtC,MAAIsB,IAAJ,EAAU9B,MAAV,EAAkB+B,QAAlB,EAA4Bna,CAA5B,EAA+Boa,gBAA/B;;AAEA,MAAI,OAAOxB,QAAP,KAAoB,UAAxB,EAAoC;AAClC,UAAM,IAAInW,SAAJ,CAAc,qEAAqE,OAAOmW,QAA1F,CAAN;AACD;;AAEDR,EAAAA,MAAM,GAAG,KAAKd,OAAd;AACA,MAAIc,MAAM,KAAKzpB,SAAf,EACE,OAAO,IAAP;AAEFurB,EAAAA,IAAI,GAAG9B,MAAM,CAACvoB,IAAD,CAAb;AACA,MAAIqqB,IAAI,KAAKvrB,SAAb,EACE,OAAO,IAAP;;AAEF,MAAIurB,IAAI,KAAKtB,QAAT,IAAqBsB,IAAI,CAACtB,QAAL,KAAkBA,QAA3C,EAAqD;AACnD,QAAI,EAAE,KAAKrB,YAAP,KAAwB,CAA5B,EACE,KAAKD,OAAL,GAAetrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAf,CADF,KAEK;AACH,aAAOQ,MAAM,CAACvoB,IAAD,CAAb;AACA,UAAIuoB,MAAM,CAACwB,cAAX,EACE,KAAK1B,IAAL,CAAU,gBAAV,EAA4BroB,IAA5B,EAAkCqqB,IAAI,CAACtB,QAAL,IAAiBA,QAAnD;AACH;AACF,GARD,MAQO,IAAI,OAAOsB,IAAP,KAAgB,UAApB,EAAgC;AACrCC,IAAAA,QAAQ,GAAG,CAAC,CAAZ;;AAEA,SAAKna,CAAC,GAAGka,IAAI,CAACxvB,MAAL,GAAc,CAAvB,EAA0BsV,CAAC,IAAI,CAA/B,EAAkCA,CAAC,EAAnC,EAAuC;AACrC,UAAIka,IAAI,CAACla,CAAD,CAAJ,KAAY4Y,QAAZ,IAAwBsB,IAAI,CAACla,CAAD,CAAJ,CAAQ4Y,QAAR,KAAqBA,QAAjD,EAA2D;AACzDwB,QAAAA,gBAAgB,GAAGF,IAAI,CAACla,CAAD,CAAJ,CAAQ4Y,QAA3B;AACAuB,QAAAA,QAAQ,GAAGna,CAAX;AACA;AACD;AACF;;AAED,QAAIma,QAAQ,GAAG,CAAf,EACE,OAAO,IAAP;AAEF,QAAIA,QAAQ,KAAK,CAAjB,EACED,IAAI,CAACxT,KAAL,GADF,KAEK;AACH2T,MAAAA,SAAS,CAACH,IAAD,EAAOC,QAAP,CAAT;AACD;AAED,QAAID,IAAI,CAACxvB,MAAL,KAAgB,CAApB,EACE0tB,MAAM,CAACvoB,IAAD,CAAN,GAAeqqB,IAAI,CAAC,CAAD,CAAnB;AAEF,QAAI9B,MAAM,CAACwB,cAAP,KAA0BjrB,SAA9B,EACE,KAAKupB,IAAL,CAAU,gBAAV,EAA4BroB,IAA5B,EAAkCuqB,gBAAgB,IAAIxB,QAAtD;AACH;;AAED,SAAO,IAAP;AACD,CApDL;;AAsDAxB,YAAY,CAAClsB,SAAb,CAAuBovB,GAAvB,GAA6BlD,YAAY,CAAClsB,SAAb,CAAuB0uB,cAApD;;AAEAxC,YAAY,CAAClsB,SAAb,CAAuBqvB,kBAAvB,GACI,SAASA,kBAAT,CAA4B1qB,IAA5B,EAAkC;AAChC,MAAI4oB,SAAJ,EAAeL,MAAf,EAAuBpY,CAAvB;AAEAoY,EAAAA,MAAM,GAAG,KAAKd,OAAd;AACA,MAAIc,MAAM,KAAKzpB,SAAf,EACE,OAAO,IAAP,CAL8B,CAOhC;;AACA,MAAIypB,MAAM,CAACwB,cAAP,KAA0BjrB,SAA9B,EAAyC;AACvC,QAAInD,SAAS,CAACd,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,WAAK4sB,OAAL,GAAetrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAf;AACA,WAAKL,YAAL,GAAoB,CAApB;AACD,KAHD,MAGO,IAAIa,MAAM,CAACvoB,IAAD,CAAN,KAAiBlB,SAArB,EAAgC;AACrC,UAAI,EAAE,KAAK4oB,YAAP,KAAwB,CAA5B,EACE,KAAKD,OAAL,GAAetrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAf,CADF,KAGE,OAAOQ,MAAM,CAACvoB,IAAD,CAAb;AACH;;AACD,WAAO,IAAP;AACD,GAnB+B,CAqBhC;;;AACA,MAAIrE,SAAS,CAACd,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,QAAI0D,IAAI,GAAGpC,MAAM,CAACoC,IAAP,CAAYgqB,MAAZ,CAAX;AACA,QAAI7pB,GAAJ;;AACA,SAAKyR,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG5R,IAAI,CAAC1D,MAArB,EAA6B,EAAEsV,CAA/B,EAAkC;AAChCzR,MAAAA,GAAG,GAAGH,IAAI,CAAC4R,CAAD,CAAV;AACA,UAAIzR,GAAG,KAAK,gBAAZ,EAA8B;AAC9B,WAAKgsB,kBAAL,CAAwBhsB,GAAxB;AACD;;AACD,SAAKgsB,kBAAL,CAAwB,gBAAxB;AACA,SAAKjD,OAAL,GAAetrB,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAf;AACA,SAAKL,YAAL,GAAoB,CAApB;AACA,WAAO,IAAP;AACD;;AAEDkB,EAAAA,SAAS,GAAGL,MAAM,CAACvoB,IAAD,CAAlB;;AAEA,MAAI,OAAO4oB,SAAP,KAAqB,UAAzB,EAAqC;AACnC,SAAKmB,cAAL,CAAoB/pB,IAApB,EAA0B4oB,SAA1B;AACD,GAFD,MAEO,IAAIA,SAAS,KAAK9pB,SAAlB,EAA6B;AAClC;AACA,SAAKqR,CAAC,GAAGyY,SAAS,CAAC/tB,MAAV,GAAmB,CAA5B,EAA+BsV,CAAC,IAAI,CAApC,EAAuCA,CAAC,EAAxC,EAA4C;AAC1C,WAAK4Z,cAAL,CAAoB/pB,IAApB,EAA0B4oB,SAAS,CAACzY,CAAD,CAAnC;AACD;AACF;;AAED,SAAO,IAAP;AACD,CAjDL;;AAmDA,SAASwa,UAAT,CAAoBpd,MAApB,EAA4BvN,IAA5B,EAAkC4qB,MAAlC,EAA0C;AACxC,MAAIrC,MAAM,GAAGhb,MAAM,CAACka,OAApB;AAEA,MAAIc,MAAM,KAAKzpB,SAAf,EACE,OAAO,EAAP;AAEF,MAAI+rB,UAAU,GAAGtC,MAAM,CAACvoB,IAAD,CAAvB;AACA,MAAI6qB,UAAU,KAAK/rB,SAAnB,EACE,OAAO,EAAP;AAEF,MAAI,OAAO+rB,UAAP,KAAsB,UAA1B,EACE,OAAOD,MAAM,GAAG,CAACC,UAAU,CAAC9B,QAAX,IAAuB8B,UAAxB,CAAH,GAAyC,CAACA,UAAD,CAAtD;AAEF,SAAOD,MAAM,GACXE,eAAe,CAACD,UAAD,CADJ,GACmBhC,UAAU,CAACgC,UAAD,EAAaA,UAAU,CAAChwB,MAAxB,CAD1C;AAED;;AAED0sB,YAAY,CAAClsB,SAAb,CAAuButB,SAAvB,GAAmC,SAASA,SAAT,CAAmB5oB,IAAnB,EAAyB;AAC1D,SAAO2qB,UAAU,CAAC,IAAD,EAAO3qB,IAAP,EAAa,IAAb,CAAjB;AACD,CAFD;;AAIAunB,YAAY,CAAClsB,SAAb,CAAuB0vB,YAAvB,GAAsC,SAASA,YAAT,CAAsB/qB,IAAtB,EAA4B;AAChE,SAAO2qB,UAAU,CAAC,IAAD,EAAO3qB,IAAP,EAAa,KAAb,CAAjB;AACD,CAFD;;AAIAunB,YAAY,CAACyD,aAAb,GAA6B,UAASxB,OAAT,EAAkBxpB,IAAlB,EAAwB;AACnD,MAAI,OAAOwpB,OAAO,CAACwB,aAAf,KAAiC,UAArC,EAAiD;AAC/C,WAAOxB,OAAO,CAACwB,aAAR,CAAsBhrB,IAAtB,CAAP;AACD,GAFD,MAEO;AACL,WAAOgrB,aAAa,CAAC5sB,IAAd,CAAmBorB,OAAnB,EAA4BxpB,IAA5B,CAAP;AACD;AACF,CAND;;AAQAunB,YAAY,CAAClsB,SAAb,CAAuB2vB,aAAvB,GAAuCA,aAAvC;;AACA,SAASA,aAAT,CAAuBhrB,IAAvB,EAA6B;AAC3B,MAAIuoB,MAAM,GAAG,KAAKd,OAAlB;;AAEA,MAAIc,MAAM,KAAKzpB,SAAf,EAA0B;AACxB,QAAI+rB,UAAU,GAAGtC,MAAM,CAACvoB,IAAD,CAAvB;;AAEA,QAAI,OAAO6qB,UAAP,KAAsB,UAA1B,EAAsC;AACpC,aAAO,CAAP;AACD,KAFD,MAEO,IAAIA,UAAU,KAAK/rB,SAAnB,EAA8B;AACnC,aAAO+rB,UAAU,CAAChwB,MAAlB;AACD;AACF;;AAED,SAAO,CAAP;AACD;;AAED0sB,YAAY,CAAClsB,SAAb,CAAuB4vB,UAAvB,GAAoC,SAASA,UAAT,GAAsB;AACxD,SAAO,KAAKvD,YAAL,GAAoB,CAApB,GAAwBX,cAAc,CAAC,KAAKU,OAAN,CAAtC,GAAuD,EAA9D;AACD,CAFD;;AAIA,SAASoB,UAAT,CAAoBqC,GAApB,EAAyBjD,CAAzB,EAA4B;AAC1B,MAAIkD,IAAI,GAAG,IAAIC,KAAJ,CAAUnD,CAAV,CAAX;;AACA,OAAK,IAAI9X,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8X,CAApB,EAAuB,EAAE9X,CAAzB,EACEgb,IAAI,CAAChb,CAAD,CAAJ,GAAU+a,GAAG,CAAC/a,CAAD,CAAb;;AACF,SAAOgb,IAAP;AACD;;AAED,SAASX,SAAT,CAAmBH,IAAnB,EAAyB5I,KAAzB,EAAgC;AAC9B,SAAOA,KAAK,GAAG,CAAR,GAAY4I,IAAI,CAACxvB,MAAxB,EAAgC4mB,KAAK,EAArC,EACE4I,IAAI,CAAC5I,KAAD,CAAJ,GAAc4I,IAAI,CAAC5I,KAAK,GAAG,CAAT,CAAlB;;AACF4I,EAAAA,IAAI,CAACgB,GAAL;AACD;;AAED,SAASP,eAAT,CAAyBI,GAAzB,EAA8B;AAC5B,MAAII,GAAG,GAAG,IAAIF,KAAJ,CAAUF,GAAG,CAACrwB,MAAd,CAAV;;AACA,OAAK,IAAIsV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGmb,GAAG,CAACzwB,MAAxB,EAAgC,EAAEsV,CAAlC,EAAqC;AACnCmb,IAAAA,GAAG,CAACnb,CAAD,CAAH,GAAS+a,GAAG,CAAC/a,CAAD,CAAH,CAAO4Y,QAAP,IAAmBmC,GAAG,CAAC/a,CAAD,CAA/B;AACD;;AACD,SAAOmb,GAAP;AACD;;;AC/bD;AACA,IAAIC,OAAO,GAAGzY,MAAM,CAACC,OAAP,GAAiB,EAA/B,EAEA;AACA;AACA;AACA;;AAEA,IAAIyY,gBAAJ;AACA,IAAIC,kBAAJ;;AAEA,SAASC,gBAAT,GAA4B;AACxB,QAAM,IAAI/uB,KAAJ,CAAU,iCAAV,CAAN;AACH;;AACD,SAASgvB,mBAAT,GAAgC;AAC5B,QAAM,IAAIhvB,KAAJ,CAAU,mCAAV,CAAN;AACH;;AACA,aAAY;AACT,MAAI;AACA,QAAI,OAAOyW,UAAP,KAAsB,UAA1B,EAAsC;AAClCoY,MAAAA,gBAAgB,GAAGpY,UAAnB;AACH,KAFD,MAEO;AACHoY,MAAAA,gBAAgB,GAAGE,gBAAnB;AACH;AACJ,GAND,CAME,OAAO7vB,CAAP,EAAU;AACR2vB,IAAAA,gBAAgB,GAAGE,gBAAnB;AACH;;AACD,MAAI;AACA,QAAI,OAAOE,YAAP,KAAwB,UAA5B,EAAwC;AACpCH,MAAAA,kBAAkB,GAAGG,YAArB;AACH,KAFD,MAEO;AACHH,MAAAA,kBAAkB,GAAGE,mBAArB;AACH;AACJ,GAND,CAME,OAAO9vB,CAAP,EAAU;AACR4vB,IAAAA,kBAAkB,GAAGE,mBAArB;AACH;AACJ,CAnBA,GAAD;;AAoBA,SAASE,UAAT,CAAoBC,GAApB,EAAyB;AACrB,MAAIN,gBAAgB,KAAKpY,UAAzB,EAAqC;AACjC;AACA,WAAOA,UAAU,CAAC0Y,GAAD,EAAM,CAAN,CAAjB;AACH,GAJoB,CAKrB;;;AACA,MAAI,CAACN,gBAAgB,KAAKE,gBAArB,IAAyC,CAACF,gBAA3C,KAAgEpY,UAApE,EAAgF;AAC5EoY,IAAAA,gBAAgB,GAAGpY,UAAnB;AACA,WAAOA,UAAU,CAAC0Y,GAAD,EAAM,CAAN,CAAjB;AACH;;AACD,MAAI;AACA;AACA,WAAON,gBAAgB,CAACM,GAAD,EAAM,CAAN,CAAvB;AACH,GAHD,CAGE,OAAMjwB,CAAN,EAAQ;AACN,QAAI;AACA;AACA,aAAO2vB,gBAAgB,CAACptB,IAAjB,CAAsB,IAAtB,EAA4B0tB,GAA5B,EAAiC,CAAjC,CAAP;AACH,KAHD,CAGE,OAAMjwB,CAAN,EAAQ;AACN;AACA,aAAO2vB,gBAAgB,CAACptB,IAAjB,CAAsB,IAAtB,EAA4B0tB,GAA5B,EAAiC,CAAjC,CAAP;AACH;AACJ;AAGJ;;AACD,SAASC,eAAT,CAAyBC,MAAzB,EAAiC;AAC7B,MAAIP,kBAAkB,KAAKG,YAA3B,EAAyC;AACrC;AACA,WAAOA,YAAY,CAACI,MAAD,CAAnB;AACH,GAJ4B,CAK7B;;;AACA,MAAI,CAACP,kBAAkB,KAAKE,mBAAvB,IAA8C,CAACF,kBAAhD,KAAuEG,YAA3E,EAAyF;AACrFH,IAAAA,kBAAkB,GAAGG,YAArB;AACA,WAAOA,YAAY,CAACI,MAAD,CAAnB;AACH;;AACD,MAAI;AACA;AACA,WAAOP,kBAAkB,CAACO,MAAD,CAAzB;AACH,GAHD,CAGE,OAAOnwB,CAAP,EAAS;AACP,QAAI;AACA;AACA,aAAO4vB,kBAAkB,CAACrtB,IAAnB,CAAwB,IAAxB,EAA8B4tB,MAA9B,CAAP;AACH,KAHD,CAGE,OAAOnwB,CAAP,EAAS;AACP;AACA;AACA,aAAO4vB,kBAAkB,CAACrtB,IAAnB,CAAwB,IAAxB,EAA8B4tB,MAA9B,CAAP;AACH;AACJ;AAIJ;;AACD,IAAIC,KAAK,GAAG,EAAZ;AACA,IAAIC,QAAQ,GAAG,KAAf;AACA,IAAIC,YAAJ;AACA,IAAIC,UAAU,GAAG,CAAC,CAAlB;;AAEA,SAASC,eAAT,GAA2B;AACvB,MAAI,CAACH,QAAD,IAAa,CAACC,YAAlB,EAAgC;AAC5B;AACH;;AACDD,EAAAA,QAAQ,GAAG,KAAX;;AACA,MAAIC,YAAY,CAACtxB,MAAjB,EAAyB;AACrBoxB,IAAAA,KAAK,GAAGE,YAAY,CAACxqB,MAAb,CAAoBsqB,KAApB,CAAR;AACH,GAFD,MAEO;AACHG,IAAAA,UAAU,GAAG,CAAC,CAAd;AACH;;AACD,MAAIH,KAAK,CAACpxB,MAAV,EAAkB;AACdyxB,IAAAA,UAAU;AACb;AACJ;;AAED,SAASA,UAAT,GAAsB;AAClB,MAAIJ,QAAJ,EAAc;AACV;AACH;;AACD,MAAIK,OAAO,GAAGV,UAAU,CAACQ,eAAD,CAAxB;AACAH,EAAAA,QAAQ,GAAG,IAAX;AAEA,MAAIvD,GAAG,GAAGsD,KAAK,CAACpxB,MAAhB;;AACA,SAAM8tB,GAAN,EAAW;AACPwD,IAAAA,YAAY,GAAGF,KAAf;AACAA,IAAAA,KAAK,GAAG,EAAR;;AACA,WAAO,EAAEG,UAAF,GAAezD,GAAtB,EAA2B;AACvB,UAAIwD,YAAJ,EAAkB;AACdA,QAAAA,YAAY,CAACC,UAAD,CAAZ,CAAyBI,GAAzB;AACH;AACJ;;AACDJ,IAAAA,UAAU,GAAG,CAAC,CAAd;AACAzD,IAAAA,GAAG,GAAGsD,KAAK,CAACpxB,MAAZ;AACH;;AACDsxB,EAAAA,YAAY,GAAG,IAAf;AACAD,EAAAA,QAAQ,GAAG,KAAX;AACAH,EAAAA,eAAe,CAACQ,OAAD,CAAf;AACH;;AAEDhB,OAAO,CAACkB,QAAR,GAAmB,UAAUX,GAAV,EAAe;AAC9B,MAAI/f,IAAI,GAAG,IAAIqf,KAAJ,CAAUzvB,SAAS,CAACd,MAAV,GAAmB,CAA7B,CAAX;;AACA,MAAIc,SAAS,CAACd,MAAV,GAAmB,CAAvB,EAA0B;AACtB,SAAK,IAAIsV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGxU,SAAS,CAACd,MAA9B,EAAsCsV,CAAC,EAAvC,EAA2C;AACvCpE,MAAAA,IAAI,CAACoE,CAAC,GAAG,CAAL,CAAJ,GAAcxU,SAAS,CAACwU,CAAD,CAAvB;AACH;AACJ;;AACD8b,EAAAA,KAAK,CAAC/rB,IAAN,CAAW,IAAIwsB,IAAJ,CAASZ,GAAT,EAAc/f,IAAd,CAAX;;AACA,MAAIkgB,KAAK,CAACpxB,MAAN,KAAiB,CAAjB,IAAsB,CAACqxB,QAA3B,EAAqC;AACjCL,IAAAA,UAAU,CAACS,UAAD,CAAV;AACH;AACJ,CAXD,EAaA;;;AACA,SAASI,IAAT,CAAcZ,GAAd,EAAmBa,KAAnB,EAA0B;AACtB,OAAKb,GAAL,GAAWA,GAAX;AACA,OAAKa,KAAL,GAAaA,KAAb;AACH;;AACDD,IAAI,CAACrxB,SAAL,CAAemxB,GAAf,GAAqB,YAAY;AAC7B,OAAKV,GAAL,CAASpwB,KAAT,CAAe,IAAf,EAAqB,KAAKixB,KAA1B;AACH,CAFD;;AAGApB,OAAO,CAACqB,KAAR,GAAgB,SAAhB;AAEArB,OAAO,CAACsB,GAAR,GAAc,EAAd;AACAtB,OAAO,CAACuB,IAAR,GAAe,EAAf;AACAvB,OAAO,CAAChuB,OAAR,GAAkB,EAAlB,EAAsB;;AACtBguB,OAAO,CAACwB,QAAR,GAAmB,EAAnB;;AAEA,SAASC,IAAT,GAAgB,CAAE;;AAElBzB,OAAO,CAAC5B,EAAR,GAAaqD,IAAb;AACAzB,OAAO,CAAC7B,WAAR,GAAsBsD,IAAtB;AACAzB,OAAO,CAACpB,IAAR,GAAe6C,IAAf;AACAzB,OAAO,CAACd,GAAR,GAAcuC,IAAd;AACAzB,OAAO,CAACxB,cAAR,GAAyBiD,IAAzB;AACAzB,OAAO,CAACb,kBAAR,GAA6BsC,IAA7B;AACAzB,OAAO,CAAClD,IAAR,GAAe2E,IAAf;AACAzB,OAAO,CAAC3B,eAAR,GAA0BoD,IAA1B;AACAzB,OAAO,CAACnB,mBAAR,GAA8B4C,IAA9B;;AAEAzB,OAAO,CAAC3C,SAAR,GAAoB,UAAUrpB,IAAV,EAAgB;AAAE,SAAO,EAAP;AAAW,CAAjD;;AAEAgsB,OAAO,CAAC0B,OAAR,GAAkB,UAAU1tB,IAAV,EAAgB;AAC9B,QAAM,IAAI5C,KAAJ,CAAU,kCAAV,CAAN;AACH,CAFD;;AAIA4uB,OAAO,CAAC2B,GAAR,GAAc,YAAY;AAAE,SAAO,GAAP;AAAY,CAAxC;;AACA3B,OAAO,CAAC4B,KAAR,GAAgB,UAAUC,GAAV,EAAe;AAC3B,QAAM,IAAIzwB,KAAJ,CAAU,gCAAV,CAAN;AACH,CAFD;;AAGA4uB,OAAO,CAAC8B,KAAR,GAAgB,YAAW;AAAE,SAAO,CAAP;AAAW,CAAxC;;;;;;;;;;;ACvLA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;AAEA,SAASC,MAAT,CAAgB5uB,GAAhB,EAAqB;AACnB,SAAO,MAAMA,GAAb;AACD;;AACD,SAAS6uB,QAAT,CAAkB7uB,GAAlB,EAAuB;AACrB,SAAOA,GAAG,CAAC8uB,SAAJ,CAAc,CAAd,CAAP;AACD;;AACD,SAASC,KAAT,GAAiB;AACf,OAAKC,MAAL,GAAc,EAAd;AACD;;AACDD,KAAK,CAACpyB,SAAN,CAAgBgB,GAAhB,GAAsB,UAAUqC,GAAV,EAAe;AACnC,MAAIivB,OAAO,GAAGL,MAAM,CAAC5uB,GAAD,CAApB;AACA,SAAO,KAAKgvB,MAAL,CAAYC,OAAZ,CAAP;AACD,CAHD;;AAIAF,KAAK,CAACpyB,SAAN,CAAgBiB,GAAhB,GAAsB,UAAUoC,GAAV,EAAeE,KAAf,EAAsB;AAC1C,MAAI+uB,OAAO,GAAGL,MAAM,CAAC5uB,GAAD,CAApB;AACA,OAAKgvB,MAAL,CAAYC,OAAZ,IAAuB/uB,KAAvB;AACA,SAAO,IAAP;AACD,CAJD;;AAKA6uB,KAAK,CAACpyB,SAAN,CAAgB+D,GAAhB,GAAsB,UAAUV,GAAV,EAAe;AACnC,MAAIivB,OAAO,GAAGL,MAAM,CAAC5uB,GAAD,CAApB;AACA,SAAOivB,OAAO,IAAI,KAAKD,MAAvB;AACD,CAHD;;AAIAD,KAAK,CAACpyB,SAAN,CAAgBuyB,MAAhB,GAAyB,UAAUlvB,GAAV,EAAe;AACtC,MAAIivB,OAAO,GAAGL,MAAM,CAAC5uB,GAAD,CAApB;AACA,MAAImvB,GAAG,GAAGF,OAAO,IAAI,KAAKD,MAA1B;AACA,SAAO,KAAKA,MAAL,CAAYC,OAAZ,CAAP;AACA,SAAOE,GAAP;AACD,CALD;;AAMAJ,KAAK,CAACpyB,SAAN,CAAgBiE,OAAhB,GAA0B,UAAU7D,EAAV,EAAc;AACtC,MAAI8C,IAAI,GAAGpC,MAAM,CAACoC,IAAP,CAAY,KAAKmvB,MAAjB,CAAX;;AACA,OAAK,IAAIvd,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGpqB,IAAI,CAAC1D,MAA3B,EAAmCsV,CAAC,GAAGwY,GAAvC,EAA4CxY,CAAC,EAA7C,EAAiD;AAC/C,QAAIzR,GAAG,GAAGH,IAAI,CAAC4R,CAAD,CAAd;AACA,QAAIvR,KAAK,GAAG,KAAK8uB,MAAL,CAAYhvB,GAAZ,CAAZ;AACAA,IAAAA,GAAG,GAAG6uB,QAAQ,CAAC7uB,GAAD,CAAd;AACAjD,IAAAA,EAAE,CAACmD,KAAD,EAAQF,GAAR,CAAF;AACD;AACF,CARD;;AASAvC,MAAM,CAACC,cAAP,CAAsBqxB,KAAK,CAACpyB,SAA5B,EAAuC,MAAvC,EAA+C;AAC7CgB,EAAAA,GAAG,EAAE,YAAY;AACf,WAAOF,MAAM,CAACoC,IAAP,CAAY,KAAKmvB,MAAjB,EAAyB7yB,MAAhC;AACD;AAH4C,CAA/C;;AAMA,SAASizB,KAAT,CAAenB,KAAf,EAAsB;AACpB,OAAKe,MAAL,GAAc,IAAID,KAAJ,EAAd,CADoB,CAGpB;;AACA,MAAId,KAAK,IAAIvB,KAAK,CAAC2C,OAAN,CAAcpB,KAAd,CAAb,EAAmC;AACjC,SAAK,IAAIxc,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGgE,KAAK,CAAC9xB,MAA5B,EAAoCsV,CAAC,GAAGwY,GAAxC,EAA6CxY,CAAC,EAA9C,EAAkD;AAChD,WAAK6d,GAAL,CAASrB,KAAK,CAACxc,CAAD,CAAd;AACD;AACF;AACF;;AACD2d,KAAK,CAACzyB,SAAN,CAAgB2yB,GAAhB,GAAsB,UAAUtvB,GAAV,EAAe;AACnC,SAAO,KAAKgvB,MAAL,CAAYpxB,GAAZ,CAAgBoC,GAAhB,EAAqB,IAArB,CAAP;AACD,CAFD;;AAGAovB,KAAK,CAACzyB,SAAN,CAAgB+D,GAAhB,GAAsB,UAAUV,GAAV,EAAe;AACnC,SAAO,KAAKgvB,MAAL,CAAYtuB,GAAZ,CAAgBV,GAAhB,CAAP;AACD,CAFD;;AAGAovB,KAAK,CAACzyB,SAAN,CAAgBiE,OAAhB,GAA0B,UAAU7D,EAAV,EAAc;AACtC,OAAKiyB,MAAL,CAAYpuB,OAAZ,CAAoB,UAAUV,KAAV,EAAiBF,GAAjB,EAAsB;AACxCjD,IAAAA,EAAE,CAACiD,GAAD,CAAF;AACD,GAFD;AAGD,CAJD;;AAKAvC,MAAM,CAACC,cAAP,CAAsB0xB,KAAK,CAACzyB,SAA5B,EAAuC,MAAvC,EAA+C;AAC7CgB,EAAAA,GAAG,EAAE,YAAY;AACf,WAAO,KAAKqxB,MAAL,CAAYvI,IAAnB;AACD;AAH4C,CAA/C;AAMA;AACA;AACA;AACA;;AACA,SAAS8I,iBAAT,GAA6B;AAC3B,MAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiC,OAAOpuB,GAAP,KAAe,WAAhD,IAA+D,OAAOquB,GAAP,KAAe,WAAlF,EAA+F;AAC7F,WAAO,KAAP;AACD;;AACD,MAAIC,IAAI,GAAGjyB,MAAM,CAAC4Q,wBAAP,CAAgCjN,GAAhC,EAAqCouB,MAAM,CAACG,OAA5C,CAAX;AACA,SAAOD,IAAI,IAAI,SAASA,IAAjB,IAAyBtuB,GAAG,CAACouB,MAAM,CAACG,OAAR,CAAH,KAAwBvuB,GAAxD;AACD,EAED;;;AAEA,IAAIwuB,WAAJ;AACA,IAAIC,WAAJ;AAEA;AACE,MAAIN,iBAAiB,EAArB,EAAyB;AAAE;AACzBK,IAAAA,WAAW,GAAGH,GAAd;AACAI,IAAAA,WAAW,GAAGzuB,GAAd;AACD,GAHD,MAGO;AAAE;AACPwuB,IAAAA,WAAW,GAAGR,KAAd;AACAS,IAAAA,WAAW,GAAGd,KAAd;AACD;AACF;;AAED,SAASe,cAAT,CAAwBC,MAAxB,EAAgC;AAC9B,SAAQ,OAAOC,WAAP,KAAuB,WAAvB,IAAsCD,MAAM,YAAYC,WAAzD,IACJ,OAAOC,IAAP,KAAgB,WAAhB,IAA+BF,MAAM,YAAYE,IADpD;AAED;;AAED,SAASC,gBAAT,CAA0BC,IAA1B,EAAgC;AAC9B,MAAI,OAAOA,IAAI,CAACttB,KAAZ,KAAsB,UAA1B,EAAsC;AACpC,WAAOstB,IAAI,CAACttB,KAAL,CAAW,CAAX,CAAP;AACD,GAH6B,CAI9B;;;AACA,MAAIgM,MAAM,GAAG,IAAImhB,WAAJ,CAAgBG,IAAI,CAACzJ,UAArB,CAAb;AACA,MAAI0J,WAAW,GAAG,IAAIC,UAAJ,CAAexhB,MAAf,CAAlB;AACA,MAAIyhB,WAAW,GAAG,IAAID,UAAJ,CAAeF,IAAf,CAAlB;AACAC,EAAAA,WAAW,CAACxyB,GAAZ,CAAgB0yB,WAAhB;AACA,SAAOzhB,MAAP;AACD;;AAED,SAAS0hB,iBAAT,CAA2BR,MAA3B,EAAmC;AACjC,MAAIA,MAAM,YAAYC,WAAtB,EAAmC;AACjC,WAAOE,gBAAgB,CAACH,MAAD,CAAvB;AACD;;AACD,MAAItJ,IAAI,GAAGsJ,MAAM,CAACtJ,IAAlB;AACA,MAAInlB,IAAI,GAAGyuB,MAAM,CAACzuB,IAAlB,CALiC,CAMjC;;AACA,MAAI,OAAOyuB,MAAM,CAACltB,KAAd,KAAwB,UAA5B,EAAwC;AACtC,WAAOktB,MAAM,CAACltB,KAAP,CAAa,CAAb,EAAgB4jB,IAAhB,EAAsBnlB,IAAtB,CAAP;AACD,GATgC,CAUjC;;;AACA,SAAOyuB,MAAM,CAACS,WAAP,CAAmB,CAAnB,EAAsB/J,IAAtB,EAA4BnlB,IAA5B,CAAP;AACD,EAED;AACA;AACA;;;AAEA,IAAImvB,YAAY,GAAGrI,QAAQ,CAACzrB,SAAT,CAAmB8C,QAAtC;AACA,IAAIixB,gBAAgB,GAAGD,YAAY,CAAC/wB,IAAb,CAAkBjC,MAAlB,CAAvB;;AAEA,SAASkzB,aAAT,CAAuBzwB,KAAvB,EAA8B;AAC5B,MAAIxD,KAAK,GAAGe,MAAM,CAAC2rB,cAAP,CAAsBlpB,KAAtB,CAAZ;AACA;;AACA,MAAIxD,KAAK,KAAK,IAAd,EAAoB;AAAE;AACpB,WAAO,IAAP;AACD;;AACD,MAAIk0B,IAAI,GAAGl0B,KAAK,CAACm0B,WAAjB;AACA,SAAQ,OAAOD,IAAP,IAAe,UAAf,IACNA,IAAI,YAAYA,IADV,IACkBH,YAAY,CAAC/wB,IAAb,CAAkBkxB,IAAlB,KAA2BF,gBADrD;AAED;;AAED,SAAS5Y,KAAT,CAAeiY,MAAf,EAAuB;AACrB,MAAIe,SAAJ;AACA,MAAIrf,CAAJ;AACA,MAAIwY,GAAJ;;AAEA,MAAI,CAAC8F,MAAD,IAAW,OAAOA,MAAP,KAAkB,QAAjC,EAA2C;AACzC,WAAOA,MAAP;AACD;;AAED,MAAIrD,KAAK,CAAC2C,OAAN,CAAcU,MAAd,CAAJ,EAA2B;AACzBe,IAAAA,SAAS,GAAG,EAAZ;;AACA,SAAKrf,CAAC,GAAG,CAAJ,EAAOwY,GAAG,GAAG8F,MAAM,CAAC5zB,MAAzB,EAAiCsV,CAAC,GAAGwY,GAArC,EAA0CxY,CAAC,EAA3C,EAA+C;AAC7Cqf,MAAAA,SAAS,CAACrf,CAAD,CAAT,GAAeqG,KAAK,CAACiY,MAAM,CAACte,CAAD,CAAP,CAApB;AACD;;AACD,WAAOqf,SAAP;AACD,GAfoB,CAiBrB;AACA;;;AACA,MAAIf,MAAM,YAAYgB,IAAtB,EAA4B;AAC1B,WAAOhB,MAAM,CAACiB,WAAP,EAAP;AACD;;AAED,MAAIlB,cAAc,CAACC,MAAD,CAAlB,EAA4B;AAC1B,WAAOQ,iBAAiB,CAACR,MAAD,CAAxB;AACD;;AAED,MAAI,CAACY,aAAa,CAACZ,MAAD,CAAlB,EAA4B;AAC1B,WAAOA,MAAP,CAD0B,CACX;AAChB;;AAEDe,EAAAA,SAAS,GAAG,EAAZ;;AACA,OAAKrf,CAAL,IAAUse,MAAV,EAAkB;AAChB;AACA,QAAItyB,MAAM,CAACd,SAAP,CAAiBwnB,cAAjB,CAAgCzkB,IAAhC,CAAqCqwB,MAArC,EAA6Cte,CAA7C,CAAJ,EAAqD;AACnD,UAAIvR,KAAK,GAAG4X,KAAK,CAACiY,MAAM,CAACte,CAAD,CAAP,CAAjB;;AACA,UAAI,OAAOvR,KAAP,KAAiB,WAArB,EAAkC;AAChC4wB,QAAAA,SAAS,CAACrf,CAAD,CAAT,GAAevR,KAAf;AACD;AACF;AACF;;AACD,SAAO4wB,SAAP;AACD;;AAED,SAASrF,IAAT,CAAc2B,GAAd,EAAmB;AACjB,MAAI6D,MAAM,GAAG,KAAb;AACA,SAAO,wBAAa,UAAU5jB,IAAV,EAAgB;AAClC;AACA,QAAI4jB,MAAJ,EAAY;AACV;AACA,YAAM,IAAIhzB,KAAJ,CAAU,4BAAV,CAAN;AACD,KAHD,MAGO;AACLgzB,MAAAA,MAAM,GAAG,IAAT;AACA7D,MAAAA,GAAG,CAACpwB,KAAJ,CAAU,IAAV,EAAgBqQ,IAAhB;AACD;AACF,GATM,CAAP;AAUD;;AAED,SAAS6jB,SAAT,CAAmB9tB,IAAnB,EAAyB;AACvB;AACA,SAAO,wBAAa,UAAUiK,IAAV,EAAgB;AAClC;AACAA,IAAAA,IAAI,GAAGyK,KAAK,CAACzK,IAAD,CAAZ;AACA,QAAI8jB,IAAI,GAAG,IAAX,CAHkC,CAIlC;;AACA,QAAIC,MAAM,GAAI,OAAO/jB,IAAI,CAACA,IAAI,CAAClR,MAAL,GAAc,CAAf,CAAX,KAAiC,UAAlC,GAAgDkR,IAAI,CAACsf,GAAL,EAAhD,GAA6D,KAA1E;AACA,QAAIlJ,OAAO,GAAG,IAAI9c,OAAJ,CAAY,UAAU0qB,OAAV,EAAmBzqB,MAAnB,EAA2B;AACnD,UAAI0qB,IAAJ;;AACA,UAAI;AACF,YAAIC,QAAQ,GAAG9F,IAAI,CAAC,UAAUzf,GAAV,EAAewlB,IAAf,EAAqB;AACvC,cAAIxlB,GAAJ,EAAS;AACPpF,YAAAA,MAAM,CAACoF,GAAD,CAAN;AACD,WAFD,MAEO;AACLqlB,YAAAA,OAAO,CAACG,IAAD,CAAP;AACD;AACF,SANkB,CAAnB,CADE,CAQF;AACA;;AACAnkB,QAAAA,IAAI,CAAC7L,IAAL,CAAU+vB,QAAV;AACAD,QAAAA,IAAI,GAAGluB,IAAI,CAACpG,KAAL,CAAWm0B,IAAX,EAAiB9jB,IAAjB,CAAP;;AACA,YAAIikB,IAAI,IAAI,OAAOA,IAAI,CAACltB,IAAZ,KAAqB,UAAjC,EAA6C;AAC3CitB,UAAAA,OAAO,CAACC,IAAD,CAAP;AACD;AACF,OAfD,CAeE,OAAOn0B,CAAP,EAAU;AACVyJ,QAAAA,MAAM,CAACzJ,CAAD,CAAN;AACD;AACF,KApBa,CAAd,CANkC,CA2BlC;;AACA,QAAIi0B,MAAJ,EAAY;AACV3N,MAAAA,OAAO,CAACrf,IAAR,CAAa,UAAUzF,MAAV,EAAkB;AAC7ByyB,QAAAA,MAAM,CAAC,IAAD,EAAOzyB,MAAP,CAAN;AACD,OAFD,EAEGyyB,MAFH;AAGD;;AACD,WAAO3N,OAAP;AACD,GAlCM,CAAP;AAmCD;;AAED,SAASgO,UAAT,CAAoBN,IAApB,EAA0BtwB,IAA1B,EAAgCwM,IAAhC,EAAsC;AACpC;AACA,MAAI8jB,IAAI,CAACN,WAAL,CAAiB3G,SAAjB,CAA2B,OAA3B,EAAoC/tB,MAAxC,EAAgD;AAC9C,QAAIu1B,OAAO,GAAG,CAAC,KAAD,EAAQP,IAAI,CAACtwB,IAAb,EAAmBA,IAAnB,CAAd;;AACA,SAAK,IAAI4Q,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpE,IAAI,CAAClR,MAAL,GAAc,CAAlC,EAAqCsV,CAAC,EAAtC,EAA0C;AACxCigB,MAAAA,OAAO,CAAClwB,IAAR,CAAa6L,IAAI,CAACoE,CAAD,CAAjB;AACD;;AACD0f,IAAAA,IAAI,CAACN,WAAL,CAAiBlH,IAAjB,CAAsB,OAAtB,EAA+B+H,OAA/B,EAL8C,CAO9C;;AACA,QAAIC,YAAY,GAAGtkB,IAAI,CAACA,IAAI,CAAClR,MAAL,GAAc,CAAf,CAAvB;;AACAkR,IAAAA,IAAI,CAACA,IAAI,CAAClR,MAAL,GAAc,CAAf,CAAJ,GAAwB,UAAU6P,GAAV,EAAemjB,GAAf,EAAoB;AAC1C,UAAIyC,YAAY,GAAG,CAAC,KAAD,EAAQT,IAAI,CAACtwB,IAAb,EAAmBA,IAAnB,CAAnB;AACA+wB,MAAAA,YAAY,GAAGA,YAAY,CAAC3uB,MAAb,CACb+I,GAAG,GAAG,CAAC,OAAD,EAAUA,GAAV,CAAH,GAAoB,CAAC,SAAD,EAAYmjB,GAAZ,CADV,CAAf;AAGAgC,MAAAA,IAAI,CAACN,WAAL,CAAiBlH,IAAjB,CAAsB,OAAtB,EAA+BiI,YAA/B;AACAD,MAAAA,YAAY,CAAC3lB,GAAD,EAAMmjB,GAAN,CAAZ;AACD,KAPD;AAQD;AACF;;AAED,SAAS0C,UAAT,CAAoBhxB,IAApB,EAA0B0wB,QAA1B,EAAoC;AAClC,SAAOL,SAAS,CAAC,wBAAa,UAAU7jB,IAAV,EAAgB;AAC5C,QAAI,KAAKykB,OAAT,EAAkB;AAChB,aAAOnrB,OAAO,CAACC,MAAR,CAAe,IAAI3I,KAAJ,CAAU,oBAAV,CAAf,CAAP;AACD;;AACD,QAAI,KAAK8zB,UAAT,EAAqB;AACnB,aAAOprB,OAAO,CAACC,MAAR,CAAe,IAAI3I,KAAJ,CAAU,uBAAV,CAAf,CAAP;AACD;;AACD,QAAIkzB,IAAI,GAAG,IAAX;AACAM,IAAAA,UAAU,CAACN,IAAD,EAAOtwB,IAAP,EAAawM,IAAb,CAAV;;AACA,QAAI,CAAC,KAAK2kB,SAAL,CAAeC,OAApB,EAA6B;AAC3B,aAAO,IAAItrB,OAAJ,CAAY,UAAU0qB,OAAV,EAAmBzqB,MAAnB,EAA2B;AAC5CuqB,QAAAA,IAAI,CAACa,SAAL,CAAeE,OAAf,CAAuB,UAAUnU,MAAV,EAAkB;AACvC,cAAIA,MAAJ,EAAY;AACVnX,YAAAA,MAAM,CAACmX,MAAD,CAAN;AACD,WAFD,MAEO;AACLsT,YAAAA,OAAO,CAACF,IAAI,CAACtwB,IAAD,CAAJ,CAAW7D,KAAX,CAAiBm0B,IAAjB,EAAuB9jB,IAAvB,CAAD,CAAP;AACD;AACF,SAND;AAOD,OARM,CAAP;AASD;;AACD,WAAOkkB,QAAQ,CAACv0B,KAAT,CAAe,IAAf,EAAqBqQ,IAArB,CAAP;AACD,GArBgB,CAAD,CAAhB;AAsBD,EAED;;;AACA,SAAS8kB,IAAT,CAAczuB,GAAd,EAAmB8oB,GAAnB,EAAwB;AACtB,MAAI2C,GAAG,GAAG,EAAV;;AACA,OAAK,IAAI1d,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGuC,GAAG,CAACrwB,MAA1B,EAAkCsV,CAAC,GAAGwY,GAAtC,EAA2CxY,CAAC,EAA5C,EAAgD;AAC9C,QAAIie,IAAI,GAAGlD,GAAG,CAAC/a,CAAD,CAAd;;AACA,QAAIie,IAAI,IAAIhsB,GAAZ,EAAiB;AACfyrB,MAAAA,GAAG,CAACO,IAAD,CAAH,GAAYhsB,GAAG,CAACgsB,IAAD,CAAf;AACD;AACF;;AACD,SAAOP,GAAP;AACD,EAED;AACA;AACA;;;AACA,IAAIiD,2BAA2B,GAAG,CAAlC;;AAEA,SAASC,gBAAT,CAA0BC,CAA1B,EAA6B;AAC3B,SAAOA,CAAP;AACD;;AAED,SAASC,0BAAT,CAAoC5zB,MAApC,EAA4C;AAC1C,SAAO,CAAC;AACN6zB,IAAAA,EAAE,EAAE7zB;AADE,GAAD,CAAP;AAGD,EAED;;;AACA,SAAS8zB,OAAT,CAAiBC,EAAjB,EAAqBC,IAArB,EAA2BpB,QAA3B,EAAqC;AACnC,MAAIqB,QAAQ,GAAGD,IAAI,CAACE,IAApB,CADmC,CAGnC;;AACA,MAAIC,YAAY,GAAG,IAAIjD,WAAJ,EAAnB;AACA+C,EAAAA,QAAQ,CAAChyB,OAAT,CAAiB,UAAUmyB,OAAV,EAAmB;AAClC,QAAID,YAAY,CAACpyB,GAAb,CAAiBqyB,OAAO,CAACpyB,EAAzB,CAAJ,EAAkC;AAChCmyB,MAAAA,YAAY,CAACn1B,GAAb,CAAiBo1B,OAAO,CAACpyB,EAAzB,EAA6Ba,IAA7B,CAAkCuxB,OAAlC;AACD,KAFD,MAEO;AACLD,MAAAA,YAAY,CAACl1B,GAAb,CAAiBm1B,OAAO,CAACpyB,EAAzB,EAA6B,CAACoyB,OAAD,CAA7B;AACD;AACF,GAND;AAQA,MAAIC,OAAO,GAAGF,YAAY,CAACrM,IAA3B;AACA,MAAIwM,OAAO,GAAG,CAAd;AACA,MAAIC,aAAa,GAAG,IAAIxG,KAAJ,CAAUsG,OAAV,CAApB;;AAEA,WAASG,wBAAT,GAAoC;AAClC,QAAI5T,OAAO,GAAG,EAAd;AACA2T,IAAAA,aAAa,CAACtyB,OAAd,CAAsB,UAAUuuB,GAAV,EAAe;AACnCA,MAAAA,GAAG,CAAC0D,IAAJ,CAASjyB,OAAT,CAAiB,UAAUwyB,IAAV,EAAgB;AAC/B7T,QAAAA,OAAO,CAAC/d,IAAR,CAAa;AACXb,UAAAA,EAAE,EAAEwuB,GAAG,CAACxuB,EADG;AAEXkyB,UAAAA,IAAI,EAAE,CAACO,IAAD;AAFK,SAAb;AAID,OALD;AAMD,KAPD;AAQA7B,IAAAA,QAAQ,CAAC,IAAD,EAAO;AAAChS,MAAAA,OAAO,EAAEA;AAAV,KAAP,CAAR;AACD;;AAED,WAAS8T,SAAT,GAAqB;AACnB,QAAI,EAAEJ,OAAF,KAAcD,OAAlB,EAA2B;AACzBG,MAAAA,wBAAwB;AACzB;AACF;;AAED,WAASG,SAAT,CAAmBC,QAAnB,EAA6B5yB,EAA7B,EAAiCkyB,IAAjC,EAAuC;AACrCK,IAAAA,aAAa,CAACK,QAAD,CAAb,GAA0B;AAAC5yB,MAAAA,EAAE,EAAEA,EAAL;AAASkyB,MAAAA,IAAI,EAAEA;AAAf,KAA1B;AACAQ,IAAAA,SAAS;AACV;;AAED,MAAIG,WAAW,GAAG,EAAlB;AACAV,EAAAA,YAAY,CAAClyB,OAAb,CAAqB,UAAUV,KAAV,EAAiBF,GAAjB,EAAsB;AACzCwzB,IAAAA,WAAW,CAAChyB,IAAZ,CAAiBxB,GAAjB;AACD,GAFD;AAIA,MAAIyR,CAAC,GAAG,CAAR;;AAEA,WAASgiB,SAAT,GAAqB;AAEnB,QAAIhiB,CAAC,IAAI+hB,WAAW,CAACr3B,MAArB,EAA6B;AAC3B;AACD;;AAED,QAAIu3B,IAAI,GAAGnhB,IAAI,CAAChQ,GAAL,CAASkP,CAAC,GAAG2gB,2BAAb,EAA0CoB,WAAW,CAACr3B,MAAtD,CAAX;AACA,QAAIw3B,KAAK,GAAGH,WAAW,CAAC3wB,KAAZ,CAAkB4O,CAAlB,EAAqBiiB,IAArB,CAAZ;AACAE,IAAAA,YAAY,CAACD,KAAD,EAAQliB,CAAR,CAAZ;AACAA,IAAAA,CAAC,IAAIkiB,KAAK,CAACx3B,MAAX;AACD;;AAED,WAASy3B,YAAT,CAAsBD,KAAtB,EAA6BE,MAA7B,EAAqC;AACnCF,IAAAA,KAAK,CAAC/yB,OAAN,CAAc,UAAUkzB,KAAV,EAAiBphB,CAAjB,EAAoB;AAChC,UAAIqhB,MAAM,GAAGF,MAAM,GAAGnhB,CAAtB;AACA,UAAIshB,WAAW,GAAGlB,YAAY,CAACn1B,GAAb,CAAiBm2B,KAAjB,CAAlB,CAFgC,CAIhC;AACA;AACA;AACA;AACA;AACA;;AACA,UAAIG,OAAO,GAAG9B,IAAI,CAAC6B,WAAW,CAAC,CAAD,CAAZ,EAAiB,CAAC,YAAD,EAAe,aAAf,CAAjB,CAAlB;AACAC,MAAAA,OAAO,CAACC,SAAR,GAAoBF,WAAW,CAACxoB,GAAZ,CAAgB,UAAUunB,OAAV,EAAmB;AACrD;AACA,eAAOA,OAAO,CAACoB,GAAf;AACD,OAHmB,CAApB,CAXgC,CAgBhC;;AACAF,MAAAA,OAAO,CAACC,SAAR,GAAoBD,OAAO,CAACC,SAAR,CAAkB3vB,MAAlB,CAAyB8tB,gBAAzB,CAApB;AAEA,UAAI+B,YAAY,GAAG/B,gBAAnB;;AAEA,UAAI4B,OAAO,CAACC,SAAR,CAAkB/3B,MAAlB,KAA6B,CAAjC,EAAoC;AAClC,eAAO83B,OAAO,CAACC,SAAf,CADkC,CAGlC;AACA;AACA;;AACAE,QAAAA,YAAY,GAAG7B,0BAAf;AACD,OA5B+B,CA8BhC;;;AACA,OAAC,MAAD,EAAS,aAAT,EAAwB,QAAxB,EAAkC,MAAlC,EAA0C,QAA1C,EAAoD3xB,OAApD,CAA4D,UAAUyzB,KAAV,EAAiB;AAC3E,YAAIA,KAAK,IAAI1B,IAAb,EAAmB;AACjBsB,UAAAA,OAAO,CAACI,KAAD,CAAP,GAAiB1B,IAAI,CAAC0B,KAAD,CAArB;AACD;AACF,OAJD;AAKA3B,MAAAA,EAAE,CAAC/0B,GAAH,CAAOm2B,KAAP,EAAcG,OAAd,EAAuB,UAAUjoB,GAAV,EAAemjB,GAAf,EAAoB;AACzC,YAAIxwB,MAAJ;AACA;;AACA,YAAIqN,GAAJ,EAAS;AACPrN,UAAAA,MAAM,GAAG,CAAC;AAACiJ,YAAAA,KAAK,EAAEoE;AAAR,WAAD,CAAT;AACD,SAFD,MAEO;AACLrN,UAAAA,MAAM,GAAGy1B,YAAY,CAACjF,GAAD,CAArB;AACD;;AACDmE,QAAAA,SAAS,CAACS,MAAD,EAASD,KAAT,EAAgBn1B,MAAhB,CAAT;AACA80B,QAAAA,SAAS;AACV,OAVD;AAWD,KA/CD;AAgDD;;AAEDA,EAAAA,SAAS;AAEV;;AAED,IAAIa,QAAJ;;AAEA,IAAI;AACFC,EAAAA,YAAY,CAACC,OAAb,CAAqB,2BAArB,EAAkD,CAAlD;AACAF,EAAAA,QAAQ,GAAG,CAAC,CAACC,YAAY,CAACE,OAAb,CAAqB,2BAArB,CAAb;AACD,CAHD,CAGE,OAAOt3B,CAAP,EAAU;AACVm3B,EAAAA,QAAQ,GAAG,KAAX;AACD;;AAED,SAASI,eAAT,GAA2B;AACzB,SAAOJ,QAAP;AACD,EAED;;;AAEA,uBAASK,OAAT,EAAkB9L,oBAAlB;AAEA;;AACA,SAAS+L,mBAAT,CAA6BzD,IAA7B,EAAmC;AACjC,MAAIuD,eAAe,EAAnB,EAAuB;AACrB73B,IAAAA,gBAAgB,CAAC,SAAD,EAAY,UAAUM,CAAV,EAAa;AACvCg0B,MAAAA,IAAI,CAACxH,IAAL,CAAUxsB,CAAC,CAAC6C,GAAZ;AACD,KAFe,CAAhB;AAGD;AACF;;AAED,SAAS20B,OAAT,GAAmB;AACjB9L,uBAAanpB,IAAb,CAAkB,IAAlB;;AACA,OAAKusB,UAAL,GAAkB,EAAlB;AAEA2I,EAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD;;AACDD,OAAO,CAACh4B,SAAR,CAAkBquB,WAAlB,GAAgC,UAAU6J,MAAV,EAAkBl0B,EAAlB,EAAsB+xB,EAAtB,EAA0BC,IAA1B,EAAgC;AAC9D;AACA,MAAI,KAAK1G,UAAL,CAAgBtrB,EAAhB,CAAJ,EAAyB;AACvB;AACD;;AACD,MAAIwwB,IAAI,GAAG,IAAX;AACA,MAAI2D,UAAU,GAAG,KAAjB;;AACA,WAASC,aAAT,GAAyB;AACvB;AACA,QAAI,CAAC5D,IAAI,CAAClF,UAAL,CAAgBtrB,EAAhB,CAAL,EAA0B;AACxB;AACD;;AACD,QAAIm0B,UAAJ,EAAgB;AACdA,MAAAA,UAAU,GAAG,SAAb;AACA;AACD;;AACDA,IAAAA,UAAU,GAAG,IAAb;AACA,QAAIE,WAAW,GAAG7C,IAAI,CAACQ,IAAD,EAAO,CAC3B,OAD2B,EAClB,cADkB,EACF,aADE,EACa,WADb,EAC0B,QAD1B,EAE3B,SAF2B,EAEhB,MAFgB,EAER,OAFQ,EAEC,cAFD,EAEiB,QAFjB,EAE2B,aAF3B,CAAP,CAAtB;AAKA;;AACA,aAAS1sB,OAAT,GAAmB;AACjB6uB,MAAAA,UAAU,GAAG,KAAb;AACD;;AAEDpC,IAAAA,EAAE,CAACuC,OAAH,CAAWD,WAAX,EAAwB/J,EAAxB,CAA2B,QAA3B,EAAqC,UAAUjpB,CAAV,EAAa;AAChD,UAAIA,CAAC,CAACkzB,GAAF,GAAQvC,IAAI,CAACwC,KAAb,IAAsB,CAACxC,IAAI,CAACyC,SAAhC,EAA2C;AACzCzC,QAAAA,IAAI,CAACwC,KAAL,GAAanzB,CAAC,CAACkzB,GAAf;AACAvC,QAAAA,IAAI,CAAC0C,QAAL,CAAcrzB,CAAd;AACD;AACF,KALD,EAKGipB,EALH,CAKM,UALN,EAKkB,YAAY;AAC5B,UAAI6J,UAAU,KAAK,SAAnB,EAA8B;AAC5B,gCAAUC,aAAV;AACD;;AACDD,MAAAA,UAAU,GAAG,KAAb;AACD,KAVD,EAUG7J,EAVH,CAUM,OAVN,EAUehlB,OAVf;AAWD;;AACD,OAAKgmB,UAAL,CAAgBtrB,EAAhB,IAAsBo0B,aAAtB;AACA,OAAK9J,EAAL,CAAQ4J,MAAR,EAAgBE,aAAhB;AACD,CAzCD;;AA2CAJ,OAAO,CAACh4B,SAAR,CAAkB0uB,cAAlB,GAAmC,UAAUwJ,MAAV,EAAkBl0B,EAAlB,EAAsB;AACvD;AACA,MAAI,EAAEA,EAAE,IAAI,KAAKsrB,UAAb,CAAJ,EAA8B;AAC5B;AACD;;AACDpD,uBAAalsB,SAAb,CAAuB0uB,cAAvB,CAAsC3rB,IAAtC,CAA2C,IAA3C,EAAiDm1B,MAAjD,EACE,KAAK5I,UAAL,CAAgBtrB,EAAhB,CADF;;AAEA,SAAO,KAAKsrB,UAAL,CAAgBtrB,EAAhB,CAAP;AACD,CARD;AAWA;;;AACAg0B,OAAO,CAACh4B,SAAR,CAAkB24B,kBAAlB,GAAuC,UAAUT,MAAV,EAAkB;AACvD;AACA;AACA,MAAIH,eAAe,EAAnB,EAAuB;AACrBH,IAAAA,YAAY,CAACM,MAAD,CAAZ,GAAwBN,YAAY,CAACM,MAAD,CAAZ,KAAyB,GAA1B,GAAiC,GAAjC,GAAuC,GAA9D;AACD;AACF,CAND;;AAQAF,OAAO,CAACh4B,SAAR,CAAkB44B,MAAlB,GAA2B,UAAUV,MAAV,EAAkB;AAC3C,OAAKlL,IAAL,CAAUkL,MAAV;AACA,OAAKS,kBAAL,CAAwBT,MAAxB;AACD,CAHD;;AAKA,SAASW,cAAT,CAAwBtoB,MAAxB,EAAgC;AAC9B;AACA,MAAI,OAAO9O,OAAP,KAAmB,WAAnB,IAAkC,OAAOA,OAAO,CAAC8O,MAAD,CAAd,KAA2B,UAAjE,EAA6E;AAC3E,QAAIG,IAAI,GAAGqf,KAAK,CAAC/vB,SAAN,CAAgBkG,KAAhB,CAAsBnD,IAAtB,CAA2BzC,SAA3B,EAAsC,CAAtC,CAAX;AACAmB,IAAAA,OAAO,CAAC8O,MAAD,CAAP,CAAgBlQ,KAAhB,CAAsBoB,OAAtB,EAA+BiP,IAA/B;AACD;AACF;;AAED,SAASooB,YAAT,CAAsBlzB,GAAtB,EAA2BC,GAA3B,EAAgC;AAC9B,MAAIkzB,UAAU,GAAG,MAAjB,CAD8B,CACL;;AACzBnzB,EAAAA,GAAG,GAAGnG,QAAQ,CAACmG,GAAD,EAAM,EAAN,CAAR,IAAqB,CAA3B;AACAC,EAAAA,GAAG,GAAGpG,QAAQ,CAACoG,GAAD,EAAM,EAAN,CAAd;;AACA,MAAIA,GAAG,KAAKA,GAAR,IAAeA,GAAG,IAAID,GAA1B,EAA+B;AAC7BC,IAAAA,GAAG,GAAG,CAACD,GAAG,IAAI,CAAR,KAAc,CAApB,CAD6B,CACN;AACxB,GAFD,MAEO;AACLC,IAAAA,GAAG,GAAGA,GAAG,GAAG,CAAZ;AACD,GAR6B,CAS9B;;;AACA,MAAIA,GAAG,GAAGkzB,UAAV,EAAsB;AACpBnzB,IAAAA,GAAG,GAAGmzB,UAAU,IAAI,CAApB,CADoB,CACG;;AACvBlzB,IAAAA,GAAG,GAAGkzB,UAAN;AACD;;AACD,MAAIC,KAAK,GAAGpjB,IAAI,CAACqjB,MAAL,EAAZ;AACA,MAAIC,KAAK,GAAGrzB,GAAG,GAAGD,GAAlB;AAEA,SAAO,CAAC,EAAEszB,KAAK,GAAGF,KAAR,GAAgBpzB,GAAlB,CAAR,CAjB8B,CAiBE;AACjC;;AAED,SAASuzB,cAAT,CAAwBvzB,GAAxB,EAA6B;AAC3B,MAAIC,GAAG,GAAG,CAAV;;AACA,MAAI,CAACD,GAAL,EAAU;AACRC,IAAAA,GAAG,GAAG,IAAN;AACD;;AACD,SAAOizB,YAAY,CAAClzB,GAAD,EAAMC,GAAN,CAAnB;AACD,EAED;AACA;;;AACA,SAASuzB,YAAT,CAAsBC,MAAtB,EAA8BC,GAA9B,EAAmC;AACjCT,EAAAA,cAAc,CAAC,MAAD,EAAS,eAAeQ,MAAf,GAAwB,sBAAxB,GAAiDC,GAA1D,CAAd;AACD;;AAED,IAAI51B,MAAJ;AACA;AACE,MAAI,OAAO5C,MAAM,CAAC4C,MAAd,KAAyB,UAA7B,EAAyC;AACvCA,IAAAA,MAAM,GAAG5C,MAAM,CAAC4C,MAAhB;AACD,GAFD,MAEO;AACL;AACA;AACAA,IAAAA,MAAM,GAAG,UAAUwO,MAAV,EAAkB;AACzB,UAAIqnB,EAAE,GAAGz4B,MAAM,CAACoR,MAAD,CAAf;;AAEA,WAAK,IAAIkU,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAG9lB,SAAS,CAACd,MAAtC,EAA8C4mB,KAAK,EAAnD,EAAuD;AACrD,YAAIoT,UAAU,GAAGl5B,SAAS,CAAC8lB,KAAD,CAA1B;;AAEA,YAAIoT,UAAU,IAAI,IAAlB,EAAwB;AAAE;AACxB,eAAK,IAAIC,OAAT,IAAoBD,UAApB,EAAgC;AAC9B;AACA,gBAAI14B,MAAM,CAACd,SAAP,CAAiBwnB,cAAjB,CAAgCzkB,IAAhC,CAAqCy2B,UAArC,EAAiDC,OAAjD,CAAJ,EAA+D;AAC7DF,cAAAA,EAAE,CAACE,OAAD,CAAF,GAAcD,UAAU,CAACC,OAAD,CAAxB;AACD;AACF;AACF;AACF;;AACD,aAAOF,EAAP;AACD,KAhBD;AAiBD;AACF;AAED,IAAIG,qBAAqB,GAAGh2B,MAA5B;AAEA,uBAASi2B,UAAT,EAAqBr4B,KAArB;;AAEA,SAASq4B,UAAT,CAAoBN,MAApB,EAA4BpuB,KAA5B,EAAmC2uB,MAAnC,EAA2C;AACzCt4B,EAAAA,KAAK,CAACyB,IAAN,CAAW,IAAX,EAAiB62B,MAAjB;AACA,OAAKP,MAAL,GAAcA,MAAd;AACA,OAAKn1B,IAAL,GAAY+G,KAAZ;AACA,OAAKhC,OAAL,GAAe2wB,MAAf;AACA,OAAK3uB,KAAL,GAAa,IAAb;AACD;;AAED0uB,UAAU,CAAC35B,SAAX,CAAqB8C,QAArB,GAAgC,YAAY;AAC1C,SAAO4D,IAAI,CAACE,SAAL,CAAe;AACpByyB,IAAAA,MAAM,EAAE,KAAKA,MADO;AAEpBn1B,IAAAA,IAAI,EAAE,KAAKA,IAFS;AAGpB+E,IAAAA,OAAO,EAAE,KAAKA,OAHM;AAIpB2wB,IAAAA,MAAM,EAAE,KAAKA;AAJO,GAAf,CAAP;AAMD,CAPD;;AASA,IAAIC,YAAY,GAAG,IAAIF,UAAJ,CAAe,GAAf,EAAoB,cAApB,EAAoC,gCAApC,CAAnB;AACA,IAAIG,iBAAiB,GAAG,IAAIH,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,6BAAnC,CAAxB;AACA,IAAII,WAAW,GAAG,IAAIJ,UAAJ,CAAe,GAAf,EAAoB,WAApB,EAAiC,SAAjC,CAAlB;AACA,IAAIK,YAAY,GAAG,IAAIL,UAAJ,CAAe,GAAf,EAAoB,UAApB,EAAgC,0BAAhC,CAAnB;AACA,IAAIM,UAAU,GAAG,IAAIN,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,iCAAnC,CAAjB;AACA,IAAIO,UAAU,GAAG,IAAIP,UAAJ,CAAe,GAAf,EAAoB,YAApB,EAAkC,0BAAlC,CAAjB;AACA,IAAIQ,WAAW,GAAG,IAAIR,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,uDAAnC,CAAlB;AACA,IAAIS,QAAQ,GAAG,IAAIT,UAAJ,CAAe,GAAf,EAAoB,qBAApB,EAA2C,mBAA3C,CAAf;AACA,IAAIU,aAAa,GAAG,IAAIV,UAAJ,CAAe,GAAf,EAAoB,eAApB,EAAqC,uCAArC,CAApB;AACA,IAAIW,OAAO,GAAG,IAAIX,UAAJ,CAAe,GAAf,EAAoB,QAApB,EAA8B,gCAA9B,CAAd;AACA,IAAIY,eAAe,GAAG,IAAIZ,UAAJ,CAAe,GAAf,EAAoB,iBAApB,EAAuC,qBAAvC,CAAtB;AACA,IAAIa,iBAAiB,GAAG,IAAIb,UAAJ,CAAe,GAAf,EAAoB,mBAApB,EAAyC,iCAAzC,CAAxB;AACA,IAAIc,cAAc,GAAG,IAAId,UAAJ,CAAe,GAAf,EAAoB,gBAApB,EAAsC,6BAAtC,CAArB;AACA,IAAIe,WAAW,GAAG,IAAIf,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,kCAAnC,CAAlB;AACA,IAAIgB,aAAa,GAAG,IAAIhB,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,gCAAnC,CAApB;AACA,IAAIiB,UAAU,GAAG,IAAIjB,UAAJ,CAAe,GAAf,EAAoB,WAApB,EAAiC,oBAAjC,CAAjB;AACA,IAAIkB,SAAS,GAAG,IAAIlB,UAAJ,CAAe,GAAf,EAAoB,qBAApB,EAA2C,SAA3C,CAAhB;AACA,IAAImB,SAAS,GAAG,IAAInB,UAAJ,CAAe,GAAf,EAAoB,kBAApB,EAAwC,SAAxC,CAAhB;AACA,IAAIoB,SAAS,GAAG,IAAIpB,UAAJ,CAAe,GAAf,EAAoB,uBAApB,EAA6C,SAA7C,CAAhB;AACA,IAAIqB,SAAS,GAAG,IAAIrB,UAAJ,CAAe,GAAf,EAAoB,WAApB,EAAiC,sDAAjC,CAAhB;AACA,IAAIsB,WAAW,GAAG,IAAItB,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,oBAAnC,CAAlB;AACA,IAAIuB,WAAW,GAAG,IAAIvB,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,6DAAnC,CAAlB;AACA,IAAIwB,YAAY,GAAG,IAAIxB,UAAJ,CAAe,GAAf,EAAoB,cAApB,EAAoC,8CAApC,CAAnB;AACA,IAAIyB,WAAW,GAAG,IAAIzB,UAAJ,CAAe,GAAf,EAAoB,aAApB,EAAmC,yBAAnC,CAAlB;;AAEA,SAAS0B,WAAT,CAAqBpwB,KAArB,EAA4B2uB,MAA5B,EAAoC;AAClC,WAAS0B,gBAAT,CAA0B1B,MAA1B,EAAkC;AAChC;AACA;;AACA;AACA,SAAK,IAAI3b,CAAT,IAAchT,KAAd,EAAqB;AACnB,UAAI,OAAOA,KAAK,CAACgT,CAAD,CAAZ,KAAoB,UAAxB,EAAoC;AAClC,aAAKA,CAAL,IAAUhT,KAAK,CAACgT,CAAD,CAAf;AACD;AACF;AACD;;;AACA,QAAI2b,MAAM,KAAKn2B,SAAf,EAA0B;AACxB,WAAKm2B,MAAL,GAAcA,MAAd;AACD;AACF;;AACD0B,EAAAA,gBAAgB,CAACt7B,SAAjB,GAA6B25B,UAAU,CAAC35B,SAAxC;AACA,SAAO,IAAIs7B,gBAAJ,CAAqB1B,MAArB,CAAP;AACD;;AAED,SAAS2B,yBAAT,CAAmClsB,GAAnC,EAAwC;AAEtC,MAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC3B,QAAIpM,IAAI,GAAGoM,GAAX;AACAA,IAAAA,GAAG,GAAGgrB,aAAN;AACAhrB,IAAAA,GAAG,CAACpM,IAAJ,GAAWA,IAAX;AACD;;AAED,MAAI,WAAWoM,GAAX,IAAkBA,GAAG,CAACpE,KAAJ,KAAc,UAApC,EAAgD;AAC9CoE,IAAAA,GAAG,CAACnL,IAAJ,GAAW,UAAX;AACAmL,IAAAA,GAAG,CAACgqB,MAAJ,GAAa,GAAb;AACD;;AAED,MAAI,EAAE,UAAUhqB,GAAZ,CAAJ,EAAsB;AACpBA,IAAAA,GAAG,CAACnL,IAAJ,GAAWmL,GAAG,CAACpE,KAAJ,IAAa,SAAxB;AACD;;AAED,MAAI,EAAE,YAAYoE,GAAd,CAAJ,EAAwB;AACtBA,IAAAA,GAAG,CAACgqB,MAAJ,GAAa,GAAb;AACD;;AAED,MAAI,EAAE,aAAahqB,GAAf,CAAJ,EAAyB;AACvBA,IAAAA,GAAG,CAACpG,OAAJ,GAAcoG,GAAG,CAACpG,OAAJ,IAAeoG,GAAG,CAACuqB,MAAjC;AACD;;AAED,SAAOvqB,GAAP;AACD;;AAED,SAASmsB,SAAT,CAAmB5zB,MAAnB,EAA2B6zB,GAA3B,EAAgCC,GAAhC,EAAqC;AACnC,MAAI;AACF,WAAO,CAAC9zB,MAAM,CAAC6zB,GAAD,EAAMC,GAAN,CAAd;AACD,GAFD,CAEE,OAAOrsB,GAAP,EAAY;AACZ,QAAIssB,GAAG,GAAG,4BAA4BtsB,GAAG,CAACvM,QAAJ,EAAtC;AACA,WAAOu4B,WAAW,CAACX,WAAD,EAAciB,GAAd,CAAlB;AACD;AACF;;AAED,SAASC,YAAT,CAAsB5F,IAAtB,EAA4B;AAC1B,MAAI0F,GAAG,GAAG,EAAV;AACA,MAAIG,SAAS,GAAG7F,IAAI,CAACpuB,MAAL,IAAe,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,UAAtD;AACA8zB,EAAAA,GAAG,CAACI,KAAJ,GAAY9F,IAAI,CAAC+F,YAAjB;AAEA,SAAO,SAASn0B,MAAT,CAAgBo0B,MAAhB,EAAwB;AAC7B,QAAI,CAACA,MAAM,CAACP,GAAZ,EAAiB;AACf;AACA;AACAO,MAAAA,MAAM,CAACP,GAAP,GAAa,EAAb;AACD;;AAED,QAAIQ,YAAY,GAAGJ,SAAS,IAAIL,SAAS,CAACxF,IAAI,CAACpuB,MAAN,EAAco0B,MAAM,CAACP,GAArB,EAA0BC,GAA1B,CAAzC;;AAEA,QAAI,OAAOO,YAAP,KAAwB,QAA5B,EAAsC;AACpC,aAAOA,YAAP;AACD;;AAED,QAAIA,YAAJ,EAAkB;AAChB,aAAO,KAAP;AACD;;AAED,QAAI,CAACjG,IAAI,CAACkG,YAAV,EAAwB;AACtB,aAAOF,MAAM,CAACP,GAAd;AACD,KAFD,MAEO,IAAI,CAACzF,IAAI,CAACmG,WAAV,EAAuB;AAC5B,WAAK,IAAIC,GAAT,IAAgBJ,MAAM,CAACP,GAAP,CAAWY,YAA3B,EAAyC;AACvC;AACA,YAAIL,MAAM,CAACP,GAAP,CAAWY,YAAX,CAAwB7U,cAAxB,CAAuC4U,GAAvC,CAAJ,EAAiD;AAC/CJ,UAAAA,MAAM,CAACP,GAAP,CAAWY,YAAX,CAAwBD,GAAxB,EAA6BE,IAA7B,GAAoC,IAApC;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD,GA5BD;AA6BD;;AAED,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AACrB,MAAIhK,GAAG,GAAG,EAAV;;AACA,OAAK,IAAI1d,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGkP,IAAI,CAACh9B,MAA3B,EAAmCsV,CAAC,GAAGwY,GAAvC,EAA4CxY,CAAC,EAA7C,EAAiD;AAC/C0d,IAAAA,GAAG,GAAGA,GAAG,CAAClsB,MAAJ,CAAWk2B,IAAI,CAAC1nB,CAAD,CAAf,CAAN;AACD;;AACD,SAAO0d,GAAP;AACD,EAED;AAEA;AACA;AACA;AACA;AACA;;;AACA,SAASiK,cAAT,CAAwBz4B,EAAxB,EAA4B;AAC1B,MAAIqL,GAAJ;;AACA,MAAI,CAACrL,EAAL,EAAS;AACPqL,IAAAA,GAAG,GAAGgsB,WAAW,CAACnB,UAAD,CAAjB;AACD,GAFD,MAEO,IAAI,OAAOl2B,EAAP,KAAc,QAAlB,EAA4B;AACjCqL,IAAAA,GAAG,GAAGgsB,WAAW,CAACpB,UAAD,CAAjB;AACD,GAFM,MAEA,IAAI,KAAK7U,IAAL,CAAUphB,EAAV,KAAiB,CAAE,kBAAD,CAAqBohB,IAArB,CAA0BphB,EAA1B,CAAtB,EAAqD;AAC1DqL,IAAAA,GAAG,GAAGgsB,WAAW,CAAClB,WAAD,CAAjB;AACD;;AACD,MAAI9qB,GAAJ,EAAS;AACP,UAAMA,GAAN;AACD;AACF,EAED;;;AAEA,SAASqtB,QAAT,CAAkB3G,EAAlB,EAAsB;AACpB,MAAI,OAAOA,EAAE,CAAC4G,OAAV,KAAsB,SAA1B,EAAqC;AACnC,WAAO5G,EAAE,CAAC4G,OAAV;AACD;AACD;;;AACA,MAAI,OAAO5G,EAAE,CAACpxB,IAAV,KAAmB,UAAvB,EAAmC;AACjCk0B,IAAAA,cAAc,CAAC,MAAD,EACZ,oDACA,6BAFY,CAAd;AAGA,WAAO9C,EAAE,CAACpxB,IAAH,OAAc,MAArB;AACD;AACD;;;AACA,SAAO,KAAP;AACD;;AAED,SAASgrB,aAAT,CAAuBiN,EAAvB,EAA2Bj4B,IAA3B,EAAiC;AAC/B,SAAO,mBAAmBi4B,EAAnB,GAAwBA,EAAE,CAACjN,aAAH,CAAiBhrB,IAAjB,CAAxB,GACwBunB,qBAAayD,aAAb,CAA2BiN,EAA3B,EAA+Bj4B,IAA/B,CAD/B;AAED;;AAED,SAASk4B,0BAAT,CAAoCrvB,CAApC,EAAuC;AACrC,MAAI,CAACA,CAAL,EAAQ;AACN,WAAO,IAAP;AACD;;AACD,MAAIsvB,KAAK,GAAGtvB,CAAC,CAAC6R,KAAF,CAAQ,GAAR,CAAZ;;AACA,MAAIyd,KAAK,CAACt9B,MAAN,KAAiB,CAArB,EAAwB;AACtB,WAAOs9B,KAAP;AACD;;AACD,MAAIA,KAAK,CAACt9B,MAAN,KAAiB,CAArB,EAAwB;AACtB,WAAO,CAACgO,CAAD,EAAIA,CAAJ,CAAP;AACD;;AACD,SAAO,IAAP;AACD;;AAED,SAASuvB,8BAAT,CAAwCvvB,CAAxC,EAA2C;AACzC,MAAIwvB,UAAU,GAAGH,0BAA0B,CAACrvB,CAAD,CAA3C;AACA,SAAOwvB,UAAU,GAAGA,UAAU,CAACngB,IAAX,CAAgB,GAAhB,CAAH,GAA0B,IAA3C;AACD,EAED;AACA;AACA;;;AACA,IAAI3Z,IAAI,GAAG,CAAC,QAAD,EAAW,UAAX,EAAuB,WAAvB,EAAoC,UAApC,EAAgD,MAAhD,EAAwD,UAAxD,EACP,MADO,EACC,MADD,EACS,UADT,EACqB,MADrB,EAC6B,WAD7B,EAC0C,MAD1C,EACkD,OADlD,EAC2D,QAD3D,CAAX;AAEA,IAAI+5B,KAAK,GAAE,UAAX;AACA,IAAIC,OAAO,GAAG,2BAAd,EAEA;;AACA;;AACA,IAAIC,MAAM,GAAG,kMAAb;;AAEA,SAASC,QAAT,CAAkB9D,GAAlB,EAAuB;AACrB,MAAI1L,CAAC,GAAGuP,MAAM,CAACE,IAAP,CAAY/D,GAAZ,CAAR;AACA,MAAInjB,GAAG,GAAG,EAAV;AACA,MAAIrB,CAAC,GAAG,EAAR;;AAEA,SAAOA,CAAC,EAAR,EAAY;AACV,QAAIzR,GAAG,GAAGH,IAAI,CAAC4R,CAAD,CAAd;AACA,QAAIvR,KAAK,GAAGqqB,CAAC,CAAC9Y,CAAD,CAAD,IAAQ,EAApB;AACA,QAAIwoB,OAAO,GAAG,CAAC,MAAD,EAAS,UAAT,EAAqBpwB,OAArB,CAA6B7J,GAA7B,MAAsC,CAAC,CAArD;AACA8S,IAAAA,GAAG,CAAC9S,GAAD,CAAH,GAAWi6B,OAAO,GAAGC,kBAAkB,CAACh6B,KAAD,CAArB,GAA+BA,KAAjD;AACD;;AAED4S,EAAAA,GAAG,CAAC8mB,KAAD,CAAH,GAAa,EAAb;AACA9mB,EAAAA,GAAG,CAACjT,IAAI,CAAC,EAAD,CAAL,CAAH,CAAcmO,OAAd,CAAsB6rB,OAAtB,EAA+B,UAAUM,EAAV,EAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AACnD,QAAID,EAAJ,EAAQ;AACNtnB,MAAAA,GAAG,CAAC8mB,KAAD,CAAH,CAAWQ,EAAX,IAAiBC,EAAjB;AACD;AACF,GAJD;AAMA,SAAOvnB,GAAP;AACD,EAED;AACA;AACA;;;AAEA,SAASwnB,SAAT,CAAmBC,MAAnB,EAA2BC,KAA3B,EAAkC;AAChC,MAAI36B,IAAI,GAAG,EAAX;AACA,MAAI46B,MAAM,GAAG,EAAb;;AACA,OAAK,IAAIz6B,GAAT,IAAgBw6B,KAAhB,EAAuB;AACrB,QAAIA,KAAK,CAACrW,cAAN,CAAqBnkB,GAArB,CAAJ,EAA+B;AAC7BH,MAAAA,IAAI,CAAC2B,IAAL,CAAUxB,GAAV;AACAy6B,MAAAA,MAAM,CAACj5B,IAAP,CAAYg5B,KAAK,CAACx6B,GAAD,CAAjB;AACD;AACF;;AACDH,EAAAA,IAAI,CAAC2B,IAAL,CAAU+4B,MAAV;AACA,SAAOnS,QAAQ,CAACprB,KAAT,CAAe,IAAf,EAAqB6C,IAArB,EAA2B7C,KAA3B,CAAiC,IAAjC,EAAuCy9B,MAAvC,CAAP;AACD,EAED;AACA;AACA;;;AACA,SAASC,MAAT,CAAgBhI,EAAhB,EAAoBoB,KAApB,EAA2B6G,OAA3B,EAAoC;AAClC,SAAO,IAAIh0B,OAAJ,CAAY,UAAU0qB,OAAV,EAAmBzqB,MAAnB,EAA2B;AAC5C8rB,IAAAA,EAAE,CAAC/0B,GAAH,CAAOm2B,KAAP,EAAc,UAAU9nB,GAAV,EAAeosB,GAAf,EAAoB;AAChC,UAAIpsB,GAAJ,EAAS;AACP;AACA,YAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,iBAAOpvB,MAAM,CAACoF,GAAD,CAAb;AACD;;AACDosB,QAAAA,GAAG,GAAG,EAAN;AACD,OAP+B,CAShC;;;AACA,UAAIwC,MAAM,GAAGxC,GAAG,CAACyC,IAAjB;AACA,UAAIC,MAAM,GAAGH,OAAO,CAACvC,GAAD,CAApB;;AAEA,UAAI,CAAC0C,MAAL,EAAa;AACX;AACA;AACA,eAAOzJ,OAAO,CAAC;AAAC0J,UAAAA,OAAO,EAAE,KAAV;AAAiB5G,UAAAA,GAAG,EAAEyG;AAAtB,SAAD,CAAd;AACD,OAjB+B,CAmBhC;AACA;;;AACAE,MAAAA,MAAM,CAACE,GAAP,GAAalH,KAAb;AACAgH,MAAAA,MAAM,CAACD,IAAP,GAAcD,MAAd;AACAvJ,MAAAA,OAAO,CAAC4J,SAAS,CAACvI,EAAD,EAAKoI,MAAL,EAAaH,OAAb,CAAV,CAAP;AACD,KAxBD;AAyBD,GA1BM,CAAP;AA2BD;;AAED,SAASM,SAAT,CAAmBvI,EAAnB,EAAuB0F,GAAvB,EAA4BuC,OAA5B,EAAqC;AACnC,SAAOjI,EAAE,CAACwI,GAAH,CAAO9C,GAAP,EAAYh0B,IAAZ,CAAiB,UAAU+qB,GAAV,EAAe;AACrC,WAAO;AACL4L,MAAAA,OAAO,EAAE,IADJ;AAEL5G,MAAAA,GAAG,EAAEhF,GAAG,CAACgF;AAFJ,KAAP;AAID,GALM,EAKJ,UAAUnoB,GAAV,EAAe;AAChB;AACA,QAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,YAAMhqB,GAAN;AACD;;AACD,WAAO0uB,MAAM,CAAChI,EAAD,EAAK0F,GAAG,CAAC4C,GAAT,EAAcL,OAAd,CAAb;AACD,GAXM,CAAP;AAYD;;AAED,IAAIQ,QAAQ,GAAG,UAAUlF,GAAV,EAAe;AAC5B,SAAOmF,IAAI,CAACnF,GAAD,CAAX;AACD,CAFD;;AAIA,IAAIoF,QAAQ,GAAG,UAAUpF,GAAV,EAAe;AAC5B,SAAOqF,IAAI,CAACrF,GAAD,CAAX;AACD,CAFD,EAIA;AACA;AACA;;;AACA,SAASsF,UAAT,CAAoB9B,KAApB,EAA2B+B,UAA3B,EAAuC;AACrC;AACA/B,EAAAA,KAAK,GAAGA,KAAK,IAAI,EAAjB;AACA+B,EAAAA,UAAU,GAAGA,UAAU,IAAI,EAA3B;;AACA,MAAI;AACF,WAAO,IAAIvL,IAAJ,CAASwJ,KAAT,EAAgB+B,UAAhB,CAAP;AACD,GAFD,CAEE,OAAOr+B,CAAP,EAAU;AACV,QAAIA,CAAC,CAAC0D,IAAF,KAAW,WAAf,EAA4B;AAC1B,YAAM1D,CAAN;AACD;;AACD,QAAIs+B,OAAO,GAAG,OAAOC,WAAP,KAAuB,WAAvB,GAAqCA,WAArC,GACA,OAAOC,aAAP,KAAyB,WAAzB,GAAuCA,aAAvC,GACA,OAAOC,cAAP,KAA0B,WAA1B,GAAwCA,cAAxC,GACAC,iBAHd;AAIA,QAAIC,OAAO,GAAG,IAAIL,OAAJ,EAAd;;AACA,SAAK,IAAIhqB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgoB,KAAK,CAACt9B,MAA1B,EAAkCsV,CAAC,IAAI,CAAvC,EAA0C;AACxCqqB,MAAAA,OAAO,CAACC,MAAR,CAAetC,KAAK,CAAChoB,CAAD,CAApB;AACD;;AACD,WAAOqqB,OAAO,CAACE,OAAR,CAAgBR,UAAU,CAACl6B,IAA3B,CAAP;AACD;AACF,EAED;AACA;;;AACA,SAAS26B,yBAAT,CAAmCC,GAAnC,EAAwC;AACtC,MAAI//B,MAAM,GAAG+/B,GAAG,CAAC//B,MAAjB;AACA,MAAIggC,GAAG,GAAG,IAAInM,WAAJ,CAAgB7zB,MAAhB,CAAV;AACA,MAAIqwB,GAAG,GAAG,IAAI6D,UAAJ,CAAe8L,GAAf,CAAV;;AACA,OAAK,IAAI1qB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtV,MAApB,EAA4BsV,CAAC,EAA7B,EAAiC;AAC/B+a,IAAAA,GAAG,CAAC/a,CAAD,CAAH,GAASyqB,GAAG,CAACE,UAAJ,CAAe3qB,CAAf,CAAT;AACD;;AACD,SAAO0qB,GAAP;AACD;;AAED,SAASE,kBAAT,CAA4BC,SAA5B,EAAuCh7B,IAAvC,EAA6C;AAC3C,SAAOi6B,UAAU,CAAC,CAACU,yBAAyB,CAACK,SAAD,CAA1B,CAAD,EAAyC;AAACh7B,IAAAA,IAAI,EAAEA;AAAP,GAAzC,CAAjB;AACD;;AAED,SAASi7B,YAAT,CAAsBC,GAAtB,EAA2Bl7B,IAA3B,EAAiC;AAC/B,SAAO+6B,kBAAkB,CAAClB,QAAQ,CAACqB,GAAD,CAAT,EAAgBl7B,IAAhB,CAAzB;AACD,EAED;AACA;AACA;;;AACA,SAASm7B,yBAAT,CAAmCC,MAAnC,EAA2C;AACzC,MAAIC,MAAM,GAAG,EAAb;AACA,MAAIC,KAAK,GAAG,IAAIvM,UAAJ,CAAeqM,MAAf,CAAZ;AACA,MAAIvgC,MAAM,GAAGygC,KAAK,CAAClW,UAAnB;;AACA,OAAK,IAAIjV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtV,MAApB,EAA4BsV,CAAC,EAA7B,EAAiC;AAC/BkrB,IAAAA,MAAM,IAAI9R,MAAM,CAACgS,YAAP,CAAoBD,KAAK,CAACnrB,CAAD,CAAzB,CAAV;AACD;;AACD,SAAOkrB,MAAP;AACD,EAED;;;AACA,SAASG,kBAAT,CAA4BC,IAA5B,EAAkCxL,QAAlC,EAA4C;AAC1C,MAAIyL,MAAM,GAAG,IAAIC,UAAJ,EAAb;AACA,MAAIC,eAAe,GAAG,OAAOF,MAAM,CAACF,kBAAd,KAAqC,UAA3D;;AACAE,EAAAA,MAAM,CAACG,SAAP,GAAmB,UAAUhgC,CAAV,EAAa;AAC9B,QAAIwB,MAAM,GAAGxB,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,IAAmB,EAAhC;;AACA,QAAIu+B,eAAJ,EAAqB;AACnB,aAAO3L,QAAQ,CAAC5yB,MAAD,CAAf;AACD;;AACD4yB,IAAAA,QAAQ,CAACkL,yBAAyB,CAAC99B,MAAD,CAA1B,CAAR;AACD,GAND;;AAOA,MAAIu+B,eAAJ,EAAqB;AACnBF,IAAAA,MAAM,CAACF,kBAAP,CAA0BC,IAA1B;AACD,GAFD,MAEO;AACLC,IAAAA,MAAM,CAACI,iBAAP,CAAyBL,IAAzB;AACD;AACF;;AAED,SAASM,kBAAT,CAA4BC,YAA5B,EAA0C/L,QAA1C,EAAoD;AAClDuL,EAAAA,kBAAkB,CAACQ,YAAD,EAAe,UAAUpB,GAAV,EAAe;AAC9C3K,IAAAA,QAAQ,CAAC2K,GAAD,CAAR;AACD,GAFiB,CAAlB;AAGD;;AAED,SAASqB,YAAT,CAAsBD,YAAtB,EAAoC/L,QAApC,EAA8C;AAC5C8L,EAAAA,kBAAkB,CAACC,YAAD,EAAe,UAAUE,MAAV,EAAkB;AACjDjM,IAAAA,QAAQ,CAAC8J,QAAQ,CAACmC,MAAD,CAAT,CAAR;AACD,GAFiB,CAAlB;AAGD,EAED;;;AACA,SAASJ,iBAAT,CAA2BL,IAA3B,EAAiCxL,QAAjC,EAA2C;AACzC,MAAIyL,MAAM,GAAG,IAAIC,UAAJ,EAAb;;AACAD,EAAAA,MAAM,CAACG,SAAP,GAAmB,UAAUhgC,CAAV,EAAa;AAC9B,QAAIwB,MAAM,GAAGxB,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,IAAmB,IAAIqxB,WAAJ,CAAgB,CAAhB,CAAhC;AACAuB,IAAAA,QAAQ,CAAC5yB,MAAD,CAAR;AACD,GAHD;;AAIAq+B,EAAAA,MAAM,CAACI,iBAAP,CAAyBL,IAAzB;AACD,EAED;;;AAEA,IAAIU,gBAAgB,GAAGC,MAAM,CAACC,YAAP,IAAuBD,MAAM,CAAChpB,UAArD;AACA,IAAIkpB,cAAc,GAAG,KAArB;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0B;AACxB,SAAOzC,QAAQ,CAACyC,GAAD,CAAf;AACD;;AAED,SAASC,SAAT,CAAmBhB,IAAnB,EAAyBphB,KAAzB,EAAgCpD,GAAhC,EAAqC;AACnC,MAAIwkB,IAAI,CAACvM,WAAT,EAAsB;AACpB,WAAOuM,IAAI,CAACvM,WAAL,CAAiB7U,KAAjB,EAAwBpD,GAAxB,CAAP;AACD;;AACD,SAAOwkB,IAAI,CAACl6B,KAAL,CAAW8Y,KAAX,EAAkBpD,GAAlB,CAAP;AACD;;AAED,SAASylB,UAAT,CAAoBtB,MAApB,EAA4BK,IAA5B,EAAkCphB,KAAlC,EAAyCpD,GAAzC,EAA8CgZ,QAA9C,EAAwD;AACtD,MAAI5V,KAAK,GAAG,CAAR,IAAapD,GAAG,GAAGwkB,IAAI,CAACtW,IAA5B,EAAkC;AAChC;AACAsW,IAAAA,IAAI,GAAGgB,SAAS,CAAChB,IAAD,EAAOphB,KAAP,EAAcpD,GAAd,CAAhB;AACD;;AACD6kB,EAAAA,iBAAiB,CAACL,IAAD,EAAO,UAAUkB,WAAV,EAAuB;AAC7CvB,IAAAA,MAAM,CAACX,MAAP,CAAckC,WAAd;AACA1M,IAAAA,QAAQ;AACT,GAHgB,CAAjB;AAID;;AAED,SAAS2M,YAAT,CAAsBxB,MAAtB,EAA8ByB,MAA9B,EAAsCxiB,KAAtC,EAA6CpD,GAA7C,EAAkDgZ,QAAlD,EAA4D;AAC1D,MAAI5V,KAAK,GAAG,CAAR,IAAapD,GAAG,GAAG4lB,MAAM,CAAChiC,MAA9B,EAAsC;AACpC;AACAgiC,IAAAA,MAAM,GAAGA,MAAM,CAACrP,SAAP,CAAiBnT,KAAjB,EAAwBpD,GAAxB,CAAT;AACD;;AACDmkB,EAAAA,MAAM,CAAC0B,YAAP,CAAoBD,MAApB;AACA5M,EAAAA,QAAQ;AACT;;AAED,SAAS8M,SAAT,CAAmBz+B,IAAnB,EAAyB2xB,QAAzB,EAAmC;AACjC,MAAI+M,aAAa,GAAG,OAAO1+B,IAAP,KAAgB,QAApC;AACA,MAAIqqB,GAAG,GAAGqU,aAAa,GAAG1+B,IAAI,CAACzD,MAAR,GAAiByD,IAAI,CAAC6mB,IAA7C;AACA,MAAI8X,SAAS,GAAGhsB,IAAI,CAAChQ,GAAL,CAASq7B,cAAT,EAAyB3T,GAAzB,CAAhB;AACA,MAAIuU,MAAM,GAAGjsB,IAAI,CAACksB,IAAL,CAAUxU,GAAG,GAAGsU,SAAhB,CAAb;AACA,MAAIG,YAAY,GAAG,CAAnB;AACA,MAAIhC,MAAM,GAAG4B,aAAa,GAAG,IAAIK,gBAAJ,EAAH,GAAe,IAAIA,iBAAI3O,WAAR,EAAzC;AAEA,MAAI+L,MAAM,GAAGuC,aAAa,GAAGJ,YAAH,GAAkBF,UAA5C;;AAEA,WAASY,IAAT,GAAgB;AACdnB,IAAAA,gBAAgB,CAACoB,aAAD,CAAhB;AACD;;AAED,WAASC,IAAT,GAAgB;AACd,QAAIhB,GAAG,GAAGpB,MAAM,CAACnkB,GAAP,CAAW,IAAX,CAAV;AACA,QAAIilB,MAAM,GAAGK,WAAW,CAACC,GAAD,CAAxB;AACAvM,IAAAA,QAAQ,CAACiM,MAAD,CAAR;AACAd,IAAAA,MAAM,CAACqC,OAAP;AACD;;AAED,WAASF,aAAT,GAAyB;AACvB,QAAIljB,KAAK,GAAG+iB,YAAY,GAAGH,SAA3B;AACA,QAAIhmB,GAAG,GAAGoD,KAAK,GAAG4iB,SAAlB;AACAG,IAAAA,YAAY;;AACZ,QAAIA,YAAY,GAAGF,MAAnB,EAA2B;AACzBzC,MAAAA,MAAM,CAACW,MAAD,EAAS98B,IAAT,EAAe+b,KAAf,EAAsBpD,GAAtB,EAA2BqmB,IAA3B,CAAN;AACD,KAFD,MAEO;AACL7C,MAAAA,MAAM,CAACW,MAAD,EAAS98B,IAAT,EAAe+b,KAAf,EAAsBpD,GAAtB,EAA2BumB,IAA3B,CAAN;AACD;AACF;;AACDD,EAAAA,aAAa;AACd;;AAED,SAASG,SAAT,CAAmBb,MAAnB,EAA2B;AACzB,SAAOQ,iBAAIM,IAAJ,CAASd,MAAT,CAAP;AACD;;AAED,SAAShK,GAAT,CAAaiE,GAAb,EAAkB8G,kBAAlB,EAAsC;AACpC,MAAIC,SAAS,GAAGrnB,KAAK,CAACsgB,GAAD,CAArB;;AACA,MAAI,CAAC8G,kBAAL,EAAyB;AACvB,WAAOE,cAAOC,EAAP,GAAYrxB,OAAZ,CAAoB,IAApB,EAA0B,EAA1B,EAA8BnJ,WAA9B,EAAP;AACD;;AAED,SAAOs6B,SAAS,CAACG,SAAjB;AACA,SAAON,SAAS,CAAC37B,IAAI,CAACE,SAAL,CAAe47B,SAAf,CAAD,CAAhB;AACD;;AAED,IAAII,IAAI,GAAGH,cAAOC,EAAlB,EAEA;AACA;AACA;AACA;AACA;;AACA,SAASG,UAAT,CAAoBC,QAApB,EAA8B;AAC5B,MAAIC,SAAJ;AACA,MAAIC,UAAJ;AACA,MAAIC,cAAJ;AACA,MAAIC,OAAO,GAAGJ,QAAQ,CAACK,QAAT,CAAkBj9B,KAAlB,EAAd;AACA,MAAIk9B,IAAJ;;AACA,SAAQA,IAAI,GAAGF,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAIqT,IAAI,GAAGD,IAAI,CAACE,GAAhB;AACA,QAAIC,QAAQ,GAAGF,IAAI,CAAC,CAAD,CAAnB;AACA,QAAI/jC,GAAG,GAAG8jC,IAAI,CAAC9jC,GAAf;;AACA,QAAIikC,QAAQ,CAAC/jC,MAAb,EAAqB;AAAE;AACrB,WAAK,IAAIsV,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGiW,QAAQ,CAAC/jC,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnDouB,QAAAA,OAAO,CAACr+B,IAAR,CAAa;AAACvF,UAAAA,GAAG,EAAEA,GAAG,GAAG,CAAZ;AAAegkC,UAAAA,GAAG,EAAEC,QAAQ,CAACzuB,CAAD;AAA5B,SAAb;AACD;;AACD;AACD;;AACD,QAAI0uB,OAAO,GAAG,CAAC,CAACH,IAAI,CAAC,CAAD,CAAJ,CAAQG,OAAxB;AACA,QAAIx/B,EAAE,GAAGq/B,IAAI,CAAC,CAAD,CAAb,CAX6B,CAY7B;;AACA,QAAI,CAACN,SAAD,KAAeE,cAAc,KAAKO,OAAnB,GAA6BP,cAA7B,GACfD,UAAU,KAAK1jC,GAAf,GAAqB0jC,UAAU,GAAG1jC,GAAlC,GAAwCyjC,SAAS,GAAG/+B,EADpD,CAAJ,EAC6D;AAC3D++B,MAAAA,SAAS,GAAG/+B,EAAZ;AACAg/B,MAAAA,UAAU,GAAG1jC,GAAb;AACA2jC,MAAAA,cAAc,GAAGO,OAAjB;AACD;AACF;;AAED,SAAOR,UAAU,GAAG,GAAb,GAAmBD,SAA1B;AACD,EAED;AACA;AACA;AACA;;;AACA,SAASU,eAAT,CAAyBC,IAAzB,EAA+B9O,QAA/B,EAAyC;AACvC,MAAIsO,OAAO,GAAGQ,IAAI,CAACx9B,KAAL,EAAd;AAEA,MAAIk9B,IAAJ;;AACA,SAAQA,IAAI,GAAGF,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAI1wB,GAAG,GAAG8jC,IAAI,CAAC9jC,GAAf;AACA,QAAI+jC,IAAI,GAAGD,IAAI,CAACE,GAAhB;AACA,QAAIC,QAAQ,GAAGF,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIM,MAAM,GACR/O,QAAQ,CAAC2O,QAAQ,CAAC/jC,MAAT,KAAoB,CAArB,EAAwBF,GAAxB,EAA6B+jC,IAAI,CAAC,CAAD,CAAjC,EAAsCD,IAAI,CAACQ,GAA3C,EAAgDP,IAAI,CAAC,CAAD,CAApD,CADV;;AAEA,SAAK,IAAIvuB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGiW,QAAQ,CAAC/jC,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnDouB,MAAAA,OAAO,CAACr+B,IAAR,CAAa;AAACvF,QAAAA,GAAG,EAAEA,GAAG,GAAG,CAAZ;AAAegkC,QAAAA,GAAG,EAAEC,QAAQ,CAACzuB,CAAD,CAA5B;AAAiC8uB,QAAAA,GAAG,EAAED;AAAtC,OAAb;AACD;AACF;AACF;;AAED,SAASE,SAAT,CAAmB78B,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,SAAOD,CAAC,CAAC1H,GAAF,GAAQ2H,CAAC,CAAC3H,GAAjB;AACD;;AAED,SAASwkC,aAAT,CAAuBJ,IAAvB,EAA6B;AAC3B,MAAIK,MAAM,GAAG,EAAb;AACAN,EAAAA,eAAe,CAACC,IAAD,EAAO,UAAUM,MAAV,EAAkB1kC,GAAlB,EAAuB0E,EAAvB,EAA2BigC,GAA3B,EAAgCjO,IAAhC,EAAsC;AAC1D,QAAIgO,MAAJ,EAAY;AACVD,MAAAA,MAAM,CAACl/B,IAAP,CAAY;AAAC2yB,QAAAA,GAAG,EAAEl4B,GAAG,GAAG,GAAN,GAAY0E,EAAlB;AAAsB1E,QAAAA,GAAG,EAAEA,GAA3B;AAAgC02B,QAAAA,IAAI,EAAEA;AAAtC,OAAZ;AACD;AACF,GAJc,CAAf;AAKA+N,EAAAA,MAAM,CAACG,IAAP,CAAYL,SAAZ,EAAuBM,OAAvB;;AACA,OAAK,IAAIrvB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGyW,MAAM,CAACvkC,MAA7B,EAAqCsV,CAAC,GAAGwY,GAAzC,EAA8CxY,CAAC,EAA/C,EAAmD;AACjD,WAAOivB,MAAM,CAACjvB,CAAD,CAAN,CAAUxV,GAAjB;AACD;;AACD,SAAOykC,MAAP;AACD,EAED;AACA;AACA;;;AACA,SAASK,gBAAT,CAA0BtB,QAA1B,EAAoC;AAClC,MAAIuB,GAAG,GAAGxB,UAAU,CAACC,QAAD,CAApB;AACA,MAAIiB,MAAM,GAAGD,aAAa,CAAChB,QAAQ,CAACK,QAAV,CAA1B;AACA,MAAImB,SAAS,GAAG,EAAhB;;AACA,OAAK,IAAIxvB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGyW,MAAM,CAACvkC,MAA7B,EAAqCsV,CAAC,GAAGwY,GAAzC,EAA8CxY,CAAC,EAA/C,EAAmD;AACjD,QAAIyvB,IAAI,GAAGR,MAAM,CAACjvB,CAAD,CAAjB;;AACA,QAAIyvB,IAAI,CAAC/M,GAAL,KAAa6M,GAAb,IAAoB,CAACE,IAAI,CAACvO,IAAL,CAAUwN,OAAnC,EAA4C;AAC1Cc,MAAAA,SAAS,CAACz/B,IAAV,CAAe0/B,IAAI,CAAC/M,GAApB;AACD;AACF;;AACD,SAAO8M,SAAP;AACD,EAED;AACA;;;AACA,SAASE,WAAT,CAAqB1B,QAArB,EAA+B;AAC7B,MAAIY,IAAI,GAAG,EAAX;AACAD,EAAAA,eAAe,CAACX,QAAQ,CAACK,QAAV,EAAoB,UAAUa,MAAV,EAAkB1kC,GAAlB,EACUmlC,OADV,EACmBb,GADnB,EACwB5N,IADxB,EAC8B;AAC/D,QAAIA,IAAI,CAACqD,MAAL,KAAgB,WAAhB,IAA+B,CAAC2K,MAApC,EAA4C;AAC1CN,MAAAA,IAAI,CAAC7+B,IAAL,CAAUvF,GAAG,GAAG,GAAN,GAAYmlC,OAAtB;AACAzO,MAAAA,IAAI,CAACqD,MAAL,GAAc,SAAd;AACD;AACF,GANc,CAAf;AAOA,SAAOqK,IAAP;AACD,EAED;;;AACA,SAASgB,UAAT,CAAoBhB,IAApB,EAA0B;AACxB,MAAIiB,KAAK,GAAG,EAAZ;AACA,MAAIzB,OAAO,GAAGQ,IAAI,CAACx9B,KAAL,EAAd;AACA,MAAIk9B,IAAJ;;AACA,SAAQA,IAAI,GAAGF,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAI1wB,GAAG,GAAG8jC,IAAI,CAAC9jC,GAAf;AACA,QAAI+jC,IAAI,GAAGD,IAAI,CAACE,GAAhB;AACA,QAAIt/B,EAAE,GAAGq/B,IAAI,CAAC,CAAD,CAAb;AACA,QAAIrN,IAAI,GAAGqN,IAAI,CAAC,CAAD,CAAf;AACA,QAAIE,QAAQ,GAAGF,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIW,MAAM,GAAGT,QAAQ,CAAC/jC,MAAT,KAAoB,CAAjC;AAEA,QAAIolC,OAAO,GAAGxB,IAAI,CAACwB,OAAL,GAAexB,IAAI,CAACwB,OAAL,CAAa1+B,KAAb,EAAf,GAAsC,EAApD;AACA0+B,IAAAA,OAAO,CAAC//B,IAAR,CAAa;AAACb,MAAAA,EAAE,EAAEA,EAAL;AAASgyB,MAAAA,IAAI,EAAEA;AAAf,KAAb;;AACA,QAAIgO,MAAJ,EAAY;AACVW,MAAAA,KAAK,CAAC9/B,IAAN,CAAW;AAACvF,QAAAA,GAAG,EAAGA,GAAG,GAAG,CAAN,GAAUslC,OAAO,CAACplC,MAAzB;AAAkC8jC,QAAAA,GAAG,EAAEsB;AAAvC,OAAX;AACD;;AACD,SAAK,IAAI9vB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGiW,QAAQ,CAAC/jC,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnDouB,MAAAA,OAAO,CAACr+B,IAAR,CAAa;AAACvF,QAAAA,GAAG,EAAEA,GAAG,GAAG,CAAZ;AAAegkC,QAAAA,GAAG,EAAEC,QAAQ,CAACzuB,CAAD,CAA5B;AAAiC8vB,QAAAA,OAAO,EAAEA;AAA1C,OAAb;AACD;AACF;;AACD,SAAOD,KAAK,CAACR,OAAN,EAAP;AACD,EAED;;;AAEA,SAASU,WAAT,CAAqB79B,CAArB,EAAwBC,CAAxB,EAA2B;AACzB,SAAOD,CAAC,CAAC1H,GAAF,GAAQ2H,CAAC,CAAC3H,GAAjB;AACD,EAED;;;AACA,SAASwlC,YAAT,CAAsBjV,GAAtB,EAA2BlP,IAA3B,EAAiCokB,UAAjC,EAA6C;AAC3C,MAAIC,GAAG,GAAG,CAAV;AACA,MAAIC,IAAI,GAAGpV,GAAG,CAACrwB,MAAf;AACA,MAAIoU,GAAJ;;AACA,SAAOoxB,GAAG,GAAGC,IAAb,EAAmB;AACjBrxB,IAAAA,GAAG,GAAIoxB,GAAG,GAAGC,IAAP,KAAiB,CAAvB;;AACA,QAAIF,UAAU,CAAClV,GAAG,CAACjc,GAAD,CAAJ,EAAW+M,IAAX,CAAV,GAA6B,CAAjC,EAAoC;AAClCqkB,MAAAA,GAAG,GAAGpxB,GAAG,GAAG,CAAZ;AACD,KAFD,MAEO;AACLqxB,MAAAA,IAAI,GAAGrxB,GAAP;AACD;AACF;;AACD,SAAOoxB,GAAP;AACD,EAED;;;AACA,SAASE,YAAT,CAAsBrV,GAAtB,EAA2BlP,IAA3B,EAAiCokB,UAAjC,EAA6C;AAC3C,MAAI93B,GAAG,GAAG63B,YAAY,CAACjV,GAAD,EAAMlP,IAAN,EAAYokB,UAAZ,CAAtB;AACAlV,EAAAA,GAAG,CAAC1iB,MAAJ,CAAWF,GAAX,EAAgB,CAAhB,EAAmB0T,IAAnB;AACD,EAED;AACA;AACA;;;AACA,SAASwkB,UAAT,CAAoBC,IAApB,EAA0BC,UAA1B,EAAsC;AACpC,MAAIC,IAAJ;AACA,MAAIf,IAAJ;;AACA,OAAK,IAAIzvB,CAAC,GAAGuwB,UAAR,EAAoB/X,GAAG,GAAG8X,IAAI,CAAC5lC,MAApC,EAA4CsV,CAAC,GAAGwY,GAAhD,EAAqDxY,CAAC,EAAtD,EAA0D;AACxD,QAAIsuB,IAAI,GAAGgC,IAAI,CAACtwB,CAAD,CAAf;AACA,QAAIywB,WAAW,GAAG,CAACnC,IAAI,CAACp/B,EAAN,EAAUo/B,IAAI,CAACpN,IAAf,EAAqB,EAArB,CAAlB;;AACA,QAAIuO,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAAC,CAAD,CAAJ,CAAQ1/B,IAAR,CAAa0gC,WAAb;AACAhB,MAAAA,IAAI,GAAGgB,WAAP;AACD,KAHD,MAGO;AACLD,MAAAA,IAAI,GAAGf,IAAI,GAAGgB,WAAd;AACD;AACF;;AACD,SAAOD,IAAP;AACD,EAED;;;AACA,SAASE,WAAT,CAAqBx+B,CAArB,EAAwBC,CAAxB,EAA2B;AACzB,SAAOD,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAC,CAAC,CAAD,CAAR,GAAc,CAAC,CAAf,GAAmB,CAA1B;AACD,EAED;AACA;;;AACA,SAASw+B,SAAT,CAAmBC,QAAnB,EAA6BC,QAA7B,EAAuC;AACrC,MAAI/U,KAAK,GAAG,CAAC;AAACgV,IAAAA,KAAK,EAAEF,QAAR;AAAkBG,IAAAA,KAAK,EAAEF;AAAzB,GAAD,CAAZ;AACA,MAAIrB,SAAS,GAAG,KAAhB;;AACA,SAAO1T,KAAK,CAACpxB,MAAN,GAAe,CAAtB,EAAyB;AACvB,QAAImhB,IAAI,GAAGiQ,KAAK,CAACZ,GAAN,EAAX;AACA,QAAI4V,KAAK,GAAGjlB,IAAI,CAACilB,KAAjB;AACA,QAAIC,KAAK,GAAGllB,IAAI,CAACklB,KAAjB;;AAEA,QAAID,KAAK,CAAC,CAAD,CAAL,CAASvM,MAAT,IAAmBwM,KAAK,CAAC,CAAD,CAAL,CAASxM,MAAhC,EAAwC;AACtCuM,MAAAA,KAAK,CAAC,CAAD,CAAL,CAASvM,MAAT,GACGuM,KAAK,CAAC,CAAD,CAAL,CAASvM,MAAT,KAAqB,WAArB,IACDwM,KAAK,CAAC,CAAD,CAAL,CAASxM,MAAT,KAAoB,WADpB,GACmC,WADnC,GACiD,SAFnD;AAGD;;AAED,SAAK,IAAIvkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+wB,KAAK,CAAC,CAAD,CAAL,CAASrmC,MAA7B,EAAqCsV,CAAC,EAAtC,EAA0C;AACxC,UAAI,CAAC8wB,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,CAAL,EAAkB;AAChBtB,QAAAA,SAAS,GAAG,UAAZ;AACAsB,QAAAA,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,IAAcC,KAAK,CAAC,CAAD,CAAL,CAAS/wB,CAAT,CAAd;AACA;AACD;;AAED,UAAIgxB,MAAM,GAAG,KAAb;;AACA,WAAK,IAAI/vB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6vB,KAAK,CAAC,CAAD,CAAL,CAASpmC,MAA7B,EAAqCuW,CAAC,EAAtC,EAA0C;AACxC,YAAI6vB,KAAK,CAAC,CAAD,CAAL,CAAS7vB,CAAT,EAAY,CAAZ,MAAmB8vB,KAAK,CAAC,CAAD,CAAL,CAAS/wB,CAAT,EAAY,CAAZ,CAAvB,EAAuC;AACrC8b,UAAAA,KAAK,CAAC/rB,IAAN,CAAW;AAAC+gC,YAAAA,KAAK,EAAEA,KAAK,CAAC,CAAD,CAAL,CAAS7vB,CAAT,CAAR;AAAqB8vB,YAAAA,KAAK,EAAEA,KAAK,CAAC,CAAD,CAAL,CAAS/wB,CAAT;AAA5B,WAAX;AACAgxB,UAAAA,MAAM,GAAG,IAAT;AACD;AACF;;AACD,UAAI,CAACA,MAAL,EAAa;AACXxB,QAAAA,SAAS,GAAG,YAAZ;AACAY,QAAAA,YAAY,CAACU,KAAK,CAAC,CAAD,CAAN,EAAWC,KAAK,CAAC,CAAD,CAAL,CAAS/wB,CAAT,CAAX,EAAwB0wB,WAAxB,CAAZ;AACD;AACF;AACF;;AACD,SAAO;AAAClB,IAAAA,SAAS,EAAEA,SAAZ;AAAuBjB,IAAAA,IAAI,EAAEqC;AAA7B,GAAP;AACD;;AAED,SAASK,OAAT,CAAiB1C,IAAjB,EAAuB+B,IAAvB,EAA6BY,UAA7B,EAAyC;AACvC,MAAIC,OAAO,GAAG,EAAd;AACA,MAAI3B,SAAS,GAAG,KAAhB;AACA,MAAIwB,MAAM,GAAG,KAAb;AACA,MAAItT,GAAJ;;AAEA,MAAI,CAAC6Q,IAAI,CAAC7jC,MAAV,EAAkB;AAChB,WAAO;AAAC6jC,MAAAA,IAAI,EAAE,CAAC+B,IAAD,CAAP;AAAed,MAAAA,SAAS,EAAE;AAA1B,KAAP;AACD;;AAED,OAAK,IAAIxvB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAG+V,IAAI,CAAC7jC,MAA3B,EAAmCsV,CAAC,GAAGwY,GAAvC,EAA4CxY,CAAC,EAA7C,EAAiD;AAC/C,QAAIoxB,MAAM,GAAG7C,IAAI,CAACvuB,CAAD,CAAjB;;AACA,QAAIoxB,MAAM,CAAC5mC,GAAP,KAAe8lC,IAAI,CAAC9lC,GAApB,IAA2B4mC,MAAM,CAAC5C,GAAP,CAAW,CAAX,MAAkB8B,IAAI,CAAC9B,GAAL,CAAS,CAAT,CAAjD,EAA8D;AAC5D;AACA;AACA9Q,MAAAA,GAAG,GAAGiT,SAAS,CAACS,MAAM,CAAC5C,GAAR,EAAa8B,IAAI,CAAC9B,GAAlB,CAAf;AACA2C,MAAAA,OAAO,CAACphC,IAAR,CAAa;AAACvF,QAAAA,GAAG,EAAE4mC,MAAM,CAAC5mC,GAAb;AAAkBgkC,QAAAA,GAAG,EAAE9Q,GAAG,CAAC6Q;AAA3B,OAAb;AACAiB,MAAAA,SAAS,GAAGA,SAAS,IAAI9R,GAAG,CAAC8R,SAA7B;AACAwB,MAAAA,MAAM,GAAG,IAAT;AACD,KAPD,MAOO,IAAIE,UAAU,KAAK,IAAnB,EAAyB;AAC9B;AACA;AACA;AACA;AAEA,UAAIG,EAAE,GAAGD,MAAM,CAAC5mC,GAAP,GAAa8lC,IAAI,CAAC9lC,GAAlB,GAAwB4mC,MAAxB,GAAiCd,IAA1C;AACA,UAAIgB,EAAE,GAAGF,MAAM,CAAC5mC,GAAP,GAAa8lC,IAAI,CAAC9lC,GAAlB,GAAwB8lC,IAAxB,GAA+Bc,MAAxC;AACA,UAAIG,IAAI,GAAGD,EAAE,CAAC9mC,GAAH,GAAS6mC,EAAE,CAAC7mC,GAAvB;AAEA,UAAIgnC,gBAAgB,GAAG,EAAvB;AAEA,UAAIC,KAAK,GAAG,EAAZ;AACAA,MAAAA,KAAK,CAAC1hC,IAAN,CAAW;AAACy+B,QAAAA,GAAG,EAAE6C,EAAE,CAAC7C,GAAT;AAAc+C,QAAAA,IAAI,EAAEA,IAApB;AAA0BG,QAAAA,MAAM,EAAE,IAAlC;AAAwCC,QAAAA,SAAS,EAAE;AAAnD,OAAX;;AACA,aAAOF,KAAK,CAAC/mC,MAAN,GAAe,CAAtB,EAAyB;AACvB,YAAImhB,IAAI,GAAG4lB,KAAK,CAACvW,GAAN,EAAX;;AACA,YAAIrP,IAAI,CAAC0lB,IAAL,KAAc,CAAlB,EAAqB;AACnB,cAAI1lB,IAAI,CAAC2iB,GAAL,CAAS,CAAT,MAAgB8C,EAAE,CAAC9C,GAAH,CAAO,CAAP,CAApB,EAA+B;AAC7BgD,YAAAA,gBAAgB,CAACzhC,IAAjB,CAAsB8b,IAAtB;AACD;;AACD;AACD;;AACD,YAAI+lB,QAAQ,GAAG/lB,IAAI,CAAC2iB,GAAL,CAAS,CAAT,CAAf;;AACA,aAAK,IAAIvtB,CAAC,GAAG,CAAR,EAAW4wB,WAAW,GAAGD,QAAQ,CAAClnC,MAAvC,EAA+CuW,CAAC,GAAG4wB,WAAnD,EAAgE5wB,CAAC,EAAjE,EAAqE;AACnEwwB,UAAAA,KAAK,CAAC1hC,IAAN,CAAW;AACTy+B,YAAAA,GAAG,EAAEoD,QAAQ,CAAC3wB,CAAD,CADJ;AAETswB,YAAAA,IAAI,EAAE1lB,IAAI,CAAC0lB,IAAL,GAAY,CAFT;AAGTG,YAAAA,MAAM,EAAE7lB,IAAI,CAAC2iB,GAHJ;AAITmD,YAAAA,SAAS,EAAE1wB;AAJF,WAAX;AAMD;AACF;;AAED,UAAI6wB,EAAE,GAAGN,gBAAgB,CAAC,CAAD,CAAzB;;AAEA,UAAI,CAACM,EAAL,EAAS;AACPX,QAAAA,OAAO,CAACphC,IAAR,CAAaqhC,MAAb;AACD,OAFD,MAEO;AACL1T,QAAAA,GAAG,GAAGiT,SAAS,CAACmB,EAAE,CAACtD,GAAJ,EAAS8C,EAAE,CAAC9C,GAAZ,CAAf;AACAsD,QAAAA,EAAE,CAACJ,MAAH,CAAU,CAAV,EAAaI,EAAE,CAACH,SAAhB,IAA6BjU,GAAG,CAAC6Q,IAAjC;AACA4C,QAAAA,OAAO,CAACphC,IAAR,CAAa;AAACvF,UAAAA,GAAG,EAAE6mC,EAAE,CAAC7mC,GAAT;AAAcgkC,UAAAA,GAAG,EAAE6C,EAAE,CAAC7C;AAAtB,SAAb;AACAgB,QAAAA,SAAS,GAAGA,SAAS,IAAI9R,GAAG,CAAC8R,SAA7B;AACAwB,QAAAA,MAAM,GAAG,IAAT;AACD;AACF,KA5CM,MA4CA;AACLG,MAAAA,OAAO,CAACphC,IAAR,CAAaqhC,MAAb;AACD;AACF,GAlEsC,CAoEvC;;;AACA,MAAI,CAACJ,MAAL,EAAa;AACXG,IAAAA,OAAO,CAACphC,IAAR,CAAaugC,IAAb;AACD;;AAEDa,EAAAA,OAAO,CAAC/B,IAAR,CAAaW,WAAb;AAEA,SAAO;AACLxB,IAAAA,IAAI,EAAE4C,OADD;AAEL3B,IAAAA,SAAS,EAAEA,SAAS,IAAI;AAFnB,GAAP;AAID,EAED;;;AACA,SAASuC,IAAT,CAAcxD,IAAd,EAAoByD,KAApB,EAA2B;AACzB;AACA,MAAInC,KAAK,GAAGD,UAAU,CAACrB,IAAD,CAAtB;AACA,MAAI0D,WAAJ;AAEA,MAAI/kC,MAAJ;;AACA,OAAK,IAAI8S,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGqX,KAAK,CAACnlC,MAA5B,EAAoCsV,CAAC,GAAGwY,GAAxC,EAA6CxY,CAAC,EAA9C,EAAkD;AAChD;AACA;AACA,QAAIswB,IAAI,GAAGT,KAAK,CAAC7vB,CAAD,CAAhB;AACA,QAAIkyB,OAAO,GAAG5B,IAAI,CAAC9B,GAAnB;AACA,QAAIF,IAAJ;;AACA,QAAI4D,OAAO,CAACxnC,MAAR,GAAiBsnC,KAArB,EAA4B;AAC1B;AACA,UAAI,CAACC,WAAL,EAAkB;AAChBA,QAAAA,WAAW,GAAG,EAAd,CADgB,CACE;AACnB;;AACD,UAAI1B,UAAU,GAAG2B,OAAO,CAACxnC,MAAR,GAAiBsnC,KAAlC;AACA1D,MAAAA,IAAI,GAAG;AACL9jC,QAAAA,GAAG,EAAE8lC,IAAI,CAAC9lC,GAAL,GAAW+lC,UADX;AAEL/B,QAAAA,GAAG,EAAE6B,UAAU,CAAC6B,OAAD,EAAU3B,UAAV;AAFV,OAAP;;AAKA,WAAK,IAAI73B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG63B,UAApB,EAAgC73B,CAAC,EAAjC,EAAqC;AACnC,YAAIgqB,GAAG,GAAI4N,IAAI,CAAC9lC,GAAL,GAAWkO,CAAZ,GAAiB,GAAjB,GAAuBw5B,OAAO,CAACx5B,CAAD,CAAP,CAAWxJ,EAA5C;AACA+iC,QAAAA,WAAW,CAACvP,GAAD,CAAX,GAAmB,IAAnB;AACD;AACF,KAfD,MAeO;AAAE;AACP4L,MAAAA,IAAI,GAAG;AACL9jC,QAAAA,GAAG,EAAE8lC,IAAI,CAAC9lC,GADL;AAELgkC,QAAAA,GAAG,EAAE6B,UAAU,CAAC6B,OAAD,EAAU,CAAV;AAFV,OAAP;AAID,KA1B+C,CA4BhD;AACA;;;AACA,QAAIhlC,MAAJ,EAAY;AACVA,MAAAA,MAAM,GAAG+jC,OAAO,CAAC/jC,MAAD,EAASohC,IAAT,EAAe,IAAf,CAAP,CAA4BC,IAArC;AACD,KAFD,MAEO;AACLrhC,MAAAA,MAAM,GAAG,CAACohC,IAAD,CAAT;AACD;AACF,GAzCwB,CA2CzB;;;AACA,MAAI2D,WAAJ,EAAiB;AACftD,IAAAA,eAAe,CAACzhC,MAAD,EAAS,UAAUgiC,MAAV,EAAkB1kC,GAAlB,EAAuBmlC,OAAvB,EAAgC;AACtD;AACA,aAAOsC,WAAW,CAACznC,GAAG,GAAG,GAAN,GAAYmlC,OAAb,CAAlB;AACD,KAHc,CAAf;AAID;;AAED,SAAO;AACLpB,IAAAA,IAAI,EAAErhC,MADD;AAEL0hC,IAAAA,IAAI,EAAEqD,WAAW,GAAGjmC,MAAM,CAACoC,IAAP,CAAY6jC,WAAZ,CAAH,GAA8B;AAF1C,GAAP;AAID;;AAED,SAASE,KAAT,CAAe5D,IAAf,EAAqB+B,IAArB,EAA2B0B,KAA3B,EAAkC;AAChC,MAAII,OAAO,GAAGnB,OAAO,CAAC1C,IAAD,EAAO+B,IAAP,CAArB;AACA,MAAI4B,OAAO,GAAGH,IAAI,CAACK,OAAO,CAAC7D,IAAT,EAAeyD,KAAf,CAAlB;AACA,SAAO;AACLzD,IAAAA,IAAI,EAAE2D,OAAO,CAAC3D,IADT;AAEL0D,IAAAA,WAAW,EAAEC,OAAO,CAACtD,IAFhB;AAGLY,IAAAA,SAAS,EAAE4C,OAAO,CAAC5C;AAHd,GAAP;AAKD,EAED;;;AACA,SAAS6C,SAAT,CAAmBzD,IAAnB,EAAyBlM,GAAzB,EAA8B;AAC5B,MAAI0L,OAAO,GAAGQ,IAAI,CAACx9B,KAAL,EAAd;AACA,MAAIkhC,QAAQ,GAAG5P,GAAG,CAACnY,KAAJ,CAAU,GAAV,CAAf;AACA,MAAIgoB,SAAS,GAAG5nC,QAAQ,CAAC2nC,QAAQ,CAAC,CAAD,CAAT,EAAc,EAAd,CAAxB;AACA,MAAIE,QAAQ,GAAGF,QAAQ,CAAC,CAAD,CAAvB;AAEA,MAAIhE,IAAJ;;AACA,SAAQA,IAAI,GAAGF,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAIoT,IAAI,CAAC9jC,GAAL,KAAa+nC,SAAb,IAA0BjE,IAAI,CAACE,GAAL,CAAS,CAAT,MAAgBgE,QAA9C,EAAwD;AACtD,aAAO,IAAP;AACD;;AACD,QAAI/D,QAAQ,GAAGH,IAAI,CAACE,GAAL,CAAS,CAAT,CAAf;;AACA,SAAK,IAAIxuB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGiW,QAAQ,CAAC/jC,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnDouB,MAAAA,OAAO,CAACr+B,IAAR,CAAa;AAACvF,QAAAA,GAAG,EAAE8jC,IAAI,CAAC9jC,GAAL,GAAW,CAAjB;AAAoBgkC,QAAAA,GAAG,EAAEC,QAAQ,CAACzuB,CAAD;AAAjC,OAAb;AACD;AACF;;AACD,SAAO,KAAP;AACD;;AAED,SAASyyB,QAAT,CAAkBnE,IAAlB,EAAwB;AACtB,SAAOA,IAAI,CAACE,GAAZ;AACD,EAED;AACA;AACA;;;AACA,SAASkE,SAAT,CAAmB1E,QAAnB,EAA6BtL,GAA7B,EAAkC;AAChC,MAAI,CAACA,GAAL,EAAU;AACRA,IAAAA,GAAG,GAAGqL,UAAU,CAACC,QAAD,CAAhB;AACD;;AACD,MAAI9+B,EAAE,GAAGwzB,GAAG,CAACrF,SAAJ,CAAcqF,GAAG,CAACtqB,OAAJ,CAAY,GAAZ,IAAmB,CAAjC,CAAT;AACA,MAAIg2B,OAAO,GAAGJ,QAAQ,CAACK,QAAT,CAAkBt0B,GAAlB,CAAsB04B,QAAtB,CAAd;AAEA,MAAIlE,IAAJ;;AACA,SAAQA,IAAI,GAAGH,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAIqT,IAAI,CAAC,CAAD,CAAJ,KAAYr/B,EAAhB,EAAoB;AAClB,aAAO,CAAC,CAACq/B,IAAI,CAAC,CAAD,CAAJ,CAAQG,OAAjB;AACD;;AACDN,IAAAA,OAAO,GAAGA,OAAO,CAAC58B,MAAR,CAAe+8B,IAAI,CAAC,CAAD,CAAnB,CAAV;AACD;AACF;;AAED,SAASoE,SAAT,CAAmBzjC,EAAnB,EAAuB;AACrB,SAAQ,SAAD,CAAYohB,IAAZ,CAAiBphB,EAAjB,CAAP;AACD,EAED;;;AACA,SAAS0jC,MAAT,CAAgBlQ,GAAhB,EAAqBsL,QAArB,EAA+B;AAC7B,MAAII,OAAO,GAAGJ,QAAQ,CAACK,QAAT,CAAkBj9B,KAAlB,EAAd;AACA,MAAIk9B,IAAJ;;AACA,SAAQA,IAAI,GAAGF,OAAO,CAAClT,GAAR,EAAf,EAA+B;AAC7B,QAAI1wB,GAAG,GAAG8jC,IAAI,CAAC9jC,GAAf;AACA,QAAI+jC,IAAI,GAAGD,IAAI,CAACE,GAAhB;AACA,QAAIt/B,EAAE,GAAGq/B,IAAI,CAAC,CAAD,CAAb;AACA,QAAIrN,IAAI,GAAGqN,IAAI,CAAC,CAAD,CAAf;AACA,QAAIE,QAAQ,GAAGF,IAAI,CAAC,CAAD,CAAnB;AACA,QAAIW,MAAM,GAAGT,QAAQ,CAAC/jC,MAAT,KAAoB,CAAjC;AAEA,QAAIolC,OAAO,GAAGxB,IAAI,CAACwB,OAAL,GAAexB,IAAI,CAACwB,OAAL,CAAa1+B,KAAb,EAAf,GAAsC,EAApD;AACA0+B,IAAAA,OAAO,CAAC//B,IAAR,CAAa;AAACb,MAAAA,EAAE,EAAEA,EAAL;AAAS1E,MAAAA,GAAG,EAAEA,GAAd;AAAmB02B,MAAAA,IAAI,EAAEA;AAAzB,KAAb;;AAEA,QAAIgO,MAAJ,EAAY;AACV,WAAK,IAAIlvB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGsX,OAAO,CAACplC,MAA9B,EAAsCsV,CAAC,GAAGwY,GAA1C,EAA+CxY,CAAC,EAAhD,EAAoD;AAClD,YAAI6yB,WAAW,GAAG/C,OAAO,CAAC9vB,CAAD,CAAzB;AACA,YAAI8yB,UAAU,GAAGD,WAAW,CAACroC,GAAZ,GAAkB,GAAlB,GAAwBqoC,WAAW,CAAC3jC,EAArD;;AAEA,YAAI4jC,UAAU,KAAKpQ,GAAnB,EAAwB;AACtB;AACA,iBAAOl4B,GAAG,GAAG,GAAN,GAAY0E,EAAnB;AACD;AACF;AACF;;AAED,SAAK,IAAI+R,CAAC,GAAG,CAAR,EAAW8xB,CAAC,GAAGtE,QAAQ,CAAC/jC,MAA7B,EAAqCuW,CAAC,GAAG8xB,CAAzC,EAA4C9xB,CAAC,EAA7C,EAAiD;AAC/CmtB,MAAAA,OAAO,CAACr+B,IAAR,CAAa;AAACvF,QAAAA,GAAG,EAAEA,GAAG,GAAG,CAAZ;AAAegkC,QAAAA,GAAG,EAAEC,QAAQ,CAACxtB,CAAD,CAA5B;AAAiC6uB,QAAAA,OAAO,EAAEA;AAA1C,OAAb;AACD;AACF;AAED;;;AACA,QAAM,IAAItjC,KAAJ,CAAU,8CAA8CwhC,QAAQ,CAAC9+B,EAAvD,GAA4D,QAA5D,GAAuEwzB,GAAjF,CAAN;AACD;;AAED,uBAASsQ,SAAT,EAAoB5b,oBAApB;;AAEA,SAAS6b,wBAAT,CAAkCvT,IAAlC,EAAwCwH,MAAxC,EAAgDgM,OAAhD,EAAyDC,OAAzD,EAAkE;AAChE;AACA,MAAI;AACFzT,IAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoBgP,MAApB,EAA4BgM,OAA5B,EAAqCC,OAArC;AACD,GAFD,CAEE,OAAOznC,CAAP,EAAU;AACVq4B,IAAAA,cAAc,CAAC,OAAD,EAAU,mCAAV,EAA+Cr4B,CAA/C,CAAd;AACD;AACF;;AAED,SAASsnC,SAAT,CAAmB/R,EAAnB,EAAuBC,IAAvB,EAA6BpB,QAA7B,EAAuC;AACrC1I,uBAAanpB,IAAb,CAAkB,IAAlB;;AACA,MAAIyxB,IAAI,GAAG,IAAX;AACA,OAAKuB,EAAL,GAAUA,EAAV;AACAC,EAAAA,IAAI,GAAGA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAR,GAAiB,EAA5B;AACA,MAAIlZ,QAAQ,GAAGkZ,IAAI,CAAClZ,QAAL,GAAgBgS,IAAI,CAAC,UAAUzf,GAAV,EAAeslB,IAAf,EAAqB;AACvD,QAAItlB,GAAJ,EAAS;AACP,UAAIsgB,aAAa,CAAC6E,IAAD,EAAO,OAAP,CAAb,GAA+B,CAAnC,EAAsC;AACpCA,QAAAA,IAAI,CAACxH,IAAL,CAAU,OAAV,EAAmB3d,GAAnB;AACD;AACF,KAJD,MAIO;AACLmlB,MAAAA,IAAI,CAACxH,IAAL,CAAU,UAAV,EAAsB2H,IAAtB;AACD;;AACDH,IAAAA,IAAI,CAACnF,kBAAL;AACA0G,IAAAA,EAAE,CAACrH,cAAH,CAAkB,WAAlB,EAA+BwZ,SAA/B;AACD,GAVkC,CAAnC;;AAWA,MAAItT,QAAJ,EAAc;AACZJ,IAAAA,IAAI,CAAClG,EAAL,CAAQ,UAAR,EAAoB,UAAUqG,IAAV,EAAgB;AAClCC,MAAAA,QAAQ,CAAC,IAAD,EAAOD,IAAP,CAAR;AACD,KAFD;AAGAH,IAAAA,IAAI,CAAClG,EAAL,CAAQ,OAAR,EAAiBsG,QAAjB;AACD;;AACD,WAASsT,SAAT,GAAqB;AACnB1T,IAAAA,IAAI,CAAC2T,MAAL;AACD;;AACDpS,EAAAA,EAAE,CAACjH,IAAH,CAAQ,WAAR,EAAqBoZ,SAArB;;AAEAlS,EAAAA,IAAI,CAAC0C,QAAL,GAAgB,UAAUsD,MAAV,EAAkBgM,OAAlB,EAA2BC,OAA3B,EAAoC;AAClD;AACA,QAAIzT,IAAI,CAAC4T,WAAT,EAAsB;AACpB;AACD;;AACDL,IAAAA,wBAAwB,CAACvT,IAAD,EAAOwH,MAAP,EAAegM,OAAf,EAAwBC,OAAxB,CAAxB;AACD,GAND;;AAQA,MAAInhB,OAAO,GAAG,IAAI9c,OAAJ,CAAY,UAAU0qB,OAAV,EAAmBzqB,MAAnB,EAA2B;AACnD+rB,IAAAA,IAAI,CAAClZ,QAAL,GAAgB,UAAUzN,GAAV,EAAemjB,GAAf,EAAoB;AAClC,UAAInjB,GAAJ,EAAS;AACPpF,QAAAA,MAAM,CAACoF,GAAD,CAAN;AACD,OAFD,MAEO;AACLqlB,QAAAA,OAAO,CAAClC,GAAD,CAAP;AACD;AACF,KAND;AAOD,GARa,CAAd;AASAgC,EAAAA,IAAI,CAAC1F,IAAL,CAAU,QAAV,EAAoB,YAAY;AAC9BiH,IAAAA,EAAE,CAACrH,cAAH,CAAkB,WAAlB,EAA+BwZ,SAA/B;AACAlS,IAAAA,IAAI,CAAClZ,QAAL,CAAc,IAAd,EAAoB;AAACuc,MAAAA,MAAM,EAAE;AAAT,KAApB;AACD,GAHD;AAIA,OAAK5xB,IAAL,GAAYqf,OAAO,CAACrf,IAAR,CAAa8B,IAAb,CAAkBud,OAAlB,CAAZ;AACA,OAAK,OAAL,IAAgBA,OAAO,CAAC,OAAD,CAAP,CAAiBvd,IAAjB,CAAsBud,OAAtB,CAAhB;AACA,OAAKrf,IAAL,CAAU,UAAUzF,MAAV,EAAkB;AAC1B8a,IAAAA,QAAQ,CAAC,IAAD,EAAO9a,MAAP,CAAR;AACD,GAFD,EAEG8a,QAFH;;AAMA,MAAI,CAACiZ,EAAE,CAACV,SAAH,CAAaC,OAAlB,EAA2B;AACzBS,IAAAA,EAAE,CAACV,SAAH,CAAaE,OAAb,CAAqB,UAAUnU,MAAV,EAAkB;AACrC,UAAIA,MAAJ,EAAY;AACV4U,QAAAA,IAAI,CAAClZ,QAAL,CAAcsE,MAAd;AACD,OAFD,MAEO,IAAIoT,IAAI,CAAC4T,WAAT,EAAsB;AAC3B5T,QAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV;AACD,OAFM,MAEA;AACLwH,QAAAA,IAAI,CAAC6T,eAAL,CAAqBrS,IAArB;AACD;AACF,KARD;AASD,GAVD,MAUO;AACLxB,IAAAA,IAAI,CAAC6T,eAAL,CAAqBrS,IAArB;AACD;AACF;;AACD8R,SAAS,CAAC9nC,SAAV,CAAoBmoC,MAApB,GAA6B,YAAY;AACvC,OAAKC,WAAL,GAAmB,IAAnB;;AACA,MAAI,KAAKrS,EAAL,CAAQV,SAAR,CAAkBC,OAAtB,EAA+B;AAC7B,SAAKtI,IAAL,CAAU,QAAV;AACD;AACF,CALD;;AAMA,SAASsb,aAAT,CAAuB7M,GAAvB,EAA4BqH,QAA5B,EAAsC9M,IAAtC,EAA4C;AAC1C,MAAIuS,UAAU,GAAG,CAAC;AAAC/Q,IAAAA,GAAG,EAAEiE,GAAG,CAACyC;AAAV,GAAD,CAAjB;;AACA,MAAIlI,IAAI,CAACwS,KAAL,KAAe,UAAnB,EAA+B;AAC7BD,IAAAA,UAAU,GAAGzE,aAAa,CAAChB,QAAQ,CAACK,QAAV,CAAb,CACZt0B,GADY,CACR,UAAU8mB,CAAV,EAAa;AAAE,aAAO;AAAC6B,QAAAA,GAAG,EAAE7B,CAAC,CAAC6B;AAAR,OAAP;AAAsB,KAD7B,CAAb;AAED;;AACD,MAAIwE,MAAM,GAAG;AACXh4B,IAAAA,EAAE,EAAE8+B,QAAQ,CAAC9+B,EADF;AAEXs0B,IAAAA,OAAO,EAAEiQ,UAFE;AAGX9M,IAAAA,GAAG,EAAEA;AAHM,GAAb;;AAMA,MAAI+L,SAAS,CAAC1E,QAAD,EAAWrH,GAAG,CAACyC,IAAf,CAAb,EAAmC;AACjClC,IAAAA,MAAM,CAACwH,OAAP,GAAiB,IAAjB;AACD;;AACD,MAAIxN,IAAI,CAACsO,SAAT,EAAoB;AAClBtI,IAAAA,MAAM,CAACP,GAAP,CAAWgN,UAAX,GAAwBrE,gBAAgB,CAACtB,QAAD,CAAxC;;AACA,QAAI,CAAC9G,MAAM,CAACP,GAAP,CAAWgN,UAAX,CAAsBjpC,MAA3B,EAAmC;AACjC,aAAOw8B,MAAM,CAACP,GAAP,CAAWgN,UAAlB;AACD;AACF;;AACD,SAAOzM,MAAP;AACD;;AAED8L,SAAS,CAAC9nC,SAAV,CAAoBqoC,eAApB,GAAsC,UAAUrS,IAAV,EAAgB;AACpD,MAAIpB,QAAQ,GAAGoB,IAAI,CAAClZ,QAApB;AACA,MAAI0X,IAAI,GAAG,IAAX;AAEA;;AACA,MAAIkU,OAAO,CAACC,oBAAZ,EAAkC;AAChCD,IAAAA,OAAO,CAACC,oBAAR,CAA6BC,QAA7B,CAAsC5S,IAAtC,EAA4C,UAAU3mB,GAAV,EAAe;AACzD,UAAIA,GAAJ,EAAS;AACP,eAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACDmlB,MAAAA,IAAI,CAACqU,SAAL,CAAe7S,IAAf;AACD,KALD;AAMD,GAPD,MAOO;AACLxB,IAAAA,IAAI,CAACqU,SAAL,CAAe7S,IAAf;AACD;AACF,CAfD;;AAiBA8R,SAAS,CAAC9nC,SAAV,CAAoB6oC,SAApB,GAAgC,UAAU7S,IAAV,EAAgB;AAC9C,MAAIxB,IAAI,GAAG,IAAX;AACA,MAAII,QAAQ,GAAGoB,IAAI,CAAClZ,QAApB;AAEAkZ,EAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;;AACA,MAAI,UAAUA,IAAV,IAAkB,EAAE,gBAAgBA,IAAlB,CAAtB,EAA+C;AAC7CA,IAAAA,IAAI,CAAC8S,UAAL,GAAkB9S,IAAI,CAAC+S,IAAvB;AACD;;AACD/S,EAAAA,IAAI,CAACsS,aAAL,GAAqBA,aAArB;;AAEA,MAAItS,IAAI,CAACwC,KAAL,KAAe,QAAnB,EAA6B;AAC3BxC,IAAAA,IAAI,CAACwC,KAAL,GAAa,KAAb;AACD;;AACD,MAAI,CAACxC,IAAI,CAACwC,KAAV,EAAiB;AACfxC,IAAAA,IAAI,CAACwC,KAAL,GAAa,CAAb;AACD;;AACD,MAAIxC,IAAI,CAACwC,KAAL,KAAe,KAAnB,EAA0B;AACxB,SAAKzC,EAAL,CAAQU,IAAR,GAAehvB,IAAf,CAAoB,UAAUgvB,IAAV,EAAgB;AAClC;AACA,UAAIjC,IAAI,CAAC4T,WAAT,EAAsB;AACpBxT,QAAAA,QAAQ,CAAC,IAAD,EAAO;AAACyE,UAAAA,MAAM,EAAE;AAAT,SAAP,CAAR;AACA;AACD;;AACDrD,MAAAA,IAAI,CAACwC,KAAL,GAAa/B,IAAI,CAACuS,UAAlB;AACAxU,MAAAA,IAAI,CAACqU,SAAL,CAAe7S,IAAf;AACD,KARD,EAQGpB,QARH;AASA;AACD;AAED;;;AACA,MAAI8T,OAAO,CAACC,oBAAZ,EAAkC;AAChCD,IAAAA,OAAO,CAACC,oBAAR,CAA6BM,SAA7B,CAAuCjT,IAAvC;;AACA,QAAI0S,OAAO,CAACC,oBAAR,CAA6BO,YAA7B,CAA0C,IAA1C,EAAgDlT,IAAhD,CAAJ,EAA2D;AACzD,aAAO0S,OAAO,CAACC,oBAAR,CAA6B/gC,MAA7B,CAAoC,IAApC,EAA0CouB,IAA1C,CAAP;AACD;AACF,GALD,MAKO;AACL,KAAC,SAAD,EAAY,QAAZ,EAAsB,UAAtB,EAAkC,MAAlC,EAA0C/xB,OAA1C,CAAkD,UAAUZ,GAAV,EAAe;AAC/D,UAAIA,GAAG,IAAI2yB,IAAX,EAAiB;AACf6C,QAAAA,cAAc,CAAC,MAAD,EACZ,UAAUx1B,GAAV,GAAgB,+CAAhB,GACA,4DADA,GAEA,6DAHY,CAAd;AAKD;AACF,KARD;AASD;;AAED,MAAI,EAAE,gBAAgB2yB,IAAlB,CAAJ,EAA6B;AAC3BA,IAAAA,IAAI,CAACmT,UAAL,GAAkB,KAAlB;AACD,GAjD6C,CAmD9C;;;AACAnT,EAAAA,IAAI,CAACoT,KAAL,GAAapT,IAAI,CAACoT,KAAL,KAAe,CAAf,GAAmB,CAAnB,GAAuBpT,IAAI,CAACoT,KAAzC;AACApT,EAAAA,IAAI,CAAClZ,QAAL,GAAgB8X,QAAhB;;AACA,MAAIyU,UAAU,GAAG,KAAKtT,EAAL,CAAQuT,QAAR,CAAiBtT,IAAjB,CAAjB;AACA;;;AACA,MAAIqT,UAAU,IAAI,OAAOA,UAAU,CAAClB,MAAlB,KAA6B,UAA/C,EAA2D;AACzD,QAAIA,MAAM,GAAG3T,IAAI,CAAC2T,MAAlB;AACA3T,IAAAA,IAAI,CAAC2T,MAAL,GAAc,wBAAa,UAAUz3B,IAAV,EAAgB;AACzC24B,MAAAA,UAAU,CAAClB,MAAX;AACAA,MAAAA,MAAM,CAAC9nC,KAAP,CAAa,IAAb,EAAmBqQ,IAAnB;AACD,KAHa,CAAd;AAID;AACF,CA/DD;AAiEA;;;;;AAIA,SAAS64B,OAAT,CAAiBC,IAAjB,EAAuBC,KAAvB,EAA8B;AAC5B,SAAOD,IAAI,GAAGC,KAAP,GAAe,CAAC,CAAhB,GAAoBD,IAAI,GAAGC,KAAP,GAAe,CAAf,GAAmB,CAA9C;AACD,EAED;AACA;;;AACA,SAASC,SAAT,CAAmB9U,QAAnB,EAA6BuC,KAA7B,EAAoC;AAClC,SAAO,UAAU9nB,GAAV,EAAeuT,OAAf,EAAwB;AAC7B,QAAIvT,GAAG,IAAKuT,OAAO,CAAC,CAAD,CAAP,IAAcA,OAAO,CAAC,CAAD,CAAP,CAAW3X,KAArC,EAA6C;AAC3CoE,MAAAA,GAAG,GAAGA,GAAG,IAAIuT,OAAO,CAAC,CAAD,CAApB;AACAvT,MAAAA,GAAG,CAAC8nB,KAAJ,GAAYA,KAAZ;AACAvC,MAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,KAJD,MAIO;AACLulB,MAAAA,QAAQ,CAAC,IAAD,EAAOhS,OAAO,CAACpjB,MAAR,GAAiBojB,OAAO,CAAC,CAAD,CAAxB,GAA+BA,OAAtC,CAAR;AACD;AACF,GARD;AASD,EAED;;;AACA,SAAS+mB,SAAT,CAAmBzT,IAAnB,EAAyB;AACvB,OAAK,IAAIphB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGohB,IAAI,CAAC12B,MAAzB,EAAiCsV,CAAC,EAAlC,EAAsC;AACpC,QAAI2mB,GAAG,GAAGvF,IAAI,CAACphB,CAAD,CAAd;;AACA,QAAI2mB,GAAG,CAACmO,QAAR,EAAkB;AAChB,aAAOnO,GAAG,CAACY,YAAX,CADgB,CACS;AAC1B,KAFD,MAEO,IAAIZ,GAAG,CAACY,YAAR,EAAsB;AAC3B;AACA,UAAIwN,IAAI,GAAG/oC,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,CAAX;;AACA,WAAK,IAAItmB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8zB,IAAI,CAACrqC,MAAzB,EAAiCuW,CAAC,EAAlC,EAAsC;AACpC,YAAIqmB,GAAG,GAAGyN,IAAI,CAAC9zB,CAAD,CAAd;AACA0lB,QAAAA,GAAG,CAACY,YAAJ,CAAiBD,GAAjB,IAAwB5G,IAAI,CAACiG,GAAG,CAACY,YAAJ,CAAiBD,GAAjB,CAAD,EAC1B,CAAC,MAAD,EAAS,QAAT,EAAmB,cAAnB,EAAmC,QAAnC,EAA6C,QAA7C,EAAuD,MAAvD,CAD0B,CAA5B;AAED;AACF;AACF;AACF,EAED;;;AACA,SAAS0N,kBAAT,CAA4B9iC,CAA5B,EAA+BC,CAA/B,EAAkC;AAChC,MAAI8iC,SAAS,GAAGR,OAAO,CAACviC,CAAC,CAACq3B,GAAH,EAAQp3B,CAAC,CAACo3B,GAAV,CAAvB;;AACA,MAAI0L,SAAS,KAAK,CAAlB,EAAqB;AACnB,WAAOA,SAAP;AACD;;AACD,MAAIC,MAAM,GAAGhjC,CAAC,CAACijC,UAAF,GAAejjC,CAAC,CAACijC,UAAF,CAAajrB,KAA5B,GAAoC,CAAjD;AACA,MAAIkrB,MAAM,GAAGjjC,CAAC,CAACgjC,UAAF,GAAehjC,CAAC,CAACgjC,UAAF,CAAajrB,KAA5B,GAAoC,CAAjD;AACA,SAAOuqB,OAAO,CAACS,MAAD,EAASE,MAAT,CAAd;AACD,EAED;AACA;;;AACA,SAASC,aAAT,CAAuBzG,IAAvB,EAA6B;AAC3B,MAAIj5B,MAAM,GAAG,EAAb;AACA,MAAI2/B,KAAK,GAAG,EAAZ;AACA3G,EAAAA,eAAe,CAACC,IAAD,EAAO,UAAUM,MAAV,EAAkB1kC,GAAlB,EAAuB0E,EAAvB,EAA2BqmC,IAA3B,EAAiC;AACrD,QAAIC,MAAM,GAAGhrC,GAAG,GAAG,GAAN,GAAY0E,EAAzB;;AACA,QAAIggC,MAAJ,EAAY;AACVv5B,MAAAA,MAAM,CAAC6/B,MAAD,CAAN,GAAiB,CAAjB;AACD;;AACD,QAAID,IAAI,KAAK5mC,SAAb,EAAwB;AACtB2mC,MAAAA,KAAK,CAACvlC,IAAN,CAAW;AAAC0lC,QAAAA,IAAI,EAAEF,IAAP;AAAa9Q,QAAAA,EAAE,EAAE+Q;AAAjB,OAAX;AACD;;AACD,WAAOA,MAAP;AACD,GATc,CAAf;AAWAF,EAAAA,KAAK,CAACjG,OAAN;AACAiG,EAAAA,KAAK,CAACnmC,OAAN,CAAc,UAAUumC,IAAV,EAAgB;AAC5B,QAAI//B,MAAM,CAAC+/B,IAAI,CAACD,IAAN,CAAN,KAAsB9mC,SAA1B,EAAqC;AACnCgH,MAAAA,MAAM,CAAC+/B,IAAI,CAACD,IAAN,CAAN,GAAoB,IAAI9/B,MAAM,CAAC+/B,IAAI,CAACjR,EAAN,CAA9B;AACD,KAFD,MAEO;AACL9uB,MAAAA,MAAM,CAAC+/B,IAAI,CAACD,IAAN,CAAN,GAAoB30B,IAAI,CAAChQ,GAAL,CAAS6E,MAAM,CAAC+/B,IAAI,CAACD,IAAN,CAAf,EAA4B,IAAI9/B,MAAM,CAAC+/B,IAAI,CAACjR,EAAN,CAAtC,CAApB;AACD;AACF,GAND;AAOA,SAAO9uB,MAAP;AACD;;AAED,SAASggC,gBAAT,CAA0BzU,IAA1B,EAAgC;AAC9B,MAAI9yB,IAAI,GAAK,WAAW8yB,IAAZ,GACVA,IAAI,CAAC9yB,IAAL,CAAUgD,KAAV,CAAgB8vB,IAAI,CAAC0U,IAArB,EAA2B1U,IAAI,CAACoT,KAAL,GAAapT,IAAI,CAAC0U,IAA7C,CADU,GAET1U,IAAI,CAAC0U,IAAL,GAAY,CAAb,GAAkB1U,IAAI,CAAC9yB,IAAL,CAAUgD,KAAV,CAAgB8vB,IAAI,CAAC0U,IAArB,CAAlB,GAA+C1U,IAAI,CAAC9yB,IAFtD;AAGA8yB,EAAAA,IAAI,CAAC9yB,IAAL,GAAYA,IAAZ;AACA8yB,EAAAA,IAAI,CAAC0U,IAAL,GAAY,CAAZ;AACA,SAAO1U,IAAI,CAACoT,KAAZ;;AACA,MAAIpT,IAAI,CAACmT,UAAT,EAAqB;AACnBjmC,IAAAA,IAAI,CAACihC,OAAL;AACAnO,IAAAA,IAAI,CAACmT,UAAL,GAAkB,KAAlB;AACD;AACF,EAED;AACA;;;AACA,SAASwB,gBAAT,CAA0BnW,IAA1B,EAAgC;AAC9B,MAAIoW,IAAI,GAAGpW,IAAI,CAACqW,gBAAL,CAAsB,CAAtB,CAAX;AACA,MAAI7U,IAAI,GAAG4U,IAAI,CAAC5U,IAAhB;AACA,MAAIpB,QAAQ,GAAGgW,IAAI,CAAChW,QAApB;AACAJ,EAAAA,IAAI,CAACxzB,GAAL,CAAS,mBAAT,EAA8BkiB,KAA9B,CAAoC,YAAY;AAC9C,WAAO,KAAP;AACD,GAFD,EAEGzb,IAFH,CAEQ,UAAUg0B,GAAV,EAAe;AACrB,QAAIA,GAAG,IAAIA,GAAG,CAACqP,QAAf,EAAyB;AACvB9U,MAAAA,IAAI,CAAC8U,QAAL,GAAgBrP,GAAG,CAACqP,QAApB;AACD;;AACDtW,IAAAA,IAAI,CAACuW,QAAL,CAAc/U,IAAd,EAAoB,UAAU3mB,GAAV,EAAemjB,GAAf,EAAoB;AACtC;AACA,UAAInjB,GAAJ,EAAS;AACPulB,QAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,OAFD,MAEO;AACLulB,QAAAA,QAAQ,CAAC,IAAD,EAAOpC,GAAP,CAAR;AACD;;AACD,8BAAU,YAAY;AACpBgC,QAAAA,IAAI,CAACqW,gBAAL,CAAsBrvB,KAAtB;;AACA,YAAIgZ,IAAI,CAACqW,gBAAL,CAAsBrrC,MAA1B,EAAkC;AAChCmrC,UAAAA,gBAAgB,CAACnW,IAAD,CAAhB;AACD;AACF,OALD;AAMD,KAbD;AAcD,GApBD;AAqBD;;AAED,SAASwW,mBAAT,CAA6B9mC,IAA7B,EAAmC;AACjC,MAAIA,IAAI,CAAC8B,MAAL,CAAY,CAAZ,MAAmB,GAAvB,EAA4B;AAC1B,WAAO9B,IAAI,GAAG,8CAAP,GACL,+BADF;AAED;;AACD,SAAO,KAAP;AACD;;AAED,uBAAS+mC,eAAT,EAA0B/e,oBAA1B;;AAEA,SAAS+e,eAAT,GAA2B;AACzB/e,uBAAanpB,IAAb,CAAkB,IAAlB,EADyB,CAGzB;;;AACA,OAAK,IAAIkb,CAAT,IAAcgtB,eAAe,CAACjrC,SAA9B,EAAyC;AACvC,QAAI,OAAO,KAAKie,CAAL,CAAP,KAAmB,UAAvB,EAAmC;AACjC,WAAKA,CAAL,IAAU,KAAKA,CAAL,EAAQ1U,IAAR,CAAa,IAAb,CAAV;AACD;AACF;AACF;;AAED0hC,eAAe,CAACjrC,SAAhB,CAA0BkrC,IAA1B,GACEhW,UAAU,CAAC,MAAD,EAAS,UAAUuG,GAAV,EAAezF,IAAf,EAAqBpB,QAArB,EAA+B;AAClD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAI,OAAOyF,GAAP,KAAe,QAAf,IAA2B1L,KAAK,CAAC2C,OAAN,CAAc+I,GAAd,CAA/B,EAAmD;AACjD,WAAO7G,QAAQ,CAACyG,WAAW,CAACV,aAAD,CAAZ,CAAf;AACD;;AACD,OAAKwQ,QAAL,CAAc;AAACjV,IAAAA,IAAI,EAAE,CAACuF,GAAD;AAAP,GAAd,EAA6BzF,IAA7B,EAAmC0T,SAAS,CAAC9U,QAAD,EAAW6G,GAAG,CAAC4C,GAAf,CAA5C;AACD,CATW,CADZ;AAYA4M,eAAe,CAACjrC,SAAhB,CAA0Bu+B,GAA1B,GAAgCrJ,UAAU,CAAC,KAAD,EAAQ,UAAUuG,GAAV,EAAezF,IAAf,EAAqB51B,EAArB,EAAyB;AACzE,MAAI,OAAO41B,IAAP,KAAgB,UAApB,EAAgC;AAC9B51B,IAAAA,EAAE,GAAG41B,IAAL;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAI,OAAOyF,GAAP,KAAe,QAAf,IAA2B1L,KAAK,CAAC2C,OAAN,CAAc+I,GAAd,CAA/B,EAAmD;AACjD,WAAOr7B,EAAE,CAACi7B,WAAW,CAACV,aAAD,CAAZ,CAAT;AACD;;AACD8B,EAAAA,cAAc,CAAChB,GAAG,CAAC4C,GAAL,CAAd;;AACA,MAAIoJ,SAAS,CAAChM,GAAG,CAAC4C,GAAL,CAAT,IAAsB,OAAO,KAAK+M,SAAZ,KAA0B,UAApD,EAAgE;AAC9D,QAAI3P,GAAG,CAACmO,QAAR,EAAkB;AAChB,aAAO,KAAKyB,YAAL,CAAkB5P,GAAlB,EAAuBr7B,EAAvB,CAAP;AACD,KAFD,MAEO;AACL,aAAO,KAAKgrC,SAAL,CAAe3P,GAAf,EAAoBr7B,EAApB,CAAP;AACD;AACF;;AACD,MAAIo0B,IAAI,GAAG,IAAX;;AACA,MAAIwB,IAAI,CAACsV,KAAL,IAAc7P,GAAG,CAACyC,IAAtB,EAA4B;AAC1BqN,IAAAA,oCAAoC;AACpCC,IAAAA,MAAM,CAAC,UAAUn8B,GAAV,EAAe;AACpB,UAAIrN,MAAM,GAAGqN,GAAG,GAAG,IAAH,GAAU;AAACwmB,QAAAA,EAAE,EAAE,IAAL;AAAW7xB,QAAAA,EAAE,EAAEy3B,GAAG,CAAC4C,GAAnB;AAAwB7G,QAAAA,GAAG,EAAEiE,GAAG,CAACyC;AAAjC,OAA1B;AACA99B,MAAAA,EAAE,CAACiP,GAAD,EAAMrN,MAAN,CAAF;AACD,KAHK,CAAN;AAID,GAND,MAMO;AACLwpC,IAAAA,MAAM,CAACprC,EAAD,CAAN;AACD;;AAED,WAASmrC,oCAAT,GAAgD;AAC9C,QAAIzO,KAAK,GAAGrB,GAAG,CAACyC,IAAJ,CAAS7e,KAAT,CAAe,GAAf,CAAZ;;AACA,QAAIosB,QAAQ,GAAG3O,KAAK,CAAC,CAAD,CAApB;AACA,QAAI4O,SAAS,GAAGjsC,QAAQ,CAACq9B,KAAK,CAAC,CAAD,CAAN,EAAW,EAAX,CAAxB;AAEA,QAAI6O,SAAS,GAAGD,SAAS,GAAG,CAA5B;AACA,QAAIE,QAAQ,GAAGpU,GAAG,EAAlB;AAEAiE,IAAAA,GAAG,CAACwO,UAAJ,GAAiB;AACfjrB,MAAAA,KAAK,EAAE2sB,SADQ;AAEfrI,MAAAA,GAAG,EAAE,CAACsI,QAAD,EAAWH,QAAX;AAFU,KAAjB;AAIAhQ,IAAAA,GAAG,CAACyC,IAAJ,GAAWyN,SAAS,GAAG,GAAZ,GAAkBC,QAA7B;AACA5V,IAAAA,IAAI,CAAC6V,SAAL,GAAiB,KAAjB;AACD;;AACD,WAASL,MAAT,CAAgBvJ,IAAhB,EAAsB;AACpB,QAAI,OAAOzN,IAAI,CAACsX,IAAZ,KAAqB,UAArB,IAAmC9V,IAAI,CAAC6V,SAAL,KAAmB,KAA1D,EAAiE;AAC/DrX,MAAAA,IAAI,CAACsX,IAAL,CAAUrQ,GAAV,EAAezF,IAAf,EAAqBiM,IAArB;AACD,KAFD,MAEO;AACLzN,MAAAA,IAAI,CAAC2W,QAAL,CAAc;AAACjV,QAAAA,IAAI,EAAE,CAACuF,GAAD;AAAP,OAAd,EAA6BzF,IAA7B,EAAmC0T,SAAS,CAACzH,IAAD,EAAOxG,GAAG,CAAC4C,GAAX,CAA5C;AACD;AACF;AACF,CAjDyC,CAA1C;AAmDA4M,eAAe,CAACjrC,SAAhB,CAA0B+rC,aAA1B,GACE7W,UAAU,CAAC,eAAD,EAAkB,UAAUiC,KAAV,EAAiB6U,YAAjB,EAA+B1B,MAA/B,EACgBlK,IADhB,EACsBz7B,IADtB,EAC4B;AACxD,MAAIsnC,GAAG,GAAG,IAAV;;AACA,MAAI,OAAOtnC,IAAP,KAAgB,UAApB,EAAgC;AAC9BA,IAAAA,IAAI,GAAGy7B,IAAP;AACAA,IAAAA,IAAI,GAAGkK,MAAP;AACAA,IAAAA,MAAM,GAAG,IAAT;AACD,GANuD,CAOxD;;AACA;;;AACA,MAAI,OAAO3lC,IAAP,KAAgB,WAApB,EAAiC;AAC/BA,IAAAA,IAAI,GAAGy7B,IAAP;AACAA,IAAAA,IAAI,GAAGkK,MAAP;AACAA,IAAAA,MAAM,GAAG,IAAT;AACD;;AACD,MAAI,CAAC3lC,IAAL,EAAW;AACTk0B,IAAAA,cAAc,CAAC,MAAD,EAAS,YAAT,EAAuBmT,YAAvB,EAAqC,aAArC,EAAoD7U,KAApD,EAA2D,yBAA3D,CAAd;AACD;;AAED,WAAS+U,gBAAT,CAA0BzQ,GAA1B,EAA+B;AAC7B,QAAI0Q,UAAU,GAAG,UAAU1Q,GAAV,GAAgBh8B,QAAQ,CAACg8B,GAAG,CAACyC,IAAL,EAAW,EAAX,CAAxB,GAAyC,CAA1D;AACAzC,IAAAA,GAAG,CAACY,YAAJ,GAAmBZ,GAAG,CAACY,YAAJ,IAAoB,EAAvC;AACAZ,IAAAA,GAAG,CAACY,YAAJ,CAAiB2P,YAAjB,IAAiC;AAC/BI,MAAAA,YAAY,EAAEznC,IADiB;AAE/B1B,MAAAA,IAAI,EAAEm9B,IAFyB;AAG/BiM,MAAAA,MAAM,EAAE,EAAEF;AAHqB,KAAjC;AAKA,WAAOF,GAAG,CAAC1N,GAAJ,CAAQ9C,GAAR,CAAP;AACD;;AAED,SAAOwQ,GAAG,CAACjrC,GAAJ,CAAQm2B,KAAR,EAAe1vB,IAAf,CAAoB,UAAUg0B,GAAV,EAAe;AACxC,QAAIA,GAAG,CAACyC,IAAJ,KAAaoM,MAAjB,EAAyB;AACvB,YAAMjP,WAAW,CAACrB,YAAD,CAAjB;AACD;;AAED,WAAOkS,gBAAgB,CAACzQ,GAAD,CAAvB;AACD,GANM,EAMJ,UAAUpsB,GAAV,EAAe;AACf;;AACD;AACA,QAAIA,GAAG,CAACuqB,MAAJ,KAAeG,WAAW,CAAC9wB,OAA/B,EAAwC;AACtC,aAAOijC,gBAAgB,CAAC;AAAC7N,QAAAA,GAAG,EAAElH;AAAN,OAAD,CAAvB;AACD,KAFD,MAEO;AACL,YAAM9nB,GAAN;AACD;AACF,GAdM,CAAP;AAeD,CA7CW,CADZ;AAgDA47B,eAAe,CAACjrC,SAAhB,CAA0BssC,gBAA1B,GACEpX,UAAU,CAAC,kBAAD,EAAqB,UAAUiC,KAAV,EAAiB6U,YAAjB,EAA+B1B,MAA/B,EACgB1V,QADhB,EAC0B;AACzD,MAAIJ,IAAI,GAAG,IAAX;AACAA,EAAAA,IAAI,CAACxzB,GAAL,CAASm2B,KAAT,EAAgB,UAAU9nB,GAAV,EAAetI,GAAf,EAAoB;AAClC;AACA,QAAIsI,GAAJ,EAAS;AACPulB,MAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACA;AACD;;AACD,QAAItI,GAAG,CAACm3B,IAAJ,KAAaoM,MAAjB,EAAyB;AACvB1V,MAAAA,QAAQ,CAACyG,WAAW,CAACrB,YAAD,CAAZ,CAAR;AACA;AACD;AACD;;;AACA,QAAI,CAACjzB,GAAG,CAACs1B,YAAT,EAAuB;AACrB,aAAOzH,QAAQ,EAAf;AACD;;AACD,WAAO7tB,GAAG,CAACs1B,YAAJ,CAAiB2P,YAAjB,CAAP;;AACA,QAAIlrC,MAAM,CAACoC,IAAP,CAAY6D,GAAG,CAACs1B,YAAhB,EAA8B78B,MAA9B,KAAyC,CAA7C,EAAgD;AAC9C,aAAOuH,GAAG,CAACs1B,YAAX;AACD;;AACD7H,IAAAA,IAAI,CAAC+J,GAAL,CAASx3B,GAAT,EAAc6tB,QAAd;AACD,GAnBD;AAoBD,CAvBW,CADZ;AA0BAqW,eAAe,CAACjrC,SAAhB,CAA0BusC,MAA1B,GACErX,UAAU,CAAC,QAAD,EAAW,UAAUsX,OAAV,EAAmBC,SAAnB,EAA8BzW,IAA9B,EAAoCpB,QAApC,EAA8C;AACnE,MAAI6G,GAAJ;;AACA,MAAI,OAAOgR,SAAP,KAAqB,QAAzB,EAAmC;AACjC;AACAhR,IAAAA,GAAG,GAAG;AACJ4C,MAAAA,GAAG,EAAEmO,OADD;AAEJtO,MAAAA,IAAI,EAAEuO;AAFF,KAAN;;AAIA,QAAI,OAAOzW,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;AACF,GAVD,MAUO;AACL;AACAyF,IAAAA,GAAG,GAAG+Q,OAAN;;AACA,QAAI,OAAOC,SAAP,KAAqB,UAAzB,EAAqC;AACnC7X,MAAAA,QAAQ,GAAG6X,SAAX;AACAzW,MAAAA,IAAI,GAAG,EAAP;AACD,KAHD,MAGO;AACLpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAGyW,SAAP;AACD;AACF;;AACDzW,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;AACAA,EAAAA,IAAI,CAAC0W,UAAL,GAAkB,IAAlB;AACA,MAAIvO,MAAM,GAAG;AAACE,IAAAA,GAAG,EAAE5C,GAAG,CAAC4C,GAAV;AAAeH,IAAAA,IAAI,EAAGzC,GAAG,CAACyC,IAAJ,IAAYlI,IAAI,CAACwB;AAAvC,GAAb;AACA2G,EAAAA,MAAM,CAACyL,QAAP,GAAkB,IAAlB;;AACA,MAAInC,SAAS,CAACtJ,MAAM,CAACE,GAAR,CAAT,IAAyB,OAAO,KAAKgN,YAAZ,KAA6B,UAA1D,EAAsE;AACpE,WAAO,KAAKA,YAAL,CAAkB5P,GAAlB,EAAuB7G,QAAvB,CAAP;AACD;;AACD,OAAKuW,QAAL,CAAc;AAACjV,IAAAA,IAAI,EAAE,CAACiI,MAAD;AAAP,GAAd,EAAgCnI,IAAhC,EAAsC0T,SAAS,CAAC9U,QAAD,EAAWuJ,MAAM,CAACE,GAAlB,CAA/C;AACD,CA/BW,CADZ;AAkCA4M,eAAe,CAACjrC,SAAhB,CAA0B2sC,QAA1B,GACEzX,UAAU,CAAC,UAAD,EAAa,UAAUwG,GAAV,EAAe1F,IAAf,EAAqBpB,QAArB,EAA+B;AACtD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAIsN,GAAG,GAAGxiC,MAAM,CAACoC,IAAP,CAAYw4B,GAAZ,CAAV;;AAEA,MAAI,CAAC4H,GAAG,CAAC9jC,MAAT,EAAiB;AACf,WAAOo1B,QAAQ,CAAC,IAAD,EAAO,EAAP,CAAf;AACD;;AAED,MAAIxG,KAAK,GAAG,CAAZ;AACA,MAAIwe,OAAO,GAAG,IAAI1Z,WAAJ,EAAd;;AAEA,WAAS2Z,YAAT,CAAsB7oC,EAAtB,EAA0B8oC,KAA1B,EAAiC;AAC/B,QAAI,CAACF,OAAO,CAAC7oC,GAAR,CAAYC,EAAZ,CAAL,EAAsB;AACpB4oC,MAAAA,OAAO,CAAC3rC,GAAR,CAAY+C,EAAZ,EAAgB;AAAC4oC,QAAAA,OAAO,EAAE;AAAV,OAAhB;AACD;;AACDA,IAAAA,OAAO,CAAC5rC,GAAR,CAAYgD,EAAZ,EAAgB4oC,OAAhB,CAAwB/nC,IAAxB,CAA6BioC,KAA7B;AACD;;AAED,WAASC,UAAT,CAAoB/oC,EAApB,EAAwBm/B,QAAxB,EAAkC;AAChC;AACA,QAAI6J,YAAY,GAAGtR,GAAG,CAAC13B,EAAD,CAAH,CAAQkC,KAAR,CAAc,CAAd,CAAnB;AACAu9B,IAAAA,eAAe,CAACN,QAAD,EAAW,UAAUa,MAAV,EAAkB1kC,GAAlB,EAAuBmlC,OAAvB,EAAgCb,GAAhC,EACxB5N,IADwB,EAClB;AACJ,UAAIsU,MAAM,GAAGhrC,GAAG,GAAG,GAAN,GAAYmlC,OAAzB;AACA,UAAIx3B,GAAG,GAAG+/B,YAAY,CAAC9/B,OAAb,CAAqBo9B,MAArB,CAAV;;AACA,UAAIr9B,GAAG,KAAK,CAAC,CAAb,EAAgB;AACd;AACD;;AAED+/B,MAAAA,YAAY,CAAC7/B,MAAb,CAAoBF,GAApB,EAAyB,CAAzB;AACA;;AACA,UAAI+oB,IAAI,CAACqD,MAAL,KAAgB,WAApB,EAAiC;AAC/BwT,QAAAA,YAAY,CAAC7oC,EAAD,EAAKsmC,MAAL,CAAZ;AACD;AACF,KAbY,CAAf,CAHgC,CAkBhC;AACA;;AACA0C,IAAAA,YAAY,CAAC/oC,OAAb,CAAqB,UAAUqmC,MAAV,EAAkB;AACrCuC,MAAAA,YAAY,CAAC7oC,EAAD,EAAKsmC,MAAL,CAAZ;AACD,KAFD;AAGD;;AAEDhH,EAAAA,GAAG,CAACz0B,GAAJ,CAAQ,UAAU7K,EAAV,EAAc;AACpB,SAAKipC,gBAAL,CAAsBjpC,EAAtB,EAA0B,UAAUqL,GAAV,EAAe8zB,QAAf,EAAyB;AACjD,UAAI9zB,GAAG,IAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAtB,IAA6BhqB,GAAG,CAACpG,OAAJ,KAAgB,SAAjD,EAA4D;AAC1D2jC,QAAAA,OAAO,CAAC3rC,GAAR,CAAY+C,EAAZ,EAAgB;AAAC4oC,UAAAA,OAAO,EAAElR,GAAG,CAAC13B,EAAD;AAAb,SAAhB;AACD,OAFD,MAEO,IAAIqL,GAAJ,EAAS;AACd;AACA,eAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD,OAHM,MAGA;AACL09B,QAAAA,UAAU,CAAC/oC,EAAD,EAAKm/B,QAAL,CAAV;AACD;;AAED,UAAI,EAAE/U,KAAF,KAAYkV,GAAG,CAAC9jC,MAApB,EAA4B;AAC1B;AACA,YAAI0tC,UAAU,GAAG,EAAjB;AACAN,QAAAA,OAAO,CAAC3oC,OAAR,CAAgB,UAAUV,KAAV,EAAiBF,GAAjB,EAAsB;AACpC6pC,UAAAA,UAAU,CAAC7pC,GAAD,CAAV,GAAkBE,KAAlB;AACD,SAFD;AAGA,eAAOqxB,QAAQ,CAAC,IAAD,EAAOsY,UAAP,CAAf;AACD;AACF,KAlBD;AAmBD,GApBD,EAoBG,IApBH;AAqBD,CAnEW,CADZ,EAsEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAjC,eAAe,CAACjrC,SAAhB,CAA0B81B,OAA1B,GACEZ,UAAU,CAAC,SAAD,EAAY,UAAUc,IAAV,EAAgBpB,QAAhB,EAA0B;AAChDkB,EAAAA,OAAO,CAAC,IAAD,EAAOE,IAAP,EAAapB,QAAb,CAAP;AACD,CAFW,CADZ,EAKA;AACA;AACA;;AACAqW,eAAe,CAACjrC,SAAhB,CAA0BmtC,eAA1B,GACEjY,UAAU,CAAC,iBAAD,EAAoB,UAAUiC,KAAV,EAAiBnsB,SAAjB,EAA4B4pB,QAA5B,EAAsC;AACpE,MAAIJ,IAAI,GAAG,IAAX;;AACA,OAAKyY,gBAAL,CAAsB9V,KAAtB,EAA6B,UAAU9nB,GAAV,EAAe+9B,OAAf,EAAwB;AACnD;AACA,QAAI/9B,GAAJ,EAAS;AACP,aAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACD,QAAI5E,MAAM,GAAG0/B,aAAa,CAACiD,OAAD,CAA1B;AACA,QAAIC,UAAU,GAAG,EAAjB;AACA,QAAI3J,IAAI,GAAG,EAAX;AACA5iC,IAAAA,MAAM,CAACoC,IAAP,CAAYuH,MAAZ,EAAoBxG,OAApB,CAA4B,UAAUqmC,MAAV,EAAkB;AAC5C,UAAI7/B,MAAM,CAAC6/B,MAAD,CAAN,GAAiBt/B,SAArB,EAAgC;AAC9BqiC,QAAAA,UAAU,CAACxoC,IAAX,CAAgBylC,MAAhB;AACD;AACF,KAJD;AAMA7G,IAAAA,eAAe,CAAC2J,OAAD,EAAU,UAAUpJ,MAAV,EAAkB1kC,GAAlB,EAAuBmlC,OAAvB,EAAgCb,GAAhC,EAAqC5N,IAArC,EAA2C;AAClE,UAAIsU,MAAM,GAAGhrC,GAAG,GAAG,GAAN,GAAYmlC,OAAzB;;AACA,UAAIzO,IAAI,CAACqD,MAAL,KAAgB,WAAhB,IAA+BgU,UAAU,CAACngC,OAAX,CAAmBo9B,MAAnB,MAA+B,CAAC,CAAnE,EAAsE;AACpE5G,QAAAA,IAAI,CAAC7+B,IAAL,CAAUylC,MAAV;AACD;AACF,KALc,CAAf;;AAMA9V,IAAAA,IAAI,CAAC8Y,aAAL,CAAmBnW,KAAnB,EAA0BuM,IAA1B,EAAgC9O,QAAhC;AACD,GArBD;AAsBD,CAxBW,CADZ,EA2BA;AACA;;AACAqW,eAAe,CAACjrC,SAAhB,CAA0ButC,OAA1B,GACErY,UAAU,CAAC,SAAD,EAAY,UAAUc,IAAV,EAAgBpB,QAAhB,EAA0B;AAChD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AAED,MAAIxB,IAAI,GAAG,IAAX;AACAwB,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;AAEAxB,EAAAA,IAAI,CAACqW,gBAAL,GAAwBrW,IAAI,CAACqW,gBAAL,IAAyB,EAAjD;;AACArW,EAAAA,IAAI,CAACqW,gBAAL,CAAsBhmC,IAAtB,CAA2B;AAACmxB,IAAAA,IAAI,EAAEA,IAAP;AAAapB,IAAAA,QAAQ,EAAEA;AAAvB,GAA3B;;AACA,MAAIJ,IAAI,CAACqW,gBAAL,CAAsBrrC,MAAtB,KAAiC,CAArC,EAAwC;AACtCmrC,IAAAA,gBAAgB,CAACnW,IAAD,CAAhB;AACD;AACF,CAdW,CADZ;;AAgBAyW,eAAe,CAACjrC,SAAhB,CAA0B+qC,QAA1B,GAAqC,UAAU/U,IAAV,EAAgBpB,QAAhB,EAA0B;AAC7D,MAAIJ,IAAI,GAAG,IAAX;AACA,MAAI6D,WAAW,GAAG;AAChBmV,IAAAA,WAAW,EAAE,KADG;AAEhB1C,IAAAA,QAAQ,EAAE9U,IAAI,CAAC8U,QAAL,IAAiB;AAFX,GAAlB;AAIA,MAAIroB,QAAQ,GAAG,EAAf;;AAEA,WAASiW,QAAT,CAAkB+U,GAAlB,EAAuB;AACrBhrB,IAAAA,QAAQ,CAAC5d,IAAT,CAAc2vB,IAAI,CAAC2Y,eAAL,CAAqBM,GAAG,CAACzpC,EAAzB,EAA6B,CAA7B,CAAd;AACD;;AACD,WAAS0pC,UAAT,CAAoB/Y,IAApB,EAA0B;AACxB,QAAIsT,OAAO,GAAGtT,IAAI,CAACmW,QAAnB;AACA9gC,IAAAA,OAAO,CAAC0Y,GAAR,CAAYD,QAAZ,EAAsBhb,IAAtB,CAA2B,YAAY;AACrC,aAAOs2B,MAAM,CAACvJ,IAAD,EAAO,mBAAP,EAA4B,SAASmZ,SAAT,CAAmBlS,GAAnB,EAAwB;AAC/D,YAAI,CAACA,GAAG,CAACqP,QAAL,IAAiBrP,GAAG,CAACqP,QAAJ,GAAe7C,OAApC,EAA6C;AAC3CxM,UAAAA,GAAG,CAACqP,QAAJ,GAAe7C,OAAf;AACA,iBAAOxM,GAAP;AACD;;AACD,eAAO,KAAP,CAL+D,CAKjD;AACf,OANY,CAAb;AAOD,KARD,EAQGh0B,IARH,CAQQ,YAAY;AAClBmtB,MAAAA,QAAQ,CAAC,IAAD,EAAO;AAACiB,QAAAA,EAAE,EAAE;AAAL,OAAP,CAAR;AACD,KAVD,EAUG3S,KAVH,CAUS0R,QAVT;AAWD;;AACDJ,EAAAA,IAAI,CAAC8D,OAAL,CAAaD,WAAb,EACG/J,EADH,CACM,QADN,EACgBoK,QADhB,EAEGpK,EAFH,CAEM,UAFN,EAEkBof,UAFlB,EAGGpf,EAHH,CAGM,OAHN,EAGesG,QAHf;AAID,CA7BD;AA+BA;;;;AAEAqW,eAAe,CAACjrC,SAAhB,CAA0BgB,GAA1B,GAAgCk0B,UAAU,CAAC,KAAD,EAAQ,UAAUlxB,EAAV,EAAcgyB,IAAd,EAAoB51B,EAApB,EAAwB;AACxE,MAAI,OAAO41B,IAAP,KAAgB,UAApB,EAAgC;AAC9B51B,IAAAA,EAAE,GAAG41B,IAAL;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAI,OAAOhyB,EAAP,KAAc,QAAlB,EAA4B;AAC1B,WAAO5D,EAAE,CAACi7B,WAAW,CAACpB,UAAD,CAAZ,CAAT;AACD;;AACD,MAAIwN,SAAS,CAACzjC,EAAD,CAAT,IAAiB,OAAO,KAAK4pC,SAAZ,KAA0B,UAA/C,EAA2D;AACzD,WAAO,KAAKA,SAAL,CAAe5pC,EAAf,EAAmB5D,EAAnB,CAAP;AACD;;AACD,MAAI2jC,MAAM,GAAG,EAAb;AAAA,MAAiBvP,IAAI,GAAG,IAAxB;;AAEA,WAASqZ,cAAT,GAA0B;AACxB,QAAI7rC,MAAM,GAAG,EAAb;AACA,QAAIosB,KAAK,GAAG2V,MAAM,CAACvkC,MAAnB;AACA;;AACA,QAAI,CAAC4uB,KAAL,EAAY;AACV,aAAOhuB,EAAE,CAAC,IAAD,EAAO4B,MAAP,CAAT;AACD,KANuB,CAQxB;;;AACA+hC,IAAAA,MAAM,CAAC9/B,OAAP,CAAe,UAAUsgC,IAAV,EAAgB;AAC7B/P,MAAAA,IAAI,CAACxzB,GAAL,CAASgD,EAAT,EAAa;AACXwzB,QAAAA,GAAG,EAAE+M,IADM;AAEXb,QAAAA,IAAI,EAAE1N,IAAI,CAAC0N,IAFA;AAGXgE,QAAAA,MAAM,EAAE1R,IAAI,CAAC0R,MAHF;AAIXvL,QAAAA,WAAW,EAAEnG,IAAI,CAACmG,WAJP;AAKX6D,QAAAA,MAAM,EAAEhK,IAAI,CAACgK;AALF,OAAb,EAMG,UAAU3wB,GAAV,EAAeosB,GAAf,EAAoB;AACrB,YAAI,CAACpsB,GAAL,EAAU;AACR;AACA,cAAIwe,QAAJ;;AACA,eAAK,IAAI/Y,CAAC,GAAG,CAAR,EAAW+yB,CAAC,GAAG7lC,MAAM,CAACxC,MAA3B,EAAmCsV,CAAC,GAAG+yB,CAAvC,EAA0C/yB,CAAC,EAA3C,EAA+C;AAC7C,gBAAI9S,MAAM,CAAC8S,CAAD,CAAN,CAAU+gB,EAAV,IAAgB7zB,MAAM,CAAC8S,CAAD,CAAN,CAAU+gB,EAAV,CAAaqI,IAAb,KAAsBzC,GAAG,CAACyC,IAA9C,EAAoD;AAClDrQ,cAAAA,QAAQ,GAAG,IAAX;AACA;AACD;AACF;;AACD,cAAI,CAACA,QAAL,EAAe;AACb7rB,YAAAA,MAAM,CAAC6C,IAAP,CAAY;AAACgxB,cAAAA,EAAE,EAAE4F;AAAL,aAAZ;AACD;AACF,SAZD,MAYO;AACLz5B,UAAAA,MAAM,CAAC6C,IAAP,CAAY;AAAC+nC,YAAAA,OAAO,EAAErI;AAAV,WAAZ;AACD;;AACDnW,QAAAA,KAAK;;AACL,YAAI,CAACA,KAAL,EAAY;AACVhuB,UAAAA,EAAE,CAAC,IAAD,EAAO4B,MAAP,CAAF;AACD;AACF,OA1BD;AA2BD,KA5BD;AA6BD;;AAED,MAAIg0B,IAAI,CAACuB,SAAT,EAAoB;AAClB,QAAIvB,IAAI,CAACuB,SAAL,KAAmB,KAAvB,EAA8B;AAC5B,WAAK0V,gBAAL,CAAsBjpC,EAAtB,EAA0B,UAAUqL,GAAV,EAAe8zB,QAAf,EAAyB;AACjD;AACA,YAAI9zB,GAAJ,EAAS;AACP,iBAAOjP,EAAE,CAACiP,GAAD,CAAT;AACD;;AACD00B,QAAAA,MAAM,GAAGD,aAAa,CAACX,QAAD,CAAb,CAAwBt0B,GAAxB,CAA4B,UAAU01B,IAAV,EAAgB;AACnD,iBAAOA,IAAI,CAAC/M,GAAZ;AACD,SAFQ,CAAT;AAGAqW,QAAAA,cAAc;AACf,OATD;AAUD,KAXD,MAWO;AACL,UAAI9d,KAAK,CAAC2C,OAAN,CAAcsD,IAAI,CAACuB,SAAnB,CAAJ,EAAmC;AACjCwM,QAAAA,MAAM,GAAG/N,IAAI,CAACuB,SAAd;;AACA,aAAK,IAAIziB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGivB,MAAM,CAACvkC,MAA3B,EAAmCsV,CAAC,EAApC,EAAwC;AACtC,cAAI+yB,CAAC,GAAG9D,MAAM,CAACjvB,CAAD,CAAd,CADsC,CAEtC;;AACA,cAAI,EAAE,OAAQ+yB,CAAR,KAAe,QAAf,IAA2B,QAAQziB,IAAR,CAAayiB,CAAb,CAA7B,CAAJ,EAAmD;AACjD,mBAAOznC,EAAE,CAACi7B,WAAW,CAACJ,WAAD,CAAZ,CAAT;AACD;AACF;;AACD4S,QAAAA,cAAc;AACf,OAVD,MAUO;AACL,eAAOztC,EAAE,CAACi7B,WAAW,CAAChB,aAAD,EAAgB,iBAAhB,CAAZ,CAAT;AACD;AACF;;AACD,WA3BkB,CA2BV;AACT;;AAED,SAAO,KAAKyT,IAAL,CAAU9pC,EAAV,EAAcgyB,IAAd,EAAoB,UAAU3mB,GAAV,EAAerN,MAAf,EAAuB;AAChD,QAAIqN,GAAJ,EAAS;AACPA,MAAAA,GAAG,CAAC8nB,KAAJ,GAAYnzB,EAAZ;AACA,aAAO5D,EAAE,CAACiP,GAAD,CAAT;AACD;;AAED,QAAIosB,GAAG,GAAGz5B,MAAM,CAACy5B,GAAjB;AACA,QAAIqH,QAAQ,GAAG9gC,MAAM,CAAC8gC,QAAtB;AACA,QAAIc,GAAG,GAAG5hC,MAAM,CAAC4hC,GAAjB;;AAEA,QAAI5N,IAAI,CAACsO,SAAT,EAAoB;AAClB,UAAIA,SAAS,GAAGF,gBAAgB,CAACtB,QAAD,CAAhC;;AACA,UAAIwB,SAAS,CAAC9kC,MAAd,EAAsB;AACpBi8B,QAAAA,GAAG,CAACgN,UAAJ,GAAiBnE,SAAjB;AACD;AACF;;AAED,QAAIkD,SAAS,CAAC1E,QAAD,EAAWrH,GAAG,CAACyC,IAAf,CAAb,EAAmC;AACjCzC,MAAAA,GAAG,CAACmO,QAAJ,GAAe,IAAf;AACD;;AAED,QAAI5T,IAAI,CAAC0N,IAAL,IAAa1N,IAAI,CAAC+X,SAAtB,EAAiC;AAC/B,UAAIC,WAAW,GAAGvS,GAAG,CAACyC,IAAJ,CAAS7e,KAAT,CAAe,GAAf,CAAlB;;AACA,UAAI4uB,KAAK,GAASxuC,QAAQ,CAACuuC,WAAW,CAAC,CAAD,CAAZ,EAAiB,EAAjB,CAA1B;AACA,UAAIvJ,OAAO,GAAOuJ,WAAW,CAAC,CAAD,CAA7B;AAEA,UAAIrJ,KAAK,GAAGD,UAAU,CAAC5B,QAAQ,CAACK,QAAV,CAAtB;AACA,UAAIiC,IAAI,GAAG,IAAX;;AAEA,WAAK,IAAItwB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6vB,KAAK,CAACnlC,MAA1B,EAAkCsV,CAAC,EAAnC,EAAuC;AACrC,YAAIo5B,WAAW,GAAGvJ,KAAK,CAAC7vB,CAAD,CAAvB;AACA,YAAIq5B,SAAS,GAAGD,WAAW,CAAC5K,GAAZ,CAAgBz0B,GAAhB,CAAoB,UAAU8mB,CAAV,EAAa;AAAE,iBAAOA,CAAC,CAAC3xB,EAAT;AAAc,SAAjD,EACbkJ,OADa,CACLu3B,OADK,CAAhB;AAEA,YAAI2J,iBAAiB,GAAGD,SAAS,KAAMF,KAAK,GAAG,CAA/C;;AAEA,YAAIG,iBAAiB,IAAK,CAAChJ,IAAD,IAAS+I,SAAS,KAAK,CAAC,CAAlD,EAAsD;AACpD/I,UAAAA,IAAI,GAAG8I,WAAP;AACD;AACF;AAED;;;AACA,UAAI,CAAC9I,IAAL,EAAW;AACT/1B,QAAAA,GAAG,GAAG,IAAI/N,KAAJ,CAAU,kBAAV,CAAN;AACA+N,QAAAA,GAAG,CAAC8nB,KAAJ,GAAYnzB,EAAZ;AACA,eAAO5D,EAAE,CAACiP,GAAD,CAAT;AACD;;AAED,UAAIg/B,UAAU,GAAGjJ,IAAI,CAAC9B,GAAL,CAASz0B,GAAT,CAAa,UAAU8mB,CAAV,EAAa;AAAE,eAAOA,CAAC,CAAC3xB,EAAT;AAAc,OAA1C,EACdkJ,OADc,CACNuuB,GAAG,CAACyC,IAAJ,CAAS7e,KAAT,CAAe,GAAf,EAAoB,CAApB,CADM,IACoB,CADrC;AAEA,UAAIivB,OAAO,GAAGlJ,IAAI,CAAC9B,GAAL,CAAS9jC,MAAT,GAAkB6uC,UAAhC;AACAjJ,MAAAA,IAAI,CAAC9B,GAAL,CAASn2B,MAAT,CAAgBkhC,UAAhB,EAA4BC,OAA5B;AACAlJ,MAAAA,IAAI,CAAC9B,GAAL,CAASa,OAAT;;AAEA,UAAInO,IAAI,CAAC0N,IAAT,EAAe;AACbjI,QAAAA,GAAG,CAACwO,UAAJ,GAAiB;AACfjrB,UAAAA,KAAK,EAAGomB,IAAI,CAAC9lC,GAAL,GAAW8lC,IAAI,CAAC9B,GAAL,CAAS9jC,MAArB,GAA+B,CADvB;AAEf8jC,UAAAA,GAAG,EAAE8B,IAAI,CAAC9B,GAAL,CAASz0B,GAAT,CAAa,UAAUy7B,MAAV,EAAkB;AAClC,mBAAOA,MAAM,CAACtmC,EAAd;AACD,WAFI;AAFU,SAAjB;AAMD;;AACD,UAAIgyB,IAAI,CAAC+X,SAAT,EAAoB;AAClB,YAAIzuC,GAAG,GAAI8lC,IAAI,CAAC9lC,GAAL,GAAW8lC,IAAI,CAAC9B,GAAL,CAAS9jC,MAA/B;AACAi8B,QAAAA,GAAG,CAAC8S,UAAJ,GAAiBnJ,IAAI,CAAC9B,GAAL,CAASz0B,GAAT,CAAa,UAAUy7B,MAAV,EAAkB;AAC9ChrC,UAAAA,GAAG;AACH,iBAAO;AACLk4B,YAAAA,GAAG,EAAEl4B,GAAG,GAAG,GAAN,GAAYgrC,MAAM,CAACtmC,EADnB;AAELq1B,YAAAA,MAAM,EAAEiR,MAAM,CAACtU,IAAP,CAAYqD;AAFf,WAAP;AAID,SANgB,CAAjB;AAOD;AACF;;AAED,QAAIrD,IAAI,CAACmG,WAAL,IAAoBV,GAAG,CAACY,YAA5B,EAA0C;AACxC,UAAIF,WAAW,GAAGV,GAAG,CAACY,YAAtB;AACA,UAAIjO,KAAK,GAAGttB,MAAM,CAACoC,IAAP,CAAYi5B,WAAZ,EAAyB38B,MAArC;;AACA,UAAI4uB,KAAK,KAAK,CAAd,EAAiB;AACf,eAAOhuB,EAAE,CAAC,IAAD,EAAOq7B,GAAP,CAAT;AACD;;AACD36B,MAAAA,MAAM,CAACoC,IAAP,CAAYi5B,WAAZ,EAAyBl4B,OAAzB,CAAiC,UAAUZ,GAAV,EAAe;AAC9C,aAAKmrC,cAAL,CAAoB/S,GAAG,CAAC4C,GAAxB,EAA6Bh7B,GAA7B,EAAkC84B,WAAW,CAAC94B,GAAD,CAA7C,EAAoD;AAClD;AACA;AACA;AACAm0B,UAAAA,GAAG,EAAEiE,GAAG,CAACyC,IAJyC;AAKlD8B,UAAAA,MAAM,EAAEhK,IAAI,CAACgK,MALqC;AAMlD4D,UAAAA,GAAG,EAAEA;AAN6C,SAApD,EAOG,UAAUv0B,GAAV,EAAepM,IAAf,EAAqB;AACtB,cAAIm5B,GAAG,GAAGX,GAAG,CAACY,YAAJ,CAAiBh5B,GAAjB,CAAV;AACA+4B,UAAAA,GAAG,CAACn5B,IAAJ,GAAWA,IAAX;AACA,iBAAOm5B,GAAG,CAACE,IAAX;AACA,iBAAOF,GAAG,CAAC58B,MAAX;;AACA,cAAI,CAAC,GAAE4uB,KAAP,EAAc;AACZhuB,YAAAA,EAAE,CAAC,IAAD,EAAOq7B,GAAP,CAAF;AACD;AACF,SAfD;AAgBD,OAjBD,EAiBGjH,IAjBH;AAkBD,KAxBD,MAwBO;AACL,UAAIiH,GAAG,CAACY,YAAR,EAAsB;AACpB,aAAK,IAAIh5B,GAAT,IAAgBo4B,GAAG,CAACY,YAApB,EAAkC;AAChC;AACA,cAAIZ,GAAG,CAACY,YAAJ,CAAiB7U,cAAjB,CAAgCnkB,GAAhC,CAAJ,EAA0C;AACxCo4B,YAAAA,GAAG,CAACY,YAAJ,CAAiBh5B,GAAjB,EAAsBi5B,IAAtB,GAA6B,IAA7B;AACD;AACF;AACF;;AACDl8B,MAAAA,EAAE,CAAC,IAAD,EAAOq7B,GAAP,CAAF;AACD;AACF,GA5GM,CAAP;AA6GD,CAhMyC,CAA1C,EAkMA;AACA;AACA;;AACAwP,eAAe,CAACjrC,SAAhB,CAA0ByuC,aAA1B,GACEvZ,UAAU,CAAC,eAAD,EAAkB,UAAUiC,KAAV,EAAiB6U,YAAjB,EAA+BhW,IAA/B,EAAqCpB,QAArC,EAA+C;AAC3E,MAAIJ,IAAI,GAAG,IAAX;;AACA,MAAIwB,IAAI,YAAYvK,QAApB,EAA8B;AAC5BmJ,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,OAAK8X,IAAL,CAAU3W,KAAV,EAAiBnB,IAAjB,EAAuB,UAAU3mB,GAAV,EAAemjB,GAAf,EAAoB;AACzC,QAAInjB,GAAJ,EAAS;AACP,aAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACD,QAAImjB,GAAG,CAACiJ,GAAJ,CAAQY,YAAR,IAAwB7J,GAAG,CAACiJ,GAAJ,CAAQY,YAAR,CAAqB2P,YAArB,CAA5B,EAAgE;AAC9DhW,MAAAA,IAAI,CAAC4N,GAAL,GAAWpR,GAAG,CAACoR,GAAf;AACA5N,MAAAA,IAAI,CAACgK,MAAL,GAAc,IAAd;;AACAxL,MAAAA,IAAI,CAACga,cAAL,CAAoBrX,KAApB,EAA2B6U,YAA3B,EACoBxZ,GAAG,CAACiJ,GAAJ,CAAQY,YAAR,CAAqB2P,YAArB,CADpB,EACwDhW,IADxD,EAC8DpB,QAD9D;AAED,KALD,MAKO;AACL,aAAOA,QAAQ,CAACyG,WAAW,CAACtB,WAAD,CAAZ,CAAf;AACD;AACF,GAZD;AAaD,CAnBW,CADZ;AAsBAkR,eAAe,CAACjrC,SAAhB,CAA0B0uC,OAA1B,GACExZ,UAAU,CAAC,SAAD,EAAY,UAAUc,IAAV,EAAgBpB,QAAhB,EAA0B;AAChD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,EAAAA,IAAI,CAAC0U,IAAL,GAAY,OAAO1U,IAAI,CAAC0U,IAAZ,KAAqB,WAArB,GAAmC1U,IAAI,CAAC0U,IAAxC,GAA+C,CAA3D;;AACA,MAAI1U,IAAI,CAAC2Y,SAAT,EAAoB;AAClB3Y,IAAAA,IAAI,CAAC4Y,QAAL,GAAgB5Y,IAAI,CAAC2Y,SAArB;AACD;;AACD,MAAI3Y,IAAI,CAAC6Y,OAAT,EAAkB;AAChB7Y,IAAAA,IAAI,CAAC8Y,MAAL,GAAc9Y,IAAI,CAAC6Y,OAAnB;AACD;;AACD,MAAI,UAAU7Y,IAAd,EAAoB;AAClB,QAAI,CAACjG,KAAK,CAAC2C,OAAN,CAAcsD,IAAI,CAAC9yB,IAAnB,CAAL,EAA+B;AAC7B,aAAO0xB,QAAQ,CAAC,IAAIrd,SAAJ,CAAc,+BAAd,CAAD,CAAf;AACD;;AACD,QAAIw3B,eAAe,GACjB,CAAC,UAAD,EAAa,QAAb,EAAuB,KAAvB,EAA8BnnC,MAA9B,CAAqC,UAAUmnC,eAAV,EAA2B;AAChE,aAAOA,eAAe,IAAI/Y,IAA1B;AACD,KAFC,EAEC,CAFD,CADF;;AAIA,QAAI+Y,eAAJ,EAAqB;AACnBna,MAAAA,QAAQ,CAACyG,WAAW,CAACb,iBAAD,EAClB,sBAAsBuU,eAAtB,GACA,oCAFkB,CAAZ,CAAR;AAIA;AACD;;AACD,QAAI,CAACrS,QAAQ,CAAC,IAAD,CAAb,EAAqB;AACnB+N,MAAAA,gBAAgB,CAACzU,IAAD,CAAhB;;AACA,UAAIA,IAAI,CAAC9yB,IAAL,CAAU1D,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,eAAO,KAAKwvC,QAAL,CAAc;AAAC5F,UAAAA,KAAK,EAAE;AAAR,SAAd,EAA0BxU,QAA1B,CAAP;AACD;AACF;AACF;;AAED,SAAO,KAAKoa,QAAL,CAAchZ,IAAd,EAAoBpB,QAApB,CAAP;AACD,CApCW,CADZ;;AAuCAqW,eAAe,CAACjrC,SAAhB,CAA0Bs4B,OAA1B,GAAoC,UAAUtC,IAAV,EAAgBpB,QAAhB,EAA0B;AAC5D,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AAEDA,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf,CAN4D,CAQ5D;AACA;AACA;;AACAA,EAAAA,IAAI,CAACwX,WAAL,GAAoB,iBAAiBxX,IAAlB,GAA0BA,IAAI,CAACwX,WAA/B,GAA6C,CAACxX,IAAI,CAAC+S,IAAtE;AAEA,SAAO,IAAIjB,SAAJ,CAAc,IAAd,EAAoB9R,IAApB,EAA0BpB,QAA1B,CAAP;AACD,CAdD;;AAgBAqW,eAAe,CAACjrC,SAAhB,CAA0B4gB,KAA1B,GAAkCsU,UAAU,CAAC,OAAD,EAAU,UAAUN,QAAV,EAAoB;AACxE,OAAKO,OAAL,GAAe,IAAf;AACA,OAAKnI,IAAL,CAAU,QAAV;AACA,SAAO,KAAKiiB,MAAL,CAAYra,QAAZ,CAAP;AACD,CAJ2C,CAA5C;AAMAqW,eAAe,CAACjrC,SAAhB,CAA0By2B,IAA1B,GAAiCvB,UAAU,CAAC,MAAD,EAAS,UAAUN,QAAV,EAAoB;AACtE,MAAIJ,IAAI,GAAG,IAAX;;AACA,OAAK0a,KAAL,CAAW,UAAU7/B,GAAV,EAAeonB,IAAf,EAAqB;AAC9B,QAAIpnB,GAAJ,EAAS;AACP,aAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD,KAH6B,CAI9B;;;AACAonB,IAAAA,IAAI,CAAC0Y,OAAL,GAAe1Y,IAAI,CAAC0Y,OAAL,IAAgB3a,IAAI,CAACtwB,IAApC;AACAuyB,IAAAA,IAAI,CAAC2Y,eAAL,GAAuB,CAAC,EAAE5a,IAAI,CAAC4a,eAAL,IAAwB,CAAC1S,QAAQ,CAAClI,IAAD,CAAnC,CAAxB;AACAiC,IAAAA,IAAI,CAAC1L,OAAL,GAAeyJ,IAAI,CAACzJ,OAApB;AACA6J,IAAAA,QAAQ,CAAC,IAAD,EAAO6B,IAAP,CAAR;AACD,GATD;AAUD,CAZ0C,CAA3C;AAcAwU,eAAe,CAACjrC,SAAhB,CAA0BgE,EAA1B,GAA+BkxB,UAAU,CAAC,IAAD,EAAO,UAAUN,QAAV,EAAoB;AAClE,SAAO,KAAKyJ,GAAL,CAASzJ,QAAT,CAAP;AACD,CAFwC,CAAzC;AAIA;;AACAqW,eAAe,CAACjrC,SAAhB,CAA0B2E,IAA1B,GAAiC,YAAY;AAC3C,SAAQ,OAAO,KAAK0qC,KAAZ,KAAsB,UAAvB,GAAqC,KAAKA,KAAL,EAArC,GAAoD,KAAKtkB,OAAhE;AACD,CAFD;;AAIAkgB,eAAe,CAACjrC,SAAhB,CAA0BmrC,QAA1B,GACEjW,UAAU,CAAC,UAAD,EAAa,UAAUwG,GAAV,EAAe1F,IAAf,EAAqBpB,QAArB,EAA+B;AACtD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AAEDA,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;;AAEA,MAAIjG,KAAK,CAAC2C,OAAN,CAAcgJ,GAAd,CAAJ,EAAwB;AACtBA,IAAAA,GAAG,GAAG;AACJxF,MAAAA,IAAI,EAAEwF;AADF,KAAN;AAGD;;AAED,MAAI,CAACA,GAAD,IAAQ,CAACA,GAAG,CAACxF,IAAb,IAAqB,CAACnG,KAAK,CAAC2C,OAAN,CAAcgJ,GAAG,CAACxF,IAAlB,CAA1B,EAAmD;AACjD,WAAOtB,QAAQ,CAACyG,WAAW,CAACvB,iBAAD,CAAZ,CAAf;AACD;;AAED,OAAK,IAAIhlB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4mB,GAAG,CAACxF,IAAJ,CAAS12B,MAA7B,EAAqC,EAAEsV,CAAvC,EAA0C;AACxC,QAAI,OAAO4mB,GAAG,CAACxF,IAAJ,CAASphB,CAAT,CAAP,KAAuB,QAAvB,IAAmCib,KAAK,CAAC2C,OAAN,CAAcgJ,GAAG,CAACxF,IAAJ,CAASphB,CAAT,CAAd,CAAvC,EAAmE;AACjE,aAAO8f,QAAQ,CAACyG,WAAW,CAACV,aAAD,CAAZ,CAAf;AACD;AACF;;AAED,MAAI2U,eAAJ;AACA5T,EAAAA,GAAG,CAACxF,IAAJ,CAASjyB,OAAT,CAAiB,UAAUw3B,GAAV,EAAe;AAC9B,QAAIA,GAAG,CAACY,YAAR,EAAsB;AACpBv7B,MAAAA,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,EAA8Bp4B,OAA9B,CAAsC,UAAUC,IAAV,EAAgB;AACpDorC,QAAAA,eAAe,GAAGA,eAAe,IAAItE,mBAAmB,CAAC9mC,IAAD,CAAxD;;AACA,YAAI,CAACu3B,GAAG,CAACY,YAAJ,CAAiBn4B,IAAjB,EAAuBkoC,YAA5B,EAA0C;AACxCvT,UAAAA,cAAc,CAAC,MAAD,EAAS,YAAT,EAAuB30B,IAAvB,EAA6B,aAA7B,EAA4Cu3B,GAAG,CAAC4C,GAAhD,EAAqD,yBAArD,CAAd;AACD;AACF,OALD;AAMD;AACF,GATD;;AAWA,MAAIiR,eAAJ,EAAqB;AACnB,WAAO1a,QAAQ,CAACyG,WAAW,CAACX,WAAD,EAAc4U,eAAd,CAAZ,CAAf;AACD;;AAED,MAAI,EAAE,eAAetZ,IAAjB,CAAJ,EAA4B;AAC1B,QAAI,eAAe0F,GAAnB,EAAwB;AACtB1F,MAAAA,IAAI,CAAC6V,SAAL,GAAiBnQ,GAAG,CAACmQ,SAArB;AACD,KAFD,MAEO;AACL7V,MAAAA,IAAI,CAAC6V,SAAL,GAAiB,IAAjB;AACD;AACF;;AAED,MAAI9gB,OAAO,GAAG,IAAd;;AACA,MAAI,CAACiL,IAAI,CAAC6V,SAAN,IAAmB,CAACnP,QAAQ,CAAC3R,OAAD,CAAhC,EAA2C;AACzC;AACA;AACA2Q,IAAAA,GAAG,CAACxF,IAAJ,CAASgO,IAAT,CAAc4F,kBAAd;AACD;;AAEDH,EAAAA,SAAS,CAACjO,GAAG,CAACxF,IAAL,CAAT,CAvDsD,CAyDtD;AACA;AACA;;AACA,MAAIoN,GAAG,GAAG5H,GAAG,CAACxF,IAAJ,CAASrnB,GAAT,CAAa,UAAU4sB,GAAV,EAAe;AACpC,WAAOA,GAAG,CAAC4C,GAAX;AACD,GAFS,CAAV;AAIA,SAAO,KAAKkR,SAAL,CAAe7T,GAAf,EAAoB1F,IAApB,EAA0B,UAAU3mB,GAAV,EAAemjB,GAAf,EAAoB;AACnD,QAAInjB,GAAJ,EAAS;AACP,aAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACD,QAAI,CAAC2mB,IAAI,CAAC6V,SAAV,EAAqB;AACnB;AACArZ,MAAAA,GAAG,GAAGA,GAAG,CAAC5qB,MAAJ,CAAW,UAAU+tB,CAAV,EAAa;AAC5B,eAAOA,CAAC,CAAC1qB,KAAT;AACD,OAFK,CAAN;AAGD,KATkD,CAUnD;;;AACA,QAAI,CAACyxB,QAAQ,CAAC3R,OAAD,CAAb,EAAwB;AACtB,WAAK,IAAIjW,CAAC,GAAG,CAAR,EAAW+yB,CAAC,GAAGrV,GAAG,CAAChzB,MAAxB,EAAgCsV,CAAC,GAAG+yB,CAApC,EAAuC/yB,CAAC,EAAxC,EAA4C;AAC1C0d,QAAAA,GAAG,CAAC1d,CAAD,CAAH,CAAO9Q,EAAP,GAAYwuB,GAAG,CAAC1d,CAAD,CAAH,CAAO9Q,EAAP,IAAas/B,GAAG,CAACxuB,CAAD,CAA5B;AACD;AACF;;AAED8f,IAAAA,QAAQ,CAAC,IAAD,EAAOpC,GAAP,CAAR;AACD,GAlBM,CAAP;AAmBD,CAnFW,CADZ;AAsFAyY,eAAe,CAACjrC,SAAhB,CAA0BwvC,yBAA1B,GACEta,UAAU,CAAC,2BAAD,EAA8B,UAAUua,WAAV,EACgB7a,QADhB,EAC0B;AAClE,MAAI8a,KAAK,GAAG,IAAI,KAAKxb,WAAT,CAAqBub,WAArB,EAAkC,KAAKE,MAAvC,CAAZ;;AAEA,WAAS3R,OAAT,CAAiBvC,GAAjB,EAAsB;AACpBA,IAAAA,GAAG,CAACmU,YAAJ,GAAmBnU,GAAG,CAACmU,YAAJ,IAAoB,EAAvC;;AACA,QAAInU,GAAG,CAACmU,YAAJ,CAAiBH,WAAjB,CAAJ,EAAmC;AACjC,aAAO,KAAP,CADiC,CACnB;AACf;;AACDhU,IAAAA,GAAG,CAACmU,YAAJ,CAAiBH,WAAjB,IAAgC,IAAhC;AACA,WAAOhU,GAAP;AACD;;AACDsC,EAAAA,MAAM,CAAC,IAAD,EAAO,4BAAP,EAAqCC,OAArC,CAAN,CACGv2B,IADH,CACQ,YAAY;AAChBmtB,IAAAA,QAAQ,CAAC,IAAD,EAAO;AAACmB,MAAAA,EAAE,EAAE2Z;AAAL,KAAP,CAAR;AACD,GAHH,EAGKxsB,KAHL,CAGW0R,QAHX;AAID,CAhBW,CADZ;AAmBAqW,eAAe,CAACjrC,SAAhB,CAA0BoiC,OAA1B,GACElN,UAAU,CAAC,SAAD,EAAY,UAAUc,IAAV,EAAgBpB,QAAhB,EAA0B;AAEhD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AAED,MAAIxB,IAAI,GAAG,IAAX;AACA,MAAIqb,SAAS,GAAG,gBAAgBrb,IAAhB,GAAuBA,IAAI,CAACsb,UAA5B,GAAyC,IAAzD;;AAEA,WAASC,SAAT,GAAqB;AACnB;AACAvb,IAAAA,IAAI,CAACwb,QAAL,CAAcha,IAAd,EAAoB,UAAU3mB,GAAV,EAAeslB,IAAf,EAAqB;AACvC,UAAItlB,GAAJ,EAAS;AACP,eAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACDmlB,MAAAA,IAAI,CAACY,UAAL,GAAkB,IAAlB;AACAZ,MAAAA,IAAI,CAACxH,IAAL,CAAU,WAAV;AACA4H,MAAAA,QAAQ,CAAC,IAAD,EAAOD,IAAI,IAAI;AAAE,cAAM;AAAR,OAAf,CAAR;AACD,KAPD;AAQD;;AAED,MAAI+H,QAAQ,CAAClI,IAAD,CAAZ,EAAoB;AAClB;AACA,WAAOub,SAAS,EAAhB;AACD;;AAEDvb,EAAAA,IAAI,CAACxzB,GAAL,CAAS,4BAAT,EAAuC,UAAUqO,GAAV,EAAe4gC,QAAf,EAAyB;AAC9D,QAAI5gC,GAAJ,EAAS;AACP;AACA,UAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,eAAOzE,QAAQ,CAACvlB,GAAD,CAAf;AACD,OAFD,MAEO;AAAE;AACP,eAAO0gC,SAAS,EAAhB;AACD;AACF;;AACD,QAAIH,YAAY,GAAGK,QAAQ,CAACL,YAA5B;AACA,QAAIlH,OAAO,GAAGlU,IAAI,CAACN,WAAnB;AACA,QAAIgc,UAAU,GAAGpvC,MAAM,CAACoC,IAAP,CAAY0sC,YAAZ,EAA0B/gC,GAA1B,CAA8B,UAAU3K,IAAV,EAAgB;AAC7D;;AACA;AACA,UAAIisC,QAAQ,GAAGN,SAAS,GACtB3rC,IAAI,CAACmN,OAAL,CAAa,IAAIC,MAAJ,CAAW,MAAMo3B,OAAO,CAAC3iC,MAAzB,CAAb,EAA+C,EAA/C,CADsB,GAC+B7B,IADvD;AAEA,aAAO,IAAIwkC,OAAJ,CAAYyH,QAAZ,EAAsB3b,IAAI,CAACmb,MAA3B,EAAmCvN,OAAnC,EAAP;AACD,KANgB,CAAjB;AAOAp4B,IAAAA,OAAO,CAAC0Y,GAAR,CAAYwtB,UAAZ,EAAwBzoC,IAAxB,CAA6BsoC,SAA7B,EAAwCnb,QAAxC;AACD,GAnBD;AAoBD,CA/CW,CADZ;;AAkDA,SAASwb,SAAT,GAAqB;AACnB,OAAK9a,OAAL,GAAe,KAAf;AACA,OAAKlU,MAAL,GAAc,KAAd;AACA,OAAKwP,KAAL,GAAa,EAAb;AACD;;AAEDwf,SAAS,CAACpwC,SAAV,CAAoBqwC,OAApB,GAA8B,YAAY;AACxC,MAAI5f,GAAJ;;AACA,MAAI,KAAKrP,MAAT,EAAiB;AACf,WAAQqP,GAAG,GAAG,KAAKG,KAAL,CAAWpV,KAAX,EAAd,EAAmC;AACjCiV,MAAAA,GAAG,CAAC,KAAKrP,MAAN,CAAH;AACD;AACF,GAJD,MAIO;AACL,WAAQqP,GAAG,GAAG,KAAKG,KAAL,CAAWpV,KAAX,EAAd,EAAmC;AACjCiV,MAAAA,GAAG;AACJ;AACF;AACF,CAXD;;AAaA2f,SAAS,CAACpwC,SAAV,CAAoBswC,IAApB,GAA2B,UAAUjhC,GAAV,EAAe;AACxC,OAAK+R,MAAL,GAAc/R,GAAd;AACA,OAAKghC,OAAL;AACD,CAHD;;AAKAD,SAAS,CAACpwC,SAAV,CAAoBuwC,KAApB,GAA4B,UAAUxa,EAAV,EAAc;AACxC,OAAKT,OAAL,GAAe,IAAf;AACA,OAAKS,EAAL,GAAUA,EAAV;AACA,OAAKsa,OAAL;AACD,CAJD;;AAMAD,SAAS,CAACpwC,SAAV,CAAoBu1B,OAApB,GAA8B,UAAU9E,GAAV,EAAe;AAC3C,OAAKG,KAAL,CAAW/rB,IAAX,CAAgB4rB,GAAhB;;AACA,MAAI,KAAKrP,MAAT,EAAiB;AACf,SAAKivB,OAAL;AACD;AACF,CALD;;AAOA,SAASG,YAAT,CAAsBtsC,IAAtB,EAA4B8xB,IAA5B,EAAkC;AAChC,MAAIz2B,KAAK,GAAG2E,IAAI,CAAC3E,KAAL,CAAW,oBAAX,CAAZ;;AACA,MAAIA,KAAJ,EAAW;AACT;AACA,WAAO;AACL2E,MAAAA,IAAI,EAAE,SAASkhB,IAAT,CAAc7lB,KAAK,CAAC,CAAD,CAAnB,IAA0BA,KAAK,CAAC,CAAD,CAAL,GAAW,KAAX,GAAmBA,KAAK,CAAC,CAAD,CAAlD,GAAwDA,KAAK,CAAC,CAAD,CAD9D;AAELwrB,MAAAA,OAAO,EAAExrB,KAAK,CAAC,CAAD;AAFT,KAAP;AAID;;AAED,MAAIkxC,QAAQ,GAAG/H,OAAO,CAAC+H,QAAvB;AACA,MAAIC,iBAAiB,GAAGhI,OAAO,CAACgI,iBAAhC;AACA,MAAI3qC,MAAM,GAAG2iC,OAAO,CAAC3iC,MAArB;AACA,MAAI4qC,WAAW,GAAG3a,IAAI,CAACjL,OAAvB;;AAEA,MAAI,CAAC4lB,WAAL,EAAkB;AAAE;AAClB,SAAK,IAAI77B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG47B,iBAAiB,CAAClxC,MAAtC,EAA8C,EAAEsV,CAAhD,EAAmD;AACjD67B,MAAAA,WAAW,GAAGD,iBAAiB,CAAC57B,CAAD,CAA/B,CADiD,CAEjD;;AACA;;AACA,UAAI67B,WAAW,KAAK,KAAhB,IAAyB,YAAYF,QAArC,IACA1Y,eAAe,EADf,IACqBH,YAAY,CAAC,sBAAsB7xB,MAAtB,GAA+B7B,IAAhC,CADrC,EAC4E;AAC1E;AACA20B,QAAAA,cAAc,CAAC,KAAD,EAAQ,6BAA6B30B,IAA7B,GAAoC,gBAApC,GACpB,8DADY,CAAd;AAEA,iBAJ0E,CAIhE;AACX;;AACD;AACD;AACF;;AAED,MAAI6mB,OAAO,GAAG0lB,QAAQ,CAACE,WAAD,CAAtB,CA/BgC,CAiChC;;AACA,MAAId,SAAS,GAAI9kB,OAAO,IAAI,gBAAgBA,OAA5B,GACdA,OAAO,CAAC+kB,UADM,GACO,IADvB;AAGA,SAAO;AACL5rC,IAAAA,IAAI,EAAE2rC,SAAS,GAAI9pC,MAAM,GAAG7B,IAAb,GAAqBA,IAD/B;AAEL6mB,IAAAA,OAAO,EAAE4lB;AAFJ,GAAP;AAID,EAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASC,qBAAT,CAA+Bpc,IAA/B,EAAqC;AAEnC,WAASqc,WAAT,CAAqBC,gBAArB,EAAuC;AACrCtc,IAAAA,IAAI,CAAC9F,cAAL,CAAoB,QAApB,EAA8BqiB,QAA9B;;AACA,QAAI,CAACD,gBAAL,EAAuB;AACrBtc,MAAAA,IAAI,CAACN,WAAL,CAAiBlH,IAAjB,CAAsB,WAAtB,EAAmCwH,IAAI,CAACtwB,IAAxC;AACD;AACF;;AAED,WAAS6sC,QAAT,GAAoB;AAClBvc,IAAAA,IAAI,CAAC9F,cAAL,CAAoB,WAApB,EAAiCmiB,WAAjC;AACArc,IAAAA,IAAI,CAACN,WAAL,CAAiBlH,IAAjB,CAAsB,OAAtB,EAA+BwH,IAA/B;AACD;;AAEDA,EAAAA,IAAI,CAAC1F,IAAL,CAAU,WAAV,EAAuB+hB,WAAvB;AACArc,EAAAA,IAAI,CAAC1F,IAAL,CAAU,QAAV,EAAoBiiB,QAApB;AACAvc,EAAAA,IAAI,CAACN,WAAL,CAAiBlH,IAAjB,CAAsB,KAAtB,EAA6BwH,IAA7B;AACD;;AAED,uBAASkU,OAAT,EAAkBuC,eAAlB;;AACA,SAASvC,OAAT,CAAiBxkC,IAAjB,EAAuB8xB,IAAvB,EAA6B;AAC3B;;AACA;AACA,MAAI,EAAE,gBAAgB0S,OAAlB,CAAJ,EAAgC;AAC9B,WAAO,IAAIA,OAAJ,CAAYxkC,IAAZ,EAAkB8xB,IAAlB,CAAP;AACD;;AAED,MAAIxB,IAAI,GAAG,IAAX;AACAwB,EAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;;AAEA,MAAI9xB,IAAI,IAAI,OAAOA,IAAP,KAAgB,QAA5B,EAAsC;AACpC8xB,IAAAA,IAAI,GAAG9xB,IAAP;AACAA,IAAAA,IAAI,GAAG8xB,IAAI,CAAC9xB,IAAZ;AACA,WAAO8xB,IAAI,CAAC9xB,IAAZ;AACD;;AAED,MAAI8xB,IAAI,CAACuM,kBAAL,KAA4B9+B,SAAhC,EAA2C;AACzCuyB,IAAAA,IAAI,CAACuM,kBAAL,GAA0B,IAA1B;AACD;;AAED,OAAKoN,MAAL,GAAc3Z,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAA1B;AAEAxB,EAAAA,IAAI,CAAC4a,eAAL,GAAuBpZ,IAAI,CAACoZ,eAA5B;AACA5a,EAAAA,IAAI,CAACzuB,MAAL,GAAc2iC,OAAO,CAAC3iC,MAAtB;;AAEA,MAAI,OAAO7B,IAAP,KAAgB,QAApB,EAA8B;AAC5B,UAAM,IAAI5C,KAAJ,CAAU,yBAAV,CAAN;AACD;;AAED,MAAI0vC,YAAY,GAAG,CAAChb,IAAI,CAACjwB,MAAL,IAAe,EAAhB,IAAsB7B,IAAzC;AACA,MAAI+sC,OAAO,GAAGT,YAAY,CAACQ,YAAD,EAAehb,IAAf,CAA1B;AAEAA,EAAAA,IAAI,CAAC9xB,IAAL,GAAY+sC,OAAO,CAAC/sC,IAApB;AACA8xB,EAAAA,IAAI,CAACjL,OAAL,GAAeiL,IAAI,CAACjL,OAAL,IAAgBkmB,OAAO,CAAClmB,OAAvC;AAEAyJ,EAAAA,IAAI,CAACtwB,IAAL,GAAYA,IAAZ;AACAswB,EAAAA,IAAI,CAAC0c,QAAL,GAAgBlb,IAAI,CAACjL,OAArB;AACA2d,EAAAA,OAAO,CAAC1b,IAAR,CAAa,OAAb,EAAsB,CAAC,SAAD,EAAY,kBAAZ,EAAgCgJ,IAAI,CAACjL,OAArC,CAAtB;;AAEA,MAAI,CAAC2d,OAAO,CAAC+H,QAAR,CAAiBza,IAAI,CAACjL,OAAtB,CAAD,IACA,CAAC2d,OAAO,CAAC+H,QAAR,CAAiBza,IAAI,CAACjL,OAAtB,EAA+BomB,KAA/B,EADL,EAC6C;AAC3C,UAAM,IAAI7vC,KAAJ,CAAU,sBAAsB00B,IAAI,CAACjL,OAArC,CAAN;AACD;;AAEDkgB,EAAAA,eAAe,CAACloC,IAAhB,CAAqByxB,IAArB;AACAA,EAAAA,IAAI,CAACa,SAAL,GAAiB,IAAI+a,SAAJ,EAAjB;AAEA5b,EAAAA,IAAI,CAACzJ,OAAL,GAAeiL,IAAI,CAACjL,OAApB;AAEA2d,EAAAA,OAAO,CAAC+H,QAAR,CAAiBza,IAAI,CAACjL,OAAtB,EAA+BhoB,IAA/B,CAAoCyxB,IAApC,EAA0CwB,IAA1C,EAAgD,UAAU3mB,GAAV,EAAe;AAC7D,QAAIA,GAAJ,EAAS;AACP,aAAOmlB,IAAI,CAACa,SAAL,CAAeib,IAAf,CAAoBjhC,GAApB,CAAP;AACD;;AACDuhC,IAAAA,qBAAqB,CAACpc,IAAD,CAArB;AAEAA,IAAAA,IAAI,CAACxH,IAAL,CAAU,SAAV,EAAqBwH,IAArB;AACAkU,IAAAA,OAAO,CAAC1b,IAAR,CAAa,SAAb,EAAwBwH,IAAI,CAACtwB,IAA7B;AACAswB,IAAAA,IAAI,CAACa,SAAL,CAAekb,KAAf,CAAqB/b,IAArB;AACD,GATD;AAWD,EAED;AACA;;;AACA,IAAIxtB,CAAC,GAAI,OAAOoqC,eAAP,KAA2B,WAA5B,GACFA,eADE,GAEF,YAAY;AAAE,SAAO;AAACC,IAAAA,KAAK,EAAE,YAAY,CAAE;AAAtB,GAAP;AAAiC,CAFrD;AAIA,IAAIC,GAAG,GAAGC,KAAV;AACA,IAAIC,CAAC,GAAGC,OAAR;AAEA/I,OAAO,CAAC+H,QAAR,GAAmB,EAAnB;AACA/H,OAAO,CAACgI,iBAAR,GAA4B,EAA5B;AAEAhI,OAAO,CAAC3iC,MAAR,GAAiB,SAAjB;AAEA,IAAI2rC,YAAY,GAAG,IAAIxlB,oBAAJ,EAAnB;;AAEA,SAASylB,iBAAT,CAA2BC,KAA3B,EAAkC;AAChC9wC,EAAAA,MAAM,CAACoC,IAAP,CAAYgpB,qBAAalsB,SAAzB,EAAoCiE,OAApC,CAA4C,UAAUZ,GAAV,EAAe;AACzD,QAAI,OAAO6oB,qBAAalsB,SAAb,CAAuBqD,GAAvB,CAAP,KAAuC,UAA3C,EAAuD;AACrDuuC,MAAAA,KAAK,CAACvuC,GAAD,CAAL,GAAaquC,YAAY,CAACruC,GAAD,CAAZ,CAAkBkG,IAAlB,CAAuBmoC,YAAvB,CAAb;AACD;AACF,GAJD,EADgC,CAOhC;AACA;;AACA,MAAIG,iBAAiB,GAAGD,KAAK,CAACE,qBAAN,GAA8B,IAAI5e,WAAJ,EAAtD;AAEA0e,EAAAA,KAAK,CAACtjB,EAAN,CAAS,KAAT,EAAgB,SAASyjB,gBAAT,CAA0Bhc,EAA1B,EAA8B;AAC5C,QAAI,CAAC8b,iBAAiB,CAAC9tC,GAAlB,CAAsBgyB,EAAE,CAAC7xB,IAAzB,CAAL,EAAqC;AACnC2tC,MAAAA,iBAAiB,CAAC5wC,GAAlB,CAAsB80B,EAAE,CAAC7xB,IAAzB,EAA+B,EAA/B;AACD;;AACD2tC,IAAAA,iBAAiB,CAAC7wC,GAAlB,CAAsB+0B,EAAE,CAAC7xB,IAAzB,EAA+BW,IAA/B,CAAoCkxB,EAApC;AACD,GALD;AAOA6b,EAAAA,KAAK,CAACtjB,EAAN,CAAS,OAAT,EAAkB,SAAS0jB,kBAAT,CAA4Bjc,EAA5B,EAAgC;AAChD,QAAI,CAAC8b,iBAAiB,CAAC9tC,GAAlB,CAAsBgyB,EAAE,CAAC7xB,IAAzB,CAAL,EAAqC;AACnC;AACD;;AACD,QAAI+tC,MAAM,GAAGJ,iBAAiB,CAAC7wC,GAAlB,CAAsB+0B,EAAE,CAAC7xB,IAAzB,CAAb;AACA,QAAI5E,GAAG,GAAG2yC,MAAM,CAAC/kC,OAAP,CAAe6oB,EAAf,CAAV;;AACA,QAAIz2B,GAAG,GAAG,CAAV,EAAa;AACX;AACA;AACD;;AACD2yC,IAAAA,MAAM,CAAC9kC,MAAP,CAAc7N,GAAd,EAAmB,CAAnB;;AACA,QAAI2yC,MAAM,CAACzyC,MAAP,GAAgB,CAApB,EAAuB;AACrB;AACAqyC,MAAAA,iBAAiB,CAAC5wC,GAAlB,CAAsB80B,EAAE,CAAC7xB,IAAzB,EAA+B+tC,MAA/B;AACD,KAHD,MAGO;AACLJ,MAAAA,iBAAiB,CAACtf,MAAlB,CAAyBwD,EAAE,CAAC7xB,IAA5B;AACD;AACF,GAjBD;AAmBA0tC,EAAAA,KAAK,CAACtjB,EAAN,CAAS,WAAT,EAAsB,SAAS4jB,sBAAT,CAAgChuC,IAAhC,EAAsC;AAC1D,QAAI,CAAC2tC,iBAAiB,CAAC9tC,GAAlB,CAAsBG,IAAtB,CAAL,EAAkC;AAChC;AACD;;AACD,QAAI+tC,MAAM,GAAGJ,iBAAiB,CAAC7wC,GAAlB,CAAsBkD,IAAtB,CAAb;AACA2tC,IAAAA,iBAAiB,CAACtf,MAAlB,CAAyBruB,IAAzB;AACA+tC,IAAAA,MAAM,CAAChuC,OAAP,CAAe,UAAU8xB,EAAV,EAAc;AAC3BA,MAAAA,EAAE,CAAC/I,IAAH,CAAQ,WAAR,EAAoB,IAApB;AACD,KAFD;AAGD,GATD;AAUD;;AAED2kB,iBAAiB,CAACjJ,OAAD,CAAjB;;AAEAA,OAAO,CAAC3d,OAAR,GAAkB,UAAU/mB,EAAV,EAAc+C,GAAd,EAAmBorC,sBAAnB,EAA2C;AAC3D;AACA,MAAIprC,GAAG,CAACoqC,KAAJ,EAAJ,EAAiB;AACfzI,IAAAA,OAAO,CAAC+H,QAAR,CAAiBzsC,EAAjB,IAAuB+C,GAAvB;;AACA,QAAIorC,sBAAJ,EAA4B;AAC1BzJ,MAAAA,OAAO,CAACgI,iBAAR,CAA0B7rC,IAA1B,CAA+Bb,EAA/B;AACD;AACF;AACF,CARD;;AAUA0kC,OAAO,CAAC0J,MAAR,GAAiB,UAAUrrC,GAAV,EAAe;AAC9B,MAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B;AAAE;AAC/BA,IAAAA,GAAG,CAAC2hC,OAAD,CAAH;AACD,GAFD,MAEO,IAAI,OAAO3hC,GAAP,KAAe,QAAf,IAA2BjG,MAAM,CAACoC,IAAP,CAAY6D,GAAZ,EAAiBvH,MAAjB,KAA4B,CAA3D,EAA8D;AACnE,UAAM,IAAI8B,KAAJ,CAAU,0BAA0ByF,GAA1B,GAAgC,qCAA1C,CAAN;AACD,GAFM,MAEA;AACLjG,IAAAA,MAAM,CAACoC,IAAP,CAAY6D,GAAZ,EAAiB9C,OAAjB,CAAyB,UAAUD,EAAV,EAAc;AAAE;AACvC0kC,MAAAA,OAAO,CAAC1oC,SAAR,CAAkBgE,EAAlB,IAAwB+C,GAAG,CAAC/C,EAAD,CAA3B;AACD,KAFD;AAGD;;AACD,MAAI,KAAKquC,UAAT,EAAqB;AACnB3J,IAAAA,OAAO,CAAC2J,UAAR,GAAqB3Y,qBAAqB,CAAC,EAAD,EAAK,KAAK2Y,UAAV,CAA1C;AACD;;AACD,SAAO3J,OAAP;AACD,CAdD;;AAgBAA,OAAO,CAAC4J,QAAR,GAAmB,UAAUC,WAAV,EAAuB;AACxC,WAASC,QAAT,CAAkBtuC,IAAlB,EAAwB8xB,IAAxB,EAA8B;AAC5B,QAAI,EAAE,gBAAgBwc,QAAlB,CAAJ,EAAiC;AAC/B,aAAO,IAAIA,QAAJ,CAAatuC,IAAb,EAAmB8xB,IAAnB,CAAP;AACD;;AAEDA,IAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;;AAEA,QAAI9xB,IAAI,IAAI,OAAOA,IAAP,KAAgB,QAA5B,EAAsC;AACpC8xB,MAAAA,IAAI,GAAG9xB,IAAP;AACAA,MAAAA,IAAI,GAAG8xB,IAAI,CAAC9xB,IAAZ;AACA,aAAO8xB,IAAI,CAAC9xB,IAAZ;AACD;;AAED8xB,IAAAA,IAAI,GAAG0D,qBAAqB,CAAC,EAAD,EAAK8Y,QAAQ,CAACH,UAAd,EAA0Brc,IAA1B,CAA5B;AACA0S,IAAAA,OAAO,CAAC3lC,IAAR,CAAa,IAAb,EAAmBmB,IAAnB,EAAyB8xB,IAAzB;AACD;;AAED,yBAASwc,QAAT,EAAmB9J,OAAnB;AAEA8J,EAAAA,QAAQ,CAAC9B,iBAAT,GAA6BhI,OAAO,CAACgI,iBAAR,CAA0BxqC,KAA1B,EAA7B;AACApF,EAAAA,MAAM,CAACoC,IAAP,CAAYwlC,OAAZ,EAAqBzkC,OAArB,CAA6B,UAAUZ,GAAV,EAAe;AAC1C,QAAI,EAAEA,GAAG,IAAImvC,QAAT,CAAJ,EAAwB;AACtBA,MAAAA,QAAQ,CAACnvC,GAAD,CAAR,GAAgBqlC,OAAO,CAACrlC,GAAD,CAAvB;AACD;AACF,GAJD,EArBwC,CA2BxC;AACA;;AACAmvC,EAAAA,QAAQ,CAACH,UAAT,GAAsB3Y,qBAAqB,CAAC,EAAD,EAAK,KAAK2Y,UAAV,EAAsBE,WAAtB,CAA3C;AAEA,SAAOC,QAAP;AACD,CAhCD;;AAkCA9J,OAAO,CAAC6I,KAAR,GAAgB,UAAU9+B,GAAV,EAAeujB,IAAf,EAAqB;AACnC,SAAOsb,GAAG,CAAC7+B,GAAD,EAAMujB,IAAN,CAAV;AACD,CAFD,EAIA;;;AACA,IAAI9zB,OAAO,GAAG,OAAd,EAEA;AACA;;AACA,SAASuwC,eAAT,CAAyBhX,GAAzB,EAA8BiX,WAA9B,EAA2C;AACzC,MAAInvC,KAAK,GAAGk4B,GAAZ;;AACA,OAAK,IAAI3mB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGolB,WAAW,CAAClzC,MAAlC,EAA0CsV,CAAC,GAAGwY,GAA9C,EAAmDxY,CAAC,EAApD,EAAwD;AACtD,QAAIzR,GAAG,GAAGqvC,WAAW,CAAC59B,CAAD,CAArB;AACAvR,IAAAA,KAAK,GAAGA,KAAK,CAACF,GAAD,CAAb;;AACA,QAAI,CAACE,KAAL,EAAY;AACV;AACD;AACF;;AACD,SAAOA,KAAP;AACD;;AAED,SAASovC,SAAT,CAAmBnJ,IAAnB,EAAyBC,KAAzB,EAAgC;AAC9B,SAAOD,IAAI,GAAGC,KAAP,GAAe,CAAC,CAAhB,GAAoBD,IAAI,GAAGC,KAAP,GAAe,CAAf,GAAmB,CAA9C;AACD,EAED;;;AACA,SAASmJ,UAAT,CAAoBC,SAApB,EAA+B;AAC7B;AACA,MAAIC,MAAM,GAAG,EAAb;AACA,MAAIC,OAAO,GAAG,EAAd;;AACA,OAAK,IAAIj+B,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGulB,SAAS,CAACrzC,MAAhC,EAAwCsV,CAAC,GAAGwY,GAA5C,EAAiDxY,CAAC,EAAlD,EAAsD;AACpD,QAAIk+B,EAAE,GAAGH,SAAS,CAAC/9B,CAAD,CAAlB;;AACA,QAAIk+B,EAAE,KAAK,GAAX,EAAgB;AACd,UAAIl+B,CAAC,GAAG,CAAJ,IAAS+9B,SAAS,CAAC/9B,CAAC,GAAG,CAAL,CAAT,KAAqB,IAAlC,EAAwC;AAAE;AACxCi+B,QAAAA,OAAO,GAAGA,OAAO,CAAC5gB,SAAR,CAAkB,CAAlB,EAAqB4gB,OAAO,CAACvzC,MAAR,GAAiB,CAAtC,IAA2C,GAArD;AACD,OAFD,MAEO;AAAE;AACPszC,QAAAA,MAAM,CAACjuC,IAAP,CAAYkuC,OAAZ;AACAA,QAAAA,OAAO,GAAG,EAAV;AACD;AACF,KAPD,MAOO;AAAE;AACPA,MAAAA,OAAO,IAAIC,EAAX;AACD;AACF;;AACDF,EAAAA,MAAM,CAACjuC,IAAP,CAAYkuC,OAAZ;AACA,SAAOD,MAAP;AACD;;AAED,IAAIG,iBAAiB,GAAG,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,CAAxB;;AACA,SAASC,oBAAT,CAA8BC,KAA9B,EAAqC;AACnC,SAAOF,iBAAiB,CAAC/lC,OAAlB,CAA0BimC,KAA1B,IAAmC,CAAC,CAA3C;AACD;;AAED,SAASC,MAAT,CAAgBrsC,GAAhB,EAAqB;AACnB,SAAOjG,MAAM,CAACoC,IAAP,CAAY6D,GAAZ,EAAiB,CAAjB,CAAP;AACD;;AAED,SAASssC,QAAT,CAAkBtsC,GAAlB,EAAuB;AACrB,SAAOA,GAAG,CAACqsC,MAAM,CAACrsC,GAAD,CAAP,CAAV;AACD,EAGD;;;AACA,SAASusC,mBAAT,CAA6BC,SAA7B,EAAwC;AAEtC;AACA;AACA;AACA,MAAI/gB,GAAG,GAAG,EAAV;AAEA+gB,EAAAA,SAAS,CAACtvC,OAAV,CAAkB,UAAU8J,QAAV,EAAoB;AACpCjN,IAAAA,MAAM,CAACoC,IAAP,CAAY6K,QAAZ,EAAsB9J,OAAtB,CAA8B,UAAUkvC,KAAV,EAAiB;AAC7C,UAAIK,OAAO,GAAGzlC,QAAQ,CAAColC,KAAD,CAAtB;;AACA,UAAI,OAAOK,OAAP,KAAmB,QAAvB,EAAiC;AAC/BA,QAAAA,OAAO,GAAG;AAACC,UAAAA,GAAG,EAAED;AAAN,SAAV;AACD;;AAED,UAAIN,oBAAoB,CAACC,KAAD,CAAxB,EAAiC;AAC/B,YAAIK,OAAO,YAAYzjB,KAAvB,EAA8B;AAC5ByC,UAAAA,GAAG,CAAC2gB,KAAD,CAAH,GAAaK,OAAO,CAAC3kC,GAAR,CAAY,UAAU+e,CAAV,EAAa;AACpC,mBAAO0lB,mBAAmB,CAAC,CAAC1lB,CAAD,CAAD,CAA1B;AACD,WAFY,CAAb;AAGD,SAJD,MAIO;AACL4E,UAAAA,GAAG,CAAC2gB,KAAD,CAAH,GAAaG,mBAAmB,CAAC,CAACE,OAAD,CAAD,CAAhC;AACD;AACF,OARD,MAQO;AACL,YAAIE,aAAa,GAAGlhB,GAAG,CAAC2gB,KAAD,CAAH,GAAa3gB,GAAG,CAAC2gB,KAAD,CAAH,IAAc,EAA/C;AACAryC,QAAAA,MAAM,CAACoC,IAAP,CAAYswC,OAAZ,EAAqBvvC,OAArB,CAA6B,UAAU0vC,QAAV,EAAoB;AAC/C,cAAIpwC,KAAK,GAAGiwC,OAAO,CAACG,QAAD,CAAnB;;AAEA,cAAIA,QAAQ,KAAK,KAAb,IAAsBA,QAAQ,KAAK,MAAvC,EAA+C;AAC7C,mBAAOC,UAAU,CAACD,QAAD,EAAWpwC,KAAX,EAAkBmwC,aAAlB,CAAjB;AACD,WAFD,MAEO,IAAIC,QAAQ,KAAK,KAAb,IAAsBA,QAAQ,KAAK,MAAvC,EAA+C;AACpD,mBAAOE,UAAU,CAACF,QAAD,EAAWpwC,KAAX,EAAkBmwC,aAAlB,CAAjB;AACD,WAFM,MAEA,IAAIC,QAAQ,KAAK,KAAjB,EAAwB;AAC7B,mBAAOG,OAAO,CAACvwC,KAAD,EAAQmwC,aAAR,CAAd;AACD,WAFM,MAEA,IAAIC,QAAQ,KAAK,KAAjB,EAAwB;AAC7B,mBAAOI,OAAO,CAACxwC,KAAD,EAAQmwC,aAAR,CAAd;AACD;;AACDA,UAAAA,aAAa,CAACC,QAAD,CAAb,GAA0BpwC,KAA1B;AACD,SAbD;AAcD;AACF,KA/BD;AAgCD,GAjCD;AAmCA,SAAOivB,GAAP;AACD,EAID;;;AACA,SAASohB,UAAT,CAAoBD,QAApB,EAA8BpwC,KAA9B,EAAqCmwC,aAArC,EAAoD;AAClD,MAAI,OAAOA,aAAa,CAACD,GAArB,KAA6B,WAAjC,EAA8C;AAC5C,WAD4C,CACpC;AACT;;AACD,MAAI,OAAOC,aAAa,CAACM,IAArB,KAA8B,WAAlC,EAA+C;AAC7C,QAAIL,QAAQ,KAAK,MAAjB,EAAyB;AACvB,UAAIpwC,KAAK,GAAGmwC,aAAa,CAACM,IAA1B,EAAgC;AAAE;AAChCN,QAAAA,aAAa,CAACM,IAAd,GAAqBzwC,KAArB;AACD;AACF,KAJD,MAIO;AAAE;AACP,UAAIA,KAAK,IAAImwC,aAAa,CAACM,IAA3B,EAAiC;AAAE;AACjC,eAAON,aAAa,CAACM,IAArB;AACAN,QAAAA,aAAa,CAACO,GAAd,GAAoB1wC,KAApB;AACD;AACF;AACF,GAXD,MAWO,IAAI,OAAOmwC,aAAa,CAACO,GAArB,KAA6B,WAAjC,EAA8C;AACnD,QAAIN,QAAQ,KAAK,MAAjB,EAAyB;AACvB,UAAIpwC,KAAK,GAAGmwC,aAAa,CAACO,GAA1B,EAA+B;AAAE;AAC/B,eAAOP,aAAa,CAACO,GAArB;AACAP,QAAAA,aAAa,CAACM,IAAd,GAAqBzwC,KAArB;AACD;AACF,KALD,MAKO;AAAE;AACP,UAAIA,KAAK,GAAGmwC,aAAa,CAACO,GAA1B,EAA+B;AAAE;AAC/BP,QAAAA,aAAa,CAACO,GAAd,GAAoB1wC,KAApB;AACD;AACF;AACF,GAXM,MAWA;AACLmwC,IAAAA,aAAa,CAACC,QAAD,CAAb,GAA0BpwC,KAA1B;AACD;AACF,EAED;;;AACA,SAASswC,UAAT,CAAoBF,QAApB,EAA8BpwC,KAA9B,EAAqCmwC,aAArC,EAAoD;AAClD,MAAI,OAAOA,aAAa,CAACD,GAArB,KAA6B,WAAjC,EAA8C;AAC5C,WAD4C,CACpC;AACT;;AACD,MAAI,OAAOC,aAAa,CAACQ,IAArB,KAA8B,WAAlC,EAA+C;AAC7C,QAAIP,QAAQ,KAAK,MAAjB,EAAyB;AACvB,UAAIpwC,KAAK,GAAGmwC,aAAa,CAACQ,IAA1B,EAAgC;AAAE;AAChCR,QAAAA,aAAa,CAACQ,IAAd,GAAqB3wC,KAArB;AACD;AACF,KAJD,MAIO;AAAE;AACP,UAAIA,KAAK,IAAImwC,aAAa,CAACQ,IAA3B,EAAiC;AAAE;AACjC,eAAOR,aAAa,CAACQ,IAArB;AACAR,QAAAA,aAAa,CAACS,GAAd,GAAoB5wC,KAApB;AACD;AACF;AACF,GAXD,MAWO,IAAI,OAAOmwC,aAAa,CAACS,GAArB,KAA6B,WAAjC,EAA8C;AACnD,QAAIR,QAAQ,KAAK,MAAjB,EAAyB;AACvB,UAAIpwC,KAAK,GAAGmwC,aAAa,CAACS,GAA1B,EAA+B;AAAE;AAC/B,eAAOT,aAAa,CAACS,GAArB;AACAT,QAAAA,aAAa,CAACQ,IAAd,GAAqB3wC,KAArB;AACD;AACF,KALD,MAKO;AAAE;AACP,UAAIA,KAAK,GAAGmwC,aAAa,CAACS,GAA1B,EAA+B;AAAE;AAC/BT,QAAAA,aAAa,CAACS,GAAd,GAAoB5wC,KAApB;AACD;AACF;AACF,GAXM,MAWA;AACLmwC,IAAAA,aAAa,CAACC,QAAD,CAAb,GAA0BpwC,KAA1B;AACD;AACF,EAED;;;AACA,SAASuwC,OAAT,CAAiBvwC,KAAjB,EAAwBmwC,aAAxB,EAAuC;AACrC,MAAI,SAASA,aAAb,EAA4B;AAC1B;AACAA,IAAAA,aAAa,CAACU,GAAd,CAAkBvvC,IAAlB,CAAuBtB,KAAvB;AACD,GAHD,MAGO;AAAE;AACPmwC,IAAAA,aAAa,CAACU,GAAd,GAAoB,CAAC7wC,KAAD,CAApB;AACD;AACF,EAED;;;AACA,SAASwwC,OAAT,CAAiBxwC,KAAjB,EAAwBmwC,aAAxB,EAAuC;AACrC;AACA;AACA,SAAOA,aAAa,CAACO,GAArB;AACA,SAAOP,aAAa,CAACM,IAArB;AACA,SAAON,aAAa,CAACS,GAArB;AACA,SAAOT,aAAa,CAACQ,IAArB;AACA,SAAOR,aAAa,CAACU,GAArB;AACAV,EAAAA,aAAa,CAACD,GAAd,GAAoBlwC,KAApB;AACD,EAED;;;AACA,SAAS8wC,yBAAT,CAAmCttC,GAAnC,EAAwC;AACpC,OAAK,IAAIgsB,IAAT,IAAiBhsB,GAAjB,EAAsB;AAClB,QAAIgpB,KAAK,CAAC2C,OAAN,CAAc3rB,GAAd,CAAJ,EAAwB;AACpB,WAAK,IAAI+N,CAAT,IAAc/N,GAAd,EAAmB;AACf,YAAIA,GAAG,CAAC+N,CAAD,CAAH,CAAO,MAAP,CAAJ,EAAoB;AAChB/N,UAAAA,GAAG,CAAC+N,CAAD,CAAH,GAASw+B,mBAAmB,CAACvsC,GAAG,CAAC+N,CAAD,CAAH,CAAO,MAAP,CAAD,CAA5B;AACH;AACJ;AACJ;;AACD,QAAIvR,KAAK,GAAGwD,GAAG,CAACgsB,IAAD,CAAf;;AACA,QAAI,OAAOxvB,KAAP,KAAiB,QAArB,EAA+B;AAC3B8wC,MAAAA,yBAAyB,CAAC9wC,KAAD,CAAzB,CAD2B,CACO;AACrC;AACJ;;AACD,SAAOwD,GAAP;AACH,EAED;;;AACA,SAASutC,eAAT,CAAyBvtC,GAAzB,EAA8BwtC,KAA9B,EAAqC;AACjC,OAAK,IAAIxhB,IAAT,IAAiBhsB,GAAjB,EAAsB;AAClB,QAAIgsB,IAAI,KAAK,MAAb,EAAqB;AACjBwhB,MAAAA,KAAK,GAAG,IAAR;AACH;;AACD,QAAIhxC,KAAK,GAAGwD,GAAG,CAACgsB,IAAD,CAAf;;AACA,QAAI,OAAOxvB,KAAP,KAAiB,QAArB,EAA+B;AAC3BgxC,MAAAA,KAAK,GAAGD,eAAe,CAAC/wC,KAAD,EAAQgxC,KAAR,CAAvB,CAD2B,CACY;AAC1C;AACJ;;AACD,SAAOA,KAAP;AACH,EAED;AACA;AACA;;;AACA,SAASC,eAAT,CAAyBC,KAAzB,EAAgC;AAC9B,MAAIzyC,MAAM,GAAGmZ,KAAK,CAACs5B,KAAD,CAAlB;AACA,MAAIC,QAAQ,GAAG,KAAf,CAF8B,CAG5B;;AACA,MAAIJ,eAAe,CAACtyC,MAAD,EAAS,KAAT,CAAnB,EAAoC;AAChCA,IAAAA,MAAM,GAAGqyC,yBAAyB,CAACryC,MAAD,CAAlC;;AACA,QAAI,UAAUA,MAAd,EAAsB;AAClBA,MAAAA,MAAM,GAAGsxC,mBAAmB,CAACtxC,MAAM,CAAC,MAAD,CAAP,CAA5B;AACH;;AACD0yC,IAAAA,QAAQ,GAAG,IAAX;AACH;;AAEH,GAAC,KAAD,EAAQ,MAAR,EAAgBzwC,OAAhB,CAAwB,UAAU0wC,OAAV,EAAmB;AACzC,QAAIA,OAAO,IAAI3yC,MAAf,EAAuB;AACrB;AACA;AACAA,MAAAA,MAAM,CAAC2yC,OAAD,CAAN,CAAgB1wC,OAAhB,CAAwB,UAAU2wC,WAAV,EAAuB;AAC7C,YAAI9B,MAAM,GAAGhyC,MAAM,CAACoC,IAAP,CAAY0xC,WAAZ,CAAb;;AACA,aAAK,IAAI9/B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGg+B,MAAM,CAACtzC,MAA3B,EAAmCsV,CAAC,EAApC,EAAwC;AACtC,cAAIq+B,KAAK,GAAGL,MAAM,CAACh+B,CAAD,CAAlB;AACA,cAAI0+B,OAAO,GAAGoB,WAAW,CAACzB,KAAD,CAAzB;;AACA,cAAI,OAAOK,OAAP,KAAmB,QAAnB,IAA+BA,OAAO,KAAK,IAA/C,EAAqD;AACnDoB,YAAAA,WAAW,CAACzB,KAAD,CAAX,GAAqB;AAACM,cAAAA,GAAG,EAAED;AAAN,aAArB;AACD;AACF;AACF,OATD;AAUD;AACF,GAfD;;AAiBA,MAAI,UAAUxxC,MAAd,EAAsB;AACpB;AACA;AACAA,IAAAA,MAAM,CAAC,MAAD,CAAN,GAAiBsxC,mBAAmB,CAAC,CAACtxC,MAAM,CAAC,MAAD,CAAP,CAAD,CAApC;AACD;;AAED,MAAI8wC,MAAM,GAAGhyC,MAAM,CAACoC,IAAP,CAAYlB,MAAZ,CAAb;;AAEA,OAAK,IAAI8S,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGg+B,MAAM,CAACtzC,MAA3B,EAAmCsV,CAAC,EAApC,EAAwC;AACtC,QAAIq+B,KAAK,GAAGL,MAAM,CAACh+B,CAAD,CAAlB;AACA,QAAI0+B,OAAO,GAAGxxC,MAAM,CAACmxC,KAAD,CAApB;;AAEA,QAAI,OAAOK,OAAP,KAAmB,QAAnB,IAA+BA,OAAO,KAAK,IAA/C,EAAqD;AACnDA,MAAAA,OAAO,GAAG;AAACC,QAAAA,GAAG,EAAED;AAAN,OAAV;AACD,KAFD,MAEO,IAAI,SAASA,OAAT,IAAoB,CAACkB,QAAzB,EAAmC;AACxC;AACA;AACAlB,MAAAA,OAAO,CAACY,GAAR,GAAc,CAACZ,OAAO,CAACY,GAAT,CAAd;AACD;;AACDpyC,IAAAA,MAAM,CAACmxC,KAAD,CAAN,GAAgBK,OAAhB;AACD;;AAED,SAAOxxC,MAAP;AACD;;AAED,SAAS6yC,GAAT,CAAavb,GAAb,EAAkBwb,OAAlB,EAA2BC,UAA3B,EAAuC;AACrC,MAAIC,OAAO,GAAG,EAAd;AACA,MAAIC,YAAY,GAAGF,UAAU,GAAGzb,GAAG,CAAC95B,MAApC;AACA;;AACA,SAAOw1C,OAAO,CAACx1C,MAAR,GAAiBy1C,YAAxB,EAAsC;AACpCD,IAAAA,OAAO,IAAIF,OAAX;AACD;;AACD,SAAOE,OAAP;AACD;;AAED,SAASE,OAAT,CAAiB5b,GAAjB,EAAsBwb,OAAtB,EAA+BC,UAA/B,EAA2C;AACzC,MAAIC,OAAO,GAAGH,GAAG,CAACvb,GAAD,EAAMwb,OAAN,EAAeC,UAAf,CAAjB;AACA,SAAOC,OAAO,GAAG1b,GAAjB;AACD;;AAED,IAAI6b,aAAa,GAAG,CAAC,GAArB,EAA0B;;AAC1B,IAAIC,gBAAgB,GAAG,CAAvB,EAA0B;;AAC1B,IAAIC,GAAG,GAAG,EAAV,EAAc;;AAEd,SAASC,OAAT,CAAiBtuC,CAAjB,EAAoBC,CAApB,EAAuB;AAErB,MAAID,CAAC,KAAKC,CAAV,EAAa;AACX,WAAO,CAAP;AACD;;AAEDD,EAAAA,CAAC,GAAGuuC,YAAY,CAACvuC,CAAD,CAAhB;AACAC,EAAAA,CAAC,GAAGsuC,YAAY,CAACtuC,CAAD,CAAhB;AAEA,MAAIuuC,EAAE,GAAGC,cAAc,CAACzuC,CAAD,CAAvB;AACA,MAAI0uC,EAAE,GAAGD,cAAc,CAACxuC,CAAD,CAAvB;;AACA,MAAKuuC,EAAE,GAAGE,EAAN,KAAc,CAAlB,EAAqB;AACnB,WAAOF,EAAE,GAAGE,EAAZ;AACD;;AACD,UAAQ,OAAO1uC,CAAf;AACE,SAAK,QAAL;AACE,aAAOA,CAAC,GAAGC,CAAX;;AACF,SAAK,SAAL;AACE,aAAOD,CAAC,GAAGC,CAAJ,GAAQ,CAAC,CAAT,GAAa,CAApB;;AACF,SAAK,QAAL;AACE,aAAO0uC,aAAa,CAAC3uC,CAAD,EAAIC,CAAJ,CAApB;AANJ;;AAQA,SAAO8oB,KAAK,CAAC2C,OAAN,CAAc1rB,CAAd,IAAmB4uC,YAAY,CAAC5uC,CAAD,EAAIC,CAAJ,CAA/B,GAAwC4uC,aAAa,CAAC7uC,CAAD,EAAIC,CAAJ,CAA5D;AACD,EAED;AACA;;;AACA,SAASsuC,YAAT,CAAsBlyC,GAAtB,EAA2B;AACzB,UAAQ,OAAOA,GAAf;AACE,SAAK,WAAL;AACE,aAAO,IAAP;;AACF,SAAK,QAAL;AACE,UAAIA,GAAG,KAAKyyC,QAAR,IAAoBzyC,GAAG,KAAK,CAACyyC,QAA7B,IAAyC7pB,KAAK,CAAC5oB,GAAD,CAAlD,EAAyD;AACvD,eAAO,IAAP;AACD;;AACD,aAAOA,GAAP;;AACF,SAAK,QAAL;AACE,UAAI0yC,OAAO,GAAG1yC,GAAd;;AACA,UAAI0sB,KAAK,CAAC2C,OAAN,CAAcrvB,GAAd,CAAJ,EAAwB;AACtB,YAAIiqB,GAAG,GAAGjqB,GAAG,CAAC7D,MAAd;AACA6D,QAAAA,GAAG,GAAG,IAAI0sB,KAAJ,CAAUzC,GAAV,CAAN;;AACA,aAAK,IAAIxY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwY,GAApB,EAAyBxY,CAAC,EAA1B,EAA8B;AAC5BzR,UAAAA,GAAG,CAACyR,CAAD,CAAH,GAASygC,YAAY,CAACQ,OAAO,CAACjhC,CAAD,CAAR,CAArB;AACD;AACH;;AACC,OAPD,MAOO,IAAIzR,GAAG,YAAY+wB,IAAnB,EAAyB;AAC9B,eAAO/wB,GAAG,CAACoZ,MAAJ,EAAP;AACD,OAFM,MAEA,IAAIpZ,GAAG,KAAK,IAAZ,EAAkB;AAAE;AACzBA,QAAAA,GAAG,GAAG,EAAN;;AACA,aAAK,IAAI2yC,CAAT,IAAcD,OAAd,EAAuB;AACrB,cAAIA,OAAO,CAACvuB,cAAR,CAAuBwuB,CAAvB,CAAJ,EAA+B;AAC7B,gBAAInzC,GAAG,GAAGkzC,OAAO,CAACC,CAAD,CAAjB;;AACA,gBAAI,OAAOnzC,GAAP,KAAe,WAAnB,EAAgC;AAC9BQ,cAAAA,GAAG,CAAC2yC,CAAD,CAAH,GAAST,YAAY,CAAC1yC,GAAD,CAArB;AACD;AACF;AACF;AACF;;AA7BL;;AA+BA,SAAOQ,GAAP;AACD;;AAED,SAAS4yC,QAAT,CAAkB5yC,GAAlB,EAAuB;AACrB,MAAIA,GAAG,KAAK,IAAZ,EAAkB;AAChB,YAAQ,OAAOA,GAAf;AACE,WAAK,SAAL;AACE,eAAOA,GAAG,GAAG,CAAH,GAAO,CAAjB;;AACF,WAAK,QAAL;AACE,eAAO6yC,oBAAoB,CAAC7yC,GAAD,CAA3B;;AACF,WAAK,QAAL;AACE;AACA;AACA;AACA;AACA;;AACA;AACA,eAAOA,GAAG,CACPgO,OADI,CACI,SADJ,EACe,cADf,EAEJA,OAFI,CAEI,SAFJ,EAEe,cAFf,EAGJA,OAHI,CAGI,SAHJ,EAGe,cAHf,CAAP;;AAIA;;AACF,WAAK,QAAL;AACE,YAAIqhB,OAAO,GAAG3C,KAAK,CAAC2C,OAAN,CAAcrvB,GAAd,CAAd;AACA,YAAIwsB,GAAG,GAAG6C,OAAO,GAAGrvB,GAAH,GAASvC,MAAM,CAACoC,IAAP,CAAYG,GAAZ,CAA1B;AACA,YAAIyR,CAAC,GAAG,CAAC,CAAT;AACA,YAAIwY,GAAG,GAAGuC,GAAG,CAACrwB,MAAd;AACA,YAAIwC,MAAM,GAAG,EAAb;;AACA,YAAI0wB,OAAJ,EAAa;AACX,iBAAO,EAAE5d,CAAF,GAAMwY,GAAb,EAAkB;AAChBtrB,YAAAA,MAAM,IAAIm0C,iBAAiB,CAACtmB,GAAG,CAAC/a,CAAD,CAAJ,CAA3B;AACD;AACF,SAJD,MAIO;AACL,iBAAO,EAAEA,CAAF,GAAMwY,GAAb,EAAkB;AAChB,gBAAI8oB,MAAM,GAAGvmB,GAAG,CAAC/a,CAAD,CAAhB;AACA9S,YAAAA,MAAM,IAAIm0C,iBAAiB,CAACC,MAAD,CAAjB,GACND,iBAAiB,CAAC9yC,GAAG,CAAC+yC,MAAD,CAAJ,CADrB;AAED;AACF;;AACD,eAAOp0C,MAAP;AAlCJ;AAoCD;;AACD,SAAO,EAAP;AACD,EAED;AACA;AACA;;;AACA,SAASm0C,iBAAT,CAA2B9yC,GAA3B,EAAgC;AAC9B,MAAIgzC,IAAI,GAAG,QAAX;AACAhzC,EAAAA,GAAG,GAAGkyC,YAAY,CAAClyC,GAAD,CAAlB;AACA,SAAOoyC,cAAc,CAACpyC,GAAD,CAAd,GAAsBgyC,GAAtB,GAA4BY,QAAQ,CAAC5yC,GAAD,CAApC,GAA4CgzC,IAAnD;AACD;;AAED,SAASC,WAAT,CAAqBhd,GAArB,EAA0BxkB,CAA1B,EAA6B;AAC3B,MAAIyhC,WAAW,GAAGzhC,CAAlB;AACA,MAAI0hC,GAAJ;AACA,MAAIH,IAAI,GAAG/c,GAAG,CAACxkB,CAAD,CAAH,KAAW,GAAtB;;AACA,MAAIuhC,IAAJ,EAAU;AACRG,IAAAA,GAAG,GAAG,CAAN;AACA1hC,IAAAA,CAAC;AACF,GAHD,MAGO;AACL,QAAI2hC,GAAG,GAAGnd,GAAG,CAACxkB,CAAD,CAAH,KAAW,GAArB;AACAA,IAAAA,CAAC;AACD,QAAI4hC,WAAW,GAAG,EAAlB;AACA,QAAIC,WAAW,GAAGrd,GAAG,CAACnH,SAAJ,CAAcrd,CAAd,EAAiBA,CAAC,GAAGsgC,gBAArB,CAAlB;AACA,QAAIwB,SAAS,GAAGn3C,QAAQ,CAACk3C,WAAD,EAAc,EAAd,CAAR,GAA4BxB,aAA5C;AACA;;AACA,QAAIsB,GAAJ,EAAS;AACPG,MAAAA,SAAS,GAAG,CAACA,SAAb;AACD;;AACD9hC,IAAAA,CAAC,IAAIsgC,gBAAL;;AACA,WAAO,IAAP,EAAa;AACX,UAAIpC,EAAE,GAAG1Z,GAAG,CAACxkB,CAAD,CAAZ;;AACA,UAAIk+B,EAAE,KAAK,QAAX,EAAqB;AACnB;AACD,OAFD,MAEO;AACL0D,QAAAA,WAAW,IAAI1D,EAAf;AACD;;AACDl+B,MAAAA,CAAC;AACF;;AACD4hC,IAAAA,WAAW,GAAGA,WAAW,CAACr3B,KAAZ,CAAkB,GAAlB,CAAd;;AACA,QAAIq3B,WAAW,CAACl3C,MAAZ,KAAuB,CAA3B,EAA8B;AAC5Bg3C,MAAAA,GAAG,GAAG/2C,QAAQ,CAACi3C,WAAD,EAAc,EAAd,CAAd;AACD,KAFD,MAEO;AACL;AACAF,MAAAA,GAAG,GAAGlxB,UAAU,CAACoxB,WAAW,CAAC,CAAD,CAAX,GAAiB,GAAjB,GAAuBA,WAAW,CAAC,CAAD,CAAnC,CAAhB;AACD;AACD;;;AACA,QAAID,GAAJ,EAAS;AACPD,MAAAA,GAAG,GAAGA,GAAG,GAAG,EAAZ;AACD;AACD;;;AACA,QAAII,SAAS,KAAK,CAAlB,EAAqB;AACnB;AACA;AACA;AACAJ,MAAAA,GAAG,GAAGlxB,UAAU,CAACkxB,GAAG,GAAG,GAAN,GAAYI,SAAb,CAAhB;AACD;AACF;;AACD,SAAO;AAACJ,IAAAA,GAAG,EAAEA,GAAN;AAAWh3C,IAAAA,MAAM,EAAGsV,CAAC,GAAGyhC;AAAxB,GAAP;AACD,EAED;AACA;;;AACA,SAASvmB,GAAT,CAAa6mB,KAAb,EAAoBC,SAApB,EAA+B;AAC7B,MAAI/vC,GAAG,GAAG8vC,KAAK,CAAC7mB,GAAN,EAAV;;AAEA,MAAI8mB,SAAS,CAACt3C,MAAd,EAAsB;AACpB,QAAIu3C,eAAe,GAAGD,SAAS,CAACA,SAAS,CAACt3C,MAAV,GAAmB,CAApB,CAA/B;;AACA,QAAIuH,GAAG,KAAKgwC,eAAe,CAACC,OAA5B,EAAqC;AACnC;AACAF,MAAAA,SAAS,CAAC9mB,GAAV;AACA+mB,MAAAA,eAAe,GAAGD,SAAS,CAACA,SAAS,CAACt3C,MAAV,GAAmB,CAApB,CAA3B;AACD;;AACD,QAAIw3C,OAAO,GAAGD,eAAe,CAACC,OAA9B;AACA,QAAIC,gBAAgB,GAAGF,eAAe,CAAC3wB,KAAvC;;AACA,QAAI2J,KAAK,CAAC2C,OAAN,CAAcskB,OAAd,CAAJ,EAA4B;AAC1BA,MAAAA,OAAO,CAACnyC,IAAR,CAAakC,GAAb;AACD,KAFD,MAEO,IAAIkwC,gBAAgB,KAAKJ,KAAK,CAACr3C,MAAN,GAAe,CAAxC,EAA2C;AAAE;AAClD,UAAI6D,GAAG,GAAGwzC,KAAK,CAAC7mB,GAAN,EAAV;AACAgnB,MAAAA,OAAO,CAAC3zC,GAAD,CAAP,GAAe0D,GAAf;AACD,KAHM,MAGA;AACL8vC,MAAAA,KAAK,CAAChyC,IAAN,CAAWkC,GAAX,EADK,CACY;AAClB;AACF;AACF;;AAED,SAASmwC,oBAAT,CAA8B5d,GAA9B,EAAmC;AACjC,MAAIud,KAAK,GAAG,EAAZ;AACA,MAAIC,SAAS,GAAG,EAAhB,CAFiC,CAEb;;AACpB,MAAIhiC,CAAC,GAAG,CAAR;AAEA;;AACA,SAAO,IAAP,EAAa;AACX,QAAI2gC,cAAc,GAAGnc,GAAG,CAACxkB,CAAC,EAAF,CAAxB;;AACA,QAAI2gC,cAAc,KAAK,QAAvB,EAAiC;AAC/B,UAAIoB,KAAK,CAACr3C,MAAN,KAAiB,CAArB,EAAwB;AACtB,eAAOq3C,KAAK,CAAC7mB,GAAN,EAAP;AACD,OAFD,MAEO;AACLA,QAAAA,GAAG,CAAC6mB,KAAD,EAAQC,SAAR,CAAH;AACA;AACD;AACF;;AACD,YAAQrB,cAAR;AACE,WAAK,GAAL;AACEoB,QAAAA,KAAK,CAAChyC,IAAN,CAAW,IAAX;AACA;;AACF,WAAK,GAAL;AACEgyC,QAAAA,KAAK,CAAChyC,IAAN,CAAWy0B,GAAG,CAACxkB,CAAD,CAAH,KAAW,GAAtB;AACAA,QAAAA,CAAC;AACD;;AACF,WAAK,GAAL;AACE,YAAIqiC,SAAS,GAAGb,WAAW,CAAChd,GAAD,EAAMxkB,CAAN,CAA3B;AACA+hC,QAAAA,KAAK,CAAChyC,IAAN,CAAWsyC,SAAS,CAACX,GAArB;AACA1hC,QAAAA,CAAC,IAAIqiC,SAAS,CAAC33C,MAAf;AACA;;AACF,WAAK,GAAL;AACE,YAAI43C,SAAS,GAAG,EAAhB;AACA;;AACA,eAAO,IAAP,EAAa;AACX,cAAIpE,EAAE,GAAG1Z,GAAG,CAACxkB,CAAD,CAAZ;;AACA,cAAIk+B,EAAE,KAAK,QAAX,EAAqB;AACnB;AACD;;AACDoE,UAAAA,SAAS,IAAIpE,EAAb;AACAl+B,UAAAA,CAAC;AACF,SAVH,CAWE;AACA;;AACA;;;AACAsiC,QAAAA,SAAS,GAAGA,SAAS,CAAC/lC,OAAV,CAAkB,eAAlB,EAAmC,QAAnC,EACTA,OADS,CACD,eADC,EACgB,QADhB,EAETA,OAFS,CAED,eAFC,EAEgB,QAFhB,CAAZ;AAGA;;AACAwlC,QAAAA,KAAK,CAAChyC,IAAN,CAAWuyC,SAAX;AACA;;AACF,WAAK,GAAL;AACE,YAAIC,YAAY,GAAG;AAAEL,UAAAA,OAAO,EAAE,EAAX;AAAe5wB,UAAAA,KAAK,EAAEywB,KAAK,CAACr3C;AAA5B,SAAnB;AACAq3C,QAAAA,KAAK,CAAChyC,IAAN,CAAWwyC,YAAY,CAACL,OAAxB;AACAF,QAAAA,SAAS,CAACjyC,IAAV,CAAewyC,YAAf;AACA;;AACF,WAAK,GAAL;AACE,YAAIC,UAAU,GAAG;AAAEN,UAAAA,OAAO,EAAE,EAAX;AAAe5wB,UAAAA,KAAK,EAAEywB,KAAK,CAACr3C;AAA5B,SAAjB;AACAq3C,QAAAA,KAAK,CAAChyC,IAAN,CAAWyyC,UAAU,CAACN,OAAtB;AACAF,QAAAA,SAAS,CAACjyC,IAAV,CAAeyyC,UAAf;AACA;;AACF;;AACA;AACE,cAAM,IAAIh2C,KAAJ,CACJ,8DACEm0C,cAFE,CAAN;AA7CJ;AAiDD;AACF;;AAED,SAASG,YAAT,CAAsB5uC,CAAtB,EAAyBC,CAAzB,EAA4B;AAC1B,MAAIqmB,GAAG,GAAG1X,IAAI,CAAChQ,GAAL,CAASoB,CAAC,CAACxH,MAAX,EAAmByH,CAAC,CAACzH,MAArB,CAAV;;AACA,OAAK,IAAIsV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwY,GAApB,EAAyBxY,CAAC,EAA1B,EAA8B;AAC5B,QAAIovB,IAAI,GAAGoR,OAAO,CAACtuC,CAAC,CAAC8N,CAAD,CAAF,EAAO7N,CAAC,CAAC6N,CAAD,CAAR,CAAlB;;AACA,QAAIovB,IAAI,KAAK,CAAb,EAAgB;AACd,aAAOA,IAAP;AACD;AACF;;AACD,SAAQl9B,CAAC,CAACxH,MAAF,KAAayH,CAAC,CAACzH,MAAhB,GAA0B,CAA1B,GACJwH,CAAC,CAACxH,MAAF,GAAWyH,CAAC,CAACzH,MAAd,GAAwB,CAAxB,GAA4B,CAAC,CAD/B;AAED;;AACD,SAASm2C,aAAT,CAAuB3uC,CAAvB,EAA0BC,CAA1B,EAA6B;AAC3B;AACA;AACA;AACA,SAAQD,CAAC,KAAKC,CAAP,GAAY,CAAZ,GAAkBD,CAAC,GAAGC,CAAL,GAAU,CAAV,GAAc,CAAC,CAAvC;AACD;;AACD,SAAS4uC,aAAT,CAAuB7uC,CAAvB,EAA0BC,CAA1B,EAA6B;AAC3B,MAAIswC,EAAE,GAAGz2C,MAAM,CAACoC,IAAP,CAAY8D,CAAZ,CAAT;AAAA,MAAyBwwC,EAAE,GAAG12C,MAAM,CAACoC,IAAP,CAAY+D,CAAZ,CAA9B;AACA,MAAIqmB,GAAG,GAAG1X,IAAI,CAAChQ,GAAL,CAAS2xC,EAAE,CAAC/3C,MAAZ,EAAoBg4C,EAAE,CAACh4C,MAAvB,CAAV;;AACA,OAAK,IAAIsV,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwY,GAApB,EAAyBxY,CAAC,EAA1B,EAA8B;AAC5B;AACA,QAAIovB,IAAI,GAAGoR,OAAO,CAACiC,EAAE,CAACziC,CAAD,CAAH,EAAQ0iC,EAAE,CAAC1iC,CAAD,CAAV,CAAlB;;AACA,QAAIovB,IAAI,KAAK,CAAb,EAAgB;AACd,aAAOA,IAAP;AACD,KAL2B,CAM5B;;;AACAA,IAAAA,IAAI,GAAGoR,OAAO,CAACtuC,CAAC,CAACuwC,EAAE,CAACziC,CAAD,CAAH,CAAF,EAAW7N,CAAC,CAACuwC,EAAE,CAAC1iC,CAAD,CAAH,CAAZ,CAAd;;AACA,QAAIovB,IAAI,KAAK,CAAb,EAAgB;AACd,aAAOA,IAAP;AACD;AAEF;;AACD,SAAQqT,EAAE,CAAC/3C,MAAH,KAAcg4C,EAAE,CAACh4C,MAAlB,GAA4B,CAA5B,GACJ+3C,EAAE,CAAC/3C,MAAH,GAAYg4C,EAAE,CAACh4C,MAAhB,GAA0B,CAA1B,GAA8B,CAAC,CADjC;AAED,EACD;AACA;AACA;AACA;;;AACA,SAASi2C,cAAT,CAAwB9f,CAAxB,EAA2B;AACzB,MAAI3xB,EAAE,GAAG,CAAC,SAAD,EAAY,QAAZ,EAAsB,QAAtB,EAAgC,QAAhC,CAAT;AACA,MAAIiJ,GAAG,GAAGjJ,EAAE,CAACkJ,OAAH,CAAW,OAAOyoB,CAAlB,CAAV,CAFyB,CAGzB;;AACA,MAAI,CAAC1oB,GAAL,EAAU;AACR,QAAI0oB,CAAC,KAAK,IAAV,EAAgB;AACd,aAAO,CAAP;AACD;;AACD,QAAI5F,KAAK,CAAC2C,OAAN,CAAciD,CAAd,CAAJ,EAAsB;AACpB,aAAO,CAAP;AACD;;AACD,WAAO1oB,GAAG,GAAG,CAAN,GAAWA,GAAG,GAAG,CAAjB,GAAuBA,GAAG,GAAG,CAApC;AACD;AACD;;;AACA,MAAI8iB,KAAK,CAAC2C,OAAN,CAAciD,CAAd,CAAJ,EAAsB;AACpB,WAAO,CAAP;AACD;AACF,EAED;AACA;AACA;AACA;AACA;;;AACA,SAASugB,oBAAT,CAA8BM,GAA9B,EAAmC;AAEjC,MAAIA,GAAG,KAAK,CAAZ,EAAe;AACb,WAAO,GAAP;AACD,GAJgC,CAMjC;AACA;;;AACA,MAAIiB,SAAS,GAAGjB,GAAG,CAACkB,aAAJ,GAAoBr4B,KAApB,CAA0B,MAA1B,CAAhB;AACA,MAAIu3B,SAAS,GAAGn3C,QAAQ,CAACg4C,SAAS,CAAC,CAAD,CAAV,EAAe,EAAf,CAAxB;AAEA,MAAIhB,GAAG,GAAGD,GAAG,GAAG,CAAhB;AAEA,MAAIx0C,MAAM,GAAGy0C,GAAG,GAAG,GAAH,GAAS,GAAzB,CAbiC,CAejC;AACA;;AACA,MAAIkB,gBAAgB,GAAI,CAAClB,GAAG,GAAG,CAACG,SAAJ,GAAgBA,SAApB,IAAiCzB,aAAzD;AACA,MAAIyC,SAAS,GAAG1C,OAAO,CAAEyC,gBAAD,CAAmB70C,QAAnB,EAAD,EAAgC,GAAhC,EAAqCsyC,gBAArC,CAAvB;AAEApzC,EAAAA,MAAM,IAAIqzC,GAAG,GAAGuC,SAAhB,CApBiC,CAsBjC;;AACA,MAAIC,MAAM,GAAGjiC,IAAI,CAACkiC,GAAL,CAASxyB,UAAU,CAACmyB,SAAS,CAAC,CAAD,CAAV,CAAnB,CAAb,CAvBiC,CAuBgB;;AACjD;;AACA,MAAIhB,GAAJ,EAAS;AAAE;AACToB,IAAAA,MAAM,GAAG,KAAKA,MAAd;AACD;;AAED,MAAIE,SAAS,GAAGF,MAAM,CAACG,OAAP,CAAe,EAAf,CAAhB,CA7BiC,CA+BjC;;AACAD,EAAAA,SAAS,GAAGA,SAAS,CAAC1mC,OAAV,CAAkB,QAAlB,EAA4B,EAA5B,CAAZ;AAEArP,EAAAA,MAAM,IAAIqzC,GAAG,GAAG0C,SAAhB;AAEA,SAAO/1C,MAAP;AACD,EAED;;;AACA,SAASi2C,iBAAT,CAA2B/T,IAA3B,EAAiC;AAE/B,WAASgU,qBAAT,CAA+Bzc,GAA/B,EAAoC;AAClC,WAAOyI,IAAI,CAACr1B,GAAL,CAAS,UAAUspC,OAAV,EAAmB;AACjC,UAAItF,SAAS,GAAGO,MAAM,CAAC+E,OAAD,CAAtB;AACA,UAAIzF,WAAW,GAAGE,UAAU,CAACC,SAAD,CAA5B;AACA,UAAIuF,aAAa,GAAG3F,eAAe,CAAChX,GAAD,EAAMiX,WAAN,CAAnC;AACA,aAAO0F,aAAP;AACD,KALM,CAAP;AAMD;;AAED,SAAO,UAAUC,IAAV,EAAgBC,IAAhB,EAAsB;AAC3B,QAAIC,YAAY,GAAGL,qBAAqB,CAACG,IAAI,CAAC5c,GAAN,CAAxC;AACA,QAAI+c,YAAY,GAAGN,qBAAqB,CAACI,IAAI,CAAC7c,GAAN,CAAxC;AACA,QAAIgd,SAAS,GAAGnD,OAAO,CAACiD,YAAD,EAAeC,YAAf,CAAvB;;AACA,QAAIC,SAAS,KAAK,CAAlB,EAAqB;AACnB,aAAOA,SAAP;AACD,KAN0B,CAO3B;;;AACA,WAAO9F,SAAS,CAAC0F,IAAI,CAAC5c,GAAL,CAAS4C,GAAV,EAAeia,IAAI,CAAC7c,GAAL,CAAS4C,GAAxB,CAAhB;AACD,GATD;AAUD;;AAED,SAASqa,oBAAT,CAA8BC,IAA9B,EAAoCC,UAApC,EAAgDC,cAAhD,EAAgE;AAC9DF,EAAAA,IAAI,GAAGA,IAAI,CAAC/wC,MAAL,CAAY,UAAU6lC,GAAV,EAAe;AAChC,WAAOqL,SAAS,CAACrL,GAAG,CAAChS,GAAL,EAAUmd,UAAU,CAAC7qC,QAArB,EAA+B8qC,cAA/B,CAAhB;AACD,GAFM,CAAP;;AAIA,MAAID,UAAU,CAAC1U,IAAf,EAAqB;AACnB;AACA,QAAI6U,WAAW,GAAGd,iBAAiB,CAACW,UAAU,CAAC1U,IAAZ,CAAnC;AACAyU,IAAAA,IAAI,GAAGA,IAAI,CAACzU,IAAL,CAAU6U,WAAV,CAAP;;AACA,QAAI,OAAOH,UAAU,CAAC1U,IAAX,CAAgB,CAAhB,CAAP,KAA8B,QAA9B,IACAmP,QAAQ,CAACuF,UAAU,CAAC1U,IAAX,CAAgB,CAAhB,CAAD,CAAR,KAAiC,MADrC,EAC6C;AAC3CyU,MAAAA,IAAI,GAAGA,IAAI,CAACxU,OAAL,EAAP;AACD;AACF;;AAED,MAAI,WAAWyU,UAAX,IAAyB,UAAUA,UAAvC,EAAmD;AACjD;AACA,QAAIlO,IAAI,GAAGkO,UAAU,CAAClO,IAAX,IAAmB,CAA9B;AACA,QAAItB,KAAK,GAAG,CAAC,WAAWwP,UAAX,GAAwBA,UAAU,CAACxP,KAAnC,GAA2CuP,IAAI,CAACn5C,MAAjD,IAA2DkrC,IAAvE;AACAiO,IAAAA,IAAI,GAAGA,IAAI,CAACzyC,KAAL,CAAWwkC,IAAX,EAAiBtB,KAAjB,CAAP;AACD;;AACD,SAAOuP,IAAP;AACD;;AAED,SAASG,SAAT,CAAmBrd,GAAnB,EAAwB1tB,QAAxB,EAAkC8qC,cAAlC,EAAkD;AAChD,SAAOA,cAAc,CAAC97B,KAAf,CAAqB,UAAUo2B,KAAV,EAAiB;AAC3C,QAAIK,OAAO,GAAGzlC,QAAQ,CAAColC,KAAD,CAAtB;AACA,QAAIT,WAAW,GAAGE,UAAU,CAACO,KAAD,CAA5B;AACA,QAAIiF,aAAa,GAAG3F,eAAe,CAAChX,GAAD,EAAMiX,WAAN,CAAnC;;AACA,QAAIQ,oBAAoB,CAACC,KAAD,CAAxB,EAAiC;AAC/B,aAAO6F,yBAAyB,CAAC7F,KAAD,EAAQK,OAAR,EAAiB/X,GAAjB,CAAhC;AACD;;AAED,WAAOwd,aAAa,CAACzF,OAAD,EAAU/X,GAAV,EAAeiX,WAAf,EAA4B0F,aAA5B,CAApB;AACD,GATM,CAAP;AAUD;;AAED,SAASa,aAAT,CAAuBzF,OAAvB,EAAgC/X,GAAhC,EAAqCiX,WAArC,EAAkD0F,aAAlD,EAAiE;AAC/D,MAAI,CAAC5E,OAAL,EAAc;AACZ;AACA,WAAO,IAAP;AACD,GAJ8D,CAM/D;;;AACA,MAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,WAAO1yC,MAAM,CAACoC,IAAP,CAAYswC,OAAZ,EAAqBz2B,KAArB,CAA2B,UAAUm8B,YAAV,EAAwB;AACxD,UAAIC,SAAS,GAAG3F,OAAO,CAAC0F,YAAD,CAAvB;AACA,aAAO35C,KAAK,CAAC25C,YAAD,EAAezd,GAAf,EAAoB0d,SAApB,EAA+BzG,WAA/B,EAA4C0F,aAA5C,CAAZ;AACD,KAHM,CAAP;AAID,GAZ8D,CAc/D;;;AACA,SAAO5E,OAAO,KAAK4E,aAAnB;AACD;;AAED,SAASY,yBAAT,CAAmC7F,KAAnC,EAA0CK,OAA1C,EAAmD/X,GAAnD,EAAwD;AAEtD,MAAI0X,KAAK,KAAK,KAAd,EAAqB;AACnB,WAAOK,OAAO,CAACxrC,IAAR,CAAa,UAAUoxC,UAAV,EAAsB;AACxC,aAAON,SAAS,CAACrd,GAAD,EAAM2d,UAAN,EAAkBt4C,MAAM,CAACoC,IAAP,CAAYk2C,UAAZ,CAAlB,CAAhB;AACD,KAFM,CAAP;AAGD;;AAED,MAAIjG,KAAK,KAAK,MAAd,EAAsB;AACpB,WAAO,CAAC2F,SAAS,CAACrd,GAAD,EAAM+X,OAAN,EAAe1yC,MAAM,CAACoC,IAAP,CAAYswC,OAAZ,CAAf,CAAjB;AACD,GAVqD,CAYtD;;;AACA,SAAO,CAACA,OAAO,CAACzrC,IAAR,CAAa,UAAUqxC,UAAV,EAAsB;AACzC,WAAON,SAAS,CAACrd,GAAD,EAAM2d,UAAN,EAAkBt4C,MAAM,CAACoC,IAAP,CAAYk2C,UAAZ,CAAlB,CAAhB;AACD,GAFO,CAAR;AAID;;AAED,SAAS75C,KAAT,CAAe25C,YAAf,EAA6Bzd,GAA7B,EAAkC0d,SAAlC,EAA6CzG,WAA7C,EAA0D0F,aAA1D,EAAyE;AACvE,MAAI,CAACiB,QAAQ,CAACH,YAAD,CAAb,EAA6B;AAC3B,UAAM,IAAI53C,KAAJ,CAAU,uBAAuB43C,YAAvB,GACd,qEADc,GAEd,iEAFI,CAAN;AAGD;;AACD,SAAOG,QAAQ,CAACH,YAAD,CAAR,CAAuBzd,GAAvB,EAA4B0d,SAA5B,EAAuCzG,WAAvC,EAAoD0F,aAApD,CAAP;AACD;;AAED,SAASkB,WAAT,CAAqBlB,aAArB,EAAoC;AAClC,SAAO,OAAOA,aAAP,KAAyB,WAAzB,IAAwCA,aAAa,KAAK,IAAjE;AACD;;AAED,SAASmB,mBAAT,CAA6BnB,aAA7B,EAA4C;AAC1C,SAAO,OAAOA,aAAP,KAAyB,WAAhC;AACD;;AAED,SAASoB,QAAT,CAAkBpB,aAAlB,EAAiCe,SAAjC,EAA4C;AAC1C,MAAIM,OAAO,GAAGN,SAAS,CAAC,CAAD,CAAvB;AACA,MAAIO,GAAG,GAAGP,SAAS,CAAC,CAAD,CAAnB;;AACA,MAAIM,OAAO,KAAK,CAAhB,EAAmB;AACjB,UAAM,IAAIn4C,KAAJ,CAAU,oCAAV,CAAN;AACD;;AAED,MAAI7B,QAAQ,CAACg6C,OAAD,EAAU,EAAV,CAAR,KAA0BA,OAA9B,EAAwC;AACtC,UAAM,IAAIn4C,KAAJ,CAAU,2BAAV,CAAN;AACD;;AAED,MAAI7B,QAAQ,CAACi6C,GAAD,EAAM,EAAN,CAAR,KAAsBA,GAA1B,EAAgC;AAC9B,UAAM,IAAIp4C,KAAJ,CAAU,2BAAV,CAAN;AACD;;AAED,MAAI7B,QAAQ,CAAC24C,aAAD,EAAgB,EAAhB,CAAR,KAAgCA,aAApC,EAAmD;AACjD,WAAO,KAAP;AACD;;AAED,SAAOA,aAAa,GAAGqB,OAAhB,KAA4BC,GAAnC;AACD;;AAED,SAASC,kBAAT,CAA4BvB,aAA5B,EAA2Ce,SAA3C,EAAsD;AACpD,SAAOA,SAAS,CAACnxC,IAAV,CAAe,UAAUnF,GAAV,EAAe;AACnC,QAAIu1C,aAAa,YAAYroB,KAA7B,EAAoC;AAClC,aAAOqoB,aAAa,CAAClrC,OAAd,CAAsBrK,GAAtB,IAA6B,CAAC,CAArC;AACD;;AAED,WAAOu1C,aAAa,KAAKv1C,GAAzB;AACD,GANM,CAAP;AAOD;;AAED,SAAS+2C,sBAAT,CAAgCxB,aAAhC,EAA+Ce,SAA/C,EAA0D;AACxD,SAAOA,SAAS,CAACp8B,KAAV,CAAgB,UAAUla,GAAV,EAAe;AACpC,WAAOu1C,aAAa,CAAClrC,OAAd,CAAsBrK,GAAtB,IAA6B,CAAC,CAArC;AACD,GAFM,CAAP;AAGD;;AAED,SAASg3C,SAAT,CAAmBzB,aAAnB,EAAkCe,SAAlC,EAA6C;AAC3C,SAAOf,aAAa,CAAC54C,MAAd,KAAyB25C,SAAhC;AACD;;AAED,SAASW,UAAT,CAAoB1B,aAApB,EAAmCe,SAAnC,EAA8C;AAC5C,MAAIY,EAAE,GAAG,IAAIzoC,MAAJ,CAAW6nC,SAAX,CAAT;AAEA,SAAOY,EAAE,CAAC30B,IAAH,CAAQgzB,aAAR,CAAP;AACD;;AAED,SAAS4B,SAAT,CAAmB5B,aAAnB,EAAkCe,SAAlC,EAA6C;AAE3C,UAAQA,SAAR;AACE,SAAK,MAAL;AACE,aAAOf,aAAa,KAAK,IAAzB;;AACF,SAAK,SAAL;AACE,aAAO,OAAQA,aAAR,KAA2B,SAAlC;;AACF,SAAK,QAAL;AACE,aAAO,OAAQA,aAAR,KAA2B,QAAlC;;AACF,SAAK,QAAL;AACE,aAAO,OAAQA,aAAR,KAA2B,QAAlC;;AACF,SAAK,OAAL;AACE,aAAOA,aAAa,YAAYroB,KAAhC;;AACF,SAAK,QAAL;AACE,aAAQ,EAAD,CAAKjtB,QAAL,CAAcC,IAAd,CAAmBq1C,aAAnB,MAAsC,iBAA7C;AAZJ;;AAeA,QAAM,IAAI92C,KAAJ,CAAU63C,SAAS,GAAG,2BAAZ,GACA,mEADV,CAAN;AAGD;;AAED,IAAIE,QAAQ,GAAG;AAEb,gBAAc,UAAU5d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAClE,QAAI,CAACroB,KAAK,CAAC2C,OAAN,CAAc0lB,aAAd,CAAL,EAAmC;AACjC,aAAO,KAAP;AACD;;AAED,QAAIA,aAAa,CAAC54C,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,aAAO,KAAP;AACD;;AAED,QAAI,OAAO44C,aAAa,CAAC,CAAD,CAApB,KAA4B,QAAhC,EAA0C;AACxC,aAAOA,aAAa,CAACpwC,IAAd,CAAmB,UAAUnF,GAAV,EAAe;AACvC,eAAOi2C,SAAS,CAACj2C,GAAD,EAAMs2C,SAAN,EAAiBr4C,MAAM,CAACoC,IAAP,CAAYi2C,SAAZ,CAAjB,CAAhB;AACD,OAFM,CAAP;AAGD;;AAED,WAAOf,aAAa,CAACpwC,IAAd,CAAmB,UAAUnF,GAAV,EAAe;AACvC,aAAOo2C,aAAa,CAACE,SAAD,EAAY1d,GAAZ,EAAiBiX,WAAjB,EAA8B7vC,GAA9B,CAApB;AACD,KAFM,CAAP;AAGD,GApBY;AAsBb,eAAa,UAAU44B,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AACjE,QAAI,CAACroB,KAAK,CAAC2C,OAAN,CAAc0lB,aAAd,CAAL,EAAmC;AACjC,aAAO,KAAP;AACD;AAED;;;AACA,QAAIA,aAAa,CAAC54C,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,aAAO,KAAP;AACD;;AAED,QAAI,OAAO44C,aAAa,CAAC,CAAD,CAApB,KAA4B,QAAhC,EAA0C;AACxC,aAAOA,aAAa,CAACr7B,KAAd,CAAoB,UAAUla,GAAV,EAAe;AACxC,eAAOi2C,SAAS,CAACj2C,GAAD,EAAMs2C,SAAN,EAAiBr4C,MAAM,CAACoC,IAAP,CAAYi2C,SAAZ,CAAjB,CAAhB;AACD,OAFM,CAAP;AAGD;;AAED,WAAOf,aAAa,CAACr7B,KAAd,CAAoB,UAAUla,GAAV,EAAe;AACxC,aAAOo2C,aAAa,CAACE,SAAD,EAAY1d,GAAZ,EAAiBiX,WAAjB,EAA8B7vC,GAA9B,CAApB;AACD,KAFM,CAAP;AAGD,GAzCY;AA2Cb,SAAO,UAAU44B,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC3D,WAAOmB,mBAAmB,CAACnB,aAAD,CAAnB,IAAsC9C,OAAO,CAAC8C,aAAD,EAAgBe,SAAhB,CAAP,KAAsC,CAAnF;AACD,GA7CY;AA+Cb,UAAQ,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC5D,WAAOmB,mBAAmB,CAACnB,aAAD,CAAnB,IAAsC9C,OAAO,CAAC8C,aAAD,EAAgBe,SAAhB,CAAP,IAAqC,CAAlF;AACD,GAjDY;AAmDb,SAAO,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC3D,WAAOmB,mBAAmB,CAACnB,aAAD,CAAnB,IAAsC9C,OAAO,CAAC8C,aAAD,EAAgBe,SAAhB,CAAP,GAAoC,CAAjF;AACD,GArDY;AAuDb,UAAQ,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC5D,WAAOmB,mBAAmB,CAACnB,aAAD,CAAnB,IAAsC9C,OAAO,CAAC8C,aAAD,EAAgBe,SAAhB,CAAP,IAAqC,CAAlF;AACD,GAzDY;AA2Db,SAAO,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC3D,WAAOmB,mBAAmB,CAACnB,aAAD,CAAnB,IAAsC9C,OAAO,CAAC8C,aAAD,EAAgBe,SAAhB,CAAP,GAAoC,CAAjF;AACD,GA7DY;AA+Db,aAAW,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC/D;AACA,QAAIe,SAAJ,EAAe;AACb,aAAOI,mBAAmB,CAACnB,aAAD,CAA1B;AACD;;AAED,WAAO,CAACmB,mBAAmB,CAACnB,aAAD,CAA3B;AACD,GAtEY;AAwEb,UAAQ,UAAU3c,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC5D,WAAOkB,WAAW,CAAClB,aAAD,CAAX,IAA8BoB,QAAQ,CAACpB,aAAD,EAAgBe,SAAhB,CAA7C;AACD,GA1EY;AA4Eb,SAAO,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC3D,WAAOe,SAAS,CAACp8B,KAAV,CAAgB,UAAUk9B,OAAV,EAAmB;AACxC,aAAO3E,OAAO,CAAC8C,aAAD,EAAgB6B,OAAhB,CAAP,KAAoC,CAA3C;AACD,KAFM,CAAP;AAGD,GAhFY;AAiFb,SAAO,UAAUxe,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC3D,WAAOkB,WAAW,CAAClB,aAAD,CAAX,IAA8BuB,kBAAkB,CAACvB,aAAD,EAAgBe,SAAhB,CAAvD;AACD,GAnFY;AAqFb,UAAQ,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC5D,WAAOkB,WAAW,CAAClB,aAAD,CAAX,IAA8B,CAACuB,kBAAkB,CAACvB,aAAD,EAAgBe,SAAhB,CAAxD;AACD,GAvFY;AAyFb,WAAS,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC7D,WAAOkB,WAAW,CAAClB,aAAD,CAAX,IAA8ByB,SAAS,CAACzB,aAAD,EAAgBe,SAAhB,CAA9C;AACD,GA3FY;AA6Fb,UAAQ,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC5D,WAAOroB,KAAK,CAAC2C,OAAN,CAAc0lB,aAAd,KAAgCwB,sBAAsB,CAACxB,aAAD,EAAgBe,SAAhB,CAA7D;AACD,GA/FY;AAiGb,YAAU,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC9D,WAAOkB,WAAW,CAAClB,aAAD,CAAX,IAA8B0B,UAAU,CAAC1B,aAAD,EAAgBe,SAAhB,CAA/C;AACD,GAnGY;AAqGb,WAAS,UAAU1d,GAAV,EAAe0d,SAAf,EAA0BzG,WAA1B,EAAuC0F,aAAvC,EAAsD;AAC7D,WAAO4B,SAAS,CAAC5B,aAAD,EAAgBe,SAAhB,CAAhB;AACD;AAvGY,CAAf,EA0GA;;AACA,SAASe,eAAT,CAAyBze,GAAzB,EAA8B1tB,QAA9B,EAAwC;AACtC;AACA,MAAI,OAAOA,QAAP,KAAoB,QAAxB,EAAkC;AAChC;AACA,UAAM,IAAIzM,KAAJ,CAAU,wCAAV,CAAN;AACD;;AAEDyM,EAAAA,QAAQ,GAAGymC,eAAe,CAACzmC,QAAD,CAA1B;AACA,MAAI0/B,GAAG,GAAG;AACR,WAAOhS;AADC,GAAV;AAIA,MAAI0e,WAAW,GAAGzB,oBAAoB,CAAC,CAACjL,GAAD,CAAD,EAAQ;AAAE,gBAAY1/B;AAAd,GAAR,EAAkCjN,MAAM,CAACoC,IAAP,CAAY6K,QAAZ,CAAlC,CAAtC;AACA,SAAOosC,WAAW,IAAIA,WAAW,CAAC36C,MAAZ,KAAuB,CAA7C;AACD;;AAED,SAAS46C,UAAT,CAAoB3F,KAApB,EAA2B;AACzB,SAAO9W,SAAS,CAAC,2BAA2B8W,KAA3B,GAAmC,GAApC,EAAyC,EAAzC,CAAhB;AACD;;AAED,SAAS4F,QAAT,CAAkB5F,KAAlB,EAAyB;AACvB,MAAIr9B,IAAI,GAAG,CACT,wBADS,EAET,iBAFS,EAGT,wBAHS,EAIT,gCAJS,EAKT,qBALS,EAMT,MANS,EAOT,kBAAkBq9B,KAAlB,GAA0B,GAPjB,EAQT,cARS,EAST,kBATS,EAUT,kBAVS,EAWT,KAXS,EAYT,IAZS,EAaT53B,IAbS,CAaJ,IAbI,CAAX;AAeA,SAAO8gB,SAAS,CAACvmB,IAAD,EAAO,EAAP,CAAhB;AACD;;AAED,SAASwxB,QAAT,CAAkB5S,IAAlB,EAAwBpB,QAAxB,EAAkC;AAChC,MAAIoB,IAAI,CAACjoB,QAAT,EAAmB;AACjB,QAAIioB,IAAI,CAACpuB,MAAL,IAAeouB,IAAI,CAACpuB,MAAL,KAAgB,WAAnC,EAAgD;AAC9C,UAAI0yC,UAAU,GAAG,OAAOtkB,IAAI,CAACpuB,MAAZ,KAAuB,QAAvB,GACfouB,IAAI,CAACpuB,MADU,GACD,UADhB;AAEA,aAAOgtB,QAAQ,CAAC,IAAItzB,KAAJ,CAAU,kCAAkCg5C,UAAlC,GAA+C,GAAzD,CAAD,CAAf;AACD;AACF;;AACD1lB,EAAAA,QAAQ;AACT;;AAED,SAASqU,SAAT,CAAmBjT,IAAnB,EAAyB;AACvB,MAAIA,IAAI,CAACukB,IAAL,IAAa,CAACvkB,IAAI,CAACpuB,MAAvB,EAA+B;AAC7BouB,IAAAA,IAAI,CAACpuB,MAAL,GAAc,OAAd;AACD;;AAED,MAAIouB,IAAI,CAACjoB,QAAL,IAAiB,CAACioB,IAAI,CAACpuB,MAA3B,EAAmC;AACjCouB,IAAAA,IAAI,CAACpuB,MAAL,GAAc,WAAd;AACD;;AAED,MAAIouB,IAAI,CAACpuB,MAAL,IAAe,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,QAA1C,EAAoD;AAClD,QAAIouB,IAAI,CAACpuB,MAAL,KAAgB,OAApB,EAA6B;AAC3BouB,MAAAA,IAAI,CAACukB,IAAL,GAAYxd,8BAA8B,CAAC/G,IAAI,CAACukB,IAAN,CAA1C;AACD,KAFD,MAEO;AACLvkB,MAAAA,IAAI,CAACpuB,MAAL,GAAcm1B,8BAA8B,CAAC/G,IAAI,CAACpuB,MAAN,CAA5C;AACD;AACF;AACF;;AAED,SAASshC,YAAT,CAAsBsR,cAAtB,EAAsCxkB,IAAtC,EAA4C;AAC1C,SAAOA,IAAI,CAACpuB,MAAL,IAAe,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,QAAtC,IACL,CAACouB,IAAI,CAACykB,OADD,IACY,CAAC/d,QAAQ,CAAC8d,cAAc,CAACzkB,EAAhB,CAD5B;AAED;;AAED,SAASnuB,MAAT,CAAgB4yC,cAAhB,EAAgCxkB,IAAhC,EAAsC;AACpC,MAAIpB,QAAQ,GAAGoB,IAAI,CAAClZ,QAApB;;AACA,MAAIkZ,IAAI,CAACpuB,MAAL,KAAgB,OAApB,EAA6B;AAC3B,QAAI,CAACouB,IAAI,CAACukB,IAAN,IAAc,OAAOvkB,IAAI,CAACukB,IAAZ,KAAqB,QAAvC,EAAiD;AAC/C,UAAIlrC,GAAG,GAAGgsB,WAAW,CAACX,WAAD,EACnB,+CADmB,CAArB;AAEA,aAAO9F,QAAQ,CAACvlB,GAAD,CAAf;AACD,KAL0B,CAM3B;;;AACA,QAAIqrC,QAAQ,GAAG7d,0BAA0B,CAAC7G,IAAI,CAACukB,IAAN,CAAzC;AACAC,IAAAA,cAAc,CAACzkB,EAAf,CAAkB/0B,GAAlB,CAAsB,aAAa05C,QAAQ,CAAC,CAAD,CAA3C,EAAgD,UAAUrrC,GAAV,EAAesrC,IAAf,EAAqB;AACnE;AACA,UAAIH,cAAc,CAACpS,WAAnB,EAAgC;AAC9B,eAAOxT,QAAQ,CAAC,IAAD,EAAO;AAACyE,UAAAA,MAAM,EAAE;AAAT,SAAP,CAAf;AACD;AACD;;;AACA,UAAIhqB,GAAJ,EAAS;AACP,eAAOulB,QAAQ,CAAC2G,yBAAyB,CAAClsB,GAAD,CAA1B,CAAf;AACD;;AACD,UAAIurC,MAAM,GAAGD,IAAI,IAAIA,IAAI,CAACE,KAAb,IAAsBF,IAAI,CAACE,KAAL,CAAWH,QAAQ,CAAC,CAAD,CAAnB,CAAtB,IACXC,IAAI,CAACE,KAAL,CAAWH,QAAQ,CAAC,CAAD,CAAnB,EAAwB7rC,GAD1B;;AAEA,UAAI,CAAC+rC,MAAL,EAAa;AACX,eAAOhmB,QAAQ,CAACyG,WAAW,CAACtB,WAAD,EACxB4gB,IAAI,CAACE,KAAL,GAAa,uBAAuBH,QAAQ,CAAC,CAAD,CAA5C,GACC,yBAFuB,CAAZ,CAAf;AAGD;;AACD1kB,MAAAA,IAAI,CAACpuB,MAAL,GAAcyyC,QAAQ,CAACO,MAAD,CAAtB;AACAJ,MAAAA,cAAc,CAAC3R,SAAf,CAAyB7S,IAAzB;AACD,KAlBD;AAmBD,GA3BD,MA2BO,IAAIA,IAAI,CAACjoB,QAAT,EAAmB;AACxBioB,IAAAA,IAAI,CAACpuB,MAAL,GAAc,UAAU6zB,GAAV,EAAe;AAC3B,aAAOye,eAAe,CAACze,GAAD,EAAMzF,IAAI,CAACjoB,QAAX,CAAtB;AACD,KAFD;;AAGAysC,IAAAA,cAAc,CAAC3R,SAAf,CAAyB7S,IAAzB;AACD,GALM,MAKA;AACL;AACA,QAAIskB,UAAU,GAAGzd,0BAA0B,CAAC7G,IAAI,CAACpuB,MAAN,CAA3C;AACA4yC,IAAAA,cAAc,CAACzkB,EAAf,CAAkB/0B,GAAlB,CAAsB,aAAas5C,UAAU,CAAC,CAAD,CAA7C,EAAkD,UAAUjrC,GAAV,EAAesrC,IAAf,EAAqB;AACrE;AACA,UAAIH,cAAc,CAACpS,WAAnB,EAAgC;AAC9B,eAAOxT,QAAQ,CAAC,IAAD,EAAO;AAACyE,UAAAA,MAAM,EAAE;AAAT,SAAP,CAAf;AACD;AACD;;;AACA,UAAIhqB,GAAJ,EAAS;AACP,eAAOulB,QAAQ,CAAC2G,yBAAyB,CAAClsB,GAAD,CAA1B,CAAf;AACD;;AACD,UAAIyrC,SAAS,GAAGH,IAAI,IAAIA,IAAI,CAACI,OAAb,IAAwBJ,IAAI,CAACI,OAAL,CAAaT,UAAU,CAAC,CAAD,CAAvB,CAAxC;;AACA,UAAI,CAACQ,SAAL,EAAgB;AACd,eAAOlmB,QAAQ,CAACyG,WAAW,CAACtB,WAAD,EACvB4gB,IAAI,IAAIA,IAAI,CAACI,OAAd,GAAyB,uBAAuBT,UAAU,CAAC,CAAD,CAA1D,GACG,2BAFqB,CAAZ,CAAf;AAGD;;AACDtkB,MAAAA,IAAI,CAACpuB,MAAL,GAAcwyC,UAAU,CAACU,SAAD,CAAxB;AACAN,MAAAA,cAAc,CAAC3R,SAAf,CAAyB7S,IAAzB;AACD,KAjBD;AAkBD;AACF;;AAED,SAASglB,wBAAT,CAAkCtS,OAAlC,EAA2C;AACzCA,EAAAA,OAAO,CAACC,oBAAR,GAA+B;AAC7BC,IAAAA,QAAQ,EAAEA,QADmB;AAE7BK,IAAAA,SAAS,EAAEA,SAFkB;AAG7BC,IAAAA,YAAY,EAAEA,YAHe;AAI7BthC,IAAAA,MAAM,EAAEA;AAJqB,GAA/B;AAMD,EAED;;;AACA8gC,OAAO,CAAC0J,MAAR,CAAe4I,wBAAf;AAEAtS,OAAO,CAACxmC,OAAR,GAAkBA,OAAlB;;AAEA,SAAS+4C,QAAT,CAAkB3pB,KAAlB,EAAyB;AACvB,SAAOA,KAAK,CAACnuB,MAAN,CAAa,UAAU4D,GAAV,EAAe4Z,IAAf,EAAqB;AACvC5Z,IAAAA,GAAG,CAAC4Z,IAAD,CAAH,GAAY,IAAZ;AACA,WAAO5Z,GAAP;AACD,GAHM,EAGJ,EAHI,CAAP;AAID,EACD;;;AACA,IAAIm0C,aAAa,GAAGD,QAAQ,CAAC,CAC3B,KAD2B,EAE3B,MAF2B,EAG3B,cAH2B,EAI3B,UAJ2B,EAK3B,YAL2B,EAM3B,YAN2B,EAO3B,YAP2B,EAQ3B,oBAR2B,EAS3B,YAT2B,EAU3B,WAV2B,EAW3B;AACA,iBAZ2B,EAa3B,oBAb2B,EAc3B,yBAd2B,EAe3B,2BAf2B,EAgB3B,oBAhB2B,EAiB3B;AACA,UAlB2B,CAAD,CAA5B,EAqBA;;AACA,IAAIE,SAAS,GAAGF,QAAQ,CAAC,CACvB,cADuB,EAEvB;AACA,iBAHuB,EAIvB,oBAJuB,EAKvB,yBALuB,EAMvB,2BANuB,EAOvB,oBAPuB,CAAD,CAAxB;;AAUA,SAASG,iBAAT,CAA2B9Q,MAA3B,EAAmC;AACjC,MAAI,CAAC,SAASllB,IAAT,CAAcklB,MAAd,CAAL,EAA4B;AAC1B,WAAOjP,WAAW,CAACJ,WAAD,CAAlB;AACD;;AACD,MAAIhuB,GAAG,GAAGq9B,MAAM,CAACp9B,OAAP,CAAe,GAAf,CAAV;AACA,MAAIs8B,IAAI,GAAGc,MAAM,CAACnY,SAAP,CAAiB,CAAjB,EAAoBllB,GAApB,CAAX;AACA,MAAIw8B,KAAK,GAAGa,MAAM,CAACnY,SAAP,CAAiBllB,GAAG,GAAG,CAAvB,CAAZ;AACA,SAAO;AACLlH,IAAAA,MAAM,EAAEtG,QAAQ,CAAC+pC,IAAD,EAAO,EAAP,CADX;AAELxlC,IAAAA,EAAE,EAAEylC;AAFC,GAAP;AAID;;AAED,SAAS4R,wBAAT,CAAkCC,SAAlC,EAA6CtlB,IAA7C,EAAmD;AACjD,MAAI12B,GAAG,GAAGg8C,SAAS,CAACt8B,KAAV,GAAkBs8B,SAAS,CAAChY,GAAV,CAAc9jC,MAAhC,GAAyC,CAAnD;AAEA,MAAI+7C,WAAW,GAAGD,SAAS,CAAChY,GAA5B;AACA,MAAIA,GAAG,GAAG,CAACiY,WAAW,CAAC,CAAD,CAAZ,EAAiBvlB,IAAjB,EAAuB,EAAvB,CAAV;;AAEA,OAAK,IAAIlhB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGiuB,WAAW,CAAC/7C,MAAlC,EAA0CsV,CAAC,GAAGwY,GAA9C,EAAmDxY,CAAC,EAApD,EAAwD;AACtDwuB,IAAAA,GAAG,GAAG,CAACiY,WAAW,CAACzmC,CAAD,CAAZ,EAAiB;AAACukB,MAAAA,MAAM,EAAE;AAAT,KAAjB,EAAsC,CAACiK,GAAD,CAAtC,CAAN;AACD;;AAED,SAAO,CAAC;AACNhkC,IAAAA,GAAG,EAAEA,GADC;AAENgkC,IAAAA,GAAG,EAAEA;AAFC,GAAD,CAAP;AAID,EAED;AACA;;;AACA,SAASkY,QAAT,CAAkB/f,GAAlB,EAAuBggB,QAAvB,EAAiCC,MAAjC,EAAyC;AACvC,MAAI,CAACA,MAAL,EAAa;AACXA,IAAAA,MAAM,GAAG;AACPnZ,MAAAA,kBAAkB,EAAE;AADb,KAAT;AAGD;;AAED,MAAIoZ,OAAJ;AACA,MAAI/P,QAAJ;AACA,MAAIgQ,OAAJ;AACA,MAAI5lB,IAAI,GAAG;AAACqD,IAAAA,MAAM,EAAE;AAAT,GAAX;;AACA,MAAIoC,GAAG,CAACmO,QAAR,EAAkB;AAChB5T,IAAAA,IAAI,CAACwN,OAAL,GAAe,IAAf;AACD;;AAED,MAAIiY,QAAJ,EAAc;AACZ,QAAI,CAAChgB,GAAG,CAAC4C,GAAT,EAAc;AACZ5C,MAAAA,GAAG,CAAC4C,GAAJ,GAAUuE,IAAI,EAAd;AACD;;AACDgJ,IAAAA,QAAQ,GAAGpU,GAAG,CAACiE,GAAD,EAAMigB,MAAM,CAACnZ,kBAAb,CAAd;;AACA,QAAI9G,GAAG,CAACyC,IAAR,EAAc;AACZ0d,MAAAA,OAAO,GAAGR,iBAAiB,CAAC3f,GAAG,CAACyC,IAAL,CAA3B;;AACA,UAAI0d,OAAO,CAAC3wC,KAAZ,EAAmB;AACjB,eAAO2wC,OAAP;AACD;;AACDngB,MAAAA,GAAG,CAACkH,SAAJ,GAAgB,CAAC;AACfrjC,QAAAA,GAAG,EAAEs8C,OAAO,CAAC71C,MADE;AAEfu9B,QAAAA,GAAG,EAAE,CAACsY,OAAO,CAAC53C,EAAT,EAAa;AAACq1B,UAAAA,MAAM,EAAE;AAAT,SAAb,EAAkC,CAAC,CAACuS,QAAD,EAAW5V,IAAX,EAAiB,EAAjB,CAAD,CAAlC;AAFU,OAAD,CAAhB;AAIA2lB,MAAAA,OAAO,GAAGC,OAAO,CAAC71C,MAAR,GAAiB,CAA3B;AACD,KAVD,MAUO;AACL01B,MAAAA,GAAG,CAACkH,SAAJ,GAAgB,CAAC;AACfrjC,QAAAA,GAAG,EAAE,CADU;AAEfgkC,QAAAA,GAAG,EAAG,CAACsI,QAAD,EAAW5V,IAAX,EAAiB,EAAjB;AAFS,OAAD,CAAhB;AAIA2lB,MAAAA,OAAO,GAAG,CAAV;AACD;AACF,GAtBD,MAsBO;AACL,QAAIlgB,GAAG,CAACwO,UAAR,EAAoB;AAClBxO,MAAAA,GAAG,CAACkH,SAAJ,GAAgB0Y,wBAAwB,CAAC5f,GAAG,CAACwO,UAAL,EAAiBjU,IAAjB,CAAxC;AACA2lB,MAAAA,OAAO,GAAGlgB,GAAG,CAACwO,UAAJ,CAAejrB,KAAzB;AACA4sB,MAAAA,QAAQ,GAAGnQ,GAAG,CAACwO,UAAJ,CAAe3G,GAAf,CAAmB,CAAnB,CAAX;AACD;;AACD,QAAI,CAAC7H,GAAG,CAACkH,SAAT,EAAoB;AAClBiZ,MAAAA,OAAO,GAAGR,iBAAiB,CAAC3f,GAAG,CAACyC,IAAL,CAA3B;;AACA,UAAI0d,OAAO,CAAC3wC,KAAZ,EAAmB;AACjB,eAAO2wC,OAAP;AACD;;AACDD,MAAAA,OAAO,GAAGC,OAAO,CAAC71C,MAAlB;AACA6lC,MAAAA,QAAQ,GAAGgQ,OAAO,CAAC53C,EAAnB;AACAy3B,MAAAA,GAAG,CAACkH,SAAJ,GAAgB,CAAC;AACfrjC,QAAAA,GAAG,EAAEq8C,OADU;AAEfrY,QAAAA,GAAG,EAAE,CAACsI,QAAD,EAAW5V,IAAX,EAAiB,EAAjB;AAFU,OAAD,CAAhB;AAID;AACF;;AAEDyG,EAAAA,cAAc,CAAChB,GAAG,CAAC4C,GAAL,CAAd;AAEA5C,EAAAA,GAAG,CAACyC,IAAJ,GAAWyd,OAAO,GAAG,GAAV,GAAgB/P,QAA3B;AAEA,MAAI5pC,MAAM,GAAG;AAAC8gC,IAAAA,QAAQ,EAAG,EAAZ;AAAgB7/B,IAAAA,IAAI,EAAG;AAAvB,GAAb;;AACA,OAAK,IAAII,GAAT,IAAgBo4B,GAAhB,EAAqB;AACnB;AACA,QAAI36B,MAAM,CAACd,SAAP,CAAiBwnB,cAAjB,CAAgCzkB,IAAhC,CAAqC04B,GAArC,EAA0Cp4B,GAA1C,CAAJ,EAAoD;AAClD,UAAIw4C,UAAU,GAAGx4C,GAAG,CAAC,CAAD,CAAH,KAAW,GAA5B;;AACA,UAAIw4C,UAAU,IAAI,CAACX,aAAa,CAAC73C,GAAD,CAAhC,EAAuC;AACrC,YAAI4H,KAAK,GAAGowB,WAAW,CAACZ,cAAD,EAAiBp3B,GAAjB,CAAvB;AACA4H,QAAAA,KAAK,CAAChC,OAAN,GAAgBwxB,cAAc,CAACxxB,OAAf,GAAyB,IAAzB,GAAgC5F,GAAhD;AACA,cAAM4H,KAAN;AACD,OAJD,MAIO,IAAI4wC,UAAU,IAAI,CAACV,SAAS,CAAC93C,GAAD,CAA5B,EAAmC;AACxCrB,QAAAA,MAAM,CAAC8gC,QAAP,CAAgBz/B,GAAG,CAAC6C,KAAJ,CAAU,CAAV,CAAhB,IAAgCu1B,GAAG,CAACp4B,GAAD,CAAnC;AACD,OAFM,MAEA;AACLrB,QAAAA,MAAM,CAACiB,IAAP,CAAYI,GAAZ,IAAmBo4B,GAAG,CAACp4B,GAAD,CAAtB;AACD;AACF;AACF;;AACD,SAAOrB,MAAP;AACD;;AAED,SAAS85C,WAAT,CAAqB74C,IAArB,EAA2B;AACzB,MAAI;AACF,WAAOu7B,QAAQ,CAACv7B,IAAD,CAAf;AACD,GAFD,CAEE,OAAOzC,CAAP,EAAU;AACV,QAAI6O,GAAG,GAAGgsB,WAAW,CAACf,OAAD,EACnB,yCADmB,CAArB;AAEA,WAAO;AAACrvB,MAAAA,KAAK,EAAEoE;AAAR,KAAP;AACD;AACF;;AAED,SAAS0sC,gBAAT,CAA0B3f,GAA1B,EAA+B4f,QAA/B,EAAyCpnB,QAAzC,EAAmD;AACjD,MAAIqnB,QAAQ,GAAGH,WAAW,CAAC1f,GAAG,CAACn5B,IAAL,CAA1B;;AACA,MAAIg5C,QAAQ,CAAChxC,KAAb,EAAoB;AAClB,WAAO2pB,QAAQ,CAACqnB,QAAQ,CAAChxC,KAAV,CAAf;AACD;;AAEDmxB,EAAAA,GAAG,CAAC58B,MAAJ,GAAay8C,QAAQ,CAACz8C,MAAtB;;AACA,MAAIw8C,QAAQ,KAAK,MAAjB,EAAyB;AACvB5f,IAAAA,GAAG,CAACn5B,IAAJ,GAAWy8B,kBAAkB,CAACuc,QAAD,EAAW7f,GAAG,CAACgQ,YAAf,CAA7B;AACD,GAFD,MAEO,IAAI4P,QAAQ,KAAK,QAAjB,EAA2B;AAChC5f,IAAAA,GAAG,CAACn5B,IAAJ,GAAWy7B,QAAQ,CAACud,QAAD,CAAnB;AACD,GAFM,MAEA;AAAE;AACP7f,IAAAA,GAAG,CAACn5B,IAAJ,GAAWg5C,QAAX;AACD;;AACDva,EAAAA,SAAS,CAACua,QAAD,EAAW,UAAUj6C,MAAV,EAAkB;AACpCo6B,IAAAA,GAAG,CAAC8f,MAAJ,GAAa,SAASl6C,MAAtB;AACA4yB,IAAAA,QAAQ;AACT,GAHQ,CAAT;AAID;;AAED,SAASunB,cAAT,CAAwB/f,GAAxB,EAA6B4f,QAA7B,EAAuCpnB,QAAvC,EAAiD;AAC/C8M,EAAAA,SAAS,CAACtF,GAAG,CAACn5B,IAAL,EAAW,UAAUm5C,GAAV,EAAe;AACjChgB,IAAAA,GAAG,CAAC8f,MAAJ,GAAa,SAASE,GAAtB,CADiC,CAEjC;;AACAhgB,IAAAA,GAAG,CAAC58B,MAAJ,GAAa48B,GAAG,CAACn5B,IAAJ,CAAS6mB,IAAT,IAAiBsS,GAAG,CAACn5B,IAAJ,CAASzD,MAA1B,IAAoC,CAAjD;;AACA,QAAIw8C,QAAQ,KAAK,QAAjB,EAA2B;AACzBtb,MAAAA,kBAAkB,CAACtE,GAAG,CAACn5B,IAAL,EAAW,UAAU08B,SAAV,EAAqB;AAChDvD,QAAAA,GAAG,CAACn5B,IAAJ,GAAW08B,SAAX;AACA/K,QAAAA,QAAQ;AACT,OAHiB,CAAlB;AAID,KALD,MAKO,IAAIonB,QAAQ,KAAK,QAAjB,EAA2B;AAChCpb,MAAAA,YAAY,CAACxE,GAAG,CAACn5B,IAAL,EAAW,UAAU48B,GAAV,EAAe;AACpCzD,QAAAA,GAAG,CAACn5B,IAAJ,GAAW48B,GAAX;AACAjL,QAAAA,QAAQ;AACT,OAHW,CAAZ;AAID,KALM,MAKA;AACLA,MAAAA,QAAQ;AACT;AACF,GAjBQ,CAAT;AAkBD;;AAED,SAASynB,oBAAT,CAA8BjgB,GAA9B,EAAmC4f,QAAnC,EAA6CpnB,QAA7C,EAAuD;AACrD,MAAIwH,GAAG,CAACE,IAAR,EAAc;AACZ,WAAO1H,QAAQ,EAAf;AACD;;AACD,MAAI,OAAOwH,GAAG,CAACn5B,IAAX,KAAoB,QAAxB,EAAkC;AAAE;AAClC84C,IAAAA,gBAAgB,CAAC3f,GAAD,EAAM4f,QAAN,EAAgBpnB,QAAhB,CAAhB;AACD,GAFD,MAEO;AAAE;AACPunB,IAAAA,cAAc,CAAC/f,GAAD,EAAM4f,QAAN,EAAgBpnB,QAAhB,CAAd;AACD;AACF;;AAED,SAAS0nB,qBAAT,CAA+BC,QAA/B,EAAyCP,QAAzC,EAAmDpnB,QAAnD,EAA6D;AAE3D,MAAI,CAAC2nB,QAAQ,CAAC/8C,MAAd,EAAsB;AACpB,WAAOo1B,QAAQ,EAAf;AACD;;AAED,MAAI4nB,IAAI,GAAG,CAAX;AACA,MAAIC,UAAJ;AAEAF,EAAAA,QAAQ,CAACt4C,OAAT,CAAiB,UAAUy4C,OAAV,EAAmB;AAClC,QAAIvgB,WAAW,GAAGugB,OAAO,CAACz5C,IAAR,IAAgBy5C,OAAO,CAACz5C,IAAR,CAAao5B,YAA7B,GAChBv7B,MAAM,CAACoC,IAAP,CAAYw5C,OAAO,CAACz5C,IAAR,CAAao5B,YAAzB,CADgB,GACyB,EAD3C;AAEA,QAAI3e,IAAI,GAAG,CAAX;;AAEA,QAAI,CAACye,WAAW,CAAC38B,MAAjB,EAAyB;AACvB,aAAO2iC,IAAI,EAAX;AACD;;AAED,aAASwa,mBAAT,CAA6BttC,GAA7B,EAAkC;AAChCotC,MAAAA,UAAU,GAAGptC,GAAb;AACAqO,MAAAA,IAAI;;AACJ,UAAIA,IAAI,KAAKye,WAAW,CAAC38B,MAAzB,EAAiC;AAC/B2iC,QAAAA,IAAI;AACL;AACF;;AAED,SAAK,IAAI9+B,GAAT,IAAgBq5C,OAAO,CAACz5C,IAAR,CAAao5B,YAA7B,EAA2C;AACzC,UAAIqgB,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,CAA0B7U,cAA1B,CAAyCnkB,GAAzC,CAAJ,EAAmD;AACjDg5C,QAAAA,oBAAoB,CAACK,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,CAA0Bh5B,GAA1B,CAAD,EAClB24C,QADkB,EACRW,mBADQ,CAApB;AAED;AACF;AACF,GAvBD;;AAyBA,WAASxa,IAAT,GAAgB;AACdqa,IAAAA,IAAI;;AACJ,QAAID,QAAQ,CAAC/8C,MAAT,KAAoBg9C,IAAxB,EAA8B;AAC5B,UAAIC,UAAJ,EAAgB;AACd7nB,QAAAA,QAAQ,CAAC6nB,UAAD,CAAR;AACD,OAFD,MAEO;AACL7nB,QAAAA,QAAQ;AACT;AACF;AACF;AACF;;AAED,SAASgoB,SAAT,CAAmBC,QAAnB,EAA6BC,IAA7B,EAAmCJ,OAAnC,EAA4C95B,OAA5C,EACmB9N,CADnB,EACsB1U,EADtB,EAC0B28C,QAD1B,EACoCtB,QADpC,EAC8C;AAE5C,MAAItU,SAAS,CAAC2V,IAAI,CAAC3Z,QAAN,EAAgBuZ,OAAO,CAAC5Z,QAAR,CAAiBtL,GAAjC,CAAT,IAAkD,CAACikB,QAAvD,EAAiE;AAC/D74B,IAAAA,OAAO,CAAC9N,CAAD,CAAP,GAAa4nC,OAAb;AACA,WAAOt8C,EAAE,EAAT;AACD,GAL2C,CAO5C;;;AACA,MAAI48C,kBAAkB,GAAGF,IAAI,CAACja,UAAL,IAAmBA,UAAU,CAACia,IAAD,CAAtD;AACA,MAAIG,iBAAiB,GAAG,aAAaH,IAAb,GAAoBA,IAAI,CAACtZ,OAAzB,GACtBgE,SAAS,CAACsV,IAAD,EAAOE,kBAAP,CADX;AAEA,MAAIxZ,OAAO,GAAG,aAAakZ,OAAO,CAAC5Z,QAArB,GAAgC4Z,OAAO,CAAC5Z,QAAR,CAAiBU,OAAjD,GACZgE,SAAS,CAACkV,OAAO,CAAC5Z,QAAT,CADX;AAEA,MAAIoa,MAAM,GAAG,MAAM93B,IAAN,CAAWs3B,OAAO,CAAC5Z,QAAR,CAAiBtL,GAA5B,CAAb;;AAEA,MAAIylB,iBAAiB,IAAI,CAACzZ,OAAtB,IAAiCiY,QAAjC,IAA6CyB,MAAjD,EAAyD;AACvD,QAAI/e,MAAM,GAAGue,OAAO,CAACz5C,IAArB;AACAk7B,IAAAA,MAAM,CAACD,IAAP,GAAc8e,kBAAd;AACA7e,IAAAA,MAAM,CAACE,GAAP,GAAaqe,OAAO,CAAC5Z,QAAR,CAAiB9+B,EAA9B;AACA04C,IAAAA,OAAO,GAAGlB,QAAQ,CAACrd,MAAD,EAASsd,QAAT,CAAlB;AACD;;AAED,MAAI3V,MAAM,GAAGmB,KAAK,CAAC6V,IAAI,CAAC3Z,QAAN,EAAgBuZ,OAAO,CAAC5Z,QAAR,CAAiBK,QAAjB,CAA0B,CAA1B,CAAhB,EAA8C0Z,QAA9C,CAAlB;AAEA,MAAIM,UAAU,GAAG1B,QAAQ,KACtBwB,iBAAiB,IAAIzZ,OAArB,IAAgCsC,MAAM,CAACxB,SAAP,KAAqB,UAAtD,IACC,CAAC2Y,iBAAD,IAAsBnX,MAAM,CAACxB,SAAP,KAAqB,UAD5C,IAEC2Y,iBAAiB,IAAI,CAACzZ,OAAtB,IAAiCsC,MAAM,CAACxB,SAAP,KAAqB,YAHhC,CAAzB;;AAKA,MAAI6Y,UAAJ,EAAgB;AACd,QAAI9tC,GAAG,GAAGgsB,WAAW,CAACrB,YAAD,CAArB;AACApX,IAAAA,OAAO,CAAC9N,CAAD,CAAP,GAAazF,GAAb;AACA,WAAOjP,EAAE,EAAT;AACD;;AAED,MAAIg9C,MAAM,GAAGV,OAAO,CAAC5Z,QAAR,CAAiBtL,GAA9B;AACAklB,EAAAA,OAAO,CAAC5Z,QAAR,CAAiBK,QAAjB,GAA4B2C,MAAM,CAACzC,IAAnC;AACAqZ,EAAAA,OAAO,CAAC3V,WAAR,GAAsBjB,MAAM,CAACiB,WAAP,IAAsB,EAA5C;AACA;;AACA,MAAI+V,IAAI,CAACO,OAAT,EAAkB;AAChBX,IAAAA,OAAO,CAAC5Z,QAAR,CAAiBua,OAAjB,GAA2BP,IAAI,CAACO,OAAhC,CADgB,CACyB;AAC1C,GAzC2C,CA2C5C;;;AACA,MAAIC,aAAa,GAAGza,UAAU,CAAC6Z,OAAO,CAAC5Z,QAAT,CAA9B;AACA,MAAIya,mBAAmB,GAAG/V,SAAS,CAACkV,OAAO,CAAC5Z,QAAT,EAAmBwa,aAAnB,CAAnC,CA7C4C,CA+C5C;AACA;;AACA,MAAIE,KAAK,GAAIP,iBAAiB,KAAKM,mBAAvB,GAA8C,CAA9C,GACVN,iBAAiB,GAAGM,mBAApB,GAA0C,CAAC,CAA3C,GAA+C,CADjD;AAGA,MAAIE,eAAJ;;AACA,MAAIL,MAAM,KAAKE,aAAf,EAA8B;AAC5B;AACAG,IAAAA,eAAe,GAAGF,mBAAlB;AACD,GAHD,MAGO;AACL;AACAE,IAAAA,eAAe,GAAGjW,SAAS,CAACkV,OAAO,CAAC5Z,QAAT,EAAmBsa,MAAnB,CAA3B;AACD;;AAEDL,EAAAA,QAAQ,CAACL,OAAD,EAAUY,aAAV,EAAyBC,mBAAzB,EAA8CE,eAA9C,EACN,IADM,EACAD,KADA,EACO1oC,CADP,EACU1U,EADV,CAAR;AAED;;AAED,SAASs9C,aAAT,CAAuBhB,OAAvB,EAAgC;AAC9B,SAAOA,OAAO,CAAC5Z,QAAR,CAAiBK,QAAjB,CAA0B,CAA1B,EAA6BG,GAA7B,CAAiC,CAAjC,EAAoCjK,MAApC,KAA+C,SAAtD;AACD;;AAED,SAASskB,WAAT,CAAqBd,QAArB,EAA+BN,QAA/B,EAAyCtQ,GAAzC,EAA8C2R,WAA9C,EAA2DC,EAA3D,EAA+Dj7B,OAA/D,EACqBm6B,QADrB,EAC+B/mB,IAD/B,EACqC8nB,eADrC,EACsD;AAEpD;AACAjB,EAAAA,QAAQ,GAAGA,QAAQ,IAAI,IAAvB;;AAEA,WAASkB,SAAT,CAAmBrB,OAAnB,EAA4BsB,UAA5B,EAAwCppB,QAAxC,EAAkD;AAChD;AACA,QAAI0oB,aAAa,GAAGza,UAAU,CAAC6Z,OAAO,CAAC5Z,QAAT,CAA9B;AACA,QAAIU,OAAO,GAAGgE,SAAS,CAACkV,OAAO,CAAC5Z,QAAT,EAAmBwa,aAAnB,CAAvB;;AACA,QAAI,gBAAgBtnB,IAAhB,IAAwBwN,OAA5B,EAAqC;AACnC5gB,MAAAA,OAAO,CAACo7B,UAAD,CAAP,GAAsB3iB,WAAW,CAACtB,WAAD,EAAc,SAAd,CAAjC;AACA,aAAOnF,QAAQ,EAAf;AACD,KAP+C,CAShD;;;AACA,QAAIuoB,UAAU,GAAG1B,QAAQ,IAAIiC,aAAa,CAAChB,OAAD,CAA1C;;AAEA,QAAIS,UAAJ,EAAgB;AACd,UAAI9tC,GAAG,GAAGgsB,WAAW,CAACrB,YAAD,CAArB;AACApX,MAAAA,OAAO,CAACo7B,UAAD,CAAP,GAAsB3uC,GAAtB;AACA,aAAOulB,QAAQ,EAAf;AACD;;AAED,QAAI4oB,KAAK,GAAGha,OAAO,GAAG,CAAH,GAAO,CAA1B;AAEAuZ,IAAAA,QAAQ,CAACL,OAAD,EAAUY,aAAV,EAAyB9Z,OAAzB,EAAkCA,OAAlC,EAA2C,KAA3C,EACNga,KADM,EACCQ,UADD,EACappB,QADb,CAAR;AAED;;AAED,MAAI6mB,QAAQ,GAAGzlB,IAAI,CAAC6V,SAApB;AACA,MAAIoS,SAAS,GAAG,IAAI/qB,WAAJ,EAAhB;AAEA,MAAIgrB,QAAQ,GAAG,CAAf;AACA,MAAIC,QAAQ,GAAG5B,QAAQ,CAAC/8C,MAAxB;;AAEA,WAAS4+C,gBAAT,GAA4B;AAC1B,QAAI,EAAEF,QAAF,KAAeC,QAAf,IAA2BL,eAA/B,EAAgD;AAC9CA,MAAAA,eAAe;AAChB;AACF;;AAEDvB,EAAAA,QAAQ,CAACt4C,OAAT,CAAiB,UAAUo6C,UAAV,EAAsBL,UAAtB,EAAkC;AAEjD,QAAIK,UAAU,CAAChgB,GAAX,IAAkBoJ,SAAS,CAAC4W,UAAU,CAAChgB,GAAZ,CAA/B,EAAiD;AAC/C,UAAI5N,GAAG,GAAG4tB,UAAU,CAACzU,QAAX,GAAsB,cAAtB,GAAuC,WAAjD;AACAqC,MAAAA,GAAG,CAACxb,GAAD,CAAH,CAAS4tB,UAAT,EAAqB;AAACza,QAAAA,GAAG,EAAEia;AAAN,OAArB,EAAgC,UAAUxuC,GAAV,EAAemjB,GAAf,EAAoB;AAClD5P,QAAAA,OAAO,CAACo7B,UAAD,CAAP,GAAsB3uC,GAAG,IAAImjB,GAA7B;AACA4rB,QAAAA,gBAAgB;AACjB,OAHD;AAIA;AACD;;AAED,QAAIp6C,EAAE,GAAGq6C,UAAU,CAACvb,QAAX,CAAoB9+B,EAA7B;;AACA,QAAIi6C,SAAS,CAACl6C,GAAV,CAAcC,EAAd,CAAJ,EAAuB;AACrBm6C,MAAAA,QAAQ,GADa,CACT;;AACZF,MAAAA,SAAS,CAACj9C,GAAV,CAAcgD,EAAd,EAAkBa,IAAlB,CAAuB,CAACw5C,UAAD,EAAaL,UAAb,CAAvB;AACD,KAHD,MAGO;AACLC,MAAAA,SAAS,CAACh9C,GAAV,CAAc+C,EAAd,EAAkB,CAAC,CAACq6C,UAAD,EAAaL,UAAb,CAAD,CAAlB;AACD;AACF,GAlBD,EAzCoD,CA6DpD;AACA;;AACAC,EAAAA,SAAS,CAACh6C,OAAV,CAAkB,UAAUiyB,IAAV,EAAgBlyB,EAAhB,EAAoB;AACpC,QAAIsyB,OAAO,GAAG,CAAd;;AAEA,aAASgoB,UAAT,GAAsB;AACpB,UAAI,EAAEhoB,OAAF,GAAYJ,IAAI,CAAC12B,MAArB,EAA6B;AAC3B++C,QAAAA,OAAO;AACR,OAFD,MAEO;AACLH,QAAAA,gBAAgB;AACjB;AACF;;AACD,aAASG,OAAT,GAAmB;AACjB,UAAIh7C,KAAK,GAAG2yB,IAAI,CAACI,OAAD,CAAhB;AACA,UAAI+nB,UAAU,GAAG96C,KAAK,CAAC,CAAD,CAAtB;AACA,UAAIy6C,UAAU,GAAGz6C,KAAK,CAAC,CAAD,CAAtB;;AAEA,UAAIq6C,WAAW,CAAC75C,GAAZ,CAAgBC,EAAhB,CAAJ,EAAyB;AACvB44C,QAAAA,SAAS,CAACC,QAAD,EAAWe,WAAW,CAAC58C,GAAZ,CAAgBgD,EAAhB,CAAX,EAAgCq6C,UAAhC,EAA4Cz7B,OAA5C,EACPo7B,UADO,EACKM,UADL,EACiBvB,QADjB,EAC2BtB,QAD3B,CAAT;AAED,OAHD,MAGO;AACL;AACA,YAAI3V,MAAM,GAAGmB,KAAK,CAAC,EAAD,EAAKoX,UAAU,CAACvb,QAAX,CAAoBK,QAApB,CAA6B,CAA7B,CAAL,EAAsC0Z,QAAtC,CAAlB;AACAwB,QAAAA,UAAU,CAACvb,QAAX,CAAoBK,QAApB,GAA+B2C,MAAM,CAACzC,IAAtC;AACAgb,QAAAA,UAAU,CAACtX,WAAX,GAAyBjB,MAAM,CAACiB,WAAP,IAAsB,EAA/C;AACAgX,QAAAA,SAAS,CAACM,UAAD,EAAaL,UAAb,EAAyBM,UAAzB,CAAT;AACD;AACF;;AACDC,IAAAA,OAAO;AACR,GA3BD;AA4BD,EAED;AACA;;;AACA,IAAIC,eAAe,GAAG,CAAtB,EAEA;AACA;AACA;;AACA,IAAIC,SAAS,GAAG,gBAAhB,EACA;AACA;;AACA,IAAIC,YAAY,GAAG,aAAnB,EACA;;AACA,IAAIC,YAAY,GAAG,cAAnB,EACA;AACA;;AACA,IAAIC,oBAAoB,GAAG,kBAA3B,EAEA;AACA;;AACA,IAAIC,UAAU,GAAG,YAAjB,EACA;;AACA,IAAIC,WAAW,GAAG,aAAlB,EACA;;AACA,IAAIC,yBAAyB,GAAG,qBAAhC;;AAEA,SAASC,aAAT,CAAuB1lB,GAAvB,EAA4B;AAC1B;AACA;AACA;AACA,MAAI;AACF,WAAO5yB,IAAI,CAACC,KAAL,CAAW2yB,GAAX,CAAP;AACD,GAFD,CAEE,OAAO94B,CAAP,EAAU;AACV;AACA,WAAOy+C,kBAASt4C,KAAT,CAAe2yB,GAAf,CAAP;AACD;AACF;;AAED,SAAS4lB,iBAAT,CAA2BC,IAA3B,EAAiC;AAC/B,MAAI;AACF,WAAOz4C,IAAI,CAACE,SAAL,CAAeu4C,IAAf,CAAP;AACD,GAFD,CAEE,OAAO3+C,CAAP,EAAU;AACV;AACA,WAAOy+C,kBAASr4C,SAAT,CAAmBu4C,IAAnB,CAAP;AACD;AACF;;AAED,SAASC,QAAT,CAAkBxqB,QAAlB,EAA4B;AAC1B,SAAO,UAAU5Y,GAAV,EAAe;AACpB,QAAI/S,OAAO,GAAG,eAAd;;AACA,QAAI+S,GAAG,CAAC9J,MAAJ,IAAc8J,GAAG,CAAC9J,MAAJ,CAAWjH,KAA7B,EAAoC;AAClChC,MAAAA,OAAO,GAAG+S,GAAG,CAAC9J,MAAJ,CAAWjH,KAAX,CAAiB/G,IAAjB,IAAyB8X,GAAG,CAAC9J,MAAJ,CAAWjH,KAAX,CAAiBhC,OAApD;AACD;;AACD2rB,IAAAA,QAAQ,CAACyG,WAAW,CAACR,SAAD,EAAY5xB,OAAZ,EAAqB+S,GAAG,CAACrX,IAAzB,CAAZ,CAAR;AACD,GAND;AAOD,EAED;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAAS06C,cAAT,CAAwBvc,QAAxB,EAAkCD,UAAlC,EAA8CW,OAA9C,EAAuD;AACrD,SAAO;AACLvgC,IAAAA,IAAI,EAAEi8C,iBAAiB,CAACpc,QAAD,CADlB;AAELD,IAAAA,UAAU,EAAEA,UAFP;AAGLyc,IAAAA,cAAc,EAAE9b,OAAO,GAAG,GAAH,GAAS,GAH3B;AAILjL,IAAAA,GAAG,EAAEuK,QAAQ,CAACvK,GAJT;AAIc;AACnBv0B,IAAAA,EAAE,EAAE8+B,QAAQ,CAAC9+B;AALR,GAAP;AAOD;;AAED,SAASu7C,cAAT,CAAwBC,YAAxB,EAAsC;AACpC,MAAI,CAACA,YAAL,EAAmB;AACjB,WAAO,IAAP;AACD;;AACD,MAAI1c,QAAQ,GAAGkc,aAAa,CAACQ,YAAY,CAACv8C,IAAd,CAA5B;AACA6/B,EAAAA,QAAQ,CAACD,UAAT,GAAsB2c,YAAY,CAAC3c,UAAnC;AACAC,EAAAA,QAAQ,CAACU,OAAT,GAAmBgc,YAAY,CAACF,cAAb,KAAgC,GAAnD;AACAxc,EAAAA,QAAQ,CAACvK,GAAT,GAAeinB,YAAY,CAACjnB,GAA5B;AACA,SAAOuK,QAAP;AACD,EAED;AACA;;;AACA,SAAS2c,SAAT,CAAmBhkB,GAAnB,EAAwB;AACtB,MAAI,CAACA,GAAL,EAAU;AACR,WAAOA,GAAP;AACD;;AACD,MAAIxuB,GAAG,GAAGwuB,GAAG,CAACikB,WAAJ,CAAgBC,WAAhB,CAA4B,GAA5B,CAAV;;AACAlkB,EAAAA,GAAG,CAAC4C,GAAJ,GAAU5C,GAAG,CAACikB,WAAJ,CAAgBvtB,SAAhB,CAA0B,CAA1B,EAA6BllB,GAAG,GAAG,CAAnC,CAAV;AACAwuB,EAAAA,GAAG,CAACyC,IAAJ,GAAWzC,GAAG,CAACikB,WAAJ,CAAgBvtB,SAAhB,CAA0BllB,GAAG,GAAG,CAAhC,CAAX;AACA,SAAOwuB,GAAG,CAACikB,WAAX;AACA,SAAOjkB,GAAP;AACD,EAED;AACA;AACA;;;AACA,SAASmkB,YAAT,CAAsBC,IAAtB,EAA4Bl7C,IAA5B,EAAkCm7C,MAAlC,EAA0ClrB,QAA1C,EAAoD;AAClD,MAAIkrB,MAAJ,EAAY;AACV,QAAI,CAACD,IAAL,EAAW;AACTjrB,MAAAA,QAAQ,CAACgK,UAAU,CAAC,CAAC,EAAD,CAAD,EAAO;AAACj6B,QAAAA,IAAI,EAAEA;AAAP,OAAP,CAAX,CAAR;AACD,KAFD,MAEO,IAAI,OAAOk7C,IAAP,KAAgB,QAApB,EAA8B;AAAE;AACrCjrB,MAAAA,QAAQ,CAACirB,IAAD,CAAR;AACD,KAFM,MAEA;AAAE;AACPjrB,MAAAA,QAAQ,CAACgL,YAAY,CAACigB,IAAD,EAAOl7C,IAAP,CAAb,CAAR;AACD;AACF,GARD,MAQO;AAAE;AACP,QAAI,CAACk7C,IAAL,EAAW;AACTjrB,MAAAA,QAAQ,CAAC,EAAD,CAAR;AACD,KAFD,MAEO,IAAI,OAAOirB,IAAP,KAAgB,QAApB,EAA8B;AAAE;AACrC1f,MAAAA,kBAAkB,CAAC0f,IAAD,EAAO,UAAU7f,MAAV,EAAkB;AACzCpL,QAAAA,QAAQ,CAAC8J,QAAQ,CAACsB,MAAD,CAAT,CAAR;AACD,OAFiB,CAAlB;AAGD,KAJM,MAIA;AAAE;AACPpL,MAAAA,QAAQ,CAACirB,IAAD,CAAR;AACD;AACF;AACF;;AAED,SAASE,2BAAT,CAAqCtkB,GAArC,EAA0CzF,IAA1C,EAAgDgqB,GAAhD,EAAqD5/C,EAArD,EAAyD;AACvD,MAAI+7B,WAAW,GAAGr7B,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAJ,IAAoB,EAAhC,CAAlB;;AACA,MAAI,CAACF,WAAW,CAAC38B,MAAjB,EAAyB;AACvB,WAAOY,EAAE,IAAIA,EAAE,EAAf;AACD;;AACD,MAAIk2B,OAAO,GAAG,CAAd;;AAEA,WAASI,SAAT,GAAqB;AACnB,QAAI,EAAEJ,OAAF,KAAc6F,WAAW,CAAC38B,MAA1B,IAAoCY,EAAxC,EAA4C;AAC1CA,MAAAA,EAAE;AACH;AACF;;AAED,WAAS6/C,eAAT,CAAyBxkB,GAAzB,EAA8BW,GAA9B,EAAmC;AACjC,QAAI8jB,MAAM,GAAGzkB,GAAG,CAACY,YAAJ,CAAiBD,GAAjB,CAAb;AACA,QAAI8f,MAAM,GAAGgE,MAAM,CAAChE,MAApB;AACA,QAAIxgB,GAAG,GAAGskB,GAAG,CAACG,WAAJ,CAAgBxB,YAAhB,EAA8B39C,GAA9B,CAAkCk7C,MAAlC,CAAV;;AACAxgB,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B0/C,MAAAA,MAAM,CAACL,IAAP,GAAcr/C,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgB69C,IAA9B;AACAnpB,MAAAA,SAAS;AACV,KAHD;AAID;;AAEDyF,EAAAA,WAAW,CAACl4B,OAAZ,CAAoB,UAAUm4B,GAAV,EAAe;AACjC,QAAIpG,IAAI,CAACmG,WAAL,IAAoBnG,IAAI,CAACkG,YAA7B,EAA2C;AACzC+jB,MAAAA,eAAe,CAACxkB,GAAD,EAAMW,GAAN,CAAf;AACD,KAFD,MAEO;AACLX,MAAAA,GAAG,CAACY,YAAJ,CAAiBD,GAAjB,EAAsBE,IAAtB,GAA6B,IAA7B;AACA5F,MAAAA,SAAS;AACV;AACF,GAPD;AAQD,EAED;AACA;AACA;AACA;;;AACA,SAAS2pB,sBAAT,CAAgCz9B,OAAhC,EAAyCk9B,MAAzC,EAAiD;AAC/C,SAAO91C,OAAO,CAAC0Y,GAAR,CAAYE,OAAO,CAAC/T,GAAR,CAAY,UAAU4+B,GAAV,EAAe;AAC5C,QAAIA,GAAG,CAAChS,GAAJ,IAAWgS,GAAG,CAAChS,GAAJ,CAAQY,YAAvB,EAAqC;AACnC,UAAIikB,QAAQ,GAAGx/C,MAAM,CAACoC,IAAP,CAAYuqC,GAAG,CAAChS,GAAJ,CAAQY,YAApB,CAAf;AACA,aAAOryB,OAAO,CAAC0Y,GAAR,CAAY49B,QAAQ,CAACzxC,GAAT,CAAa,UAAUutB,GAAV,EAAe;AAC7C,YAAI8jB,MAAM,GAAGzS,GAAG,CAAChS,GAAJ,CAAQY,YAAR,CAAqBD,GAArB,CAAb;;AACA,YAAI,EAAE,UAAU8jB,MAAZ,CAAJ,EAAyB;AAAE;AACzB;AACD;;AACD,YAAIL,IAAI,GAAGK,MAAM,CAACL,IAAlB;AACA,YAAIl7C,IAAI,GAAGu7C,MAAM,CAAC9T,YAAlB;AACA,eAAO,IAAIpiC,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpC8wC,UAAAA,YAAY,CAACC,IAAD,EAAOl7C,IAAP,EAAam7C,MAAb,EAAqB,UAAU78C,IAAV,EAAgB;AAC/CwqC,YAAAA,GAAG,CAAChS,GAAJ,CAAQY,YAAR,CAAqBD,GAArB,IAA4B1C,qBAAqB,CAC/ClE,IAAI,CAAC0qB,MAAD,EAAS,CAAC,QAAD,EAAW,cAAX,CAAT,CAD2C,EAE/C;AAACj9C,cAAAA,IAAI,EAAEA;AAAP,aAF+C,CAAjD;AAIA6L,YAAAA,OAAO;AACR,WANW,CAAZ;AAOD,SARM,CAAP;AASD,OAhBkB,CAAZ,CAAP;AAiBD;AACF,GArBkB,CAAZ,CAAP;AAsBD;;AAED,SAASyxC,WAAT,CAAqB7c,IAArB,EAA2BvM,KAA3B,EAAkC6oB,GAAlC,EAAuC;AAErC,MAAIQ,uBAAuB,GAAG,EAA9B;AACA,MAAIC,QAAQ,GAAGT,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAf;AACA,MAAIgC,QAAQ,GAAGV,GAAG,CAACG,WAAJ,CAAgBxB,YAAhB,CAAf;AACA,MAAIgC,cAAc,GAAGX,GAAG,CAACG,WAAJ,CAAgBvB,oBAAhB,CAArB;AACA,MAAIxwB,KAAK,GAAGsV,IAAI,CAAClkC,MAAjB;;AAEA,WAASk3B,SAAT,GAAqB;AACnBtI,IAAAA,KAAK;;AACL,QAAI,CAACA,KAAL,EAAY;AAAE;AACZwyB,MAAAA,yBAAyB;AAC1B;AACF;;AAED,WAASA,yBAAT,GAAqC;AACnC,QAAI,CAACJ,uBAAuB,CAAChhD,MAA7B,EAAqC;AACnC;AACD;;AACDghD,IAAAA,uBAAuB,CAACv8C,OAAxB,CAAgC,UAAUi4C,MAAV,EAAkB;AAChD,UAAI2E,QAAQ,GAAGF,cAAc,CAACv6B,KAAf,CAAqB,WAArB,EAAkCgI,KAAlC,CACb0yB,WAAW,CAACC,KAAZ,CACE7E,MAAM,GAAG,IADX,EACiBA,MAAM,GAAG,UAD1B,EACsC,KADtC,EAC6C,KAD7C,CADa,CAAf;;AAGA2E,MAAAA,QAAQ,CAACT,SAAT,GAAqB,UAAU5/C,CAAV,EAAa;AAChC,YAAI4tB,KAAK,GAAG5tB,CAAC,CAAC0R,MAAF,CAASlQ,MAArB;;AACA,YAAI,CAACosB,KAAL,EAAY;AACV;AACAsyB,UAAAA,QAAQ,CAACnuB,MAAT,CAAgB2pB,MAAhB;AACD;AACF,OAND;AAOD,KAXD;AAYD;;AAEDxY,EAAAA,IAAI,CAACz/B,OAAL,CAAa,UAAUqmC,MAAV,EAAkB;AAC7B,QAAIlkB,KAAK,GAAGq6B,QAAQ,CAACr6B,KAAT,CAAe,aAAf,CAAZ;AACA,QAAI/iB,GAAG,GAAG8zB,KAAK,GAAG,IAAR,GAAemT,MAAzB;;AACAlkB,IAAAA,KAAK,CAACgtB,MAAN,CAAa/vC,GAAb,EAAkB+8C,SAAlB,GAA8B,UAAU5/C,CAAV,EAAa;AACzC,UAAI+3B,GAAG,GAAG/3B,CAAC,CAAC0R,MAAF,CAASlQ,MAAnB;;AACA,UAAI,OAAOu2B,GAAP,KAAe,QAAnB,EAA6B;AAC3B,eAAO7B,SAAS,EAAhB;AACD;;AACD+pB,MAAAA,QAAQ,CAACluB,MAAT,CAAgBgG,GAAhB;AAEA,UAAIyoB,MAAM,GAAGL,cAAc,CAACv6B,KAAf,CAAqB,KAArB,EACV66B,UADU,CACCH,WAAW,CAACI,IAAZ,CAAiB3oB,GAAjB,CADD,CAAb;;AAGAyoB,MAAAA,MAAM,CAACZ,SAAP,GAAmB,UAAUr0C,KAAV,EAAiB;AAClC,YAAIi1C,MAAM,GAAGj1C,KAAK,CAACmG,MAAN,CAAalQ,MAA1B;;AACA,YAAIg/C,MAAJ,EAAY;AACV,cAAI9E,MAAM,GAAG8E,MAAM,CAACz9C,KAAP,CAAa49C,SAAb,CAAuB9hC,KAAvB,CAA6B,IAA7B,EAAmC,CAAnC,CAAb;AACAmhC,UAAAA,uBAAuB,CAAC37C,IAAxB,CAA6Bq3C,MAA7B;AACAyE,UAAAA,cAAc,CAACpuB,MAAf,CAAsByuB,MAAM,CAACI,UAA7B;AACAJ,UAAAA,MAAM,CAACK,QAAP;AACD,SALD,MAKO;AAAE;AACP3qB,UAAAA,SAAS;AACV;AACF,OAVD;AAWD,KArBD;AAsBD,GAzBD;AA0BD;;AAED,SAAS4qB,qBAAT,CAA+BC,GAA/B,EAAoCC,MAApC,EAA4CC,IAA5C,EAAkD;AAChD,MAAI;AACF,WAAO;AACLzB,MAAAA,GAAG,EAAEuB,GAAG,CAACG,WAAJ,CAAgBF,MAAhB,EAAwBC,IAAxB;AADA,KAAP;AAGD,GAJD,CAIE,OAAOpyC,GAAP,EAAY;AACZ,WAAO;AACLpE,MAAAA,KAAK,EAAEoE;AADF,KAAP;AAGD;AACF;;AAED,IAAImrC,cAAc,GAAG,IAAIxiB,OAAJ,EAArB;;AAEA,SAAS2pB,WAAT,CAAqBjG,MAArB,EAA6BhgB,GAA7B,EAAkC1F,IAAlC,EAAwCiW,GAAxC,EAA6CsV,GAA7C,EAAkD3sB,QAAlD,EAA4D;AAC1D,MAAI2nB,QAAQ,GAAG7gB,GAAG,CAACxF,IAAnB;AACA,MAAI8pB,GAAJ;AACA,MAAI4B,QAAJ;AACA,MAAIC,UAAJ;AACA,MAAIC,WAAJ;AACA,MAAIC,iBAAJ;AACA,MAAIC,SAAJ;AACA,MAAIC,YAAJ;AACA,MAAIC,OAAJ;;AAEA,OAAK,IAAIptC,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGivB,QAAQ,CAAC/8C,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnD,QAAI2mB,GAAG,GAAG8gB,QAAQ,CAACznC,CAAD,CAAlB;;AACA,QAAI2mB,GAAG,CAAC4C,GAAJ,IAAWoJ,SAAS,CAAChM,GAAG,CAAC4C,GAAL,CAAxB,EAAmC;AACjC;AACD;;AACD5C,IAAAA,GAAG,GAAG8gB,QAAQ,CAACznC,CAAD,CAAR,GAAc0mC,QAAQ,CAAC/f,GAAD,EAAMzF,IAAI,CAAC6V,SAAX,EAAsB6P,MAAtB,CAA5B;;AACA,QAAIjgB,GAAG,CAACxwB,KAAJ,IAAa,CAACg3C,YAAlB,EAAgC;AAC9BA,MAAAA,YAAY,GAAGxmB,GAAf;AACD;AACF;;AAED,MAAIwmB,YAAJ,EAAkB;AAChB,WAAOrtB,QAAQ,CAACqtB,YAAD,CAAf;AACD;;AAED,MAAIE,gBAAgB,GAAG,KAAvB;AACA,MAAIC,aAAa,GAAG,CAApB;AACA,MAAIx/B,OAAO,GAAG,IAAImN,KAAJ,CAAUwsB,QAAQ,CAAC/8C,MAAnB,CAAd;AACA,MAAIo+C,WAAW,GAAG,IAAI1qB,WAAJ,EAAlB;AACA,MAAImvB,mBAAmB,GAAG,KAA1B;AACA,MAAIrG,QAAQ,GAAG/P,GAAG,CAACqW,KAAJ,CAAUC,WAAV,GAAwB,MAAxB,GAAiC,QAAhD;AAEAjG,EAAAA,qBAAqB,CAACC,QAAD,EAAWP,QAAX,EAAqB,UAAU3sC,GAAV,EAAe;AACvD,QAAIA,GAAJ,EAAS;AACP,aAAOulB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACDmzC,IAAAA,gBAAgB;AACjB,GALoB,CAArB;;AAOA,WAASA,gBAAT,GAA4B;AAE1B,QAAIhB,MAAM,GAAG,CACX/C,SADW,EACAC,YADA,EAEXC,YAFW,EAGXG,WAHW,EAGEF,oBAHF,EAIXC,UAJW,CAAb;AAMA,QAAI4D,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAMC,MAAN,EAAc,WAAd,CAArC;;AACA,QAAIiB,SAAS,CAACx3C,KAAd,EAAqB;AACnB,aAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD+0C,IAAAA,GAAG,GAAGyC,SAAS,CAACzC,GAAhB;AACAA,IAAAA,GAAG,CAAC0C,OAAJ,GAActD,QAAQ,CAACxqB,QAAD,CAAtB;AACAorB,IAAAA,GAAG,CAAC2C,SAAJ,GAAgBvD,QAAQ,CAACxqB,QAAD,CAAxB;AACAorB,IAAAA,GAAG,CAAC4C,UAAJ,GAAiB9lC,QAAjB;AACA8kC,IAAAA,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAX;AACAoD,IAAAA,UAAU,GAAG7B,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAb;AACAoD,IAAAA,WAAW,GAAG9B,GAAG,CAACG,WAAJ,CAAgBxB,YAAhB,CAAd;AACAoD,IAAAA,iBAAiB,GAAG/B,GAAG,CAACG,WAAJ,CAAgBvB,oBAAhB,CAApB;AACAoD,IAAAA,SAAS,GAAGhC,GAAG,CAACG,WAAJ,CAAgBtB,UAAhB,CAAZ;;AAEAmD,IAAAA,SAAS,CAAChhD,GAAV,CAAc69C,UAAd,EAA0BuB,SAA1B,GAAsC,UAAU5/C,CAAV,EAAa;AACjD0hD,MAAAA,OAAO,GAAG1hD,CAAC,CAAC0R,MAAF,CAASlQ,MAAnB;AACA6gD,MAAAA,qBAAqB;AACtB,KAHD;;AAKAC,IAAAA,iBAAiB,CAAC,UAAUzzC,GAAV,EAAe;AAC/B,UAAIA,GAAJ,EAAS;AACPgzC,QAAAA,mBAAmB,GAAG,IAAtB;AACA,eAAOztB,QAAQ,CAACvlB,GAAD,CAAf;AACD;;AACD0zC,MAAAA,iBAAiB;AAClB,KANgB,CAAjB;AAOD;;AAED,WAASC,kBAAT,GAA8B;AAC5Bb,IAAAA,gBAAgB,GAAG,IAAnB;AACAU,IAAAA,qBAAqB;AACtB;;AAED,WAASI,cAAT,GAA0B;AACxBtF,IAAAA,WAAW,CAACjC,MAAM,CAACwH,UAAR,EAAoB3G,QAApB,EAA8BtQ,GAA9B,EAAmC2R,WAAnC,EACCoC,GADD,EACMp9B,OADN,EACem6B,QADf,EACyB/mB,IADzB,EAC+BgtB,kBAD/B,CAAX;AAED;;AAED,WAASH,qBAAT,GAAiC;AAC/B,QAAI,CAACX,OAAD,IAAY,CAACC,gBAAjB,EAAmC;AACjC;AACD,KAH8B,CAI/B;AACA;;;AACAD,IAAAA,OAAO,CAACiB,QAAR,IAAoBf,aAApB;AACAJ,IAAAA,SAAS,CAACzjB,GAAV,CAAc2jB,OAAd;AACD;;AAED,WAASa,iBAAT,GAA6B;AAE3B,QAAI,CAACxG,QAAQ,CAAC/8C,MAAd,EAAsB;AACpB;AACD;;AAED,QAAI4jD,UAAU,GAAG,CAAjB;;AAEA,aAAS1sB,SAAT,GAAqB;AACnB,UAAI,EAAE0sB,UAAF,KAAiB7G,QAAQ,CAAC/8C,MAA9B,EAAsC;AACpCyjD,QAAAA,cAAc;AACf;AACF;;AAED,aAASI,YAAT,CAAsBt3C,KAAtB,EAA6B;AAC3B,UAAI+2B,QAAQ,GAAGyc,cAAc,CAACxzC,KAAK,CAACmG,MAAN,CAAalQ,MAAd,CAA7B;;AAEA,UAAI8gC,QAAJ,EAAc;AACZ8a,QAAAA,WAAW,CAAC38C,GAAZ,CAAgB6hC,QAAQ,CAAC9+B,EAAzB,EAA6B8+B,QAA7B;AACD;;AACDpM,MAAAA,SAAS;AACV;;AAED,SAAK,IAAI5hB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGivB,QAAQ,CAAC/8C,MAA/B,EAAuCsV,CAAC,GAAGwY,GAA3C,EAAgDxY,CAAC,EAAjD,EAAqD;AACnD,UAAI4nC,OAAO,GAAGH,QAAQ,CAACznC,CAAD,CAAtB;;AACA,UAAI4nC,OAAO,CAACre,GAAR,IAAeoJ,SAAS,CAACiV,OAAO,CAACre,GAAT,CAA5B,EAA2C;AACzC3H,QAAAA,SAAS,GADgC,CAC5B;;AACb;AACD;;AACD,UAAIgF,GAAG,GAAGkmB,QAAQ,CAAC5gD,GAAT,CAAa07C,OAAO,CAAC5Z,QAAR,CAAiB9+B,EAA9B,CAAV;AACA03B,MAAAA,GAAG,CAAC0kB,SAAJ,GAAgBiD,YAAhB;AACD;AACF;;AAED,WAASvmC,QAAT,GAAoB;AAClB,QAAIulC,mBAAJ,EAAyB;AACvB;AACD;;AAED7H,IAAAA,cAAc,CAAC5hB,MAAf,CAAsBqT,GAAG,CAACqW,KAAJ,CAAUp+C,IAAhC;AACA0wB,IAAAA,QAAQ,CAAC,IAAD,EAAOhS,OAAP,CAAR;AACD;;AAED,WAAS0gC,gBAAT,CAA0BpH,MAA1B,EAAkCtnB,QAAlC,EAA4C;AAE1C,QAAI8G,GAAG,GAAGomB,WAAW,CAAC9gD,GAAZ,CAAgBk7C,MAAhB,CAAV;;AACAxgB,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,UAAI,CAACA,CAAC,CAAC0R,MAAF,CAASlQ,MAAd,EAAsB;AACpB,YAAIqN,GAAG,GAAGgsB,WAAW,CAACF,YAAD,EACnB,yCACA+gB,MAFmB,CAArB;AAGA7sC,QAAAA,GAAG,CAACgqB,MAAJ,GAAa,GAAb;AACAzE,QAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,OAND,MAMO;AACLulB,QAAAA,QAAQ;AACT;AACF,KAVD;AAWD;;AAED,WAASkuB,iBAAT,CAA2BS,MAA3B,EAAmC;AAGjC,QAAIC,OAAO,GAAG,EAAd;AACAjH,IAAAA,QAAQ,CAACt4C,OAAT,CAAiB,UAAUy4C,OAAV,EAAmB;AAClC,UAAIA,OAAO,CAACz5C,IAAR,IAAgBy5C,OAAO,CAACz5C,IAAR,CAAao5B,YAAjC,EAA+C;AAC7Cv7B,QAAAA,MAAM,CAACoC,IAAP,CAAYw5C,OAAO,CAACz5C,IAAR,CAAao5B,YAAzB,EAAuCp4B,OAAvC,CAA+C,UAAUw/C,QAAV,EAAoB;AACjE,cAAIrnB,GAAG,GAAGsgB,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,CAA0BonB,QAA1B,CAAV;;AACA,cAAIrnB,GAAG,CAACE,IAAR,EAAc;AACZknB,YAAAA,OAAO,CAAC3+C,IAAR,CAAau3B,GAAG,CAAC8f,MAAjB;AACD;AACF,SALD;AAMD;AACF,KATD;;AAUA,QAAI,CAACsH,OAAO,CAAChkD,MAAb,EAAqB;AACnB,aAAO+jD,MAAM,EAAb;AACD;;AACD,QAAIjtB,OAAO,GAAG,CAAd;AACA,QAAIjnB,GAAJ;;AAEA,aAASqnB,SAAT,GAAqB;AACnB,UAAI,EAAEJ,OAAF,KAAcktB,OAAO,CAAChkD,MAA1B,EAAkC;AAChC+jD,QAAAA,MAAM,CAACl0C,GAAD,CAAN;AACD;AACF;;AACDm0C,IAAAA,OAAO,CAACv/C,OAAR,CAAgB,UAAUi4C,MAAV,EAAkB;AAChCoH,MAAAA,gBAAgB,CAACpH,MAAD,EAAS,UAAUwH,MAAV,EAAkB;AACzC,YAAIA,MAAM,IAAI,CAACr0C,GAAf,EAAoB;AAClBA,UAAAA,GAAG,GAAGq0C,MAAN;AACD;;AACDhtB,QAAAA,SAAS;AACV,OALe,CAAhB;AAMD,KAPD;AAQD;;AAED,WAASqmB,QAAT,CAAkBL,OAAlB,EAA2BY,aAA3B,EAA0CC,mBAA1C,EAA+DE,eAA/D,EACkBkG,QADlB,EAC4BnG,KAD5B,EACmCQ,UADnC,EAC+CppB,QAD/C,EACyD;AAEvD8nB,IAAAA,OAAO,CAAC5Z,QAAR,CAAiBD,UAAjB,GAA8Bya,aAA9B;AACAZ,IAAAA,OAAO,CAAC5Z,QAAR,CAAiBU,OAAjB,GAA2B+Z,mBAA3B;AAEA,QAAI9hB,GAAG,GAAGihB,OAAO,CAACz5C,IAAlB;AACAw4B,IAAAA,GAAG,CAAC4C,GAAJ,GAAUqe,OAAO,CAAC5Z,QAAR,CAAiB9+B,EAA3B;AACAy3B,IAAAA,GAAG,CAACyC,IAAJ,GAAWwe,OAAO,CAAC5Z,QAAR,CAAiBtL,GAA5B;;AAEA,QAAIimB,eAAJ,EAAqB;AACnBhiB,MAAAA,GAAG,CAACmO,QAAJ,GAAe,IAAf;AACD;;AAED,QAAIga,cAAc,GAAGnoB,GAAG,CAACY,YAAJ,IACnBv7B,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,EAA8B78B,MADhC;;AAEA,QAAIokD,cAAJ,EAAoB;AAClB,aAAOC,gBAAgB,CAACnH,OAAD,EAAUY,aAAV,EAAyBC,mBAAzB,EACrBoG,QADqB,EACX3F,UADW,EACCppB,QADD,CAAvB;AAED;;AAEDwtB,IAAAA,aAAa,IAAI5E,KAAjB;AACAqF,IAAAA,qBAAqB;AAErBiB,IAAAA,SAAS,CAACpH,OAAD,EAAUY,aAAV,EAAyBC,mBAAzB,EACPoG,QADO,EACG3F,UADH,EACeppB,QADf,CAAT;AAED;;AAED,WAASkvB,SAAT,CAAmBpH,OAAnB,EAA4BY,aAA5B,EAA2CC,mBAA3C,EACmBoG,QADnB,EAC6B3F,UAD7B,EACyCppB,QADzC,EACmD;AAEjD,QAAI6G,GAAG,GAAGihB,OAAO,CAACz5C,IAAlB;AACA,QAAI6/B,QAAQ,GAAG4Z,OAAO,CAAC5Z,QAAvB;AAEArH,IAAAA,GAAG,CAACikB,WAAJ,GAAkB5c,QAAQ,CAAC9+B,EAAT,GAAc,IAAd,GAAqB8+B,QAAQ,CAACtL,GAAhD;AACA,WAAOiE,GAAG,CAAC4C,GAAX;AACA,WAAO5C,GAAG,CAACyC,IAAX;;AAEA,aAAS6lB,WAAT,CAAqBvjD,CAArB,EAAwB;AACtB,UAAIwjD,YAAY,GAAGtH,OAAO,CAAC3V,WAAR,IAAuB,EAA1C;;AAEA,UAAI4c,QAAQ,IAAI1X,GAAG,CAACmD,eAApB,EAAqC;AACnC4U,QAAAA,YAAY,GAAGA,YAAY,CAAC19C,MAAb,CAAoBk+B,WAAW,CAACkY,OAAO,CAAC5Z,QAAT,CAA/B,CAAf;AACD;;AAED,UAAIkhB,YAAY,IAAIA,YAAY,CAACxkD,MAAjC,EAAyC;AACvC+gD,QAAAA,WAAW,CAACyD,YAAD,EAAetH,OAAO,CAAC5Z,QAAR,CAAiB9+B,EAAhC,EAAoCg8C,GAApC,CAAX;AACD;;AAEDld,MAAAA,QAAQ,CAACvK,GAAT,GAAe/3B,CAAC,CAAC0R,MAAF,CAASlQ,MAAxB,CAXsB,CAYtB;AACA;;AACA,UAAIiiD,eAAe,GAAG5E,cAAc,CAACvc,QAAD,EAAWwa,aAAX,EAClCC,mBADkC,CAApC;AAEA,UAAI2G,WAAW,GAAGtC,QAAQ,CAACrjB,GAAT,CAAa0lB,eAAb,CAAlB;AACAC,MAAAA,WAAW,CAAC9D,SAAZ,GAAwB+D,gBAAxB;AACD;;AAED,aAASC,gBAAT,CAA0B5jD,CAA1B,EAA6B;AAC3B;AACAA,MAAAA,CAAC,CAAC6jD,cAAF,GAF2B,CAEP;;AACpB7jD,MAAAA,CAAC,CAAC8jD,eAAF,GAH2B,CAGN;;AACrB,UAAIl+B,KAAK,GAAGy7B,UAAU,CAACz7B,KAAX,CAAiB,aAAjB,CAAZ;AACA,UAAIm+B,SAAS,GAAGn+B,KAAK,CAACgtB,MAAN,CAAa3X,GAAG,CAACikB,WAAjB,CAAhB;;AACA6E,MAAAA,SAAS,CAACnE,SAAV,GAAsB,UAAU5/C,CAAV,EAAa;AACjC,YAAIgkD,MAAM,GAAG3C,UAAU,CAACtjB,GAAX,CAAe9C,GAAf,EAAoBj7B,CAAC,CAAC0R,MAAF,CAASlQ,MAA7B,CAAb;AACAwiD,QAAAA,MAAM,CAACpE,SAAP,GAAmB2D,WAAnB;AACD,OAHD;AAID;;AAED,aAASI,gBAAT,GAA4B;AAC1BvhC,MAAAA,OAAO,CAACo7B,UAAD,CAAP,GAAsB;AACpBnoB,QAAAA,EAAE,EAAE,IADgB;AAEpB7xB,QAAAA,EAAE,EAAE8+B,QAAQ,CAAC9+B,EAFO;AAGpBwzB,QAAAA,GAAG,EAAEsL,QAAQ,CAACtL;AAHM,OAAtB;AAKAomB,MAAAA,WAAW,CAAC38C,GAAZ,CAAgBy7C,OAAO,CAAC5Z,QAAR,CAAiB9+B,EAAjC,EAAqC04C,OAAO,CAAC5Z,QAA7C;AACA2hB,MAAAA,wBAAwB,CAAC/H,OAAD,EAAU5Z,QAAQ,CAACvK,GAAnB,EAAwB3D,QAAxB,CAAxB;AACD;;AAED,QAAI4vB,MAAM,GAAG3C,UAAU,CAACtjB,GAAX,CAAe9C,GAAf,CAAb;AAEA+oB,IAAAA,MAAM,CAACpE,SAAP,GAAmB2D,WAAnB;AACAS,IAAAA,MAAM,CAAClnC,OAAP,GAAiB8mC,gBAAjB;AACD;;AAED,WAASP,gBAAT,CAA0BnH,OAA1B,EAAmCY,aAAnC,EAAkDC,mBAAlD,EAC0BoG,QAD1B,EACoC3F,UADpC,EACgDppB,QADhD,EAC0D;AAGxD,QAAI6G,GAAG,GAAGihB,OAAO,CAACz5C,IAAlB;AAEA,QAAIqzB,OAAO,GAAG,CAAd;AACA,QAAI6F,WAAW,GAAGr7B,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,CAAlB;;AAEA,aAASqoB,cAAT,GAA0B;AACxB,UAAIpuB,OAAO,KAAK6F,WAAW,CAAC38B,MAA5B,EAAoC;AAClCskD,QAAAA,SAAS,CAACpH,OAAD,EAAUY,aAAV,EAAyBC,mBAAzB,EACPoG,QADO,EACG3F,UADH,EACeppB,QADf,CAAT;AAED;AACF;;AAED,aAAS+vB,eAAT,GAA2B;AACzBruB,MAAAA,OAAO;AACPouB,MAAAA,cAAc;AACf;;AAEDvoB,IAAAA,WAAW,CAACl4B,OAAZ,CAAoB,UAAUZ,GAAV,EAAe;AACjC,UAAI+4B,GAAG,GAAGsgB,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,CAA0Bh5B,GAA1B,CAAV;;AACA,UAAI,CAAC+4B,GAAG,CAACE,IAAT,EAAe;AACb,YAAIr5B,IAAI,GAAGm5B,GAAG,CAACn5B,IAAf;AACA,eAAOm5B,GAAG,CAACn5B,IAAX;AACAm5B,QAAAA,GAAG,CAACiQ,MAAJ,GAAa5sC,QAAQ,CAAC69C,aAAD,EAAgB,EAAhB,CAArB;AACA,YAAIpB,MAAM,GAAG9f,GAAG,CAAC8f,MAAjB;AACA0I,QAAAA,cAAc,CAAC1I,MAAD,EAASj5C,IAAT,EAAe0hD,eAAf,CAAd;AACD,OAND,MAMO;AACLruB,QAAAA,OAAO;AACPouB,QAAAA,cAAc;AACf;AACF,KAZD;AAaD,GAtTyD,CAwT1D;AACA;;;AACA,WAASD,wBAAT,CAAkC/H,OAAlC,EAA2CnkB,GAA3C,EAAgD3D,QAAhD,EAA0D;AAExD,QAAIiwB,SAAS,GAAG,CAAhB;AACA,QAAIC,SAAS,GAAGhkD,MAAM,CAACoC,IAAP,CAAYw5C,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,IAA6B,EAAzC,CAAhB;;AAEA,QAAI,CAACyoB,SAAS,CAACtlD,MAAf,EAAuB;AACrB,aAAOo1B,QAAQ,EAAf;AACD;;AAED,aAAS8B,SAAT,GAAqB;AACnB,UAAI,EAAEmuB,SAAF,KAAgBC,SAAS,CAACtlD,MAA9B,EAAsC;AACpCo1B,QAAAA,QAAQ;AACT;AACF;;AAED,aAASjC,GAAT,CAAayJ,GAAb,EAAkB;AAChB,UAAI8f,MAAM,GAAGQ,OAAO,CAACz5C,IAAR,CAAao5B,YAAb,CAA0BD,GAA1B,EAA+B8f,MAA5C;AACA,UAAIxgB,GAAG,GAAGqmB,iBAAiB,CAACxjB,GAAlB,CAAsB;AAC9BhG,QAAAA,GAAG,EAAEA,GADyB;AAE9B4oB,QAAAA,SAAS,EAAEjF,MAAM,GAAG,IAAT,GAAgB3jB;AAFG,OAAtB,CAAV;AAKAmD,MAAAA,GAAG,CAAC0kB,SAAJ,GAAgB1pB,SAAhB;;AACAgF,MAAAA,GAAG,CAACpe,OAAJ,GAAc,UAAU9c,CAAV,EAAa;AACzB;AACA;AACA;AACAA,QAAAA,CAAC,CAAC6jD,cAAF,GAJyB,CAIL;;AACpB7jD,QAAAA,CAAC,CAAC8jD,eAAF,GALyB,CAKJ;;AACrB5tB,QAAAA,SAAS;AACV,OAPD;AAQD;;AACD,SAAK,IAAI5hB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgwC,SAAS,CAACtlD,MAA9B,EAAsCsV,CAAC,EAAvC,EAA2C;AACzC6d,MAAAA,GAAG,CAACmyB,SAAS,CAAChwC,CAAD,CAAV,CAAH,CADyC,CACtB;AACpB;AACF;;AAED,WAAS8vC,cAAT,CAAwB1I,MAAxB,EAAgCj5C,IAAhC,EAAsC2xB,QAAtC,EAAgD;AAG9C,QAAI2vB,SAAS,GAAGzC,WAAW,CAAC1zB,KAAZ,CAAkB8tB,MAAlB,CAAhB;;AACAqI,IAAAA,SAAS,CAACnE,SAAV,GAAsB,UAAU5/C,CAAV,EAAa;AACjC,UAAI4tB,KAAK,GAAG5tB,CAAC,CAAC0R,MAAF,CAASlQ,MAArB;;AACA,UAAIosB,KAAJ,EAAW;AACT,eAAOwG,QAAQ,EAAf,CADS,CACU;AACpB;;AACD,UAAImwB,MAAM,GAAG;AACX7I,QAAAA,MAAM,EAAEA,MADG;AAEX2D,QAAAA,IAAI,EAAE58C;AAFK,OAAb;AAIA,UAAIuhD,MAAM,GAAG1C,WAAW,CAACvjB,GAAZ,CAAgBwmB,MAAhB,CAAb;AACAP,MAAAA,MAAM,CAACpE,SAAP,GAAmBxrB,QAAnB;AACD,KAXD;AAYD;AACF,EAED;AACA;AACA;AACA;;;AACA,SAASowB,gBAAT,CAA0B7E,WAA1B,EAAuC8E,QAAvC,EAAiD9b,UAAjD,EAA6D+b,SAA7D,EAAwEC,OAAxE,EAAiF;AAE/E,MAAID,SAAS,KAAK,CAAC,CAAnB,EAAsB;AACpBA,IAAAA,SAAS,GAAG,IAAZ;AACD,GAJ8E,CAM/E;AACA;AACA;AACA;;;AAEA,MAAIE,SAAS,GAAG,OAAOjF,WAAW,CAACkF,MAAnB,KAA8B,UAA9B,IACd,OAAOlF,WAAW,CAACmF,UAAnB,KAAkC,UADpB,IAEdJ,SAAS,GAAG,CAFE,IAEG,CAAC/b,UAFpB;AAIA,MAAIoc,SAAJ;AACA,MAAIC,WAAJ;AACA,MAAIC,YAAJ;;AAEA,WAASC,QAAT,CAAkBllD,CAAlB,EAAqB;AACnBglD,IAAAA,WAAW,GAAGhlD,CAAC,CAAC0R,MAAF,CAASlQ,MAAvB;;AACA,QAAIujD,SAAJ,EAAe;AACbJ,MAAAA,OAAO,CAACI,SAAD,EAAYC,WAAZ,EAAyBC,YAAzB,CAAP;AACD;AACF;;AAED,WAASE,YAAT,CAAsBnlD,CAAtB,EAAyB;AACvB+kD,IAAAA,SAAS,GAAG/kD,CAAC,CAAC0R,MAAF,CAASlQ,MAArB;;AACA,QAAIwjD,WAAJ,EAAiB;AACfL,MAAAA,OAAO,CAACI,SAAD,EAAYC,WAAZ,EAAyBC,YAAzB,CAAP;AACD;AACF;;AAED,WAASG,oBAAT,GAAgC;AAC9B,QAAI,CAACL,SAAS,CAAC/lD,MAAf,EAAuB;AAAE;AACvB,aAAO2lD,OAAO,EAAd;AACD,KAH6B,CAI9B;;;AACA,QAAIU,OAAO,GAAGN,SAAS,CAACA,SAAS,CAAC/lD,MAAV,GAAmB,CAApB,CAAvB;AACA,QAAIsmD,WAAJ;;AACA,QAAIb,QAAQ,IAAIA,QAAQ,CAACc,KAAzB,EAAgC;AAC9B,UAAI;AACFD,QAAAA,WAAW,GAAGhF,WAAW,CAACC,KAAZ,CAAkB8E,OAAlB,EAA2BZ,QAAQ,CAACc,KAApC,EACZ,IADY,EACNd,QAAQ,CAACe,SADH,CAAd;AAED,OAHD,CAGE,OAAOxlD,CAAP,EAAU;AACV,YAAIA,CAAC,CAAC0D,IAAF,KAAW,WAAX,IAA0B1D,CAAC,CAAC4W,IAAF,KAAW,CAAzC,EAA4C;AAC1C,iBAAO+tC,OAAO,EAAd,CAD0C,CACxB;AACnB;AACF;AACF,KATD,MASO;AACLW,MAAAA,WAAW,GAAGhF,WAAW,CAACmF,UAAZ,CAAuBJ,OAAvB,EAAgC,IAAhC,CAAd;AACD;;AACDZ,IAAAA,QAAQ,GAAGa,WAAX;AACAP,IAAAA,SAAS,GAAG,IAAZ;AACAC,IAAAA,WAAW,GAAG,IAAd;AACArF,IAAAA,WAAW,CAACkF,MAAZ,CAAmBJ,QAAnB,EAA6BC,SAA7B,EAAwC9E,SAAxC,GAAoDsF,QAApD;AACAvF,IAAAA,WAAW,CAACmF,UAAZ,CAAuBL,QAAvB,EAAiCC,SAAjC,EAA4C9E,SAA5C,GAAwDuF,YAAxD;AACD;;AAED,WAASO,QAAT,CAAkB1lD,CAAlB,EAAqB;AACnB,QAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,QAAI,CAACg/C,MAAL,EAAa;AAAE;AACb,aAAOmE,OAAO,EAAd;AACD,KAJkB,CAKnB;;;AACAA,IAAAA,OAAO,CAAC,CAACnE,MAAM,CAAC39C,GAAR,CAAD,EAAe,CAAC29C,MAAM,CAACz9C,KAAR,CAAf,EAA+By9C,MAA/B,CAAP;AACD;;AAED,MAAIoE,SAAJ,EAAe;AACbK,IAAAA,YAAY,GAAG;AAAC,kBAAYG;AAAb,KAAf;AACAzF,IAAAA,WAAW,CAACkF,MAAZ,CAAmBJ,QAAnB,EAA6BC,SAA7B,EAAwC9E,SAAxC,GAAoDsF,QAApD;AACAvF,IAAAA,WAAW,CAACmF,UAAZ,CAAuBL,QAAvB,EAAiCC,SAAjC,EAA4C9E,SAA5C,GAAwDuF,YAAxD;AACD,GAJD,MAIO,IAAIxc,UAAJ,EAAgB;AACrBgX,IAAAA,WAAW,CAACc,UAAZ,CAAuBgE,QAAvB,EAAiC,MAAjC,EAAyC7E,SAAzC,GAAqD8F,QAArD;AACD,GAFM,MAEA;AACL/F,IAAAA,WAAW,CAACc,UAAZ,CAAuBgE,QAAvB,EAAiC7E,SAAjC,GAA6C8F,QAA7C;AACD;AACF,EAED;;;AACA,SAASb,MAAT,CAAgBlF,WAAhB,EAA6B8E,QAA7B,EAAuC57C,SAAvC,EAAkD;AAChD,MAAI,OAAO82C,WAAW,CAACkF,MAAnB,KAA8B,UAAlC,EAA8C;AAC5C;AACAlF,IAAAA,WAAW,CAACkF,MAAZ,CAAmBJ,QAAnB,EAA6B7E,SAA7B,GAAyC/2C,SAAzC;AACA;AACD,GAL+C,CAMhD;;;AACA,MAAIy0B,MAAM,GAAG,EAAb;;AAEA,WAASooB,QAAT,CAAkB1lD,CAAlB,EAAqB;AACnB,QAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,QAAIg/C,MAAJ,EAAY;AACVljB,MAAAA,MAAM,CAACj5B,IAAP,CAAYm8C,MAAM,CAACz9C,KAAnB;AACAy9C,MAAAA,MAAM,CAACK,QAAP;AACD,KAHD,MAGO;AACLh4C,MAAAA,SAAS,CAAC;AACR6I,QAAAA,MAAM,EAAE;AACNlQ,UAAAA,MAAM,EAAE87B;AADF;AADA,OAAD,CAAT;AAKD;AACF;;AAEDqiB,EAAAA,WAAW,CAACc,UAAZ,CAAuBgE,QAAvB,EAAiC7E,SAAjC,GAA6C8F,QAA7C;AACD;;AAED,SAASC,WAAT,CAAqBjjD,IAArB,EAA2B0+C,QAA3B,EAAqCuD,OAArC,EAA8C;AAC5C;AACA,MAAIK,WAAW,GAAG,IAAIz1B,KAAJ,CAAU7sB,IAAI,CAAC1D,MAAf,CAAlB;AACA,MAAI4uB,KAAK,GAAG,CAAZ;AACAlrB,EAAAA,IAAI,CAACe,OAAL,CAAa,UAAUZ,GAAV,EAAe+iB,KAAf,EAAsB;AACjCw7B,IAAAA,QAAQ,CAAC5gD,GAAT,CAAaqC,GAAb,EAAkB+8C,SAAlB,GAA8B,UAAUr0C,KAAV,EAAiB;AAC7C,UAAIA,KAAK,CAACmG,MAAN,CAAalQ,MAAjB,EAAyB;AACvBwjD,QAAAA,WAAW,CAACp/B,KAAD,CAAX,GAAqBra,KAAK,CAACmG,MAAN,CAAalQ,MAAlC;AACD,OAFD,MAEO;AACLwjD,QAAAA,WAAW,CAACp/B,KAAD,CAAX,GAAqB;AAAC/iB,UAAAA,GAAG,EAAEA,GAAN;AAAW4H,UAAAA,KAAK,EAAE;AAAlB,SAArB;AACD;;AACDmjB,MAAAA,KAAK;;AACL,UAAIA,KAAK,KAAKlrB,IAAI,CAAC1D,MAAnB,EAA2B;AACzB2lD,QAAAA,OAAO,CAACjiD,IAAD,EAAOsiD,WAAP,EAAoB,EAApB,CAAP;AACD;AACF,KAVD;AAWD,GAZD;AAaD;;AAED,SAASY,cAAT,CAAwBpnC,KAAxB,EAA+BpD,GAA/B,EAAoCyqC,YAApC,EAAkDhjD,GAAlD,EAAuD8lC,UAAvD,EAAmE;AACjE,MAAI;AACF,QAAInqB,KAAK,IAAIpD,GAAb,EAAkB;AAChB,UAAIutB,UAAJ,EAAgB;AACd,eAAO2X,WAAW,CAACC,KAAZ,CAAkBnlC,GAAlB,EAAuBoD,KAAvB,EAA8B,CAACqnC,YAA/B,EAA6C,KAA7C,CAAP;AACD,OAFD,MAEO;AACL,eAAOvF,WAAW,CAACC,KAAZ,CAAkB/hC,KAAlB,EAAyBpD,GAAzB,EAA8B,KAA9B,EAAqC,CAACyqC,YAAtC,CAAP;AACD;AACF,KAND,MAMO,IAAIrnC,KAAJ,EAAW;AAChB,UAAImqB,UAAJ,EAAgB;AACd,eAAO2X,WAAW,CAACwF,UAAZ,CAAuBtnC,KAAvB,CAAP;AACD,OAFD,MAEO;AACL,eAAO8hC,WAAW,CAACmF,UAAZ,CAAuBjnC,KAAvB,CAAP;AACD;AACF,KANM,MAMA,IAAIpD,GAAJ,EAAS;AACd,UAAIutB,UAAJ,EAAgB;AACd,eAAO2X,WAAW,CAACmF,UAAZ,CAAuBrqC,GAAvB,EAA4B,CAACyqC,YAA7B,CAAP;AACD,OAFD,MAEO;AACL,eAAOvF,WAAW,CAACwF,UAAZ,CAAuB1qC,GAAvB,EAA4B,CAACyqC,YAA7B,CAAP;AACD;AACF,KANM,MAMA,IAAIhjD,GAAJ,EAAS;AACd,aAAOy9C,WAAW,CAACI,IAAZ,CAAiB79C,GAAjB,CAAP;AACD;AACF,GAtBD,CAsBE,OAAO7C,CAAP,EAAU;AACV,WAAO;AAACyK,MAAAA,KAAK,EAAEzK;AAAR,KAAP;AACD;;AACD,SAAO,IAAP;AACD;;AAED,SAAS+lD,UAAT,CAAoBvwB,IAApB,EAA0BurB,GAA1B,EAA+B3sB,QAA/B,EAAyC;AACvC,MAAI5V,KAAK,GAAG,cAAcgX,IAAd,GAAqBA,IAAI,CAAC4Y,QAA1B,GAAqC,KAAjD;AACA,MAAIhzB,GAAG,GAAG,YAAYoa,IAAZ,GAAmBA,IAAI,CAAC8Y,MAAxB,GAAiC,KAA3C;AACA,MAAIzrC,GAAG,GAAG,SAAS2yB,IAAT,GAAgBA,IAAI,CAAC3yB,GAArB,GAA2B,KAArC;AACA,MAAIH,IAAI,GAAG,UAAU8yB,IAAV,GAAiBA,IAAI,CAAC9yB,IAAtB,GAA6B,KAAxC;AACA,MAAIwnC,IAAI,GAAG1U,IAAI,CAAC0U,IAAL,IAAa,CAAxB;AACA,MAAItB,KAAK,GAAG,OAAOpT,IAAI,CAACoT,KAAZ,KAAsB,QAAtB,GAAiCpT,IAAI,CAACoT,KAAtC,GAA8C,CAAC,CAA3D;AACA,MAAIid,YAAY,GAAGrwB,IAAI,CAACwwB,aAAL,KAAuB,KAA1C;AAEA,MAAIvB,QAAJ;AACA,MAAIwB,aAAJ;;AACA,MAAI,CAACvjD,IAAL,EAAW;AACT+hD,IAAAA,QAAQ,GAAGmB,cAAc,CAACpnC,KAAD,EAAQpD,GAAR,EAAayqC,YAAb,EAA2BhjD,GAA3B,EAAgC2yB,IAAI,CAACmT,UAArC,CAAzB;AACAsd,IAAAA,aAAa,GAAGxB,QAAQ,IAAIA,QAAQ,CAACh6C,KAArC;;AACA,QAAIw7C,aAAa,IACf,EAAEA,aAAa,CAACviD,IAAd,KAAuB,WAAvB,IAAsCuiD,aAAa,CAACrvC,IAAd,KAAuB,CAA/D,CADF,EACqE;AACnE;AACA;AACA,aAAOwd,QAAQ,CAACyG,WAAW,CAACR,SAAD,EACzB4rB,aAAa,CAACviD,IADW,EACLuiD,aAAa,CAACx9C,OADT,CAAZ,CAAf;AAED;AACF;;AAED,MAAIu4C,MAAM,GAAG,CAAC/C,SAAD,EAAYC,YAAZ,EAA0BG,UAA1B,CAAb;;AAEA,MAAI7oB,IAAI,CAACmG,WAAT,EAAsB;AACpBqlB,IAAAA,MAAM,CAAC38C,IAAP,CAAY85C,YAAZ;AACD;;AACD,MAAI8D,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAMC,MAAN,EAAc,UAAd,CAArC;;AACA,MAAIiB,SAAS,CAACx3C,KAAd,EAAqB;AACnB,WAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD,MAAI+0C,GAAG,GAAGyC,SAAS,CAACzC,GAApB;AACAA,EAAAA,GAAG,CAAC4C,UAAJ,GAAiB8D,aAAjB;AACA1G,EAAAA,GAAG,CAAC0C,OAAJ,GAActD,QAAQ,CAACxqB,QAAD,CAAtB;AACA,MAAIgtB,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAf;AACA,MAAIgC,QAAQ,GAAGT,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAf;AACA,MAAIsD,SAAS,GAAGhC,GAAG,CAACG,WAAJ,CAAgBtB,UAAhB,CAAhB;AACA,MAAI8H,aAAa,GAAGlG,QAAQ,CAACr6B,KAAT,CAAe,aAAf,CAApB;AACA,MAAIxD,OAAO,GAAG,EAAd;AACA,MAAIugC,QAAJ;AACA,MAAIyD,SAAJ;;AAEA5E,EAAAA,SAAS,CAAChhD,GAAV,CAAc69C,UAAd,EAA0BuB,SAA1B,GAAsC,UAAU5/C,CAAV,EAAa;AACjD2iD,IAAAA,QAAQ,GAAG3iD,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgBmhD,QAA3B;AACD,GAFD;AAIA;;;AACA,MAAIntB,IAAI,CAACgT,UAAT,EAAqB;AACnB6d,IAAAA,eAAe,CAACpG,QAAD,EAAW,UAAUjgD,CAAV,EAAa;AACrC,UAAIA,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,IAAmBxB,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgBxC,MAAhB,GAAyB,CAAhD,EAAmD;AACjDonD,QAAAA,SAAS,GAAGpmD,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgB,CAAhB,CAAZ;AACD;AACF,KAJc,CAAf;AAKD;;AAED,WAAS6kD,eAAT,CAAyB1G,WAAzB,EAAsC92C,SAAtC,EAAiD;AAC/C,aAAS68C,QAAT,CAAkB1lD,CAAlB,EAAqB;AACnB,UAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;AACA,UAAI8kD,MAAM,GAAGrjD,SAAb;;AACA,UAAIu9C,MAAM,IAAIA,MAAM,CAAC39C,GAArB,EAA0B;AACxByjD,QAAAA,MAAM,GAAG9F,MAAM,CAAC39C,GAAhB;AACD;;AACD,aAAOgG,SAAS,CAAC;AACf6I,QAAAA,MAAM,EAAE;AACNlQ,UAAAA,MAAM,EAAE,CAAC8kD,MAAD;AADF;AADO,OAAD,CAAhB;AAKD;;AACD3G,IAAAA,WAAW,CAACc,UAAZ,CAAuB,IAAvB,EAA6B,MAA7B,EAAqCb,SAArC,GAAiD8F,QAAjD;AACD,GAtEsC,CAwEvC;AACA;;;AACA,WAASa,sBAAT,CAAgCjkB,QAAhC,EAA0C2K,GAA1C,EAA+C6P,aAA/C,EAA8D;AAC5D,QAAIj6C,GAAG,GAAGy/B,QAAQ,CAAC9+B,EAAT,GAAc,IAAd,GAAqBs5C,aAA/B;;AACAqJ,IAAAA,aAAa,CAAC3lD,GAAd,CAAkBqC,GAAlB,EAAuB+8C,SAAvB,GAAoC,SAAS4G,QAAT,CAAkBxmD,CAAlB,EAAqB;AACvDitC,MAAAA,GAAG,CAAChS,GAAJ,GAAUgkB,SAAS,CAACj/C,CAAC,CAAC0R,MAAF,CAASlQ,MAAV,CAAT,IAA8B,EAAxC;;AACA,UAAIg0B,IAAI,CAACsO,SAAT,EAAoB;AAClB,YAAIA,SAAS,GAAGF,gBAAgB,CAACtB,QAAD,CAAhC;;AACA,YAAIwB,SAAS,CAAC9kC,MAAd,EAAsB;AACpBiuC,UAAAA,GAAG,CAAChS,GAAJ,CAAQgN,UAAR,GAAqBnE,SAArB;AACD;AACF;;AACDyb,MAAAA,2BAA2B,CAACtS,GAAG,CAAChS,GAAL,EAAUzF,IAAV,EAAgBgqB,GAAhB,CAA3B;AACD,KATD;AAUD;;AAED,WAASiH,YAAT,CAAsB3J,aAAtB,EAAqCxa,QAArC,EAA+C;AAC7C,QAAI2K,GAAG,GAAG;AACRzpC,MAAAA,EAAE,EAAE8+B,QAAQ,CAAC9+B,EADL;AAERX,MAAAA,GAAG,EAAEy/B,QAAQ,CAAC9+B,EAFN;AAGRT,MAAAA,KAAK,EAAE;AACLi0B,QAAAA,GAAG,EAAE8lB;AADA;AAHC,KAAV;AAOA,QAAI9Z,OAAO,GAAGV,QAAQ,CAACU,OAAvB;;AACA,QAAIA,OAAJ,EAAa;AACX,UAAItgC,IAAJ,EAAU;AACR0f,QAAAA,OAAO,CAAC/d,IAAR,CAAa4oC,GAAb,EADQ,CAER;;AACAA,QAAAA,GAAG,CAAClqC,KAAJ,CAAUigC,OAAV,GAAoB,IAApB;AACAiK,QAAAA,GAAG,CAAChS,GAAJ,GAAU,IAAV;AACD;AACF,KAPD,MAOO,IAAIiP,IAAI,MAAM,CAAd,EAAiB;AACtB9nB,MAAAA,OAAO,CAAC/d,IAAR,CAAa4oC,GAAb;;AACA,UAAIzX,IAAI,CAACkG,YAAT,EAAuB;AACrB6qB,QAAAA,sBAAsB,CAACjkB,QAAD,EAAW2K,GAAX,EAAgB6P,aAAhB,CAAtB;AACD;AACF;AACF;;AAED,WAASrmB,YAAT,CAAsBiwB,WAAtB,EAAmC;AACjC,SAAK,IAAIpyC,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAG45B,WAAW,CAAC1nD,MAAlC,EAA0CsV,CAAC,GAAGwY,GAA9C,EAAmDxY,CAAC,EAApD,EAAwD;AACtD,UAAI8N,OAAO,CAACpjB,MAAR,KAAmB4pC,KAAvB,EAA8B;AAC5B;AACD;;AACD,UAAI+d,UAAU,GAAGD,WAAW,CAACpyC,CAAD,CAA5B;;AACA,UAAIqyC,UAAU,CAACl8C,KAAX,IAAoB/H,IAAxB,EAA8B;AAC5B;AACA0f,QAAAA,OAAO,CAAC/d,IAAR,CAAasiD,UAAb;AACA;AACD;;AACD,UAAIrkB,QAAQ,GAAGyc,cAAc,CAAC4H,UAAD,CAA7B;AACA,UAAI7J,aAAa,GAAGxa,QAAQ,CAACD,UAA7B;AACAokB,MAAAA,YAAY,CAAC3J,aAAD,EAAgBxa,QAAhB,CAAZ;AACD;AACF;;AAED,WAASqiB,OAAT,CAAiBiC,SAAjB,EAA4BF,WAA5B,EAAyClG,MAAzC,EAAiD;AAC/C,QAAI,CAACA,MAAL,EAAa;AACX;AACD;;AACD/pB,IAAAA,YAAY,CAACiwB,WAAD,CAAZ;;AACA,QAAItkC,OAAO,CAACpjB,MAAR,GAAiB4pC,KAArB,EAA4B;AAC1B4X,MAAAA,MAAM,CAACK,QAAP;AACD;AACF;;AAED,WAASqE,QAAT,CAAkBllD,CAAlB,EAAqB;AACnB,QAAIs9B,MAAM,GAAGt9B,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,QAAIg0B,IAAI,CAACmT,UAAT,EAAqB;AACnBrL,MAAAA,MAAM,GAAGA,MAAM,CAACqG,OAAP,EAAT;AACD;;AACDlN,IAAAA,YAAY,CAAC6G,MAAD,CAAZ;AACD;;AAED,WAASupB,cAAT,GAA0B;AACxB,QAAIC,SAAS,GAAG;AACdC,MAAAA,UAAU,EAAEpE,QADE;AAEdjsB,MAAAA,MAAM,EAAElB,IAAI,CAAC0U,IAFC;AAGdiO,MAAAA,IAAI,EAAE/1B;AAHQ,KAAhB;AAMA;;AACA,QAAIoT,IAAI,CAACgT,UAAL,IAAmB4d,SAAS,KAAKnjD,SAArC,EAAgD;AAC9C6jD,MAAAA,SAAS,CAACte,UAAV,GAAuB4d,SAAvB;AACD;;AACDhyB,IAAAA,QAAQ,CAAC,IAAD,EAAO0yB,SAAP,CAAR;AACD;;AAED,WAASZ,aAAT,GAAyB;AACvB,QAAI1wB,IAAI,CAACmG,WAAT,EAAsB;AACpBkkB,MAAAA,sBAAsB,CAACz9B,OAAD,EAAUoT,IAAI,CAACgK,MAAf,CAAtB,CAA6Cv4B,IAA7C,CAAkD4/C,cAAlD;AACD,KAFD,MAEO;AACLA,MAAAA,cAAc;AACf;AACF,GAvKsC,CAyKvC;;;AACA,MAAIZ,aAAa,IAAIrd,KAAK,KAAK,CAA/B,EAAkC;AAChC;AACD;;AACD,MAAIlmC,IAAJ,EAAU;AACR,WAAOijD,WAAW,CAACnwB,IAAI,CAAC9yB,IAAN,EAAY0+C,QAAZ,EAAsBuD,OAAtB,CAAlB;AACD;;AACD,MAAI/b,KAAK,KAAK,CAAC,CAAf,EAAkB;AAAE;AAClB,WAAOic,MAAM,CAACzD,QAAD,EAAWqD,QAAX,EAAqBS,QAArB,CAAb;AACD,GAlLsC,CAmLvC;AACA;;;AACAV,EAAAA,gBAAgB,CAACpD,QAAD,EAAWqD,QAAX,EAAqBjvB,IAAI,CAACmT,UAA1B,EAAsCC,KAAK,GAAGsB,IAA9C,EAAoDya,OAApD,CAAhB;AACD,EAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASqC,gBAAT,CAA0BxH,GAA1B,EAA+B;AAC7B,SAAO,IAAIh2C,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpC,QAAI24C,OAAO,GAAG7oB,UAAU,CAAC,CAAC,EAAD,CAAD,CAAxB;AACA,QAAIlD,GAAG,GAAGskB,GAAG,CAACG,WAAJ,CAAgBpB,yBAAhB,EAA2CxgB,GAA3C,CAA+CkpB,OAA/C,EAAwD,KAAxD,CAAV;;AAEA/rB,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,YAAY;AAC1B,UAAIsH,aAAa,GAAG3lD,SAAS,CAACK,SAAV,CAAoB7C,KAApB,CAA0B,eAA1B,CAApB;AACA,UAAIooD,WAAW,GAAG5lD,SAAS,CAACK,SAAV,CAAoB7C,KAApB,CAA0B,QAA1B,CAAlB,CAF0B,CAG1B;AACA;;AACAuP,MAAAA,OAAO,CAAC64C,WAAW,IAAI,CAACD,aAAhB,IACNjoD,QAAQ,CAACioD,aAAa,CAAC,CAAD,CAAd,EAAmB,EAAnB,CAAR,IAAkC,EAD7B,CAAP;AAED,KAPD;;AASAhsB,IAAAA,GAAG,CAACpe,OAAJ,GAAc0iC,GAAG,CAAC0C,OAAJ,GAAc,UAAUliD,CAAV,EAAa;AACvC;AACA;AACAA,MAAAA,CAAC,CAAC6jD,cAAF;AACA7jD,MAAAA,CAAC,CAAC8jD,eAAF;AACAx1C,MAAAA,OAAO,CAAC,KAAD,CAAP;AACD,KAND;AAOD,GApBM,EAoBJoU,KApBI,CAoBE,YAAY;AACnB,WAAO,KAAP,CADmB,CACL;AACf,GAtBM,CAAP;AAuBD;;AAED,SAAS0kC,SAAT,CAAmB5H,GAAnB,EAAwB5/C,EAAxB,EAA4B;AAC1B,MAAIgmB,KAAK,GAAG45B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,EAA2Br4B,KAA3B,CAAiC,gBAAjC,CAAZ;;AACAA,EAAAA,KAAK,CAACgI,KAAN,CAAY0yB,WAAW,CAACI,IAAZ,CAAiB,GAAjB,CAAZ,EAAmCd,SAAnC,GAA+C,UAAU5/C,CAAV,EAAa;AAC1DJ,IAAAA,EAAE,CAACI,CAAC,CAAC0R,MAAF,CAASlQ,MAAV,CAAF;AACD,GAFD;AAGD,EAED;;;AAEA,IAAI6lD,OAAO,GAAG,KAAd;AACA,IAAIj3B,KAAK,GAAG,EAAZ;;AAEA,SAASk3B,OAAT,CAAiBr3B,GAAjB,EAAsBphB,GAAtB,EAA2BmjB,GAA3B,EAAgCkW,OAAhC,EAAyC;AACvC,MAAI;AACFjY,IAAAA,GAAG,CAACphB,GAAD,EAAMmjB,GAAN,CAAH;AACD,GAFD,CAEE,OAAOnjB,GAAP,EAAY;AACZ;AACA;AACA;AACAq5B,IAAAA,OAAO,CAAC1b,IAAR,CAAa,OAAb,EAAsB3d,GAAtB;AACD;AACF;;AAED,SAAS04C,SAAT,GAAqB;AACnB,MAAIF,OAAO,IAAI,CAACj3B,KAAK,CAACpxB,MAAtB,EAA8B;AAC5B;AACD;;AACDqoD,EAAAA,OAAO,GAAG,IAAV;AACAj3B,EAAAA,KAAK,CAACpV,KAAN;AACD;;AAED,SAASwsC,WAAT,CAAqB3xC,MAArB,EAA6Bue,QAA7B,EAAuC8T,OAAvC,EAAgD;AAC9C9X,EAAAA,KAAK,CAAC/rB,IAAN,CAAW,SAASojD,SAAT,GAAqB;AAC9B5xC,IAAAA,MAAM,CAAC,SAAS6xC,WAAT,CAAqB74C,GAArB,EAA0BmjB,GAA1B,EAA+B;AACpCs1B,MAAAA,OAAO,CAAClzB,QAAD,EAAWvlB,GAAX,EAAgBmjB,GAAhB,EAAqBkW,OAArB,CAAP;AACAmf,MAAAA,OAAO,GAAG,KAAV;AACA,8BAAU,SAASM,OAAT,GAAmB;AAC3BJ,QAAAA,SAAS,CAACrf,OAAD,CAAT;AACD,OAFD;AAGD,KANK,CAAN;AAOD,GARD;AASAqf,EAAAA,SAAS;AACV;;AAED,SAASzvB,OAAT,CAAiBtC,IAAjB,EAAuBiW,GAAvB,EAA4B/T,MAA5B,EAAoCqpB,GAApC,EAAyC;AACvCvrB,EAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;;AAEA,MAAIA,IAAI,CAAC8S,UAAT,EAAqB;AACnB,QAAI9kC,EAAE,GAAGk0B,MAAM,GAAG,GAAT,GAAe0K,IAAI,EAA5B;AACA4X,IAAAA,cAAc,CAACnsB,WAAf,CAA2B6J,MAA3B,EAAmCl0B,EAAnC,EAAuCioC,GAAvC,EAA4CjW,IAA5C;AACAwkB,IAAAA,cAAc,CAAC5hB,MAAf,CAAsBV,MAAtB;AACA,WAAO;AACLiQ,MAAAA,MAAM,EAAE,YAAY;AAClBqS,QAAAA,cAAc,CAAC9rB,cAAf,CAA8BwJ,MAA9B,EAAsCl0B,EAAtC;AACD;AAHI,KAAP;AAKD;;AAED,MAAIokD,MAAM,GAAGpyB,IAAI,CAACykB,OAAL,IAAgB,IAAIxnB,WAAJ,CAAgB+C,IAAI,CAACykB,OAArB,CAA7B;AAEAzkB,EAAAA,IAAI,CAACwC,KAAL,GAAaxC,IAAI,CAACwC,KAAL,IAAc,CAA3B;AACA,MAAIyP,OAAO,GAAGjS,IAAI,CAACwC,KAAnB;AAEA,MAAI4Q,KAAK,GAAG,WAAWpT,IAAX,GAAkBA,IAAI,CAACoT,KAAvB,GAA+B,CAAC,CAA5C;;AACA,MAAIA,KAAK,KAAK,CAAd,EAAiB;AACfA,IAAAA,KAAK,GAAG,CAAR,CADe,CACJ;AACZ;;AAED,MAAIxmB,OAAO,GAAG,EAAd;AACA,MAAIylC,UAAU,GAAG,CAAjB;AACA,MAAIzgD,MAAM,GAAGg0B,YAAY,CAAC5F,IAAD,CAAzB;AACA,MAAIsyB,gBAAgB,GAAG,IAAIp1B,WAAJ,EAAvB;AAEA,MAAI8sB,GAAJ;AACA,MAAI6B,UAAJ;AACA,MAAID,QAAJ;AACA,MAAI+E,aAAJ;;AAEA,WAASxB,OAAT,CAAiBiC,SAAjB,EAA4BF,WAA5B,EAAyClG,MAAzC,EAAiD;AAC/C,QAAI,CAACA,MAAD,IAAW,CAACoG,SAAS,CAAC5nD,MAA1B,EAAkC;AAAE;AAClC;AACD;;AAED,QAAI+oD,WAAW,GAAG,IAAIx4B,KAAJ,CAAUq3B,SAAS,CAAC5nD,MAApB,CAAlB;AACA,QAAIgpD,SAAS,GAAG,IAAIz4B,KAAJ,CAAUq3B,SAAS,CAAC5nD,MAApB,CAAhB;;AAEA,aAASipD,4BAAT,CAAsC3lB,QAAtC,EAAgD4lB,UAAhD,EAA4D;AAC1D,UAAI1sB,MAAM,GAAGhG,IAAI,CAACsS,aAAL,CAAmBogB,UAAnB,EAA+B5lB,QAA/B,EAAyC9M,IAAzC,CAAb;AACAiS,MAAAA,OAAO,GAAGjM,MAAM,CAACzD,GAAP,GAAauK,QAAQ,CAACvK,GAAhC;AAEA,UAAIowB,QAAQ,GAAG/gD,MAAM,CAACo0B,MAAD,CAArB;;AACA,UAAI,OAAO2sB,QAAP,KAAoB,QAAxB,EAAkC;AAAE;AAClC,eAAO3+C,OAAO,CAACC,MAAR,CAAe0+C,QAAf,CAAP;AACD;;AAED,UAAI,CAACA,QAAL,EAAe;AACb,eAAO3+C,OAAO,CAAC8E,OAAR,EAAP;AACD;;AACDu5C,MAAAA,UAAU;;AACV,UAAIryB,IAAI,CAACwX,WAAT,EAAsB;AACpB5qB,QAAAA,OAAO,CAAC/d,IAAR,CAAam3B,MAAb;AACD,OAfyD,CAgB1D;AACA;;;AACA,UAAIhG,IAAI,CAACmG,WAAL,IAAoBnG,IAAI,CAACkG,YAA7B,EAA2C;AACzC,eAAO,IAAIlyB,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpCixC,UAAAA,2BAA2B,CAAC2I,UAAD,EAAa1yB,IAAb,EAAmBgqB,GAAnB,EAAwB,YAAY;AAC7DK,YAAAA,sBAAsB,CAAC,CAACrkB,MAAD,CAAD,EAAWhG,IAAI,CAACgK,MAAhB,CAAtB,CAA8Cv4B,IAA9C,CAAmD,YAAY;AAC7DqH,cAAAA,OAAO,CAACktB,MAAD,CAAP;AACD,aAFD;AAGD,WAJ0B,CAA3B;AAKD,SANM,CAAP;AAOD,OARD,MAQO;AACL,eAAOhyB,OAAO,CAAC8E,OAAR,CAAgBktB,MAAhB,CAAP;AACD;AACF;;AAED,aAAS4sB,WAAT,GAAuB;AACrB,UAAInmC,QAAQ,GAAG,EAAf;;AACA,WAAK,IAAI3N,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGi7B,WAAW,CAAC/oD,MAAlC,EAA0CsV,CAAC,GAAGwY,GAA9C,EAAmDxY,CAAC,EAApD,EAAwD;AACtD,YAAIuzC,UAAU,KAAKjf,KAAnB,EAA0B;AACxB;AACD;;AACD,YAAIsf,UAAU,GAAGH,WAAW,CAACzzC,CAAD,CAA5B;;AACA,YAAI,CAAC4zC,UAAL,EAAiB;AACf;AACD;;AACD,YAAI5lB,QAAQ,GAAG0lB,SAAS,CAAC1zC,CAAD,CAAxB;AACA2N,QAAAA,QAAQ,CAAC5d,IAAT,CAAc4jD,4BAA4B,CAAC3lB,QAAD,EAAW4lB,UAAX,CAA1C;AACD;;AAED1+C,MAAAA,OAAO,CAAC0Y,GAAR,CAAYD,QAAZ,EAAsBhb,IAAtB,CAA2B,UAAU6wB,OAAV,EAAmB;AAC5C,aAAK,IAAIxjB,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGgL,OAAO,CAAC94B,MAA9B,EAAsCsV,CAAC,GAAGwY,GAA1C,EAA+CxY,CAAC,EAAhD,EAAoD;AAClD,cAAIwjB,OAAO,CAACxjB,CAAD,CAAX,EAAgB;AACdkhB,YAAAA,IAAI,CAAC0C,QAAL,CAAcJ,OAAO,CAACxjB,CAAD,CAArB;AACD;AACF;AACF,OAND,EAMGoO,KANH,CAMS8S,IAAI,CAAClZ,QANd;;AAQA,UAAIurC,UAAU,KAAKjf,KAAnB,EAA0B;AACxB4X,QAAAA,MAAM,CAACK,QAAP;AACD;AACF,KAhE8C,CAkE/C;AACA;AACA;;;AACA,QAAI/qB,OAAO,GAAG,CAAd;AACA4wB,IAAAA,WAAW,CAACjjD,OAAZ,CAAoB,UAAUV,KAAV,EAAiBuR,CAAjB,EAAoB;AACtC,UAAI2mB,GAAG,GAAGgkB,SAAS,CAACl8C,KAAD,CAAnB;AACA,UAAIg1B,GAAG,GAAG6uB,SAAS,CAACtyC,CAAD,CAAnB;AACA+zC,MAAAA,0BAA0B,CAACptB,GAAD,EAAMlD,GAAN,EAAW,UAAUuK,QAAV,EAAoB4lB,UAApB,EAAgC;AACnEF,QAAAA,SAAS,CAAC1zC,CAAD,CAAT,GAAeguB,QAAf;AACAylB,QAAAA,WAAW,CAACzzC,CAAD,CAAX,GAAiB4zC,UAAjB;;AACA,YAAI,EAAEpyB,OAAF,KAAc8wB,SAAS,CAAC5nD,MAA5B,EAAoC;AAClCopD,UAAAA,WAAW;AACZ;AACF,OANyB,CAA1B;AAOD,KAVD;AAWD;;AAED,WAASE,aAAT,CAAuBrtB,GAAvB,EAA4BlD,GAA5B,EAAiCuK,QAAjC,EAA2C1iC,EAA3C,EAA+C;AAC7C,QAAI0iC,QAAQ,CAACvK,GAAT,KAAiBA,GAArB,EAA0B;AACxB;AACA,aAAOn4B,EAAE,EAAT;AACD;;AAED,QAAI0iC,QAAQ,CAACD,UAAT,KAAwBpH,GAAG,CAACyC,IAAhC,EAAsC;AACpC;AACA,aAAO99B,EAAE,CAAC0iC,QAAD,EAAWrH,GAAX,CAAT;AACD,KAT4C,CAW7C;;;AACA,QAAIstB,QAAQ,GAAGttB,GAAG,CAAC4C,GAAJ,GAAU,IAAV,GAAiByE,QAAQ,CAACD,UAAzC;AACA,QAAInH,GAAG,GAAGirB,aAAa,CAAC3lD,GAAd,CAAkB+nD,QAAlB,CAAV;;AACArtB,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3BJ,MAAAA,EAAE,CAAC0iC,QAAD,EAAW2c,SAAS,CAACj/C,CAAC,CAAC0R,MAAF,CAASlQ,MAAV,CAApB,CAAF;AACD,KAFD;AAGD;;AAED,WAAS6mD,0BAAT,CAAoCptB,GAApC,EAAyClD,GAAzC,EAA8Cn4B,EAA9C,EAAkD;AAChD,QAAIgoD,MAAM,IAAI,CAACA,MAAM,CAACrkD,GAAP,CAAW03B,GAAG,CAAC4C,GAAf,CAAf,EAAoC;AAClC,aAAOj+B,EAAE,EAAT;AACD;;AAED,QAAI0iC,QAAQ,GAAGwlB,gBAAgB,CAACtnD,GAAjB,CAAqBy6B,GAAG,CAAC4C,GAAzB,CAAf;;AACA,QAAIyE,QAAJ,EAAc;AAAE;AACd,aAAOgmB,aAAa,CAACrtB,GAAD,EAAMlD,GAAN,EAAWuK,QAAX,EAAqB1iC,EAArB,CAApB;AACD,KAR+C,CAShD;;;AACAwhD,IAAAA,QAAQ,CAAC5gD,GAAT,CAAay6B,GAAG,CAAC4C,GAAjB,EAAsB+hB,SAAtB,GAAkC,UAAU5/C,CAAV,EAAa;AAC7CsiC,MAAAA,QAAQ,GAAGyc,cAAc,CAAC/+C,CAAC,CAAC0R,MAAF,CAASlQ,MAAV,CAAzB;AACAsmD,MAAAA,gBAAgB,CAACrnD,GAAjB,CAAqBw6B,GAAG,CAAC4C,GAAzB,EAA8ByE,QAA9B;AACAgmB,MAAAA,aAAa,CAACrtB,GAAD,EAAMlD,GAAN,EAAWuK,QAAX,EAAqB1iC,EAArB,CAAb;AACD,KAJD;AAKD;;AAED,WAASmjD,MAAT,GAAkB;AAChBvtB,IAAAA,IAAI,CAAClZ,QAAL,CAAc,IAAd,EAAoB;AAClB8F,MAAAA,OAAO,EAAEA,OADS;AAElBkoB,MAAAA,QAAQ,EAAE7C;AAFQ,KAApB;AAID;;AAED,WAASye,aAAT,GAAyB;AACvB,QAAI,CAAC1wB,IAAI,CAAC8S,UAAN,IAAoB9S,IAAI,CAACmG,WAA7B,EAA0C;AACxC;AACA;AACAkkB,MAAAA,sBAAsB,CAACz9B,OAAD,CAAtB,CAAgCnb,IAAhC,CAAqC87C,MAArC;AACD,KAJD,MAIO;AACLA,MAAAA,MAAM;AACP;AACF;;AAED,MAAIyF,YAAY,GAAG,CAACvK,SAAD,EAAYC,YAAZ,CAAnB;;AACA,MAAI1oB,IAAI,CAACmG,WAAT,EAAsB;AACpB6sB,IAAAA,YAAY,CAACnkD,IAAb,CAAkB85C,YAAlB;AACD;;AACD,MAAI8D,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAMyH,YAAN,EAAoB,UAApB,CAArC;;AACA,MAAIvG,SAAS,CAACx3C,KAAd,EAAqB;AACnB,WAAO+qB,IAAI,CAAClZ,QAAL,CAAc2lC,SAAS,CAACx3C,KAAxB,CAAP;AACD;;AACD+0C,EAAAA,GAAG,GAAGyC,SAAS,CAACzC,GAAhB;AACAA,EAAAA,GAAG,CAAC0C,OAAJ,GAActD,QAAQ,CAACppB,IAAI,CAAClZ,QAAN,CAAtB;AACAkjC,EAAAA,GAAG,CAAC4C,UAAJ,GAAiB8D,aAAjB;AAEA7E,EAAAA,UAAU,GAAG7B,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAb;AACAkD,EAAAA,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAX;AACAkI,EAAAA,aAAa,GAAG9E,UAAU,CAACz7B,KAAX,CAAiB,aAAjB,CAAhB;AAEA,MAAI6+B,QAAQ,GAAIjvB,IAAI,CAACwC,KAAL,IAAc,CAACxC,IAAI,CAACmT,UAArB,GACb2X,WAAW,CAACmF,UAAZ,CAAuBjwB,IAAI,CAACwC,KAA5B,EAAmC,IAAnC,CADa,GAC8B,IAD7C;AAGAwsB,EAAAA,gBAAgB,CAACnD,UAAD,EAAaoD,QAAb,EAAuBjvB,IAAI,CAACmT,UAA5B,EAAwCC,KAAxC,EAA+C+b,OAA/C,CAAhB;AACD;;AAED,IAAI8D,SAAS,GAAG,IAAI/1B,WAAJ,EAAhB;AACA,IAAIg2B,kBAAJ;AACA,IAAIC,WAAW,GAAG,IAAIj2B,WAAJ,EAAlB;;AAEA,SAASk2B,QAAT,CAAkBpzB,IAAlB,EAAwBpB,QAAxB,EAAkC;AAChC,MAAIqX,GAAG,GAAG,IAAV;AAEA+b,EAAAA,WAAW,CAAC,UAAUqB,YAAV,EAAwB;AAClCl9B,IAAAA,IAAI,CAAC8f,GAAD,EAAMjW,IAAN,EAAYqzB,YAAZ,CAAJ;AACD,GAFU,EAERz0B,QAFQ,EAEEqX,GAAG,CAAC/X,WAFN,CAAX;AAGD;;AAED,SAAS/H,IAAT,CAAc8f,GAAd,EAAmBjW,IAAnB,EAAyBpB,QAAzB,EAAmC;AAEjC,MAAIsD,MAAM,GAAGlC,IAAI,CAAC9xB,IAAlB;AAEA,MAAIq9C,GAAG,GAAG,IAAV;AACAtV,EAAAA,GAAG,CAACqW,KAAJ,GAAY,IAAZ,CALiC,CAOjC;;AACA,WAASgH,YAAT,CAAsBvzB,EAAtB,EAA0B;AACxB,QAAI6rB,QAAQ,GAAG7rB,EAAE,CAACwzB,iBAAH,CAAqB9K,SAArB,EAAgC;AAAC+K,MAAAA,OAAO,EAAG;AAAX,KAAhC,CAAf;AACAzzB,IAAAA,EAAE,CAACwzB,iBAAH,CAAqB7K,YAArB,EAAmC;AAAC+K,MAAAA,aAAa,EAAE;AAAhB,KAAnC,EACGC,WADH,CACe,aADf,EAC8B,aAD9B,EAC6C;AAACC,MAAAA,MAAM,EAAE;AAAT,KAD7C;AAEA5zB,IAAAA,EAAE,CAACwzB,iBAAH,CAAqB5K,YAArB,EAAmC;AAAC6K,MAAAA,OAAO,EAAE;AAAV,KAAnC;AACAzzB,IAAAA,EAAE,CAACwzB,iBAAH,CAAqB1K,UAArB,EAAiC;AAAC2K,MAAAA,OAAO,EAAE,IAAV;AAAgBC,MAAAA,aAAa,EAAE;AAA/B,KAAjC;AACA1zB,IAAAA,EAAE,CAACwzB,iBAAH,CAAqBxK,yBAArB,EANwB,CAQxB;;AACA6C,IAAAA,QAAQ,CAAC8H,WAAT,CAAqB,gBAArB,EAAuC,gBAAvC,EAAyD;AAACC,MAAAA,MAAM,EAAG;AAAV,KAAzD,EATwB,CAWxB;;AACA5zB,IAAAA,EAAE,CAACwzB,iBAAH,CAAqBzK,WAArB,EAAkC;AAAC0K,MAAAA,OAAO,EAAE;AAAV,KAAlC,EAZwB,CAcxB;;AACA,QAAI7I,cAAc,GAAG5qB,EAAE,CAACwzB,iBAAH,CAAqB3K,oBAArB,EACnB;AAAC6K,MAAAA,aAAa,EAAE;AAAhB,KADmB,CAArB;AAEA9I,IAAAA,cAAc,CAAC+I,WAAf,CAA2B,KAA3B,EAAkC,KAAlC;AACA/I,IAAAA,cAAc,CAAC+I,WAAf,CAA2B,WAA3B,EAAwC,WAAxC,EAAqD;AAACC,MAAAA,MAAM,EAAE;AAAT,KAArD;AACD,GA3BgC,CA6BjC;AACA;AACA;;;AACA,WAASC,sBAAT,CAAgC5J,GAAhC,EAAqCprB,QAArC,EAA+C;AAC7C,QAAIgtB,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAf;AACAmD,IAAAA,QAAQ,CAAC8H,WAAT,CAAqB,gBAArB,EAAuC,gBAAvC,EAAyD;AAACC,MAAAA,MAAM,EAAG;AAAV,KAAzD;;AAEA/H,IAAAA,QAAQ,CAACX,UAAT,GAAsBb,SAAtB,GAAkC,UAAUr0C,KAAV,EAAiB;AACjD,UAAIi1C,MAAM,GAAGj1C,KAAK,CAACmG,MAAN,CAAalQ,MAA1B;;AACA,UAAIg/C,MAAJ,EAAY;AACV,YAAIle,QAAQ,GAAGke,MAAM,CAACz9C,KAAtB;AACA,YAAIigC,OAAO,GAAGgE,SAAS,CAAC1E,QAAD,CAAvB;AACAA,QAAAA,QAAQ,CAACwc,cAAT,GAA0B9b,OAAO,GAAG,GAAH,GAAS,GAA1C;AACAoe,QAAAA,QAAQ,CAACrjB,GAAT,CAAauE,QAAb;AACAke,QAAAA,MAAM,CAACK,QAAP;AACD,OAND,MAMO;AACLzsB,QAAAA,QAAQ;AACT;AACF,KAXD;AAYD,GAhDgC,CAkDjC;;;AACA,WAASi1B,sBAAT,CAAgC9zB,EAAhC,EAAoC;AAClCA,IAAAA,EAAE,CAACwzB,iBAAH,CAAqBzK,WAArB,EAAkC;AAAC0K,MAAAA,OAAO,EAAE;AAAV,KAAlC,EACGE,WADH,CACe,aADf,EAC8B,aAD9B,EAC6C;AAACC,MAAAA,MAAM,EAAE;AAAT,KAD7C;AAED,GAtDgC,CAwDjC;;;AACA,WAASG,iBAAT,CAA2B9J,GAA3B,EAAgC5/C,EAAhC,EAAoC;AAClC,QAAI2pD,UAAU,GAAG/J,GAAG,CAACG,WAAJ,CAAgBrB,WAAhB,CAAjB;AACA,QAAI8C,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAf;AACA,QAAIgC,QAAQ,GAAGT,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAf;AAEA,QAAIsC,MAAM,GAAGY,QAAQ,CAACX,UAAT,EAAb;;AACAD,IAAAA,MAAM,CAACZ,SAAP,GAAmB,UAAUr0C,KAAV,EAAiB;AAClC,UAAIi1C,MAAM,GAAGj1C,KAAK,CAACmG,MAAN,CAAalQ,MAA1B;;AACA,UAAIg/C,MAAJ,EAAY;AACV,YAAIle,QAAQ,GAAGke,MAAM,CAACz9C,KAAtB;AACA,YAAI4zB,KAAK,GAAG2L,QAAQ,CAAC9+B,EAArB;AACA,YAAIgmD,KAAK,GAAGviB,SAAS,CAACtQ,KAAD,CAArB;AACA,YAAImT,MAAM,GAAGzH,UAAU,CAACC,QAAD,CAAvB;;AACA,YAAIknB,KAAJ,EAAW;AACT,cAAIjB,QAAQ,GAAG5xB,KAAK,GAAG,IAAR,GAAemT,MAA9B,CADS,CAET;AACA;;AACA,cAAItrB,KAAK,GAAGmY,KAAK,GAAG,IAApB;AACA,cAAIvb,GAAG,GAAGub,KAAK,GAAG,KAAlB;AACA,cAAI/Q,KAAK,GAAGq6B,QAAQ,CAACr6B,KAAT,CAAe,aAAf,CAAZ;AACA,cAAI8S,KAAK,GAAG4nB,WAAW,CAACC,KAAZ,CAAkB/hC,KAAlB,EAAyBpD,GAAzB,EAA8B,KAA9B,EAAqC,KAArC,CAAZ;AACA,cAAIquC,SAAS,GAAG7jC,KAAK,CAAC66B,UAAN,CAAiB/nB,KAAjB,CAAhB;;AACA+wB,UAAAA,SAAS,CAAC7J,SAAV,GAAsB,UAAU5/C,CAAV,EAAa;AACjCypD,YAAAA,SAAS,GAAGzpD,CAAC,CAAC0R,MAAF,CAASlQ,MAArB;;AACA,gBAAI,CAACioD,SAAL,EAAgB;AACd;AACArI,cAAAA,QAAQ,CAACrvB,MAAT,CAAgByuB,MAAM,CAACI,UAAvB;AACAJ,cAAAA,MAAM,CAACK,QAAP;AACD,aAJD,MAIO;AACL,kBAAIp+C,IAAI,GAAGgnD,SAAS,CAAC1mD,KAArB;;AACA,kBAAIN,IAAI,CAACy8C,WAAL,KAAqBqJ,QAAzB,EAAmC;AACjCgB,gBAAAA,UAAU,CAACxrB,GAAX,CAAet7B,IAAf;AACD;;AACDw9C,cAAAA,QAAQ,CAACluB,MAAT,CAAgB03B,SAAS,CAAC7I,UAA1B;AACA6I,cAAAA,SAAS,CAAC5I,QAAV;AACD;AACF,WAdD;AAeD,SAxBD,MAwBO;AACLL,UAAAA,MAAM,CAACK,QAAP;AACD;AACF,OAhCD,MAgCO,IAAIjhD,EAAJ,EAAQ;AACbA,QAAAA,EAAE;AACH;AACF,KArCD;AAsCD,GArGgC,CAuGjC;;;AACA,WAAS8pD,oBAAT,CAA8Bn0B,EAA9B,EAAkC;AAChC,QAAI4qB,cAAc,GAAG5qB,EAAE,CAACwzB,iBAAH,CAAqB3K,oBAArB,EACnB;AAAC6K,MAAAA,aAAa,EAAE;AAAhB,KADmB,CAArB;AAEA9I,IAAAA,cAAc,CAAC+I,WAAf,CAA2B,KAA3B,EAAkC,KAAlC;AACA/I,IAAAA,cAAc,CAAC+I,WAAf,CAA2B,WAA3B,EAAwC,WAAxC,EAAqD;AAACC,MAAAA,MAAM,EAAE;AAAT,KAArD;AACD,GA7GgC,CA+GjC;;;AACA,WAASQ,kBAAT,CAA4BnK,GAA5B,EAAiCprB,QAAjC,EAA2C;AACzC,QAAI6rB,QAAQ,GAAGT,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAf;AACA,QAAIgC,QAAQ,GAAGV,GAAG,CAACG,WAAJ,CAAgBxB,YAAhB,CAAf;AACA,QAAIgC,cAAc,GAAGX,GAAG,CAACG,WAAJ,CAAgBvB,oBAAhB,CAArB,CAHyC,CAKzC;AACA;AACA;;AACA,QAAIljB,GAAG,GAAGglB,QAAQ,CAACtyB,KAAT,EAAV;;AACAsN,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,UAAI4tB,KAAK,GAAG5tB,CAAC,CAAC0R,MAAF,CAASlQ,MAArB;;AACA,UAAI,CAACosB,KAAL,EAAY;AACV,eAAOwG,QAAQ,EAAf,CADU,CACS;AACpB;;AAED6rB,MAAAA,QAAQ,CAACQ,UAAT,GAAsBb,SAAtB,GAAkC,UAAU5/C,CAAV,EAAa;AAC7C,YAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,YAAI,CAACg/C,MAAL,EAAa;AACX,iBAAOpsB,QAAQ,EAAf,CADW,CACQ;AACpB;;AACD,YAAI6G,GAAG,GAAGulB,MAAM,CAACz9C,KAAjB;AACA,YAAIg1B,GAAG,GAAGyoB,MAAM,CAACI,UAAjB;AACA,YAAIvX,IAAI,GAAG/oC,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAJ,IAAoB,EAAhC,CAAX;AACA,YAAI+tB,SAAS,GAAG,EAAhB;;AACA,aAAK,IAAIr0C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8zB,IAAI,CAACrqC,MAAzB,EAAiCuW,CAAC,EAAlC,EAAsC;AACpC,cAAIqmB,GAAG,GAAGX,GAAG,CAACY,YAAJ,CAAiBwN,IAAI,CAAC9zB,CAAD,CAArB,CAAV;AACAq0C,UAAAA,SAAS,CAAChuB,GAAG,CAAC8f,MAAL,CAAT,GAAwB,IAAxB,CAFoC,CAEN;AAC/B;;AACD,YAAIsH,OAAO,GAAG1iD,MAAM,CAACoC,IAAP,CAAYknD,SAAZ,CAAd;;AACA,aAAKr0C,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGytC,OAAO,CAAChkD,MAAxB,EAAgCuW,CAAC,EAAjC,EAAqC;AACnC,cAAImmC,MAAM,GAAGsH,OAAO,CAACztC,CAAD,CAApB;AACA4qC,UAAAA,cAAc,CAACpiB,GAAf,CAAmB;AACjBhG,YAAAA,GAAG,EAAEA,GADY;AAEjB4oB,YAAAA,SAAS,EAAEjF,MAAM,GAAG,IAAT,GAAgB3jB;AAFV,WAAnB;AAID;;AACDyoB,QAAAA,MAAM,CAACK,QAAP;AACD,OAtBD;AAuBD,KA7BD;AA8BD,GAvJgC,CAyJjC;AACA;AACA;AACA;AACA;AACA;;;AACA,WAASgJ,eAAT,CAAyBrK,GAAzB,EAA8B;AAE5B,aAASsK,oBAAT,CAA8B9K,YAA9B,EAA4C;AAC1C,UAAI,CAACA,YAAY,CAACv8C,IAAlB,EAAwB;AACtB;AACAu8C,QAAAA,YAAY,CAAChc,OAAb,GAAuBgc,YAAY,CAACF,cAAb,KAAgC,GAAvD;AACA,eAAOE,YAAP;AACD;;AACD,aAAOD,cAAc,CAACC,YAAD,CAArB;AACD,KAT2B,CAW5B;AACA;;;AACA,QAAIqC,UAAU,GAAG7B,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAjB;AACA,QAAIkD,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAf;AACA,QAAIuC,MAAM,GAAGY,QAAQ,CAACX,UAAT,EAAb;;AACAD,IAAAA,MAAM,CAACZ,SAAP,GAAmB,UAAU5/C,CAAV,EAAa;AAC9B,UAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,UAAI,CAACg/C,MAAL,EAAa;AACX,eADW,CACH;AACT;;AACD,UAAIle,QAAQ,GAAGwnB,oBAAoB,CAACtJ,MAAM,CAACz9C,KAAR,CAAnC;AAEAu/B,MAAAA,QAAQ,CAACD,UAAT,GAAsBC,QAAQ,CAACD,UAAT,IACpBA,UAAU,CAACC,QAAD,CADZ;;AAGA,eAASynB,gBAAT,GAA4B;AAC1B;AACA;AACA,YAAIvrC,KAAK,GAAG8jB,QAAQ,CAAC9+B,EAAT,GAAc,IAA1B;AACA,YAAI4X,GAAG,GAAGknB,QAAQ,CAAC9+B,EAAT,GAAc,UAAxB;AACA,YAAI03B,GAAG,GAAGmmB,UAAU,CAACz7B,KAAX,CAAiB,aAAjB,EAAgC66B,UAAhC,CACRH,WAAW,CAACC,KAAZ,CAAkB/hC,KAAlB,EAAyBpD,GAAzB,CADQ,CAAV;AAGA,YAAI4uC,WAAW,GAAG,CAAlB;;AACA9uB,QAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,cAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,cAAI,CAACg/C,MAAL,EAAa;AACXle,YAAAA,QAAQ,CAACvK,GAAT,GAAeiyB,WAAf;AACA,mBAAOC,gBAAgB,EAAvB;AACD;;AACD,cAAIlyB,GAAG,GAAGyoB,MAAM,CAACI,UAAjB;;AACA,cAAI7oB,GAAG,GAAGiyB,WAAV,EAAuB;AACrBA,YAAAA,WAAW,GAAGjyB,GAAd;AACD;;AACDyoB,UAAAA,MAAM,CAACK,QAAP;AACD,SAXD;AAYD;;AAED,eAASoJ,gBAAT,GAA4B;AAC1B,YAAIxG,eAAe,GAAG5E,cAAc,CAACvc,QAAD,EAClCA,QAAQ,CAACD,UADyB,EACbC,QAAQ,CAACU,OADI,CAApC;AAGA,YAAI9H,GAAG,GAAGkmB,QAAQ,CAACrjB,GAAT,CAAa0lB,eAAb,CAAV;;AACAvoB,QAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,YAAY;AAC1BY,UAAAA,MAAM,CAACK,QAAP;AACD,SAFD;AAGD;;AAED,UAAIve,QAAQ,CAACvK,GAAb,EAAkB;AAChB,eAAOkyB,gBAAgB,EAAvB;AACD;;AAEDF,MAAAA,gBAAgB;AACjB,KAhDD;AAkDD;;AAEDte,EAAAA,GAAG,CAACtP,OAAJ,GAAc,KAAd;;AACAsP,EAAAA,GAAG,CAACtnC,IAAJ,GAAW,YAAY;AACrB,WAAO,KAAP;AACD,GAFD;;AAIAsnC,EAAAA,GAAG,CAAC5N,GAAJ,GAAU9J,SAAS,CAAC,UAAUK,QAAV,EAAoB;AACtCA,IAAAA,QAAQ,CAAC,IAAD,EAAOqX,GAAG,CAACqW,KAAJ,CAAUoI,UAAjB,CAAR;AACD,GAFkB,CAAnB;;AAIAze,EAAAA,GAAG,CAACsD,SAAJ,GAAgB,SAASob,YAAT,CAAsBjvB,GAAtB,EAA2BkvB,OAA3B,EAAoCh2B,QAApC,EAA8C;AAC5D+sB,IAAAA,WAAW,CAAC3rB,IAAD,EAAO0F,GAAP,EAAYkvB,OAAZ,EAAqB3e,GAArB,EAA0BsV,GAA1B,EAA+B3sB,QAA/B,CAAX;AACD,GAFD,CA5OiC,CAgPjC;AACA;;;AACAqX,EAAAA,GAAG,CAAC6B,IAAJ,GAAW,SAAS+c,OAAT,CAAiB7mD,EAAjB,EAAqBgyB,IAArB,EAA2BpB,QAA3B,EAAqC;AAC9C,QAAI6G,GAAJ;AACA,QAAIqH,QAAJ;AACA,QAAIzzB,GAAJ;AACA,QAAI2wC,GAAG,GAAGhqB,IAAI,CAAC4N,GAAf;;AACA,QAAI,CAACoc,GAAL,EAAU;AACR,UAAIyC,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EACnC,CAAC9C,SAAD,EAAYC,YAAZ,EAA0BC,YAA1B,CADmC,EACM,UADN,CAArC;;AAEA,UAAI8D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,eAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD+0C,MAAAA,GAAG,GAAGyC,SAAS,CAACzC,GAAhB;AACD;;AAED,aAASuD,MAAT,GAAkB;AAChB3uB,MAAAA,QAAQ,CAACvlB,GAAD,EAAM;AAACosB,QAAAA,GAAG,EAAEA,GAAN;AAAWqH,QAAAA,QAAQ,EAAEA,QAArB;AAA+Bc,QAAAA,GAAG,EAAEoc;AAApC,OAAN,CAAR;AACD;;AAEDA,IAAAA,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,EAA2Bz9C,GAA3B,CAA+BgD,EAA/B,EAAmCo8C,SAAnC,GAA+C,UAAU5/C,CAAV,EAAa;AAC1DsiC,MAAAA,QAAQ,GAAGyc,cAAc,CAAC/+C,CAAC,CAAC0R,MAAF,CAASlQ,MAAV,CAAzB,CAD0D,CAE1D;AACA;AACA;AACA;AACA;;AACA,UAAI,CAAC8gC,QAAL,EAAe;AACbzzB,QAAAA,GAAG,GAAGgsB,WAAW,CAACtB,WAAD,EAAc,SAAd,CAAjB;AACA,eAAOwpB,MAAM,EAAb;AACD;;AAED,UAAIjZ,MAAJ;;AACA,UAAI,CAACtU,IAAI,CAACwB,GAAV,EAAe;AACb8S,QAAAA,MAAM,GAAGxH,QAAQ,CAACD,UAAlB;AACA,YAAIW,OAAO,GAAGgE,SAAS,CAAC1E,QAAD,CAAvB;;AACA,YAAIU,OAAJ,EAAa;AACXn0B,UAAAA,GAAG,GAAGgsB,WAAW,CAACtB,WAAD,EAAc,SAAd,CAAjB;AACA,iBAAOwpB,MAAM,EAAb;AACD;AACF,OAPD,MAOO;AACLjZ,QAAAA,MAAM,GAAGtU,IAAI,CAAC0R,MAAL,GAAcA,MAAM,CAAC1R,IAAI,CAACwB,GAAN,EAAWsL,QAAX,CAApB,GAA2C9M,IAAI,CAACwB,GAAzD;AACD;;AAED,UAAI2oB,WAAW,GAAGH,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,CAAlB;AACA,UAAIr7C,GAAG,GAAGy/B,QAAQ,CAAC9+B,EAAT,GAAc,IAAd,GAAqBsmC,MAA/B;;AAEA6V,MAAAA,WAAW,CAAC/5B,KAAZ,CAAkB,aAAlB,EAAiCplB,GAAjC,CAAqCqC,GAArC,EAA0C+8C,SAA1C,GAAsD,UAAU5/C,CAAV,EAAa;AACjEi7B,QAAAA,GAAG,GAAGj7B,CAAC,CAAC0R,MAAF,CAASlQ,MAAf;;AACA,YAAIy5B,GAAJ,EAAS;AACPA,UAAAA,GAAG,GAAGgkB,SAAS,CAAChkB,GAAD,CAAf;AACD;;AACD,YAAI,CAACA,GAAL,EAAU;AACRpsB,UAAAA,GAAG,GAAGgsB,WAAW,CAACtB,WAAD,EAAc,SAAd,CAAjB;AACA,iBAAOwpB,MAAM,EAAb;AACD;;AACDA,QAAAA,MAAM;AACP,OAVD;AAWD,KAtCD;AAuCD,GAzDD;;AA2DAtX,EAAAA,GAAG,CAACuC,cAAJ,GAAqB,UAAUrX,KAAV,EAAiB2zB,QAAjB,EAA2BC,UAA3B,EAAuC/0B,IAAvC,EAA6CpB,QAA7C,EAAuD;AAC1E,QAAIorB,GAAJ;;AACA,QAAIhqB,IAAI,CAAC4N,GAAT,EAAc;AACZoc,MAAAA,GAAG,GAAGhqB,IAAI,CAAC4N,GAAX;AACD,KAFD,MAEO;AACL,UAAI6e,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EACnC,CAAC9C,SAAD,EAAYC,YAAZ,EAA0BC,YAA1B,CADmC,EACM,UADN,CAArC;;AAEA,UAAI8D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,eAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD+0C,MAAAA,GAAG,GAAGyC,SAAS,CAACzC,GAAhB;AACD;;AACD,QAAI9D,MAAM,GAAG6O,UAAU,CAAC7O,MAAxB;AACA,QAAIv3C,IAAI,GAAGomD,UAAU,CAAC3e,YAAtB;;AAEA4T,IAAAA,GAAG,CAACG,WAAJ,CAAgBxB,YAAhB,EAA8B39C,GAA9B,CAAkCk7C,MAAlC,EAA0CkE,SAA1C,GAAsD,UAAU5/C,CAAV,EAAa;AACjE,UAAIq/C,IAAI,GAAGr/C,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgB69C,IAA3B;AACAD,MAAAA,YAAY,CAACC,IAAD,EAAOl7C,IAAP,EAAaqxB,IAAI,CAACgK,MAAlB,EAA0B,UAAUgrB,QAAV,EAAoB;AACxDp2B,QAAAA,QAAQ,CAAC,IAAD,EAAOo2B,QAAP,CAAR;AACD,OAFW,CAAZ;AAGD,KALD;AAMD,GArBD;;AAuBA/e,EAAAA,GAAG,CAACiD,KAAJ,GAAY,SAAS+b,QAAT,CAAkBr2B,QAAlB,EAA4B;AACtC,QAAIgyB,SAAJ;AACA,QAAIzD,QAAJ;AAEA,QAAIV,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAM,CAAC1C,UAAD,EAAaH,YAAb,CAAN,EAAkC,UAAlC,CAArC;;AACA,QAAI+D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,aAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD,QAAI+0C,GAAG,GAAGyC,SAAS,CAACzC,GAApB;;AACAA,IAAAA,GAAG,CAACG,WAAJ,CAAgBtB,UAAhB,EAA4B79C,GAA5B,CAAgC69C,UAAhC,EAA4CuB,SAA5C,GAAwD,UAAU5/C,CAAV,EAAa;AACnE2iD,MAAAA,QAAQ,GAAG3iD,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,CAAgBmhD,QAA3B;AACD,KAFD;;AAGAnD,IAAAA,GAAG,CAACG,WAAJ,CAAgBzB,YAAhB,EAA8BuC,UAA9B,CAAyC,IAAzC,EAA+C,MAA/C,EAAuDb,SAAvD,GAAmE,UAAU5/C,CAAV,EAAa;AAC9E,UAAIwgD,MAAM,GAAGxgD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;AACA4kD,MAAAA,SAAS,GAAG5F,MAAM,GAAGA,MAAM,CAAC39C,GAAV,GAAgB,CAAlC;AACD,KAHD;;AAKA28C,IAAAA,GAAG,CAAC4C,UAAJ,GAAiB,YAAY;AAC3BhuB,MAAAA,QAAQ,CAAC,IAAD,EAAO;AACbs2B,QAAAA,SAAS,EAAE/H,QADE;AAEbna,QAAAA,UAAU,EAAE4d,SAFC;AAGb;AACAuE,QAAAA,qBAAqB,EAAGlf,GAAG,CAACqW,KAAJ,CAAUC,WAAV,GAAwB,QAAxB,GAAmC;AAJ9C,OAAP,CAAR;AAMD,KAPD;AAQD,GAzBD;;AA2BAtW,EAAAA,GAAG,CAAC+C,QAAJ,GAAe,SAASoc,WAAT,CAAqBp1B,IAArB,EAA2BpB,QAA3B,EAAqC;AAClD2xB,IAAAA,UAAU,CAACvwB,IAAD,EAAOurB,GAAP,EAAY3sB,QAAZ,CAAV;AACD,GAFD;;AAIAqX,EAAAA,GAAG,CAAC3C,QAAJ,GAAe,SAAS+hB,UAAT,CAAoBr1B,IAApB,EAA0B;AACvC,WAAOsC,OAAO,CAACtC,IAAD,EAAOiW,GAAP,EAAY/T,MAAZ,EAAoBqpB,GAApB,CAAd;AACD,GAFD;;AAIAtV,EAAAA,GAAG,CAACgD,MAAJ,GAAa,UAAUra,QAAV,EAAoB;AAC/B;AACA;AACA2sB,IAAAA,GAAG,CAAC3gC,KAAJ;AACAqoC,IAAAA,SAAS,CAAC12B,MAAV,CAAiB2F,MAAjB;AACAtD,IAAAA,QAAQ;AACT,GAND;;AAQAqX,EAAAA,GAAG,CAACgB,gBAAJ,GAAuB,UAAU9V,KAAV,EAAiBvC,QAAjB,EAA2B;AAChD,QAAI6tB,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAM,CAAC9C,SAAD,CAAN,EAAmB,UAAnB,CAArC;;AACA,QAAIgE,SAAS,CAACx3C,KAAd,EAAqB;AACnB,aAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD,QAAI+0C,GAAG,GAAGyC,SAAS,CAACzC,GAApB;AACA,QAAItkB,GAAG,GAAGskB,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,EAA2Bz9C,GAA3B,CAA+Bm2B,KAA/B,CAAV;;AACAuE,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAUr0C,KAAV,EAAiB;AAC/B,UAAI0vB,GAAG,GAAG8jB,cAAc,CAACxzC,KAAK,CAACmG,MAAN,CAAalQ,MAAd,CAAxB;;AACA,UAAI,CAACy5B,GAAL,EAAU;AACR7G,QAAAA,QAAQ,CAACyG,WAAW,CAACtB,WAAD,CAAZ,CAAR;AACD,OAFD,MAEO;AACLnF,QAAAA,QAAQ,CAAC,IAAD,EAAO6G,GAAG,CAAC0H,QAAX,CAAR;AACD;AACF,KAPD;AAQD,GAfD,CA/WiC,CAgYjC;AACA;AACA;;;AACA8I,EAAAA,GAAG,CAACqB,aAAJ,GAAoB,UAAUnW,KAAV,EAAiBuM,IAAjB,EAAuB9O,QAAvB,EAAiC;AACnD,QAAI4sB,MAAM,GAAG,CACX/C,SADW,EAEXC,YAFW,EAGXC,YAHW,EAIXC,oBAJW,CAAb;AAMA,QAAI6D,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAMC,MAAN,EAAc,WAAd,CAArC;;AACA,QAAIiB,SAAS,CAACx3C,KAAd,EAAqB;AACnB,aAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD,QAAI+0C,GAAG,GAAGyC,SAAS,CAACzC,GAApB;AAEA,QAAI4B,QAAQ,GAAG5B,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,CAAf;;AAEAmD,IAAAA,QAAQ,CAAC5gD,GAAT,CAAam2B,KAAb,EAAoBipB,SAApB,GAAgC,UAAUr0C,KAAV,EAAiB;AAC/C,UAAI+2B,QAAQ,GAAGyc,cAAc,CAACxzC,KAAK,CAACmG,MAAN,CAAalQ,MAAd,CAA7B;AACAyhC,MAAAA,eAAe,CAACX,QAAQ,CAACK,QAAV,EAAoB,UAAUa,MAAV,EAAkB1kC,GAAlB,EACgBmlC,OADhB,EACyBb,GADzB,EAC8B5N,IAD9B,EACoC;AACrE,YAAIsU,MAAM,GAAGhrC,GAAG,GAAG,GAAN,GAAYmlC,OAAzB;;AACA,YAAIf,IAAI,CAACx2B,OAAL,CAAao9B,MAAb,MAAyB,CAAC,CAA9B,EAAiC;AAC/BtU,UAAAA,IAAI,CAACqD,MAAL,GAAc,SAAd;AACD;AACF,OANc,CAAf;AAOAknB,MAAAA,WAAW,CAAC7c,IAAD,EAAOvM,KAAP,EAAc6oB,GAAd,CAAX;AACA,UAAI1C,aAAa,GAAGxa,QAAQ,CAACD,UAA7B;AACA,UAAIW,OAAO,GAAGV,QAAQ,CAACU,OAAvB;AACAwc,MAAAA,GAAG,CAACG,WAAJ,CAAgB1B,SAAhB,EAA2BlgB,GAA3B,CACE8gB,cAAc,CAACvc,QAAD,EAAWwa,aAAX,EAA0B9Z,OAA1B,CADhB;AAED,KAdD;;AAeAwc,IAAAA,GAAG,CAAC0C,OAAJ,GAActD,QAAQ,CAACxqB,QAAD,CAAtB;;AACAorB,IAAAA,GAAG,CAAC4C,UAAJ,GAAiB,YAAY;AAC3BhuB,MAAAA,QAAQ;AACT,KAFD;AAGD,GAlCD;;AAqCAqX,EAAAA,GAAG,CAAC2B,SAAJ,GAAgB,UAAU5pC,EAAV,EAAc4wB,QAAd,EAAwB;AACtC,QAAI6tB,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAM,CAACzC,WAAD,CAAN,EAAqB,UAArB,CAArC;;AACA,QAAI2D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,aAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD,QAAI4yC,EAAE,GAAG4E,SAAS,CAACzC,GAAnB;AACA,QAAItkB,GAAG,GAAGmiB,EAAE,CAACsC,WAAH,CAAerB,WAAf,EAA4B99C,GAA5B,CAAgCgD,EAAhC,CAAV;AAEA03B,IAAAA,GAAG,CAACpe,OAAJ,GAAc8hC,QAAQ,CAACxqB,QAAD,CAAtB;;AACA8G,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,UAAIi7B,GAAG,GAAGj7B,CAAC,CAAC0R,MAAF,CAASlQ,MAAnB;;AACA,UAAI,CAACy5B,GAAL,EAAU;AACR7G,QAAAA,QAAQ,CAACyG,WAAW,CAACtB,WAAD,CAAZ,CAAR;AACD,OAFD,MAEO;AACL,eAAO0B,GAAG,CAAC,aAAD,CAAV,CADK,CACsB;;AAC3B7G,QAAAA,QAAQ,CAAC,IAAD,EAAO6G,GAAP,CAAR;AACD;AACF,KARD;AASD,GAlBD;;AAoBAwQ,EAAAA,GAAG,CAACb,SAAJ,GAAgB,UAAU3P,GAAV,EAAezF,IAAf,EAAqBpB,QAArB,EAA+B;AAC7C,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACD,WAAOyF,GAAG,CAACwO,UAAX,CAL6C,CAKtB;;AACvB,QAAIqhB,MAAM,GAAG7vB,GAAG,CAACyC,IAAjB;AACA,QAAIl6B,EAAE,GAAGy3B,GAAG,CAAC4C,GAAb;;AACA,QAAI,CAACitB,MAAL,EAAa;AACX7vB,MAAAA,GAAG,CAACyC,IAAJ,GAAW,KAAX;AACD,KAFD,MAEO;AACLzC,MAAAA,GAAG,CAACyC,IAAJ,GAAW,QAAQz+B,QAAQ,CAAC6rD,MAAM,CAACjsC,KAAP,CAAa,GAAb,EAAkB,CAAlB,CAAD,EAAuB,EAAvB,CAAR,GAAqC,CAA7C,CAAX;AACD;;AAED,QAAIw+B,EAAE,GAAG7nB,IAAI,CAAC4N,GAAd;AACA,QAAI3T,GAAJ;;AACA,QAAI,CAAC4tB,EAAL,EAAS;AACP,UAAI4E,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAM,CAACzC,WAAD,CAAN,EAAqB,WAArB,CAArC;;AACA,UAAI2D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,eAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD4yC,MAAAA,EAAE,GAAG4E,SAAS,CAACzC,GAAf;AACAnC,MAAAA,EAAE,CAACvgC,OAAH,GAAa8hC,QAAQ,CAACxqB,QAAD,CAArB;;AACAipB,MAAAA,EAAE,CAAC+E,UAAH,GAAgB,YAAY;AAC1B,YAAI3yB,GAAJ,EAAS;AACP2E,UAAAA,QAAQ,CAAC,IAAD,EAAO3E,GAAP,CAAR;AACD;AACF,OAJD;AAKD;;AAED,QAAIs7B,MAAM,GAAG1N,EAAE,CAACsC,WAAH,CAAerB,WAAf,CAAb;AACA,QAAIpjB,GAAJ;;AACA,QAAI4vB,MAAJ,EAAY;AACV5vB,MAAAA,GAAG,GAAG6vB,MAAM,CAACvqD,GAAP,CAAWgD,EAAX,CAAN;;AACA03B,MAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,YAAIgrD,MAAM,GAAGhrD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,YAAI,CAACwpD,MAAD,IAAWA,MAAM,CAACttB,IAAP,KAAgBotB,MAA/B,EAAuC;AACrC12B,UAAAA,QAAQ,CAACyG,WAAW,CAACrB,YAAD,CAAZ,CAAR;AACD,SAFD,MAEO;AAAE;AACP,cAAI0B,GAAG,GAAG6vB,MAAM,CAAChtB,GAAP,CAAW9C,GAAX,CAAV;;AACAC,UAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,YAAY;AAC1BnwB,YAAAA,GAAG,GAAG;AAAC4F,cAAAA,EAAE,EAAE,IAAL;AAAW7xB,cAAAA,EAAE,EAAEy3B,GAAG,CAAC4C,GAAnB;AAAwB7G,cAAAA,GAAG,EAAEiE,GAAG,CAACyC;AAAjC,aAAN;;AACA,gBAAIlI,IAAI,CAAC4N,GAAT,EAAc;AAAE;AACdhP,cAAAA,QAAQ,CAAC,IAAD,EAAO3E,GAAP,CAAR;AACD;AACF,WALD;AAMD;AACF,OAbD;AAcD,KAhBD,MAgBO;AAAE;AACPyL,MAAAA,GAAG,GAAG6vB,MAAM,CAAC54B,GAAP,CAAW8I,GAAX,CAAN;;AACAC,MAAAA,GAAG,CAACpe,OAAJ,GAAc,UAAU9c,CAAV,EAAa;AACzB;AACAo0B,QAAAA,QAAQ,CAACyG,WAAW,CAACrB,YAAD,CAAZ,CAAR;AACAx5B,QAAAA,CAAC,CAAC6jD,cAAF,GAHyB,CAGL;;AACpB7jD,QAAAA,CAAC,CAAC8jD,eAAF,GAJyB,CAIJ;AACtB,OALD;;AAMA5oB,MAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,YAAY;AAC1BnwB,QAAAA,GAAG,GAAG;AAAC4F,UAAAA,EAAE,EAAE,IAAL;AAAW7xB,UAAAA,EAAE,EAAEy3B,GAAG,CAAC4C,GAAnB;AAAwB7G,UAAAA,GAAG,EAAEiE,GAAG,CAACyC;AAAjC,SAAN;;AACA,YAAIlI,IAAI,CAAC4N,GAAT,EAAc;AAAE;AACdhP,UAAAA,QAAQ,CAAC,IAAD,EAAO3E,GAAP,CAAR;AACD;AACF,OALD;AAMD;AACF,GA/DD;;AAiEAgc,EAAAA,GAAG,CAACZ,YAAJ,GAAmB,UAAU5P,GAAV,EAAezF,IAAf,EAAqBpB,QAArB,EAA+B;AAChD,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACD,QAAI6nB,EAAE,GAAG7nB,IAAI,CAAC4N,GAAd;;AACA,QAAI,CAACia,EAAL,EAAS;AACP,UAAI4E,SAAS,GAAGnB,qBAAqB,CAACC,GAAD,EAAM,CAACzC,WAAD,CAAN,EAAqB,WAArB,CAArC;;AACA,UAAI2D,SAAS,CAACx3C,KAAd,EAAqB;AACnB,eAAO2pB,QAAQ,CAAC6tB,SAAS,CAACx3C,KAAX,CAAf;AACD;;AACD4yC,MAAAA,EAAE,GAAG4E,SAAS,CAACzC,GAAf;;AACAnC,MAAAA,EAAE,CAAC+E,UAAH,GAAgB,YAAY;AAC1B,YAAI3yB,GAAJ,EAAS;AACP2E,UAAAA,QAAQ,CAAC,IAAD,EAAO3E,GAAP,CAAR;AACD;AACF,OAJD;AAKD;;AACD,QAAIA,GAAJ;AACA,QAAIjsB,EAAE,GAAGy3B,GAAG,CAAC4C,GAAb;AACA,QAAIktB,MAAM,GAAG1N,EAAE,CAACsC,WAAH,CAAerB,WAAf,CAAb;AACA,QAAIpjB,GAAG,GAAG6vB,MAAM,CAACvqD,GAAP,CAAWgD,EAAX,CAAV;AAEA03B,IAAAA,GAAG,CAACpe,OAAJ,GAAc8hC,QAAQ,CAACxqB,QAAD,CAAtB;;AACA8G,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAC3B,UAAIgrD,MAAM,GAAGhrD,CAAC,CAAC0R,MAAF,CAASlQ,MAAtB;;AACA,UAAI,CAACwpD,MAAD,IAAWA,MAAM,CAACttB,IAAP,KAAgBzC,GAAG,CAACyC,IAAnC,EAAyC;AACvCtJ,QAAAA,QAAQ,CAACyG,WAAW,CAACtB,WAAD,CAAZ,CAAR;AACD,OAFD,MAEO;AACLwxB,QAAAA,MAAM,CAACh5B,MAAP,CAAcvuB,EAAd;AACAisB,QAAAA,GAAG,GAAG;AAAC4F,UAAAA,EAAE,EAAE,IAAL;AAAW7xB,UAAAA,EAAE,EAAEA,EAAf;AAAmBwzB,UAAAA,GAAG,EAAE;AAAxB,SAAN;;AACA,YAAIxB,IAAI,CAAC4N,GAAT,EAAc;AAAE;AACdhP,UAAAA,QAAQ,CAAC,IAAD,EAAO3E,GAAP,CAAR;AACD;AACF;AACF,KAXD;AAYD,GApCD;;AAsCAgc,EAAAA,GAAG,CAAC+D,QAAJ,GAAe,UAAUha,IAAV,EAAgBpB,QAAhB,EAA0B;AACvC4lB,IAAAA,cAAc,CAACnrB,kBAAf,CAAkC6I,MAAlC,EADuC,CAGvC;;AACA,QAAIuzB,OAAO,GAAGtC,WAAW,CAACnoD,GAAZ,CAAgBk3B,MAAhB,CAAd;;AACA,QAAIuzB,OAAO,IAAIA,OAAO,CAACzpD,MAAvB,EAA+B;AAC7BypD,MAAAA,OAAO,CAACzpD,MAAR,CAAe4e,KAAf;AACAqoC,MAAAA,SAAS,CAAC12B,MAAV,CAAiB2F,MAAjB;AACD;;AACD,QAAIwD,GAAG,GAAGgwB,SAAS,CAACC,cAAV,CAAyBzzB,MAAzB,CAAV;;AAEAwD,IAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,YAAY;AAC1B;AACA+I,MAAAA,WAAW,CAAC52B,MAAZ,CAAmB2F,MAAnB;;AACA,UAAIH,eAAe,MAAOG,MAAM,IAAIN,YAApC,EAAmD;AACjD,eAAOA,YAAY,CAACM,MAAD,CAAnB;AACD;;AACDtD,MAAAA,QAAQ,CAAC,IAAD,EAAO;AAAE,cAAM;AAAR,OAAP,CAAR;AACD,KAPD;;AASA8G,IAAAA,GAAG,CAACpe,OAAJ,GAAc8hC,QAAQ,CAACxqB,QAAD,CAAtB;AACD,GArBD;;AAuBA,MAAIg3B,MAAM,GAAG3C,SAAS,CAACjoD,GAAV,CAAck3B,MAAd,CAAb;;AAEA,MAAI0zB,MAAJ,EAAY;AACVrK,IAAAA,GAAG,GAAGqK,MAAM,CAACrK,GAAb;AACAtV,IAAAA,GAAG,CAACqW,KAAJ,GAAYsJ,MAAM,CAAC7qB,MAAnB;AACA,WAAO,wBAAU,YAAY;AAC3BnM,MAAAA,QAAQ,CAAC,IAAD,EAAOqX,GAAP,CAAR;AACD,KAFM,CAAP;AAGD;;AAED,MAAIvQ,GAAG,GAAGgwB,SAAS,CAACG,IAAV,CAAe3zB,MAAf,EAAuBsmB,eAAvB,CAAV;AACA2K,EAAAA,WAAW,CAACloD,GAAZ,CAAgBi3B,MAAhB,EAAwBwD,GAAxB;;AAEAA,EAAAA,GAAG,CAACowB,eAAJ,GAAsB,UAAUtrD,CAAV,EAAa;AACjC,QAAIu1B,EAAE,GAAGv1B,CAAC,CAAC0R,MAAF,CAASlQ,MAAlB;;AACA,QAAIxB,CAAC,CAACurD,UAAF,GAAe,CAAnB,EAAsB;AACpB,aAAOzC,YAAY,CAACvzB,EAAD,CAAnB,CADoB,CACK;AAC1B,KAJgC,CAKjC;;;AAEA,QAAIiqB,GAAG,GAAGx/C,CAAC,CAACwrD,aAAF,CAAgBtK,WAA1B,CAPiC,CAQjC;AACA;;AAEA,QAAIlhD,CAAC,CAACurD,UAAF,GAAe,CAAnB,EAAsB;AACpBlC,MAAAA,sBAAsB,CAAC9zB,EAAD,CAAtB,CADoB,CACQ;AAC7B;;AACD,QAAIv1B,CAAC,CAACurD,UAAF,GAAe,CAAnB,EAAsB;AACpB7B,MAAAA,oBAAoB,CAACn0B,EAAD,CAApB,CADoB,CACM;AAC3B;;AAED,QAAIk2B,UAAU,GAAG,CACfrC,sBADe,EACS;AACxBE,IAAAA,iBAFe,EAES;AACxBK,IAAAA,kBAHe,EAGS;AACxBE,IAAAA,eAJe,CAIS;AAJT,KAAjB;AAOA,QAAIv1C,CAAC,GAAGtU,CAAC,CAACurD,UAAV;;AAEA,aAAS9pB,IAAT,GAAgB;AACd,UAAIiqB,SAAS,GAAGD,UAAU,CAACn3C,CAAC,GAAG,CAAL,CAA1B;AACAA,MAAAA,CAAC;;AACD,UAAIo3C,SAAJ,EAAe;AACbA,QAAAA,SAAS,CAAClM,GAAD,EAAM/d,IAAN,CAAT;AACD;AACF;;AAEDA,IAAAA,IAAI;AACL,GApCD;;AAsCAvG,EAAAA,GAAG,CAAC0kB,SAAJ,GAAgB,UAAU5/C,CAAV,EAAa;AAE3B+gD,IAAAA,GAAG,GAAG/gD,CAAC,CAAC0R,MAAF,CAASlQ,MAAf;;AAEAu/C,IAAAA,GAAG,CAAC4K,eAAJ,GAAsB,YAAY;AAChC5K,MAAAA,GAAG,CAAC3gC,KAAJ;AACAqoC,MAAAA,SAAS,CAAC12B,MAAV,CAAiB2F,MAAjB;AACD,KAHD;;AAKAqpB,IAAAA,GAAG,CAACmB,OAAJ,GAAc,UAAUliD,CAAV,EAAa;AACzBq4B,MAAAA,cAAc,CAAC,OAAD,EAAU,+BAAV,EAA2Cr4B,CAAC,CAAC0R,MAAF,CAASjH,KAApD,CAAd;AACAs2C,MAAAA,GAAG,CAAC3gC,KAAJ;AACAqoC,MAAAA,SAAS,CAAC12B,MAAV,CAAiB2F,MAAjB;AACD,KAJD,CAT2B,CAe3B;AACA;AACA;AACA;AACA;AACA;;;AAEA,QAAI8nB,GAAG,GAAGuB,GAAG,CAACG,WAAJ,CAAgB,CACxB7C,UADwB,EAExBE,yBAFwB,EAGxBN,SAHwB,CAAhB,EAIP,WAJO,CAAV;AAMA,QAAI2N,aAAa,GAAG,KAApB;AACA,QAAIlK,OAAJ;AACA,QAAIiB,QAAJ;AACA,QAAIZ,WAAJ;AACA,QAAImI,UAAJ;;AAEA,aAAS2B,aAAT,GAAyB;AACvB,UAAI,OAAO9J,WAAP,KAAuB,WAAvB,IAAsC,CAAC6J,aAA3C,EAA0D;AACxD;AACD;;AACDngB,MAAAA,GAAG,CAACqW,KAAJ,GAAY;AACVp+C,QAAAA,IAAI,EAAEg0B,MADI;AAEVwyB,QAAAA,UAAU,EAAEA,UAFF;AAGVnI,QAAAA,WAAW,EAAEA;AAHH,OAAZ;AAMA0G,MAAAA,SAAS,CAAChoD,GAAV,CAAci3B,MAAd,EAAsB;AACpBqpB,QAAAA,GAAG,EAAEA,GADe;AAEpBxgB,QAAAA,MAAM,EAAEkL,GAAG,CAACqW;AAFQ,OAAtB;AAIA1tB,MAAAA,QAAQ,CAAC,IAAD,EAAOqX,GAAP,CAAR;AACD;;AAED,aAASqgB,mBAAT,GAA+B;AAC7B,UAAI,OAAOnJ,QAAP,KAAoB,WAApB,IAAmC,OAAOjB,OAAP,KAAmB,WAA1D,EAAuE;AACrE;AACD;;AACD,UAAIqK,WAAW,GAAGr0B,MAAM,GAAG,KAA3B;;AACA,UAAIq0B,WAAW,IAAIrK,OAAnB,EAA4B;AAC1BwI,QAAAA,UAAU,GAAGxI,OAAO,CAACqK,WAAD,CAApB;AACD,OAFD,MAEO;AACLrK,QAAAA,OAAO,CAACqK,WAAD,CAAP,GAAuB7B,UAAU,GAAG9nB,IAAI,EAAxC;AACD;;AACDsf,MAAAA,OAAO,CAACiB,QAAR,GAAmBA,QAAnB;AACAnD,MAAAA,GAAG,CAACG,WAAJ,CAAgBtB,UAAhB,EAA4BtgB,GAA5B,CAAgC2jB,OAAhC;AACD,KA/D0B,CAiE3B;AACA;AACA;;;AACAlC,IAAAA,GAAG,CAACG,WAAJ,CAAgBtB,UAAhB,EAA4B79C,GAA5B,CAAgC69C,UAAhC,EAA4CuB,SAA5C,GAAwD,UAAU5/C,CAAV,EAAa;AACnE0hD,MAAAA,OAAO,GAAG1hD,CAAC,CAAC0R,MAAF,CAASlQ,MAAT,IAAmB;AAAEgC,QAAAA,EAAE,EAAE66C;AAAN,OAA7B;AACAyN,MAAAA,mBAAmB;AACpB,KAHD,CApE2B,CAyE3B;AACA;AACA;;;AACA1E,IAAAA,SAAS,CAAC5H,GAAD,EAAM,UAAU5xB,KAAV,EAAiB;AAC9B+0B,MAAAA,QAAQ,GAAG/0B,KAAX;AACAk+B,MAAAA,mBAAmB;AACpB,KAHQ,CAAT,CA5E2B,CAiF3B;AACA;AACA;;AACA,QAAI,CAACpD,kBAAL,EAAyB;AACvB;AACAA,MAAAA,kBAAkB,GAAG1B,gBAAgB,CAACxH,GAAD,CAArC;AACD;;AAEDkJ,IAAAA,kBAAkB,CAACzhD,IAAnB,CAAwB,UAAU5E,GAAV,EAAe;AACrC0/C,MAAAA,WAAW,GAAG1/C,GAAd;AACAwpD,MAAAA,aAAa;AACd,KAHD,EAzF2B,CA8F3B;AACA;;AACArM,IAAAA,GAAG,CAAC4C,UAAJ,GAAiB,YAAY;AAC3BwJ,MAAAA,aAAa,GAAG,IAAhB;AACAC,MAAAA,aAAa;AACd,KAHD;;AAIArM,IAAAA,GAAG,CAAC0C,OAAJ,GAActD,QAAQ,CAACxqB,QAAD,CAAtB;AACD,GArGD;;AAuGA8G,EAAAA,GAAG,CAACpe,OAAJ,GAAc,YAAY;AACxB,QAAIqe,GAAG,GAAG,6DAAV;AACA9C,IAAAA,cAAc,CAAC,OAAD,EAAU8C,GAAV,CAAd;AACA/G,IAAAA,QAAQ,CAACyG,WAAW,CAACR,SAAD,EAAYc,GAAZ,CAAZ,CAAR;AACD,GAJD;AAKD;;AAEDytB,QAAQ,CAACjY,KAAT,GAAiB,YAAY;AAC3B;AACA;AAEA;AACA;AACA,MAAI;AACF;AACA;AACA,WAAO,OAAOua,SAAP,KAAqB,WAArB,IAAoC,OAAO5K,WAAP,KAAuB,WAAlE;AACD,GAJD,CAIE,OAAOtgD,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACF,CAbD;;AAeA,SAASgsD,QAAT,CAAmB9jB,OAAnB,EAA4B;AAC1BA,EAAAA,OAAO,CAAC3d,OAAR,CAAgB,KAAhB,EAAuBq+B,QAAvB,EAAiC,IAAjC;AACD,EAED;AACA;;;AAGA,SAASqD,IAAT,CAAcC,gBAAd,EAAgCtjB,KAAhC,EAAuC;AACrC,SAAO,IAAIp/B,OAAJ,CAAY,UAAU8E,OAAV,EAAmB7E,MAAnB,EAA2B;AAC5C,QAAI49C,OAAO,GAAG,CAAd;AACA,QAAI9U,OAAO,GAAG,CAAd;AACA,QAAI5Q,IAAI,GAAG,CAAX;AACA,QAAI7U,GAAG,GAAGo/B,gBAAgB,CAACltD,MAA3B;AACA,QAAI6P,GAAJ;;AAEA,aAAS84C,OAAT,GAAmB;AACjBN,MAAAA,OAAO;AACP6E,MAAAA,gBAAgB,CAAC3Z,OAAO,EAAR,CAAhB,GAA8BtrC,IAA9B,CAAmC4B,SAAnC,EAA8CC,OAA9C;AACD;;AAED,aAASqjD,MAAT,GAAkB;AAChB,UAAI,EAAExqB,IAAF,KAAW7U,GAAf,EAAoB;AAClB;AACA,YAAIje,GAAJ,EAAS;AACPpF,UAAAA,MAAM,CAACoF,GAAD,CAAN;AACD,SAFD,MAEO;AACLP,UAAAA,OAAO;AACR;AACF,OAPD,MAOO;AACL89C,QAAAA,YAAY;AACb;AACF;;AAED,aAASvjD,SAAT,GAAqB;AACnBw+C,MAAAA,OAAO;AACP8E,MAAAA,MAAM;AACP;AAED;;;AACA,aAASrjD,OAAT,CAAiBujD,OAAjB,EAA0B;AACxBhF,MAAAA,OAAO;AACPx4C,MAAAA,GAAG,GAAGA,GAAG,IAAIw9C,OAAb;AACAF,MAAAA,MAAM;AACP;;AAED,aAASC,YAAT,GAAwB;AACtB,aAAO/E,OAAO,GAAGze,KAAV,IAAmB2J,OAAO,GAAGzlB,GAApC,EAAyC;AACvC66B,QAAAA,OAAO;AACR;AACF;;AAEDyE,IAAAA,YAAY;AACb,GA5CM,CAAP;AA6CD;;AAED,IAAIE,kBAAkB,GAAG,EAAzB;AACA,IAAIC,qBAAqB,GAAG,EAA5B;AACA,IAAIC,sBAAsB,GAAG,IAA7B;AACA,IAAIC,iBAAiB,GAAG,KAAxB;AAEA,IAAIC,kBAAkB,GAAG,EAAzB;;AAEA,SAASC,6BAAT,CAAuC1f,GAAvC,EAA4C;AAC1C,MAAIhS,GAAG,GAAGgS,GAAG,CAAChS,GAAJ,IAAWgS,GAAG,CAAC5X,EAAzB;AACA,MAAIgU,IAAI,GAAGpO,GAAG,IAAIA,GAAG,CAACY,YAAtB;;AACA,MAAI,CAACwN,IAAL,EAAW;AACT;AACD;;AACD/oC,EAAAA,MAAM,CAACoC,IAAP,CAAY2mC,IAAZ,EAAkB5lC,OAAlB,CAA0B,UAAUw/C,QAAV,EAAoB;AAC5C,QAAIrnB,GAAG,GAAGyN,IAAI,CAAC4Z,QAAD,CAAd;AACArnB,IAAAA,GAAG,CAACn5B,IAAJ,GAAW28B,YAAY,CAACxD,GAAG,CAACn5B,IAAL,EAAWm5B,GAAG,CAACgQ,YAAf,CAAvB;AACD,GAHD;AAID;;AAED,SAASghB,WAAT,CAAqBppD,EAArB,EAAyB;AACvB,MAAI,WAAWohB,IAAX,CAAgBphB,EAAhB,CAAJ,EAAyB;AACvB,WAAO,aAAaqpD,kBAAkB,CAACrpD,EAAE,CAACkC,KAAH,CAAS,CAAT,CAAD,CAAtC;AACD;;AACD,MAAI,UAAUkf,IAAV,CAAephB,EAAf,CAAJ,EAAwB;AACtB,WAAO,YAAYqpD,kBAAkB,CAACrpD,EAAE,CAACkC,KAAH,CAAS,CAAT,CAAD,CAArC;AACD;;AACD,SAAOmnD,kBAAkB,CAACrpD,EAAD,CAAzB;AACD;;AAED,SAASspD,uBAAT,CAAiC7xB,GAAjC,EAAsC;AACpC,MAAI,CAACA,GAAG,CAACY,YAAL,IAAqB,CAACv7B,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,CAA1B,EAAyD;AACvD,WAAOryB,OAAO,CAAC8E,OAAR,EAAP;AACD;;AAED,SAAO9E,OAAO,CAAC0Y,GAAR,CAAY5hB,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,EAA8BxtB,GAA9B,CAAkC,UAAUxL,GAAV,EAAe;AAClE,QAAI0nD,UAAU,GAAGtvB,GAAG,CAACY,YAAJ,CAAiBh5B,GAAjB,CAAjB;;AACA,QAAI0nD,UAAU,CAAC9nD,IAAX,IAAmB,OAAO8nD,UAAU,CAAC9nD,IAAlB,KAA2B,QAAlD,EAA4D;AAC1D,aAAO,IAAI+G,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpC8xB,QAAAA,YAAY,CAACmqB,UAAU,CAAC9nD,IAAZ,EAAkB6L,OAAlB,CAAZ;AACD,OAFM,EAEJrH,IAFI,CAEC,UAAUo4B,GAAV,EAAe;AACrBkrB,QAAAA,UAAU,CAAC9nD,IAAX,GAAkB48B,GAAlB;AACD,OAJM,CAAP;AAKD;AACF,GATkB,CAAZ,CAAP;AAUD;;AAED,SAAS0tB,YAAT,CAAsBv3B,IAAtB,EAA4B;AAC1B,MAAI,CAACA,IAAI,CAACjwB,MAAV,EAAkB;AAChB,WAAO,KAAP;AACD;;AACD,MAAIkR,QAAQ,GAAGmmB,QAAQ,CAACpH,IAAI,CAACjwB,MAAN,CAAR,CAAsBkR,QAArC;AACA,SAAOA,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAA3C;AACD,EAED;AACA;;;AACA,SAASu2C,OAAT,CAAiBtpD,IAAjB,EAAuB8xB,IAAvB,EAA6B;AAC3B;AACA,MAAIu3B,YAAY,CAACv3B,IAAD,CAAhB,EAAwB;AACtB,QAAIkC,MAAM,GAAGlC,IAAI,CAAC9xB,IAAL,CAAUkb,MAAV,CAAiB4W,IAAI,CAACjwB,MAAL,CAAYvG,MAA7B,CAAb,CADsB,CAEtB;;AACA,QAAIuG,MAAM,GAAGiwB,IAAI,CAACjwB,MAAL,CAAYsL,OAAZ,CAAoB,MAApB,EAA4B,GAA5B,CAAb;AACAnN,IAAAA,IAAI,GAAG6B,MAAM,GAAGsnD,kBAAkB,CAACn1B,MAAD,CAAlC;AACD;;AAED,MAAI/hB,GAAG,GAAGinB,QAAQ,CAACl5B,IAAD,CAAlB;;AACA,MAAIiS,GAAG,CAACs3C,IAAJ,IAAYt3C,GAAG,CAACu3C,QAApB,EAA8B;AAC5Bv3C,IAAAA,GAAG,CAACw3C,IAAJ,GAAW;AAACC,MAAAA,QAAQ,EAAEz3C,GAAG,CAACs3C,IAAf;AAAqBC,MAAAA,QAAQ,EAAEv3C,GAAG,CAACu3C;AAAnC,KAAX;AACD,GAZ0B,CAc3B;AACA;;;AACA,MAAI5wB,KAAK,GAAG3mB,GAAG,CAACivB,IAAJ,CAAS/zB,OAAT,CAAiB,YAAjB,EAA+B,EAA/B,EAAmCgO,KAAnC,CAAyC,GAAzC,CAAZ;AAEAlJ,EAAAA,GAAG,CAAC4f,EAAJ,GAAS+G,KAAK,CAAC9M,GAAN,EAAT,CAlB2B,CAmB3B;;AACA,MAAI7Z,GAAG,CAAC4f,EAAJ,CAAO7oB,OAAP,CAAe,GAAf,MAAwB,CAAC,CAA7B,EAAgC;AAC9BiJ,IAAAA,GAAG,CAAC4f,EAAJ,GAASs3B,kBAAkB,CAACl3C,GAAG,CAAC4f,EAAL,CAA3B;AACD;;AAED5f,EAAAA,GAAG,CAACivB,IAAJ,GAAWtI,KAAK,CAACjgB,IAAN,CAAW,GAAX,CAAX;AAEA,SAAO1G,GAAP;AACD,EAED;;;AACA,SAAS03C,QAAT,CAAkB73B,IAAlB,EAAwBoP,IAAxB,EAA8B;AAC5B,SAAO0oB,MAAM,CAAC93B,IAAD,EAAOA,IAAI,CAACD,EAAL,GAAU,GAAV,GAAgBqP,IAAvB,CAAb;AACD,EAED;;;AACA,SAAS0oB,MAAT,CAAgB93B,IAAhB,EAAsBoP,IAAtB,EAA4B;AAC1B;AACA;AACA,MAAI2oB,OAAO,GAAG,CAAC/3B,IAAI,CAACoP,IAAN,GAAa,EAAb,GAAkB,GAAhC,CAH0B,CAK1B;AACA;;AACA,SAAOpP,IAAI,CAAC/e,QAAL,GAAgB,KAAhB,GAAwB+e,IAAI,CAACg4B,IAA7B,IACCh4B,IAAI,CAACjf,IAAL,GAAa,MAAMif,IAAI,CAACjf,IAAxB,GAAgC,EADjC,IAEA,GAFA,GAEMif,IAAI,CAACoP,IAFX,GAEkB2oB,OAFlB,GAE4B3oB,IAFnC;AAGD;;AAED,SAAS6oB,WAAT,CAAqBtwC,MAArB,EAA6B;AAC3B,SAAO,MAAM7c,MAAM,CAACoC,IAAP,CAAYya,MAAZ,EAAoB9O,GAApB,CAAwB,UAAUmnC,CAAV,EAAa;AAChD,WAAOA,CAAC,GAAG,GAAJ,GAAUqX,kBAAkB,CAAC1vC,MAAM,CAACq4B,CAAD,CAAP,CAAnC;AACD,GAFY,EAEVn5B,IAFU,CAEL,GAFK,CAAb;AAGD;;AAED,SAASqxC,eAAT,CAAyBl4B,IAAzB,EAA+B;AAC7B,MAAIm4B,EAAE,GAAI,OAAOpsD,SAAP,KAAqB,WAArB,IAAoCA,SAAS,CAACK,SAA/C,GACLL,SAAS,CAACK,SAAV,CAAoB8F,WAApB,EADK,GAC+B,EADxC;AAEA,MAAIkmD,IAAI,GAAGD,EAAE,CAACjhD,OAAH,CAAW,MAAX,MAAuB,CAAC,CAAnC;AACA,MAAImhD,SAAS,GAAGF,EAAE,CAACjhD,OAAH,CAAW,SAAX,MAA0B,CAAC,CAA3C;AACA,MAAIohD,MAAM,GAAGH,EAAE,CAACjhD,OAAH,CAAW,MAAX,MAAuB,CAAC,CAArC;AACA,MAAIqhD,KAAK,GAAG,EAAE,YAAYv4B,IAAd,KAAuBA,IAAI,CAACzlB,MAAL,KAAgB,KAAnD;AACA,SAAO,CAAC69C,IAAI,IAAIC,SAAR,IAAqBC,MAAtB,KAAiCC,KAAxC;AACD,EAED;;;AACA,SAASC,SAAT,CAAmBx4B,IAAnB,EAAyBpB,QAAzB,EAAmC;AAEjC;AACA,MAAIqX,GAAG,GAAG,IAAV;AAEA,MAAI+hB,IAAI,GAAGR,OAAO,CAACx3B,IAAI,CAAC9xB,IAAN,EAAY8xB,IAAZ,CAAlB;AACA,MAAIy4B,KAAK,GAAGZ,QAAQ,CAACG,IAAD,EAAO,EAAP,CAApB;AAEAh4B,EAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;;AAEA,MAAI04B,QAAQ,GAAG,UAAUj8C,GAAV,EAAeoU,OAAf,EAAwB;AAErCA,IAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACAA,IAAAA,OAAO,CAAC8nC,OAAR,GAAkB9nC,OAAO,CAAC8nC,OAAR,IAAmB,IAAInd,CAAJ,EAArC;AAEA3qB,IAAAA,OAAO,CAAC+nC,WAAR,GAAsB,SAAtB;;AAEA,QAAI54B,IAAI,CAAC23B,IAAL,IAAaK,IAAI,CAACL,IAAtB,EAA4B;AAC1B,UAAIkB,KAAK,GAAG74B,IAAI,CAAC23B,IAAL,IAAaK,IAAI,CAACL,IAA9B;AACA,UAAIr0B,GAAG,GAAGu1B,KAAK,CAACjB,QAAN,GAAiB,GAAjB,GAAuBiB,KAAK,CAACnB,QAAvC;AACA,UAAIoB,KAAK,GAAGpwB,QAAQ,CAACqwB,QAAQ,CAAC1B,kBAAkB,CAAC/zB,GAAD,CAAnB,CAAT,CAApB;AACAzS,MAAAA,OAAO,CAAC8nC,OAAR,CAAgB1tD,GAAhB,CAAoB,eAApB,EAAqC,WAAW6tD,KAAhD;AACD;;AAED,QAAIH,OAAO,GAAG34B,IAAI,CAAC24B,OAAL,IAAgB,EAA9B;AACA7tD,IAAAA,MAAM,CAACoC,IAAP,CAAYyrD,OAAZ,EAAqB1qD,OAArB,CAA6B,UAAUZ,GAAV,EAAe;AAC1CwjB,MAAAA,OAAO,CAAC8nC,OAAR,CAAgBvvB,MAAhB,CAAuB/7B,GAAvB,EAA4BsrD,OAAO,CAACtrD,GAAD,CAAnC;AACD,KAFD;AAIA;;AACA,QAAI6qD,eAAe,CAACrnC,OAAD,CAAnB,EAA8B;AAC5BpU,MAAAA,GAAG,IAAI,CAACA,GAAG,CAACvF,OAAJ,CAAY,GAAZ,MAAqB,CAAC,CAAtB,GAA0B,GAA1B,GAAgC,GAAjC,IAAwC,SAAxC,GAAoDknB,IAAI,CAAC46B,GAAL,EAA3D;AACD;;AAED,QAAIC,QAAQ,GAAGj5B,IAAI,CAACub,KAAL,IAAcD,GAA7B;AACA,WAAO2d,QAAQ,CAACx8C,GAAD,EAAMoU,OAAN,CAAf;AACD,GA1BD;;AA4BA,WAASqoC,aAAT,CAAuBhrD,IAAvB,EAA6BusB,GAA7B,EAAkC;AAChC,WAAOyE,UAAU,CAAChxB,IAAD,EAAO,wBAAa,UAAUwM,IAAV,EAAgB;AACnDy+C,MAAAA,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AACvB,eAAOgpB,GAAG,CAACpwB,KAAJ,CAAU,IAAV,EAAgBqQ,IAAhB,CAAP;AACD,OAFD,EAEGwS,KAFH,CAES,UAAU1iB,CAAV,EAAa;AACpB,YAAIo0B,QAAQ,GAAGlkB,IAAI,CAACsf,GAAL,EAAf;AACA4E,QAAAA,QAAQ,CAACp0B,CAAD,CAAR;AACD,OALD;AAMD,KAPuB,CAAP,CAAV,CAOH+I,IAPG,CAOE0iC,GAPF,CAAP;AAQD;;AAED,WAASmjB,SAAT,CAAmB38C,GAAnB,EAAwBoU,OAAxB,EAAiC+N,QAAjC,EAA2C;AAEzC,QAAI5yB,MAAM,GAAG,EAAb;AAEA6kB,IAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACAA,IAAAA,OAAO,CAAC8nC,OAAR,GAAkB9nC,OAAO,CAAC8nC,OAAR,IAAmB,IAAInd,CAAJ,EAArC;;AAEA,QAAI,CAAC3qB,OAAO,CAAC8nC,OAAR,CAAgB3tD,GAAhB,CAAoB,cAApB,CAAL,EAA0C;AACxC6lB,MAAAA,OAAO,CAAC8nC,OAAR,CAAgB1tD,GAAhB,CAAoB,cAApB,EAAoC,kBAApC;AACD;;AACD,QAAI,CAAC4lB,OAAO,CAAC8nC,OAAR,CAAgB3tD,GAAhB,CAAoB,QAApB,CAAL,EAAoC;AAClC6lB,MAAAA,OAAO,CAAC8nC,OAAR,CAAgB1tD,GAAhB,CAAoB,QAApB,EAA8B,kBAA9B;AACD;;AAED,WAAOytD,QAAQ,CAACj8C,GAAD,EAAMoU,OAAN,CAAR,CAAuBpf,IAAvB,CAA4B,UAAU0G,QAAV,EAAoB;AACrDnM,MAAAA,MAAM,CAAC6zB,EAAP,GAAY1nB,QAAQ,CAAC0nB,EAArB;AACA7zB,MAAAA,MAAM,CAACq3B,MAAP,GAAgBlrB,QAAQ,CAACkrB,MAAzB;AACA,aAAOlrB,QAAQ,CAACgxC,IAAT,EAAP;AACD,KAJM,EAIJ13C,IAJI,CAIC,UAAU03C,IAAV,EAAgB;AACtBn9C,MAAAA,MAAM,CAACiB,IAAP,GAAck8C,IAAd;;AACA,UAAI,CAACn9C,MAAM,CAAC6zB,EAAZ,EAAgB;AACd7zB,QAAAA,MAAM,CAACiB,IAAP,CAAYo2B,MAAZ,GAAqBr3B,MAAM,CAACq3B,MAA5B;AACA,YAAIhqB,GAAG,GAAGksB,yBAAyB,CAACv5B,MAAM,CAACiB,IAAR,CAAnC;;AACA,YAAI2xB,QAAJ,EAAc;AACZ,iBAAOA,QAAQ,CAACvlB,GAAD,CAAf;AACD,SAFD,MAEO;AACL,gBAAMA,GAAN;AACD;AACF;;AAED,UAAI0gB,KAAK,CAAC2C,OAAN,CAAc1wB,MAAM,CAACiB,IAArB,CAAJ,EAAgC;AAC9BjB,QAAAA,MAAM,CAACiB,IAAP,GAAcjB,MAAM,CAACiB,IAAP,CAAY4L,GAAZ,CAAgB,UAAUwgD,CAAV,EAAa;AACzC,cAAIA,CAAC,CAACpkD,KAAF,IAAWokD,CAAC,CAACziB,OAAjB,EAA0B;AACxB,mBAAOrR,yBAAyB,CAAC8zB,CAAD,CAAhC;AACD,WAFD,MAEO;AACL,mBAAOA,CAAP;AACD;AACF,SANa,CAAd;AAOD;;AAED,UAAIz6B,QAAJ,EAAc;AACZA,QAAAA,QAAQ,CAAC,IAAD,EAAO5yB,MAAM,CAACiB,IAAd,CAAR;AACD,OAFD,MAEO;AACL,eAAOjB,MAAP;AACD;AACF,KA/BM,CAAP;AAgCD;;AAED,MAAIstD,YAAJ;;AAEA,WAASH,KAAT,GAAiB;AACf,QAAIn5B,IAAI,CAACu5B,UAAT,EAAqB;AACnB,aAAOvlD,OAAO,CAAC8E,OAAR,EAAP;AACD,KAHc,CAKf;AACA;AACA;;;AACA,QAAIwgD,YAAJ,EAAkB;AAChB,aAAOA,YAAP;AACD;;AAEDA,IAAAA,YAAY,GAAGF,SAAS,CAACX,KAAD,CAAT,CAAiBvrC,KAAjB,CAAuB,UAAU7T,GAAV,EAAe;AACnD,UAAIA,GAAG,IAAIA,GAAG,CAACgqB,MAAX,IAAqBhqB,GAAG,CAACgqB,MAAJ,KAAe,GAAxC,EAA6C;AAC3C;AACAD,QAAAA,YAAY,CAAC,GAAD,EAAM,iDAAN,CAAZ;AACA,eAAOg2B,SAAS,CAACX,KAAD,EAAQ;AAACl+C,UAAAA,MAAM,EAAE;AAAT,SAAR,CAAhB;AACD,OAJD,MAIO;AACL,eAAOvG,OAAO,CAACC,MAAR,CAAeoF,GAAf,CAAP;AACD;AACF,KARc,EAQZ6T,KARY,CAQN,UAAU7T,GAAV,EAAe;AACtB;AACA;;AACA;AACA,UAAIA,GAAG,IAAIA,GAAG,CAACgqB,MAAX,IAAqBhqB,GAAG,CAACgqB,MAAJ,KAAe,GAAxC,EAA6C;AAC3C,eAAO,IAAP;AACD;;AACD,aAAOrvB,OAAO,CAACC,MAAR,CAAeoF,GAAf,CAAP;AACD,KAhBc,CAAf;AAkBAigD,IAAAA,YAAY,CAACpsC,KAAb,CAAmB,YAAY;AAC7BosC,MAAAA,YAAY,GAAG,IAAf;AACD,KAFD;AAIA,WAAOA,YAAP;AACD;;AAED,0BAAU,YAAY;AACpB16B,IAAAA,QAAQ,CAAC,IAAD,EAAOqX,GAAP,CAAR;AACD,GAFD;AAIAA,EAAAA,GAAG,CAACtP,OAAJ,GAAc,IAAd;AAEA;;AACAsP,EAAAA,GAAG,CAACtnC,IAAJ,GAAW,YAAY;AACrB,WAAO,MAAP;AACD,GAFD;;AAIAsnC,EAAAA,GAAG,CAACjoC,EAAJ,GAASkrD,aAAa,CAAC,IAAD,EAAO,UAAUt6B,QAAV,EAAoB;AAC/C85B,IAAAA,QAAQ,CAACZ,MAAM,CAACE,IAAD,EAAO,EAAP,CAAP,CAAR,CAA2BvmD,IAA3B,CAAgC,UAAU0G,QAAV,EAAoB;AAClD,aAAOA,QAAQ,CAACgxC,IAAT,EAAP;AACD,KAFD,EAEGj8B,KAFH,CAES,YAAY;AACnB,aAAO,EAAP;AACD,KAJD,EAIGzb,IAJH,CAIQ,UAAUzF,MAAV,EAAkB;AACxB;AACA,UAAIwtD,OAAO,GAAIxtD,MAAM,IAAIA,MAAM,CAAC4gC,IAAlB,GACT5gC,MAAM,CAAC4gC,IAAP,GAAcorB,IAAI,CAACj4B,EADV,GACgB83B,QAAQ,CAACG,IAAD,EAAO,EAAP,CADtC;AAEAp5B,MAAAA,QAAQ,CAAC,IAAD,EAAO46B,OAAP,CAAR;AACD,KATD;AAUD,GAXqB,CAAtB,CAnJiC,CAgKjC;AACA;;AACAvjB,EAAAA,GAAG,CAACsB,OAAJ,GAAc2hB,aAAa,CAAC,SAAD,EAAY,UAAUl5B,IAAV,EAAgBpB,QAAhB,EAA0B;AAC/D,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,IAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;AAEAo5B,IAAAA,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,UAAP,CAAT,EAA6B;AAACz9C,MAAAA,MAAM,EAAE;AAAT,KAA7B,CAAT,CAAwD9I,IAAxD,CAA6D,YAAY;AACvE,eAASgoD,IAAT,GAAgB;AACdxjB,QAAAA,GAAG,CAACxV,IAAJ,CAAS,UAAUpnB,GAAV,EAAemjB,GAAf,EAAoB;AAC3B;AACA;;AACA;AACA,cAAIA,GAAG,IAAI,CAACA,GAAG,CAACk9B,eAAhB,EAAiC;AAC/B96B,YAAAA,QAAQ,CAAC,IAAD,EAAO;AAACiB,cAAAA,EAAE,EAAE;AAAL,aAAP,CAAR;AACD,WAFD,MAEO;AACL9d,YAAAA,UAAU,CAAC03C,IAAD,EAAOz5B,IAAI,CAAC25B,QAAL,IAAiB,GAAxB,CAAV;AACD;AACF,SATD;AAUD,OAZsE,CAavE;;;AACAF,MAAAA,IAAI;AACL,KAfD;AAgBD,GAvB0B,CAA3B;AAyBAxjB,EAAAA,GAAG,CAACnW,OAAJ,GAAcZ,UAAU,CAAC,SAAD,EAAY,UAAUc,IAAV,EAAgBpB,QAAhB,EAA0B;AAC5D,QAAIJ,IAAI,GAAG,IAAX;;AAEA,aAASo7B,SAAT,CAAmBxvD,EAAnB,EAAuB;AACrB,UAAIud,MAAM,GAAG,EAAb;;AACA,UAAIqY,IAAI,CAAC0N,IAAT,EAAe;AACb/lB,QAAAA,MAAM,CAAC+lB,IAAP,GAAc,IAAd;AACD;;AACD,UAAI1N,IAAI,CAACmG,WAAT,EAAsB;AACpB;AACAxe,QAAAA,MAAM,CAACwe,WAAP,GAAqB,IAArB;AACD;;AACD,UAAInG,IAAI,CAAC0R,MAAT,EAAiB;AACf/pB,QAAAA,MAAM,CAAC+pB,MAAP,GAAgB,IAAhB;AACD;;AACD0nB,MAAAA,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,cAAcC,WAAW,CAACtwC,MAAD,CAAhC,CAAT,EAAoD;AAC3DpN,QAAAA,MAAM,EAAE,MADmD;AAE3DsvC,QAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAe;AAAEsvB,UAAAA,IAAI,EAAEF,IAAI,CAACE;AAAb,SAAf;AAFqD,OAApD,CAAT,CAGGzuB,IAHH,CAGQ,UAAUzF,MAAV,EAAkB;AACxB,YAAIg0B,IAAI,CAACmG,WAAL,IAAoBnG,IAAI,CAACgK,MAA7B,EAAqC;AACnCh+B,UAAAA,MAAM,CAACiB,IAAP,CAAY2f,OAAZ,CAAoB3e,OAApB,CAA4B,UAAUuuB,GAAV,EAAe;AACzCA,YAAAA,GAAG,CAAC0D,IAAJ,CAASjyB,OAAT,CAAiBkpD,6BAAjB;AACD,WAFD;AAGD;;AACD/sD,QAAAA,EAAE,CAAC,IAAD,EAAO4B,MAAM,CAACiB,IAAd,CAAF;AACD,OAVD,EAUGigB,KAVH,CAUS9iB,EAVT;AAWD;AAED;;;AACA,aAASyvD,aAAT,GAAyB;AACvB;AACA,UAAI3K,SAAS,GAAG6H,qBAAhB;AACA,UAAI+C,UAAU,GAAGl6C,IAAI,CAACksB,IAAL,CAAU9L,IAAI,CAACE,IAAL,CAAU12B,MAAV,GAAmB0lD,SAA7B,CAAjB;AACA,UAAI5uB,OAAO,GAAG,CAAd;AACA,UAAI1T,OAAO,GAAG,IAAImN,KAAJ,CAAU+/B,UAAV,CAAd;;AAEA,eAASC,QAAT,CAAkBC,QAAlB,EAA4B;AAC1B,eAAO,UAAU3gD,GAAV,EAAemjB,GAAf,EAAoB;AACzB;AACA5P,UAAAA,OAAO,CAACotC,QAAD,CAAP,GAAoBx9B,GAAG,CAAC5P,OAAxB;;AACA,cAAI,EAAE0T,OAAF,KAAcw5B,UAAlB,EAA8B;AAC5Bl7B,YAAAA,QAAQ,CAAC,IAAD,EAAO;AAAChS,cAAAA,OAAO,EAAE2Z,OAAO,CAAC3Z,OAAD;AAAjB,aAAP,CAAR;AACD;AACF,SAND;AAOD;;AAED,WAAK,IAAI9N,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGg7C,UAApB,EAAgCh7C,CAAC,EAAjC,EAAqC;AACnC,YAAIm7C,OAAO,GAAGz6B,IAAI,CAACQ,IAAD,EAAO,CAAC,MAAD,EAAS,aAAT,EAAwB,QAAxB,EAAkC,QAAlC,CAAP,CAAlB;AACAi6B,QAAAA,OAAO,CAAC/5B,IAAR,GAAeF,IAAI,CAACE,IAAL,CAAUhwB,KAAV,CAAgB4O,CAAC,GAAGowC,SAApB,EACbtvC,IAAI,CAAChQ,GAAL,CAASowB,IAAI,CAACE,IAAL,CAAU12B,MAAnB,EAA2B,CAACsV,CAAC,GAAG,CAAL,IAAUowC,SAArC,CADa,CAAf;AAEApvB,QAAAA,OAAO,CAACtB,IAAD,EAAOy7B,OAAP,EAAgBF,QAAQ,CAACj7C,CAAD,CAAxB,CAAP;AACD;AACF,KApD2D,CAsD5D;;;AACA,QAAI25C,KAAK,GAAGX,MAAM,CAACE,IAAD,EAAO,EAAP,CAAlB;AACA,QAAIkC,eAAe,GAAGhD,kBAAkB,CAACuB,KAAD,CAAxC;AAEA;;AACA,QAAI,OAAOyB,eAAP,KAA2B,SAA/B,EAA0C;AACxC;AACAN,MAAAA,SAAS,CAAC,UAAUvgD,GAAV,EAAemjB,GAAf,EAAoB;AAC5B,YAAInjB,GAAJ,EAAS;AACP69C,UAAAA,kBAAkB,CAACuB,KAAD,CAAlB,GAA4B,KAA5B;AACAr1B,UAAAA,YAAY,CACV/pB,GAAG,CAACgqB,MADM,EAEV,6CACA,6BAHU,CAAZ;AAKAw2B,UAAAA,aAAa;AACd,SARD,MAQO;AACL3C,UAAAA,kBAAkB,CAACuB,KAAD,CAAlB,GAA4B,IAA5B;AACA75B,UAAAA,QAAQ,CAAC,IAAD,EAAOpC,GAAP,CAAR;AACD;AACF,OAbQ,CAAT;AAcD,KAhBD,MAgBO,IAAI09B,eAAJ,EAAqB;AAC1BN,MAAAA,SAAS,CAACh7B,QAAD,CAAT;AACD,KAFM,MAEA;AACLi7B,MAAAA,aAAa;AACd;AACF,GAhFuB,CAAxB,CA3LiC,CA6QjC;AACA;AACA;;AACA5jB,EAAAA,GAAG,CAACiD,KAAJ,GAAY,UAAUta,QAAV,EAAoB;AAC9Bu6B,IAAAA,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AACvB,aAAOinD,QAAQ,CAACb,QAAQ,CAACG,IAAD,EAAO,EAAP,CAAT,CAAf;AACD,KAFD,EAEGvmD,IAFH,CAEQ,UAAU0G,QAAV,EAAoB;AAC1B,aAAOA,QAAQ,CAACgxC,IAAT,EAAP;AACD,KAJD,EAIG13C,IAJH,CAIQ,UAAUgvB,IAAV,EAAgB;AACtBA,MAAAA,IAAI,CAACu3B,IAAL,GAAYH,QAAQ,CAACG,IAAD,EAAO,EAAP,CAApB;AACAp5B,MAAAA,QAAQ,CAAC,IAAD,EAAO6B,IAAP,CAAR;AACD,KAPD,EAOGvT,KAPH,CAOS0R,QAPT;AAQD,GATD;;AAWAqX,EAAAA,GAAG,CAACsF,KAAJ,GAAY,UAAUnM,IAAV,EAAgBve,OAAhB,EAAyB;AACnC,WAAOsoC,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AAC9B,UAAIgL,GAAG,GAAG2yB,IAAI,CAACjT,SAAL,CAAe,CAAf,EAAkB,CAAlB,MAAyB,GAAzB,GACR27B,MAAM,CAACE,IAAD,EAAO5oB,IAAI,CAACjT,SAAL,CAAe,CAAf,CAAP,CADE,GAER07B,QAAQ,CAACG,IAAD,EAAO5oB,IAAP,CAFV;AAGA,aAAOspB,QAAQ,CAACj8C,GAAD,EAAMoU,OAAN,CAAf;AACD,KALM,CAAP;AAMD,GAPD,CA3RiC,CAoSjC;AACA;AACA;;;AACAolB,EAAAA,GAAG,CAACjrC,GAAJ,GAAUkuD,aAAa,CAAC,KAAD,EAAQ,UAAUlrD,EAAV,EAAcgyB,IAAd,EAAoBpB,QAApB,EAA8B;AAC3D;AACA,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,IAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ,CAN2D,CAQ3D;;AACA,QAAIrY,MAAM,GAAG,EAAb;;AAEA,QAAIqY,IAAI,CAAC0N,IAAT,EAAe;AACb/lB,MAAAA,MAAM,CAAC+lB,IAAP,GAAc,IAAd;AACD;;AAED,QAAI1N,IAAI,CAAC+X,SAAT,EAAoB;AAClBpwB,MAAAA,MAAM,CAACowB,SAAP,GAAmB,IAAnB;AACD;;AAED,QAAI/X,IAAI,CAAC0R,MAAT,EAAiB;AACf/pB,MAAAA,MAAM,CAAC+pB,MAAP,GAAgB,IAAhB;AACD;;AAED,QAAI1R,IAAI,CAACuB,SAAT,EAAoB;AAClB,UAAIvB,IAAI,CAACuB,SAAL,KAAmB,KAAvB,EAA8B;AAC5BvB,QAAAA,IAAI,CAACuB,SAAL,GAAiB7wB,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAACuB,SAApB,CAAjB;AACD;;AACD5Z,MAAAA,MAAM,CAAC4Z,SAAP,GAAmBvB,IAAI,CAACuB,SAAxB;AACD;;AAED,QAAIvB,IAAI,CAACwB,GAAT,EAAc;AACZ7Z,MAAAA,MAAM,CAAC6Z,GAAP,GAAaxB,IAAI,CAACwB,GAAlB;AACD;;AAED,QAAIxB,IAAI,CAACsO,SAAT,EAAoB;AAClB3mB,MAAAA,MAAM,CAAC2mB,SAAP,GAAmBtO,IAAI,CAACsO,SAAxB;AACD;AAED;;;AACA,QAAItO,IAAI,CAACgT,UAAT,EAAqB;AACnBrrB,MAAAA,MAAM,CAACqrB,UAAP,GAAoBhT,IAAI,CAACgT,UAAzB;AACD;;AAEDhlC,IAAAA,EAAE,GAAGopD,WAAW,CAACppD,EAAD,CAAhB;;AAEA,aAASmsD,gBAAT,CAA0B10B,GAA1B,EAA+B;AAC7B,UAAIoO,IAAI,GAAGpO,GAAG,CAACY,YAAf;AACA,UAAI+zB,SAAS,GAAGvmB,IAAI,IAAI/oC,MAAM,CAACoC,IAAP,CAAY2mC,IAAZ,CAAxB;;AACA,UAAI,CAACA,IAAD,IAAS,CAACumB,SAAS,CAAC5wD,MAAxB,EAAgC;AAC9B;AACD,OAL4B,CAM7B;AACA;AACA;AACA;;;AACA,eAAS6wD,SAAT,CAAmB5M,QAAnB,EAA6B;AAC3B,YAAIrnB,GAAG,GAAGyN,IAAI,CAAC4Z,QAAD,CAAd;;AACA,YAAIre,IAAI,GAAGgoB,WAAW,CAAC3xB,GAAG,CAAC4C,GAAL,CAAX,GAAuB,GAAvB,GAA6BiyB,kBAAkB,CAAC7M,QAAD,CAA/C,GACP,OADO,GACGhoB,GAAG,CAACyC,IADlB;;AAEA,eAAOwwB,QAAQ,CAACb,QAAQ,CAACG,IAAD,EAAO5oB,IAAP,CAAT,CAAR,CAA+B39B,IAA/B,CAAoC,UAAU0G,QAAV,EAAoB;AAC7D,cAAI,OAAO+hB,OAAP,KAAmB,WAAnB,IAAkC,KAAtC,EAAwD;AACtD,mBAAO/hB,QAAQ,CAAC4xB,MAAT,EAAP;AACD,WAFD,MAEO;AACL;AACA,mBAAO5xB,QAAQ,CAACiyB,IAAT,EAAP;AACD;AACF,SAPM,EAOJ34B,IAPI,CAOC,UAAU24B,IAAV,EAAgB;AACtB,cAAIpK,IAAI,CAACgK,MAAT,EAAiB;AACf;AACA,gBAAI,OAAO9P,OAAP,KAAmB,WAAnB,IAAkC,KAAtC,EAAwD;AACtDkQ,cAAAA,IAAI,CAACz7B,IAAL,GAAYy3B,GAAG,CAACgQ,YAAhB;AACD;;AACD,mBAAOhM,IAAP;AACD;;AACD,iBAAO,IAAIp2B,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpC8xB,YAAAA,YAAY,CAACR,IAAD,EAAOtxB,OAAP,CAAZ;AACD,WAFM,CAAP;AAGD,SAlBM,EAkBJrH,IAlBI,CAkBC,UAAUxE,IAAV,EAAgB;AACtB,iBAAOm5B,GAAG,CAACE,IAAX;AACA,iBAAOF,GAAG,CAAC58B,MAAX;AACA48B,UAAAA,GAAG,CAACn5B,IAAJ,GAAWA,IAAX;AACD,SAtBM,CAAP;AAuBD;;AAED,UAAIypD,gBAAgB,GAAG0D,SAAS,CAACvhD,GAAV,CAAc,UAAU40C,QAAV,EAAoB;AACvD,eAAO,YAAY;AACjB,iBAAO4M,SAAS,CAAC5M,QAAD,CAAhB;AACD,SAFD;AAGD,OAJsB,CAAvB,CAvC6B,CA6C7B;AACA;;AACA,aAAOgJ,IAAI,CAACC,gBAAD,EAAmB,CAAnB,CAAX;AACD;;AAED,aAAS6D,mBAAT,CAA6BC,SAA7B,EAAwC;AACtC,UAAIzgC,KAAK,CAAC2C,OAAN,CAAc89B,SAAd,CAAJ,EAA8B;AAC5B,eAAOxmD,OAAO,CAAC0Y,GAAR,CAAY8tC,SAAS,CAAC3hD,GAAV,CAAc,UAAU4sB,GAAV,EAAe;AAC9C,cAAIA,GAAG,CAAC5F,EAAR,EAAY;AACV,mBAAOs6B,gBAAgB,CAAC10B,GAAG,CAAC5F,EAAL,CAAvB;AACD;AACF,SAJkB,CAAZ,CAAP;AAKD;;AACD,aAAOs6B,gBAAgB,CAACK,SAAD,CAAvB;AACD;;AAED,QAAI/9C,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAOhqD,EAAE,GAAGiqD,WAAW,CAACtwC,MAAD,CAAvB,CAAlB;AACAyxC,IAAAA,SAAS,CAAC38C,GAAD,CAAT,CAAehL,IAAf,CAAoB,UAAU+qB,GAAV,EAAe;AACjC,aAAOxoB,OAAO,CAAC8E,OAAR,GAAkBrH,IAAlB,CAAuB,YAAY;AACxC,YAAIuuB,IAAI,CAACmG,WAAT,EAAsB;AACpB,iBAAOo0B,mBAAmB,CAAC/9B,GAAG,CAACvvB,IAAL,CAA1B;AACD;AACF,OAJM,EAIJwE,IAJI,CAIC,YAAY;AAClBmtB,QAAAA,QAAQ,CAAC,IAAD,EAAOpC,GAAG,CAACvvB,IAAX,CAAR;AACD,OANM,CAAP;AAOD,KARD,EAQGigB,KARH,CAQS,UAAU1iB,CAAV,EAAa;AACpBA,MAAAA,CAAC,CAAC22B,KAAF,GAAUnzB,EAAV;AACA4wB,MAAAA,QAAQ,CAACp0B,CAAD,CAAR;AACD,KAXD;AAYD,GAvHsB,CAAvB,CAvSiC,CAiajC;;AACAyrC,EAAAA,GAAG,CAACM,MAAJ,GAAa2iB,aAAa,CAAC,QAAD,EAAW,UAAU1iB,OAAV,EAAmBC,SAAnB,EAA8BzW,IAA9B,EAAoC51B,EAApC,EAAwC;AAC3E,QAAIq7B,GAAJ;;AACA,QAAI,OAAOgR,SAAP,KAAqB,QAAzB,EAAmC;AACjC;AACAhR,MAAAA,GAAG,GAAG;AACJ4C,QAAAA,GAAG,EAAEmO,OADD;AAEJtO,QAAAA,IAAI,EAAEuO;AAFF,OAAN;;AAIA,UAAI,OAAOzW,IAAP,KAAgB,UAApB,EAAgC;AAC9B51B,QAAAA,EAAE,GAAG41B,IAAL;AACAA,QAAAA,IAAI,GAAG,EAAP;AACD;AACF,KAVD,MAUO;AACL;AACAyF,MAAAA,GAAG,GAAG+Q,OAAN;;AACA,UAAI,OAAOC,SAAP,KAAqB,UAAzB,EAAqC;AACnCrsC,QAAAA,EAAE,GAAGqsC,SAAL;AACAzW,QAAAA,IAAI,GAAG,EAAP;AACD,OAHD,MAGO;AACL51B,QAAAA,EAAE,GAAG41B,IAAL;AACAA,QAAAA,IAAI,GAAGyW,SAAP;AACD;AACF;;AAED,QAAInC,MAAM,GAAI7O,GAAG,CAACyC,IAAJ,IAAYlI,IAAI,CAACwB,GAA/B;AACA,QAAI/kB,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAOZ,WAAW,CAAC3xB,GAAG,CAAC4C,GAAL,CAAlB,CAAR,GAAuC,OAAvC,GAAiDiM,MAA3D;AAEA8kB,IAAAA,SAAS,CAAC38C,GAAD,EAAM;AAAClC,MAAAA,MAAM,EAAE;AAAT,KAAN,EAA0BnQ,EAA1B,CAAT,CAAuC8iB,KAAvC,CAA6C9iB,EAA7C;AACD,GA5ByB,CAA1B;;AA8BA,WAASkwD,kBAAT,CAA4BtkB,YAA5B,EAA0C;AACxC,WAAOA,YAAY,CAAC3sB,KAAb,CAAmB,GAAnB,EAAwBxQ,GAAxB,CAA4Bw+C,kBAA5B,EAAgDxwC,IAAhD,CAAqD,GAArD,CAAP;AACD,GAlcgC,CAocjC;;;AACAovB,EAAAA,GAAG,CAACwC,aAAJ,GAAoBygB,aAAa,CAAC,eAAD,EAAkB,UAAU/3B,KAAV,EAAiB6U,YAAjB,EACOhW,IADP,EACapB,QADb,EACuB;AACxE,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACD,QAAIrY,MAAM,GAAGqY,IAAI,CAACwB,GAAL,GAAY,UAAUxB,IAAI,CAACwB,GAA3B,GAAkC,EAA/C;AACA,QAAI/kB,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAOZ,WAAW,CAACj2B,KAAD,CAAlB,CAAR,GAAqC,GAArC,GACNm5B,kBAAkB,CAACtkB,YAAD,CADZ,GAC6BruB,MADvC;AAEA,QAAI8yC,WAAJ;AACA/B,IAAAA,QAAQ,CAACj8C,GAAD,EAAM;AAAClC,MAAAA,MAAM,EAAE;AAAT,KAAN,CAAR,CAA+B9I,IAA/B,CAAoC,UAAU0G,QAAV,EAAoB;AACtDsiD,MAAAA,WAAW,GAAGtiD,QAAQ,CAACwgD,OAAT,CAAiB3tD,GAAjB,CAAqB,cAArB,CAAd;;AACA,UAAI,CAACmN,QAAQ,CAAC0nB,EAAd,EAAkB;AAChB,cAAM1nB,QAAN;AACD,OAFD,MAEO;AACL,YAAI,OAAO+hB,OAAP,KAAmB,WAAnB,IAAkC,KAAtC,EAAwD;AACtD,iBAAO/hB,QAAQ,CAAC4xB,MAAT,EAAP;AACD,SAFD,MAEO;AACL;AACA,iBAAO5xB,QAAQ,CAACiyB,IAAT,EAAP;AACD;AACF;AACF,KAZD,EAYG34B,IAZH,CAYQ,UAAU24B,IAAV,EAAgB;AACtB;AACA,UAAI,OAAOlQ,OAAP,KAAmB,WAAnB,IAAkC,KAAtC,EAAwD;AACtDkQ,QAAAA,IAAI,CAACz7B,IAAL,GAAY8rD,WAAZ;AACD;;AACD77B,MAAAA,QAAQ,CAAC,IAAD,EAAOwL,IAAP,CAAR;AACD,KAlBD,EAkBGld,KAlBH,CAkBS,UAAU7T,GAAV,EAAe;AACtBulB,MAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,KApBD;AAqBD,GA/BgC,CAAjC,CArciC,CAsejC;;AACA48B,EAAAA,GAAG,CAACK,gBAAJ,GAAwB4iB,aAAa,CAAC,kBAAD,EAAqB,UAAU/3B,KAAV,EACO6U,YADP,EAEO1B,MAFP,EAGO1V,QAHP,EAGiB;AACzE,QAAIniB,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAOZ,WAAW,CAACj2B,KAAD,CAAX,GAAqB,GAArB,GACNm5B,kBAAkB,CAACtkB,YAAD,CADnB,CAAR,GAC6C,OAD7C,GACuD1B,MADjE;AAEA8kB,IAAAA,SAAS,CAAC38C,GAAD,EAAM;AAAClC,MAAAA,MAAM,EAAE;AAAT,KAAN,EAA0BqkB,QAA1B,CAAT,CAA6C1R,KAA7C,CAAmD0R,QAAnD;AACD,GAPoC,CAArC,CAveiC,CAgfjC;AACA;AACA;;AACAqX,EAAAA,GAAG,CAACF,aAAJ,GAAoBmjB,aAAa,CAAC,eAAD,EAAkB,UAAU/3B,KAAV,EAAiB6U,YAAjB,EACO1B,MADP,EACelK,IADf,EAEOz7B,IAFP,EAEaiwB,QAFb,EAEuB;AACxE,QAAI,OAAOjwB,IAAP,KAAgB,UAApB,EAAgC;AAC9BiwB,MAAAA,QAAQ,GAAGjwB,IAAX;AACAA,MAAAA,IAAI,GAAGy7B,IAAP;AACAA,MAAAA,IAAI,GAAGkK,MAAP;AACAA,MAAAA,MAAM,GAAG,IAAT;AACD;;AACD,QAAItmC,EAAE,GAAGopD,WAAW,CAACj2B,KAAD,CAAX,GAAqB,GAArB,GAA2Bm5B,kBAAkB,CAACtkB,YAAD,CAAtD;AACA,QAAIv5B,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAOhqD,EAAP,CAAlB;;AACA,QAAIsmC,MAAJ,EAAY;AACV73B,MAAAA,GAAG,IAAI,UAAU63B,MAAjB;AACD;;AAED,QAAI,OAAOlK,IAAP,KAAgB,QAApB,EAA8B;AAC5B;AACA,UAAIJ,MAAJ;;AACA,UAAI;AACFA,QAAAA,MAAM,GAAGxB,QAAQ,CAAC4B,IAAD,CAAjB;AACD,OAFD,CAEE,OAAO/wB,GAAP,EAAY;AACZ,eAAOulB,QAAQ,CAACyG,WAAW,CAACf,OAAD,EACX,yCADW,CAAZ,CAAf;AAED;;AACD8F,MAAAA,IAAI,GAAGJ,MAAM,GAAGN,kBAAkB,CAACM,MAAD,EAASr7B,IAAT,CAArB,GAAsC,EAAnD;AACD,KAvBuE,CAyBxE;;;AACAyqD,IAAAA,SAAS,CAAC38C,GAAD,EAAM;AACbk8C,MAAAA,OAAO,EAAE,IAAInd,CAAJ,CAAM;AAAC,wBAAgB7sC;AAAjB,OAAN,CADI;AAEb4L,MAAAA,MAAM,EAAE,KAFK;AAGbsvC,MAAAA,IAAI,EAAEzf;AAHO,KAAN,EAINxL,QAJM,CAAT,CAIa1R,KAJb,CAImB0R,QAJnB;AAKD,GAjCgC,CAAjC,CAnfiC,CAshBjC;AACA;;AACAqX,EAAAA,GAAG,CAACsD,SAAJ,GAAgB,UAAU7T,GAAV,EAAe1F,IAAf,EAAqBpB,QAArB,EAA+B;AAC7C;AACA;AACA;AACA8G,IAAAA,GAAG,CAACmQ,SAAJ,GAAgB7V,IAAI,CAAC6V,SAArB;AAEAsjB,IAAAA,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AACvB,aAAOuC,OAAO,CAAC0Y,GAAR,CAAYgZ,GAAG,CAACxF,IAAJ,CAASrnB,GAAT,CAAay+C,uBAAb,CAAZ,CAAP;AACD,KAFD,EAEG7lD,IAFH,CAEQ,YAAY;AAClB;AACA,aAAO2nD,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,YAAP,CAAT,EAA+B;AAC7Cz9C,QAAAA,MAAM,EAAE,MADqC;AAE7CsvC,QAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAe80B,GAAf;AAFuC,OAA/B,EAGb9G,QAHa,CAAhB;AAID,KARD,EAQG1R,KARH,CAQS0R,QART;AASD,GAfD,CAxhBiC,CA0iBjC;;;AACAqX,EAAAA,GAAG,CAACH,IAAJ,GAAW,UAAUrQ,GAAV,EAAezF,IAAf,EAAqBpB,QAArB,EAA+B;AACxCu6B,IAAAA,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AACvB,aAAO6lD,uBAAuB,CAAC7xB,GAAD,CAA9B;AACD,KAFD,EAEGh0B,IAFH,CAEQ,YAAY;AAClB,aAAO2nD,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAOZ,WAAW,CAAC3xB,GAAG,CAAC4C,GAAL,CAAlB,CAAT,EAAuC;AACrD9tB,QAAAA,MAAM,EAAE,KAD6C;AAErDsvC,QAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAe60B,GAAf;AAF+C,OAAvC,CAAhB;AAID,KAPD,EAOGh0B,IAPH,CAOQ,UAAUzF,MAAV,EAAkB;AACxB4yB,MAAAA,QAAQ,CAAC,IAAD,EAAO5yB,MAAM,CAACiB,IAAd,CAAR;AACD,KATD,EASGigB,KATH,CASS,UAAU7T,GAAV,EAAe;AACtBA,MAAAA,GAAG,CAAC8nB,KAAJ,GAAYsE,GAAG,IAAIA,GAAG,CAAC4C,GAAvB;AACAzJ,MAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,KAZD;AAaD,GAdD,CA3iBiC,CA4jBjC;AACA;;;AACA48B,EAAAA,GAAG,CAACyC,OAAJ,GAAcwgB,aAAa,CAAC,SAAD,EAAY,UAAUl5B,IAAV,EAAgBpB,QAAhB,EAA0B;AAC/D,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,IAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ,CAL+D,CAO/D;;AACA,QAAIrY,MAAM,GAAG,EAAb;AACA,QAAIkiC,IAAJ;AACA,QAAItvC,MAAM,GAAG,KAAb;;AAEA,QAAIylB,IAAI,CAACsO,SAAT,EAAoB;AAClB3mB,MAAAA,MAAM,CAAC2mB,SAAP,GAAmB,IAAnB;AACD;AAED;;;AACA,QAAItO,IAAI,CAACgT,UAAT,EAAqB;AACnBrrB,MAAAA,MAAM,CAACqrB,UAAP,GAAoB,IAApB;AACD;;AAED,QAAIhT,IAAI,CAACmT,UAAT,EAAqB;AACnBxrB,MAAAA,MAAM,CAACwrB,UAAP,GAAoB,IAApB;AACD;;AAED,QAAInT,IAAI,CAACkG,YAAT,EAAuB;AACrBve,MAAAA,MAAM,CAACue,YAAP,GAAsB,IAAtB;AACD,KA3B8D,CA6B/D;;;AACA,QAAIlG,IAAI,CAACmG,WAAT,EAAsB;AACpBxe,MAAAA,MAAM,CAACwe,WAAP,GAAqB,IAArB;AACD;;AAED,QAAInG,IAAI,CAAC3yB,GAAT,EAAc;AACZsa,MAAAA,MAAM,CAACta,GAAP,GAAaqD,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAAC3yB,GAApB,CAAb;AACD;;AAED,QAAI2yB,IAAI,CAAC2Y,SAAT,EAAoB;AAClB3Y,MAAAA,IAAI,CAAC4Y,QAAL,GAAgB5Y,IAAI,CAAC2Y,SAArB;AACD;;AAED,QAAI3Y,IAAI,CAAC4Y,QAAT,EAAmB;AACjBjxB,MAAAA,MAAM,CAACixB,QAAP,GAAkBloC,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAAC4Y,QAApB,CAAlB;AACD;;AAED,QAAI5Y,IAAI,CAAC6Y,OAAT,EAAkB;AAChB7Y,MAAAA,IAAI,CAAC8Y,MAAL,GAAc9Y,IAAI,CAAC6Y,OAAnB;AACD;;AAED,QAAI7Y,IAAI,CAAC8Y,MAAT,EAAiB;AACfnxB,MAAAA,MAAM,CAACmxB,MAAP,GAAgBpoC,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAAC8Y,MAApB,CAAhB;AACD;;AAED,QAAI,OAAO9Y,IAAI,CAACwwB,aAAZ,KAA8B,WAAlC,EAA+C;AAC7C7oC,MAAAA,MAAM,CAAC6oC,aAAP,GAAuB,CAAC,CAACxwB,IAAI,CAACwwB,aAA9B;AACD;;AAED,QAAI,OAAOxwB,IAAI,CAACoT,KAAZ,KAAsB,WAA1B,EAAuC;AACrCzrB,MAAAA,MAAM,CAACyrB,KAAP,GAAepT,IAAI,CAACoT,KAApB;AACD;;AAED,QAAI,OAAOpT,IAAI,CAAC0U,IAAZ,KAAqB,WAAzB,EAAsC;AACpC/sB,MAAAA,MAAM,CAAC+sB,IAAP,GAAc1U,IAAI,CAAC0U,IAAnB;AACD;;AAED,QAAIgmB,QAAQ,GAAGzC,WAAW,CAACtwC,MAAD,CAA1B;;AAEA,QAAI,OAAOqY,IAAI,CAAC9yB,IAAZ,KAAqB,WAAzB,EAAsC;AACpCqN,MAAAA,MAAM,GAAG,MAAT;AACAsvC,MAAAA,IAAI,GAAG;AAAC38C,QAAAA,IAAI,EAAE8yB,IAAI,CAAC9yB;AAAZ,OAAP;AACD;;AAEDksD,IAAAA,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,cAAc0C,QAArB,CAAT,EAAyC;AAC/CngD,MAAAA,MAAM,EAAEA,MADuC;AAEhDsvC,MAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAei5C,IAAf;AAF0C,KAAzC,CAAT,CAGGp4C,IAHH,CAGQ,UAAUzF,MAAV,EAAkB;AACxB,UAAIg0B,IAAI,CAACkG,YAAL,IAAqBlG,IAAI,CAACmG,WAA1B,IAAyCnG,IAAI,CAACgK,MAAlD,EAA0D;AACxDh+B,QAAAA,MAAM,CAACiB,IAAP,CAAY01C,IAAZ,CAAiB10C,OAAjB,CAAyBkpD,6BAAzB;AACD;;AACDv4B,MAAAA,QAAQ,CAAC,IAAD,EAAO5yB,MAAM,CAACiB,IAAd,CAAR;AACD,KARD,EAQGigB,KARH,CAQS0R,QART;AASD,GAlF0B,CAA3B,CA9jBiC,CAkpBjC;AACA;AACA;;AACAqX,EAAAA,GAAG,CAAC3C,QAAJ,GAAe,UAAUtT,IAAV,EAAgB;AAE7B;AACA;AACA;AACA;AACA,QAAIkvB,SAAS,GAAG,gBAAgBlvB,IAAhB,GAAuBA,IAAI,CAAC26B,UAA5B,GAAyC7D,kBAAzD;AAEA92B,IAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;;AAEA,QAAIA,IAAI,CAAC8S,UAAL,IAAmB,EAAE,eAAe9S,IAAjB,CAAvB,EAA+C;AAC7CA,MAAAA,IAAI,CAAC46B,SAAL,GAAiB3D,iBAAjB;AACD;;AAED,QAAI4D,cAAc,GAAI,aAAa76B,IAAd,GAAsBA,IAAI,CAAC9E,OAA3B,GAAqC,KAAK,IAA/D,CAd6B,CAgB7B;;AACA,QAAI,aAAa8E,IAAb,IAAqBA,IAAI,CAAC9E,OAA1B,IACD2/B,cAAc,GAAG76B,IAAI,CAAC9E,OAAvB,GAAkC87B,sBADpC,EAC4D;AACxD6D,MAAAA,cAAc,GAAG76B,IAAI,CAAC9E,OAAL,GAAe87B,sBAAhC;AACH;AAED;;;AACA,QAAI,eAAeh3B,IAAf,IAAuBA,IAAI,CAAC46B,SAA5B,IACAC,cAAc,GAAG76B,IAAI,CAAC46B,SAAvB,GAAoC5D,sBADvC,EAC+D;AAC3D6D,MAAAA,cAAc,GAAG76B,IAAI,CAAC46B,SAAL,GAAiB5D,sBAAlC;AACH;;AAED,QAAIrvC,MAAM,GAAG,EAAb;;AACA,QAAI,aAAaqY,IAAb,IAAqBA,IAAI,CAAC9E,OAA9B,EAAuC;AACrCvT,MAAAA,MAAM,CAACuT,OAAP,GAAiB8E,IAAI,CAAC9E,OAAtB;AACD;;AAED,QAAIkY,KAAK,GAAI,OAAOpT,IAAI,CAACoT,KAAZ,KAAsB,WAAvB,GAAsCpT,IAAI,CAACoT,KAA3C,GAAmD,KAA/D;AACA,QAAI0nB,WAAW,GAAG1nB,KAAlB;;AAEA,QAAIpT,IAAI,CAACwS,KAAT,EAAgB;AACd7qB,MAAAA,MAAM,CAAC6qB,KAAP,GAAexS,IAAI,CAACwS,KAApB;AACD;;AAED,QAAIxS,IAAI,CAACkG,YAAL,IAAqBlG,IAAI,CAACpuB,MAAL,IAAe,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,UAA/D,EAA2E;AACzE+V,MAAAA,MAAM,CAACue,YAAP,GAAsB,IAAtB;AACD;;AAED,QAAIlG,IAAI,CAACmG,WAAT,EAAsB;AACpBxe,MAAAA,MAAM,CAACwe,WAAP,GAAqB,IAArB;AACD;;AAED,QAAInG,IAAI,CAAC8S,UAAT,EAAqB;AACnBnrB,MAAAA,MAAM,CAACozC,IAAP,GAAc,UAAd;AACD;;AAED,QAAI/6B,IAAI,CAACg7B,YAAT,EAAuB;AACrBrzC,MAAAA,MAAM,CAACqzC,YAAP,GAAsBh7B,IAAI,CAACg7B,YAA3B;AACD;;AAED,QAAIh7B,IAAI,CAACsO,SAAT,EAAoB;AAClB3mB,MAAAA,MAAM,CAAC2mB,SAAP,GAAmB,IAAnB;AACD;;AAED,QAAItO,IAAI,CAACmT,UAAT,EAAqB;AACnBxrB,MAAAA,MAAM,CAACwrB,UAAP,GAAoB,IAApB;AACD;AAED;;;AACA,QAAInT,IAAI,CAACgT,UAAT,EAAqB;AACnBrrB,MAAAA,MAAM,CAACqrB,UAAP,GAAoB,IAApB;AACD;;AAED,QAAI,eAAehT,IAAnB,EAAyB;AACvB;AACA,UAAIA,IAAI,CAAC46B,SAAT,EAAoB;AAClBjzC,QAAAA,MAAM,CAACizC,SAAP,GAAmB56B,IAAI,CAAC46B,SAAxB;AACD;AACF;;AAED,QAAI56B,IAAI,CAACpuB,MAAL,IAAe,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,QAA1C,EAAoD;AAClD+V,MAAAA,MAAM,CAAC/V,MAAP,GAAgBouB,IAAI,CAACpuB,MAArB;AACD;;AAED,QAAIouB,IAAI,CAACukB,IAAL,IAAa,OAAOvkB,IAAI,CAACukB,IAAZ,KAAqB,QAAtC,EAAgD;AAC9C58B,MAAAA,MAAM,CAAC/V,MAAP,GAAgB,OAAhB;AACA+V,MAAAA,MAAM,CAAC48B,IAAP,GAAcvkB,IAAI,CAACukB,IAAnB;AACD,KAnF4B,CAqF7B;AACA;;;AACA,QAAIvkB,IAAI,CAAC+F,YAAL,IAAqB,OAAO/F,IAAI,CAAC+F,YAAZ,KAA6B,QAAtD,EAAgE;AAC9D,WAAK,IAAIk1B,UAAT,IAAuBj7B,IAAI,CAAC+F,YAA5B,EAA0C;AACxC;AACA,YAAI/F,IAAI,CAAC+F,YAAL,CAAkBvU,cAAlB,CAAiCypC,UAAjC,CAAJ,EAAkD;AAChDtzC,UAAAA,MAAM,CAACszC,UAAD,CAAN,GAAqBj7B,IAAI,CAAC+F,YAAL,CAAkBk1B,UAAlB,CAArB;AACD;AACF;AACF;;AAED,QAAI1gD,MAAM,GAAG,KAAb;AACA,QAAIsvC,IAAJ;;AAEA,QAAI7pB,IAAI,CAACykB,OAAT,EAAkB;AAChB;AACA;AACA98B,MAAAA,MAAM,CAAC/V,MAAP,GAAgB,UAAhB;AACA2I,MAAAA,MAAM,GAAG,MAAT;AACAsvC,MAAAA,IAAI,GAAG;AAACpF,QAAAA,OAAO,EAAEzkB,IAAI,CAACykB;AAAf,OAAP;AACD;AACD;AAPA,SAQK,IAAIzkB,IAAI,CAACjoB,QAAT,EAAmB;AACtB;AACA4P,QAAAA,MAAM,CAAC/V,MAAP,GAAgB,WAAhB;AACA2I,QAAAA,MAAM,GAAG,MAAT;AACAsvC,QAAAA,IAAI,GAAG;AAAC9xC,UAAAA,QAAQ,EAAEioB,IAAI,CAACjoB;AAAhB,SAAP;AACD;;AAED,QAAImjD,UAAU,GAAG,IAAIlqD,CAAJ,EAAjB;AACA,QAAImqD,cAAJ,CAnH6B,CAqH7B;AACA;;AACA,QAAId,SAAS,GAAG,UAAU73B,KAAV,EAAiB5D,QAAjB,EAA2B;AACzC,UAAIoB,IAAI,CAACo7B,OAAT,EAAkB;AAChB;AACD;;AACDzzC,MAAAA,MAAM,CAAC6a,KAAP,GAAeA,KAAf,CAJyC,CAKzC;;AACA;;AACA,UAAI,OAAO7a,MAAM,CAAC6a,KAAd,KAAwB,QAA5B,EAAsC;AACpC7a,QAAAA,MAAM,CAAC6a,KAAP,GAAe9xB,IAAI,CAACE,SAAL,CAAe+W,MAAM,CAAC6a,KAAtB,CAAf;AACD;;AAED,UAAIxC,IAAI,CAACmT,UAAT,EAAqB;AACnB,YAAIC,KAAJ,EAAW;AACTzrB,UAAAA,MAAM,CAACyrB,KAAP,GAAe0nB,WAAf;AACD;AACF,OAJD,MAIO;AACLnzC,QAAAA,MAAM,CAACyrB,KAAP,GAAgB,CAACA,KAAD,IAAU0nB,WAAW,GAAG5L,SAAzB,GACbA,SADa,GACD4L,WADd;AAED,OAlBwC,CAoBzC;;;AACA,UAAIr+C,GAAG,GAAGo7C,QAAQ,CAACG,IAAD,EAAO,aAAaC,WAAW,CAACtwC,MAAD,CAA/B,CAAlB;AACA,UAAI0zC,SAAS,GAAG;AACdC,QAAAA,MAAM,EAAEJ,UAAU,CAACI,MADL;AAEd/gD,QAAAA,MAAM,EAAEA,MAFM;AAGdsvC,QAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAei5C,IAAf;AAHQ,OAAhB;AAKAsR,MAAAA,cAAc,GAAG34B,KAAjB;AAEA;;AACA,UAAIxC,IAAI,CAACo7B,OAAT,EAAkB;AAChB;AACD,OAhCwC,CAkCzC;;;AACAjC,MAAAA,KAAK,GAAG1nD,IAAR,CAAa,YAAY;AACvB,eAAO2nD,SAAS,CAAC38C,GAAD,EAAM4+C,SAAN,EAAiBz8B,QAAjB,CAAhB;AACD,OAFD,EAEG1R,KAFH,CAES0R,QAFT;AAGD,KAtCD,CAvH6B,CA+J7B;AACA;AACA;;;AACA,QAAIhS,OAAO,GAAG;AAACA,MAAAA,OAAO,EAAE;AAAV,KAAd;;AAEA,QAAI2uC,OAAO,GAAG,UAAUliD,GAAV,EAAemjB,GAAf,EAAoB;AAChC,UAAIwD,IAAI,CAACo7B,OAAT,EAAkB;AAChB;AACD;;AACD,UAAII,kBAAkB,GAAG,CAAzB,CAJgC,CAKhC;;AACA,UAAIh/B,GAAG,IAAIA,GAAG,CAAC5P,OAAf,EAAwB;AACtB4uC,QAAAA,kBAAkB,GAAGh/B,GAAG,CAAC5P,OAAJ,CAAYpjB,MAAjC;AACAojB,QAAAA,OAAO,CAACkoB,QAAR,GAAmBtY,GAAG,CAACsY,QAAvB;AACA,YAAI9C,OAAO,GAAG,IAAd;AACA,YAAIC,OAAO,GAAG,IAAd,CAJsB,CAKtB;;AACA;;AACA,YAAI,OAAOzV,GAAG,CAACwV,OAAX,KAAuB,QAA3B,EAAqC;AACnCA,UAAAA,OAAO,GAAGxV,GAAG,CAACwV,OAAd;AACD;;AACD,YAAI,OAAOplB,OAAO,CAACkoB,QAAf,KAA4B,QAA5B,IAAwC,OAAOloB,OAAO,CAACkoB,QAAf,KAA4B,QAAxE,EAAkF;AAChF7C,UAAAA,OAAO,GAAGrlB,OAAO,CAACkoB,QAAlB;AACD,SAZqB,CAatB;;;AACA,YAAIpP,GAAG,GAAG,EAAV;AACAA,QAAAA,GAAG,CAACI,KAAJ,GAAY9F,IAAI,CAAC+F,YAAjB;AACAvJ,QAAAA,GAAG,CAAC5P,OAAJ,GAAc4P,GAAG,CAAC5P,OAAJ,CAAYhb,MAAZ,CAAmB,UAAUvC,CAAV,EAAa;AAC5CyrD,UAAAA,WAAW;AACX,cAAI7gC,GAAG,GAAG2L,YAAY,CAAC5F,IAAD,CAAZ,CAAmB3wB,CAAnB,CAAV;;AACA,cAAI4qB,GAAJ,EAAS;AACP,gBAAI+F,IAAI,CAACkG,YAAL,IAAqBlG,IAAI,CAACmG,WAA1B,IAAyCnG,IAAI,CAACgK,MAAlD,EAA0D;AACxDmtB,cAAAA,6BAA6B,CAAC9nD,CAAD,CAA7B;AACD;;AACD,gBAAI2wB,IAAI,CAACwX,WAAT,EAAsB;AACpB5qB,cAAAA,OAAO,CAACA,OAAR,CAAgB/d,IAAhB,CAAqBQ,CAArB;AACD;;AACD2wB,YAAAA,IAAI,CAAC0C,QAAL,CAAcrzB,CAAd,EAAiB2iC,OAAjB,EAA0BC,OAA1B;AACD;;AACD,iBAAOhY,GAAP;AACD,SAba,CAAd;AAcD,OA9BD,MA8BO,IAAI5gB,GAAJ,EAAS;AACd;AACA;AACA2mB,QAAAA,IAAI,CAACo7B,OAAL,GAAe,IAAf;AACAp7B,QAAAA,IAAI,CAAClZ,QAAL,CAAczN,GAAd;AACA;AACD,OA1C+B,CA4ChC;AACA;;;AACA,UAAImjB,GAAG,IAAIA,GAAG,CAACsY,QAAf,EAAyB;AACvBqmB,QAAAA,cAAc,GAAG3+B,GAAG,CAACsY,QAArB;AACD;;AAED,UAAI2mB,QAAQ,GAAIroB,KAAK,IAAI0nB,WAAW,IAAI,CAAzB,IACZt+B,GAAG,IAAIg/B,kBAAkB,GAAGtM,SADhB,IAEZlvB,IAAI,CAACmT,UAFR;;AAIA,UAAKnT,IAAI,CAAC8S,UAAL,IAAmB,EAAEM,KAAK,IAAI0nB,WAAW,IAAI,CAA1B,CAApB,IAAqD,CAACW,QAA1D,EAAoE;AAClE;AACA,gCAAU,YAAY;AAAEpB,UAAAA,SAAS,CAACc,cAAD,EAAiBI,OAAjB,CAAT;AAAqC,SAA7D;AACD,OAHD,MAGO;AACL;AACAv7B,QAAAA,IAAI,CAAClZ,QAAL,CAAc,IAAd,EAAoB8F,OAApB;AACD;AACF,KA7DD;;AA+DAytC,IAAAA,SAAS,CAACr6B,IAAI,CAACwC,KAAL,IAAc,CAAf,EAAkB+4B,OAAlB,CAAT,CAnO6B,CAqO7B;;AACA,WAAO;AACLppB,MAAAA,MAAM,EAAE,YAAY;AAClBnS,QAAAA,IAAI,CAACo7B,OAAL,GAAe,IAAf;AACAF,QAAAA,UAAU,CAAC7f,KAAX;AACD;AAJI,KAAP;AAMD,GA5OD,CArpBiC,CAm4BjC;AACA;AACA;;;AACApF,EAAAA,GAAG,CAACU,QAAJ,GAAeuiB,aAAa,CAAC,UAAD,EAAa,UAAUxzB,GAAV,EAAe1F,IAAf,EAAqBpB,QAArB,EAA+B;AACtE;AACA,QAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD,KALqE,CAOtE;;;AACAo5B,IAAAA,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,YAAP,CAAT,EAA+B;AACtCz9C,MAAAA,MAAM,EAAE,MAD8B;AAEtCsvC,MAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAe80B,GAAf;AAFgC,KAA/B,EAGN9G,QAHM,CAAT,CAGa1R,KAHb,CAGmB0R,QAHnB;AAID,GAZ2B,CAA5B;;AAcAqX,EAAAA,GAAG,CAACgD,MAAJ,GAAa,UAAUra,QAAV,EAAoB;AAC/BA,IAAAA,QAAQ;AACT,GAFD;;AAIAqX,EAAAA,GAAG,CAAC+D,QAAJ,GAAe,UAAUnpB,OAAV,EAAmB+N,QAAnB,EAA6B;AAC1Cw6B,IAAAA,SAAS,CAACvB,QAAQ,CAACG,IAAD,EAAO,EAAP,CAAT,EAAqB;AAACz9C,MAAAA,MAAM,EAAE;AAAT,KAArB,CAAT,CAAkD9I,IAAlD,CAAuD,UAAU03C,IAAV,EAAgB;AACrEvqB,MAAAA,QAAQ,CAAC,IAAD,EAAOuqB,IAAP,CAAR;AACD,KAFD,EAEGj8B,KAFH,CAES,UAAU7T,GAAV,EAAe;AACtB;AACA,UAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtBzE,QAAAA,QAAQ,CAAC,IAAD,EAAO;AAACiB,UAAAA,EAAE,EAAE;AAAL,SAAP,CAAR;AACD,OAFD,MAEO;AACLjB,QAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD;AACF,KATD;AAUD,GAXD;AAYD,EAED;;;AACAm/C,SAAS,CAACrd,KAAV,GAAkB,YAAY;AAC5B,SAAO,IAAP;AACD,CAFD;;AAIA,SAASugB,WAAT,CAAsBhpB,OAAtB,EAA+B;AAC7BA,EAAAA,OAAO,CAAC3d,OAAR,CAAgB,MAAhB,EAAwByjC,SAAxB,EAAmC,KAAnC;AACA9lB,EAAAA,OAAO,CAAC3d,OAAR,CAAgB,OAAhB,EAAyByjC,SAAzB,EAAoC,KAApC;AACD;;AAED,SAASmD,eAAT,CAAyB1oD,OAAzB,EAAkC;AAChC,OAAKowB,MAAL,GAAc,GAAd;AACA,OAAKn1B,IAAL,GAAY,mBAAZ;AACA,OAAK+E,OAAL,GAAeA,OAAf;AACA,OAAKgC,KAAL,GAAa,IAAb;;AACA,MAAI;AACF3J,IAAAA,KAAK,CAACswD,iBAAN,CAAwB,IAAxB,EAA8BD,eAA9B;AACD,GAFD,CAEE,OAAOnxD,CAAP,EAAU,CAAE;AACf;;AAED,uBAASmxD,eAAT,EAA0BrwD,KAA1B;;AAEA,SAASuwD,aAAT,CAAuB5oD,OAAvB,EAAgC;AAC9B,OAAKowB,MAAL,GAAc,GAAd;AACA,OAAKn1B,IAAL,GAAY,WAAZ;AACA,OAAK+E,OAAL,GAAeA,OAAf;AACA,OAAKgC,KAAL,GAAa,IAAb;;AACA,MAAI;AACF3J,IAAAA,KAAK,CAACswD,iBAAN,CAAwB,IAAxB,EAA8BC,aAA9B;AACD,GAFD,CAEE,OAAOrxD,CAAP,EAAU,CAAE;AACf;;AAED,uBAASqxD,aAAT,EAAwBvwD,KAAxB;;AAEA,SAASwwD,YAAT,CAAsB7oD,OAAtB,EAA+B;AAC7B,OAAKowB,MAAL,GAAc,GAAd;AACA,OAAKn1B,IAAL,GAAY,eAAZ;AACA,OAAK+E,OAAL,GAAeA,OAAf;AACA,OAAKgC,KAAL,GAAa,IAAb;;AACA,MAAI;AACF3J,IAAAA,KAAK,CAACswD,iBAAN,CAAwB,IAAxB,EAA8BE,YAA9B;AACD,GAFD,CAEE,OAAOtxD,CAAP,EAAU,CAAE;AACf;;AAED,uBAASsxD,YAAT,EAAuBxwD,KAAvB;;AAEA,SAASywD,gBAAT,CAA0BjrC,OAA1B,EAAmC8N,QAAnC,EAA6C;AAC3C,MAAIA,QAAJ,EAAc;AACZ9N,IAAAA,OAAO,CAACrf,IAAR,CAAa,UAAU+qB,GAAV,EAAe;AAC1B,8BAAU,YAAY;AACpBoC,QAAAA,QAAQ,CAAC,IAAD,EAAOpC,GAAP,CAAR;AACD,OAFD;AAGD,KAJD,EAIG,UAAUoH,MAAV,EAAkB;AACnB,8BAAU,YAAY;AACpBhF,QAAAA,QAAQ,CAACgF,MAAD,CAAR;AACD,OAFD;AAGD,KARD;AASD;;AACD,SAAO9S,OAAP;AACD;;AAED,SAASkrC,WAAT,CAAqBvhC,GAArB,EAA0B;AACxB,SAAO,wBAAa,UAAU/f,IAAV,EAAgB;AAClC,QAAItQ,EAAE,GAAGsQ,IAAI,CAACsf,GAAL,EAAT;AACA,QAAIlJ,OAAO,GAAG2J,GAAG,CAACpwB,KAAJ,CAAU,IAAV,EAAgBqQ,IAAhB,CAAd;;AACA,QAAI,OAAOtQ,EAAP,KAAc,UAAlB,EAA8B;AAC5B2xD,MAAAA,gBAAgB,CAACjrC,OAAD,EAAU1mB,EAAV,CAAhB;AACD;;AACD,WAAO0mB,OAAP;AACD,GAPM,CAAP;AAQD,EAED;;;AACA,SAASmrC,GAAT,CAAanrC,OAAb,EAAsBorC,mBAAtB,EAA2C;AACzC,SAAOprC,OAAO,CAACrf,IAAR,CAAa,UAAU+qB,GAAV,EAAe;AACjC,WAAO0/B,mBAAmB,GAAGzqD,IAAtB,CAA2B,YAAY;AAC5C,aAAO+qB,GAAP;AACD,KAFM,CAAP;AAGD,GAJM,EAIJ,UAAUoH,MAAV,EAAkB;AACnB,WAAOs4B,mBAAmB,GAAGzqD,IAAtB,CAA2B,YAAY;AAC5C,YAAMmyB,MAAN;AACD,KAFM,CAAP;AAGD,GARM,CAAP;AASD;;AAED,SAASu4B,aAAT,CAAuBvhC,KAAvB,EAA8BwhC,cAA9B,EAA8C;AAC5C,SAAO,YAAY;AACjB,QAAI1hD,IAAI,GAAGpQ,SAAX;AACA,QAAIwsB,IAAI,GAAG,IAAX;AACA,WAAO8D,KAAK,CAAC+B,GAAN,CAAU,YAAY;AAC3B,aAAOy/B,cAAc,CAAC/xD,KAAf,CAAqBysB,IAArB,EAA2Bpc,IAA3B,CAAP;AACD,KAFM,CAAP;AAGD,GAND;AAOD,EAED;AACA;;;AACA,SAAS2hD,IAAT,CAAcxiC,GAAd,EAAmB;AACjB,MAAIyiC,MAAM,GAAG,IAAIr/B,WAAJ,CAAgBpD,GAAhB,CAAb;AACA,MAAI7tB,MAAM,GAAG,IAAI+tB,KAAJ,CAAUuiC,MAAM,CAACxoC,IAAjB,CAAb;AACA,MAAI1D,KAAK,GAAG,CAAC,CAAb;AACAksC,EAAAA,MAAM,CAACruD,OAAP,CAAe,UAAUV,KAAV,EAAiB;AAC9BvB,IAAAA,MAAM,CAAC,EAAEokB,KAAH,CAAN,GAAkB7iB,KAAlB;AACD,GAFD;AAGA,SAAOvB,MAAP;AACD;;AAED,SAASuwD,cAAT,CAAwB1jD,GAAxB,EAA6B;AAC3B,MAAI7M,MAAM,GAAG,IAAI+tB,KAAJ,CAAUlhB,GAAG,CAACib,IAAd,CAAb;AACA,MAAI1D,KAAK,GAAG,CAAC,CAAb;AACAvX,EAAAA,GAAG,CAAC5K,OAAJ,CAAY,UAAUV,KAAV,EAAiBF,GAAjB,EAAsB;AAChCrB,IAAAA,MAAM,CAAC,EAAEokB,KAAH,CAAN,GAAkB/iB,GAAlB;AACD,GAFD;AAGA,SAAOrB,MAAP;AACD;;AAED,SAASwwD,kBAAT,CAA4BtuD,IAA5B,EAAkC;AAChC,MAAI+E,OAAO,GAAG,aAAa/E,IAAb,GACZ,6CADY,GAEZ,mBAFF;AAGA,SAAO,IAAI4tD,YAAJ,CAAiB7oD,OAAjB,CAAP;AACD;;AAED,SAASwpD,GAAT,CAAa30B,MAAb,EAAqB;AACnB,MAAI97B,MAAM,GAAG,CAAb;;AACA,OAAK,IAAI8S,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGwQ,MAAM,CAACt+B,MAA7B,EAAqCsV,CAAC,GAAGwY,GAAzC,EAA8CxY,CAAC,EAA/C,EAAmD;AACjD,QAAI0hC,GAAG,GAAG1Y,MAAM,CAAChpB,CAAD,CAAhB;;AACA,QAAI,OAAO0hC,GAAP,KAAe,QAAnB,EAA6B;AAC3B,UAAIzmB,KAAK,CAAC2C,OAAN,CAAc8jB,GAAd,CAAJ,EAAwB;AACtB;AACAx0C,QAAAA,MAAM,GAAG,OAAOA,MAAP,KAAkB,QAAlB,GAA6B,CAACA,MAAD,CAA7B,GAAwCA,MAAjD;;AACA,aAAK,IAAI+T,CAAC,GAAG,CAAR,EAAW28C,IAAI,GAAGlc,GAAG,CAACh3C,MAA3B,EAAmCuW,CAAC,GAAG28C,IAAvC,EAA6C38C,CAAC,EAA9C,EAAkD;AAChD,cAAI48C,IAAI,GAAGnc,GAAG,CAACzgC,CAAD,CAAd;;AACA,cAAI,OAAO48C,IAAP,KAAgB,QAApB,EAA8B;AAC5B,kBAAMH,kBAAkB,CAAC,MAAD,CAAxB;AACD,WAFD,MAEO,IAAI,OAAOxwD,MAAM,CAAC+T,CAAD,CAAb,KAAqB,WAAzB,EAAsC;AAC3C/T,YAAAA,MAAM,CAAC6C,IAAP,CAAY8tD,IAAZ;AACD,WAFM,MAEA;AACL3wD,YAAAA,MAAM,CAAC+T,CAAD,CAAN,IAAa48C,IAAb;AACD;AACF;AACF,OAbD,MAaO;AAAE;AACP,cAAMH,kBAAkB,CAAC,MAAD,CAAxB;AACD;AACF,KAjBD,MAiBO,IAAI,OAAOxwD,MAAP,KAAkB,QAAtB,EAAgC;AACrCA,MAAAA,MAAM,IAAIw0C,GAAV;AACD,KAFM,MAEA;AAAE;AACPx0C,MAAAA,MAAM,CAAC,CAAD,CAAN,IAAaw0C,GAAb;AACD;AACF;;AACD,SAAOx0C,MAAP;AACD;;AAED,IAAIR,GAAG,GAAGq3B,cAAc,CAACtvB,IAAf,CAAoB,IAApB,EAA0B,KAA1B,CAAV;AACA,IAAImpB,OAAO,GAAG3C,KAAK,CAAC2C,OAApB;AACA,IAAIjW,MAAM,GAAG/V,IAAI,CAACC,KAAlB;;AAEA,SAASisD,oBAAT,CAA8BnsD,IAA9B,EAAoCumB,IAApC,EAA0C;AACxC,SAAO2Q,SAAS,CACd,aAAal3B,IAAI,CAAC4K,OAAL,CAAa,OAAb,EAAsB,EAAtB,CAAb,GAAyC,IAD3B,EAEd;AACE2b,IAAAA,IAAI,EAAEA,IADR;AAEEylC,IAAAA,GAAG,EAAEA,GAFP;AAGEjxD,IAAAA,GAAG,EAAEA,GAHP;AAIEkxB,IAAAA,OAAO,EAAEA,OAJX;AAKEjW,IAAAA,MAAM,EAAEA;AALV,GAFc,CAAhB;AAUD;AAED;;;;;;AAMA,SAASo2C,WAAT,GAAuB;AACrB,OAAK/rC,OAAL,GAAe,IAAI9c,OAAJ,CAAY,UAAU0qB,OAAV,EAAmB;AAACA,IAAAA,OAAO;AAAK,GAA5C,CAAf;AACD;;AACDm+B,WAAW,CAAC7yD,SAAZ,CAAsB2yB,GAAtB,GAA4B,UAAUy/B,cAAV,EAA0B;AACpD,OAAKtrC,OAAL,GAAe,KAAKA,OAAL,CAAa5D,KAAb,CAAmB,YAAY,CAC5C;AACD,GAFc,EAEZzb,IAFY,CAEP,YAAY;AAClB,WAAO2qD,cAAc,EAArB;AACD,GAJc,CAAf;AAKA,SAAO,KAAKtrC,OAAZ;AACD,CAPD;;AAQA+rC,WAAW,CAAC7yD,SAAZ,CAAsBujD,MAAtB,GAA+B,YAAY;AACzC,SAAO,KAAKz8B,OAAZ;AACD,CAFD;;AAIA,SAASlgB,SAAT,CAAmB6tC,KAAnB,EAA0B;AACxB,MAAI,CAACA,KAAL,EAAY;AACV,WAAO,WAAP,CADU,CACU;AACrB,GAHuB,CAIxB;AACA;;;AACA,UAAQ,OAAOA,KAAf;AACE,SAAK,UAAL;AACE;AACA,aAAOA,KAAK,CAAC3xC,QAAN,EAAP;;AACF,SAAK,QAAL;AACE;AACA,aAAO2xC,KAAK,CAAC3xC,QAAN,EAAP;;AACF;AACE;AACA,aAAO4D,IAAI,CAACE,SAAL,CAAe6tC,KAAf,CAAP;AATJ;AAWD;AAED;;;AACA,SAASqe,mBAAT,CAA6BlY,MAA7B,EAAqCmY,SAArC,EAAgD;AAC9C;AACA,SAAOnsD,SAAS,CAACg0C,MAAD,CAAT,GAAoBh0C,SAAS,CAACmsD,SAAD,CAA7B,GAA2C,WAAlD;AACD;;AAED,SAASC,UAAT,CAAoBC,QAApB,EAA8BvY,QAA9B,EAAwCE,MAAxC,EAAgDmY,SAAhD,EAA2DG,SAA3D,EAAsEC,YAAtE,EAAoF;AAClF,MAAIC,aAAa,GAAGN,mBAAmB,CAAClY,MAAD,EAASmY,SAAT,CAAvC;AAEA,MAAIM,WAAJ;;AACA,MAAI,CAACH,SAAL,EAAgB;AACd;AACAG,IAAAA,WAAW,GAAGJ,QAAQ,CAACK,YAAT,GAAwBL,QAAQ,CAACK,YAAT,IAAyB,EAA/D;;AACA,QAAID,WAAW,CAACD,aAAD,CAAf,EAAgC;AAC9B,aAAOC,WAAW,CAACD,aAAD,CAAlB;AACD;AACF;;AAED,MAAIG,cAAc,GAAGN,QAAQ,CAACx8B,IAAT,GAAgBhvB,IAAhB,CAAqB,UAAUgvB,IAAV,EAAgB;AAExD,QAAI+8B,SAAS,GAAG/8B,IAAI,CAAC0Y,OAAL,GAAe,UAAf,IACb+jB,SAAS,GAAG,MAAH,GAAY7wB,SAAS,CAAC+wB,aAAD,CADjB,CAAhB,CAFwD,CAKxD;AACA;;AACA,aAASK,YAAT,CAAsBh4B,GAAtB,EAA2B;AACzBA,MAAAA,GAAG,CAACof,KAAJ,GAAYpf,GAAG,CAACof,KAAJ,IAAa,EAAzB;AACA,UAAI6Y,YAAY,GAAGhZ,QAAnB;;AACA,UAAIgZ,YAAY,CAACxmD,OAAb,CAAqB,GAArB,MAA8B,CAAC,CAAnC,EAAsC;AACpCwmD,QAAAA,YAAY,GAAGhZ,QAAQ,GAAG,GAAX,GAAiBA,QAAhC;AACD;;AACD,UAAIiZ,MAAM,GAAGl4B,GAAG,CAACof,KAAJ,CAAU6Y,YAAV,IAA0Bj4B,GAAG,CAACof,KAAJ,CAAU6Y,YAAV,KAA2B,EAAlE;AACA;;AACA,UAAIC,MAAM,CAACH,SAAD,CAAV,EAAuB;AACrB,eADqB,CACb;AACT;;AACDG,MAAAA,MAAM,CAACH,SAAD,CAAN,GAAoB,IAApB;AACA,aAAO/3B,GAAP;AACD;;AACD,WAAOsC,MAAM,CAACk1B,QAAD,EAAW,YAAYE,YAAvB,EAAqCM,YAArC,CAAN,CAAyDhsD,IAAzD,CAA8D,YAAY;AAC/E,aAAOwrD,QAAQ,CAACzjB,yBAAT,CAAmCgkB,SAAnC,EAA8C/rD,IAA9C,CAAmD,UAAU+qB,GAAV,EAAe;AACvE,YAAIuD,EAAE,GAAGvD,GAAG,CAACuD,EAAb;AACAA,QAAAA,EAAE,CAACqZ,eAAH,GAAqB,IAArB;AACA,YAAImL,IAAI,GAAG;AACTr2C,UAAAA,IAAI,EAAEsvD,SADG;AAETz9B,UAAAA,EAAE,EAAEA,EAFK;AAGTk9B,UAAAA,QAAQ,EAAEA,QAHD;AAITloC,UAAAA,OAAO,EAAEkoC,QAAQ,CAACloC,OAJT;AAKT6vB,UAAAA,MAAM,EAAEA,MALC;AAMTmY,UAAAA,SAAS,EAAEA;AANF,SAAX;AAQA,eAAOxY,IAAI,CAACxkB,EAAL,CAAQ/0B,GAAR,CAAY,gBAAZ,EAA8BkiB,KAA9B,CAAoC,UAAU7T,GAAV,EAAe;AACxD;AACA,cAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,kBAAMhqB,GAAN;AACD;AACF,SALM,EAKJ5H,IALI,CAKC,UAAUmsD,UAAV,EAAsB;AAC5BrZ,UAAAA,IAAI,CAAChiB,GAAL,GAAWq7B,UAAU,GAAGA,UAAU,CAACr7B,GAAd,GAAoB,CAAzC;;AACA,cAAI86B,WAAJ,EAAiB;AACf9Y,YAAAA,IAAI,CAACxkB,EAAL,CAAQjH,IAAR,CAAa,WAAb,EAA0B,YAAY;AACpC,qBAAOukC,WAAW,CAACD,aAAD,CAAlB;AACD,aAFD;AAGD;;AACD,iBAAO7Y,IAAP;AACD,SAbM,CAAP;AAcD,OAzBM,CAAP;AA0BD,KA3BM,CAAP;AA4BD,GAjDoB,CAArB;;AAmDA,MAAI8Y,WAAJ,EAAiB;AACfA,IAAAA,WAAW,CAACD,aAAD,CAAX,GAA6BG,cAA7B;AACD;;AACD,SAAOA,cAAP;AACD;;AAED,IAAIM,gBAAgB,GAAG,EAAvB;AACA,IAAIC,aAAa,GAAG,IAAIjB,WAAJ,EAApB;AACA,IAAIkB,oBAAoB,GAAG,EAA3B;;AAEA,SAASC,aAAT,CAAuB9vD,IAAvB,EAA6B;AAC3B;AACA;AACA,SAAOA,IAAI,CAACgJ,OAAL,CAAa,GAAb,MAAsB,CAAC,CAAvB,GAA2B,CAAChJ,IAAD,EAAOA,IAAP,CAA3B,GAA0CA,IAAI,CAACmb,KAAL,CAAW,GAAX,CAAjD;AACD;;AAED,SAAS40C,QAAT,CAAkB37B,OAAlB,EAA2B;AACzB;AACA;AACA,SAAOA,OAAO,CAAC94B,MAAR,KAAmB,CAAnB,IAAwB,MAAM4lB,IAAN,CAAWkT,OAAO,CAAC,CAAD,CAAP,CAAWd,GAAtB,CAA/B;AACD;;AAED,SAAS08B,SAAT,CAAmBn+B,EAAnB,EAAuBv1B,CAAvB,EAA0B;AACxB,MAAI;AACFu1B,IAAAA,EAAE,CAAC/I,IAAH,CAAQ,OAAR,EAAiBxsB,CAAjB;AACD,GAFD,CAEE,OAAO6O,GAAP,EAAY;AACZwpB,IAAAA,cAAc,CAAC,OAAD,EACZ,+DACA,sCADA,GAEA,2DAFA,GAGA,+CAJY,CAAd;AAKAA,IAAAA,cAAc,CAAC,OAAD,EAAUr4B,CAAV,CAAd;AACD;AACF;AAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,SAAS2zD,uBAAT,CAAiChB,YAAjC,EAA+CiB,MAA/C,EAAuDC,OAAvD,EAAgEC,aAAhE,EAA+E;AAE7E,WAASC,MAAT,CAAgBx+B,EAAhB,EAAoBtF,GAApB,EAAyBgL,GAAzB,EAA8B;AAC5B;AACA;AACA,QAAI;AACFhL,MAAAA,GAAG,CAACgL,GAAD,CAAH;AACD,KAFD,CAEE,OAAOj7B,CAAP,EAAU;AACV0zD,MAAAA,SAAS,CAACn+B,EAAD,EAAKv1B,CAAL,CAAT;AACD;AACF;;AAED,WAASg0D,SAAT,CAAmBz+B,EAAnB,EAAuBtF,GAAvB,EAA4BvtB,IAA5B,EAAkC46B,MAAlC,EAA0C22B,QAA1C,EAAoD;AAClD;AACA;AACA;AACA;AACA,QAAI;AACF,aAAO;AAACC,QAAAA,MAAM,EAAGjkC,GAAG,CAACvtB,IAAD,EAAO46B,MAAP,EAAe22B,QAAf;AAAb,OAAP;AACD,KAFD,CAEE,OAAOj0D,CAAP,EAAU;AACV0zD,MAAAA,SAAS,CAACn+B,EAAD,EAAKv1B,CAAL,CAAT;AACA,aAAO;AAACyK,QAAAA,KAAK,EAAEzK;AAAR,OAAP;AACD;AACF;;AAED,WAASm0D,kBAAT,CAA4Bh/B,CAA5B,EAA+Bi/B,CAA/B,EAAkC;AAChC,QAAIC,UAAU,GAAGvf,OAAO,CAAC3f,CAAC,CAACtyB,GAAH,EAAQuxD,CAAC,CAACvxD,GAAV,CAAxB;AACA,WAAOwxD,UAAU,KAAK,CAAf,GAAmBA,UAAnB,GAAgCvf,OAAO,CAAC3f,CAAC,CAACpyB,KAAH,EAAUqxD,CAAC,CAACrxD,KAAZ,CAA9C;AACD;;AAED,WAASuxD,YAAT,CAAsBlyC,OAAtB,EAA+BwmB,KAA/B,EAAsCsB,IAAtC,EAA4C;AAC1CA,IAAAA,IAAI,GAAGA,IAAI,IAAI,CAAf;;AACA,QAAI,OAAOtB,KAAP,KAAiB,QAArB,EAA+B;AAC7B,aAAOxmB,OAAO,CAAC1c,KAAR,CAAcwkC,IAAd,EAAoBtB,KAAK,GAAGsB,IAA5B,CAAP;AACD,KAFD,MAEO,IAAIA,IAAI,GAAG,CAAX,EAAc;AACnB,aAAO9nB,OAAO,CAAC1c,KAAR,CAAcwkC,IAAd,CAAP;AACD;;AACD,WAAO9nB,OAAP;AACD;;AAED,WAASmyC,UAAT,CAAoBtnB,GAApB,EAAyB;AACvB,QAAI5qC,GAAG,GAAG4qC,GAAG,CAAClqC,KAAd,CADuB,CAEvB;AACA;;AACA,QAAI4zB,KAAK,GAAIt0B,GAAG,IAAI,OAAOA,GAAP,KAAe,QAAtB,IAAkCA,GAAG,CAACw7B,GAAvC,IAA+CoP,GAAG,CAACzpC,EAA/D;AACA,WAAOmzB,KAAP;AACD;;AAED,WAASg2B,6BAAT,CAAuC36B,GAAvC,EAA4C;AAC1CA,IAAAA,GAAG,CAACmmB,IAAJ,CAAS10C,OAAT,CAAiB,UAAUwpC,GAAV,EAAe;AAC9B,UAAI5D,IAAI,GAAG4D,GAAG,CAAChS,GAAJ,IAAWgS,GAAG,CAAChS,GAAJ,CAAQY,YAA9B;;AACA,UAAI,CAACwN,IAAL,EAAW;AACT;AACD;;AACD/oC,MAAAA,MAAM,CAACoC,IAAP,CAAY2mC,IAAZ,EAAkB5lC,OAAlB,CAA0B,UAAUw/C,QAAV,EAAoB;AAC5C,YAAIrnB,GAAG,GAAGyN,IAAI,CAAC4Z,QAAD,CAAd;AACA5Z,QAAAA,IAAI,CAAC4Z,QAAD,CAAJ,CAAexgD,IAAf,GAAsB28B,YAAY,CAACxD,GAAG,CAACn5B,IAAL,EAAWm5B,GAAG,CAACgQ,YAAf,CAAlC;AACD,OAHD;AAID,KATD;AAUD;;AAED,WAAS4oB,sBAAT,CAAgCh/B,IAAhC,EAAsC;AACpC,WAAO,UAAUxD,GAAV,EAAe;AACpB,UAAIwD,IAAI,CAACkG,YAAL,IAAqBlG,IAAI,CAACmG,WAA1B,IAAyCnG,IAAI,CAACgK,MAAlD,EAA0D;AACxDmtB,QAAAA,6BAA6B,CAAC36B,GAAD,CAA7B;AACD;;AACD,aAAOA,GAAP;AACD,KALD;AAMD;;AAED,WAASyiC,YAAT,CAAsBC,SAAtB,EAAiCl/B,IAAjC,EAAuCrY,MAAvC,EAA+Cw3C,MAA/C,EAAuD;AACrD;AACA,QAAItyD,GAAG,GAAGmzB,IAAI,CAACk/B,SAAD,CAAd;;AACA,QAAI,OAAOryD,GAAP,KAAe,WAAnB,EAAgC;AAC9B,UAAIsyD,MAAJ,EAAY;AACVtyD,QAAAA,GAAG,GAAGwqD,kBAAkB,CAAC3mD,IAAI,CAACE,SAAL,CAAe/D,GAAf,CAAD,CAAxB;AACD;;AACD8a,MAAAA,MAAM,CAAC9Y,IAAP,CAAYqwD,SAAS,GAAG,GAAZ,GAAkBryD,GAA9B;AACD;AACF;;AAED,WAASuyD,aAAT,CAAuBC,gBAAvB,EAAyC;AACvC,QAAI,OAAOA,gBAAP,KAA4B,WAAhC,EAA6C;AAC3C,UAAIC,QAAQ,GAAGnsC,MAAM,CAACksC,gBAAD,CAArB,CAD2C,CAE3C;;AACA,UAAI,CAACppC,KAAK,CAACqpC,QAAD,CAAN,IAAoBA,QAAQ,KAAK71D,QAAQ,CAAC41D,gBAAD,EAAmB,EAAnB,CAA7C,EAAqE;AACnE,eAAOC,QAAP;AACD,OAFD,MAEO;AACL,eAAOD,gBAAP;AACD;AACF;AACF;;AAED,WAASE,aAAT,CAAuBv/B,IAAvB,EAA6B;AAC3BA,IAAAA,IAAI,CAACw/B,WAAL,GAAmBJ,aAAa,CAACp/B,IAAI,CAACw/B,WAAN,CAAhC;AACAx/B,IAAAA,IAAI,CAACoT,KAAL,GAAagsB,aAAa,CAACp/B,IAAI,CAACoT,KAAN,CAA1B;AACApT,IAAAA,IAAI,CAAC0U,IAAL,GAAY0qB,aAAa,CAACp/B,IAAI,CAAC0U,IAAN,CAAzB;AACA,WAAO1U,IAAP;AACD;;AAED,WAASy/B,oBAAT,CAA8BC,MAA9B,EAAsC;AACpC,QAAIA,MAAJ,EAAY;AACV,UAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,eAAQ,IAAI/D,eAAJ,CAAoB,iCAC1B+D,MAD0B,GACjB,GADH,CAAR;AAED;;AACD,UAAIA,MAAM,GAAG,CAAb,EAAgB;AACd,eAAO,IAAI/D,eAAJ,CAAoB,yCACzB,GADyB,GACnB+D,MADmB,GACV,GADV,CAAP;AAED;AACF;AACF;;AAED,WAASC,oBAAT,CAA8B9uC,OAA9B,EAAuC4J,GAAvC,EAA4C;AAC1C,QAAImlC,YAAY,GAAG/uC,OAAO,CAACsiB,UAAR,GAAqB,QAArB,GAAgC,UAAnD;AACA,QAAI0sB,UAAU,GAAGhvC,OAAO,CAACsiB,UAAR,GAAqB,UAArB,GAAkC,QAAnD;;AAEA,QAAI,OAAOtiB,OAAO,CAAC+uC,YAAD,CAAd,KAAiC,WAAjC,IACF,OAAO/uC,OAAO,CAACgvC,UAAD,CAAd,KAA+B,WAD7B,IAEFvgB,OAAO,CAACzuB,OAAO,CAAC+uC,YAAD,CAAR,EAAwB/uC,OAAO,CAACgvC,UAAD,CAA/B,CAAP,GAAsD,CAFxD,EAE2D;AACzD,YAAM,IAAIlE,eAAJ,CAAoB,uCACxB,+DADI,CAAN;AAED,KALD,MAKO,IAAIlhC,GAAG,CAACttB,MAAJ,IAAc0jB,OAAO,CAAC1jB,MAAR,KAAmB,KAArC,EAA4C;AACjD,UAAI0jB,OAAO,CAACqV,YAAZ,EAA0B;AACxB,cAAM,IAAIy1B,eAAJ,CAAoB,2CAApB,CAAN;AACD,OAFD,MAEO,IAAI9qC,OAAO,CAAC3jB,IAAR,IAAgB2jB,OAAO,CAAC3jB,IAAR,CAAa1D,MAAb,GAAsB,CAAtC,IACT,CAACqnB,OAAO,CAACivC,KADA,IACS,CAACjvC,OAAO,CAAC2uC,WADtB,EACmC;AACxC,cAAM,IAAI7D,eAAJ,CAAoB,iDACxB,eADI,CAAN;AAED;AACF;;AACD,KAAC,aAAD,EAAgB,OAAhB,EAAyB,MAAzB,EAAiC1tD,OAAjC,CAAyC,UAAU8xD,UAAV,EAAsB;AAC7D,UAAI9qD,KAAK,GAAGwqD,oBAAoB,CAAC5uC,OAAO,CAACkvC,UAAD,CAAR,CAAhC;;AACA,UAAI9qD,KAAJ,EAAW;AACT,cAAMA,KAAN;AACD;AACF,KALD;AAMD;;AAED,WAAS+qD,SAAT,CAAmBjgC,EAAnB,EAAuBtF,GAAvB,EAA4BuF,IAA5B,EAAkC;AAChC;AACA,QAAIrY,MAAM,GAAG,EAAb;AACA,QAAIkiC,IAAJ;AACA,QAAItvC,MAAM,GAAG,KAAb;AACA,QAAIslB,EAAJ,EAAQwD,MAAR,CALgC,CAOhC;AACA;AACA;AACA;;AACA47B,IAAAA,YAAY,CAAC,QAAD,EAAWj/B,IAAX,EAAiBrY,MAAjB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,cAAD,EAAiBj/B,IAAjB,EAAuBrY,MAAvB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,aAAD,EAAgBj/B,IAAhB,EAAsBrY,MAAtB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,OAAD,EAAUj/B,IAAV,EAAgBrY,MAAhB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,YAAD,EAAej/B,IAAf,EAAqBrY,MAArB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,OAAD,EAAUj/B,IAAV,EAAgBrY,MAAhB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,aAAD,EAAgBj/B,IAAhB,EAAsBrY,MAAtB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,MAAD,EAASj/B,IAAT,EAAerY,MAAf,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,OAAD,EAAUj/B,IAAV,EAAgBrY,MAAhB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,WAAD,EAAcj/B,IAAd,EAAoBrY,MAApB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,UAAD,EAAaj/B,IAAb,EAAmBrY,MAAnB,EAA2B,IAA3B,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,WAAD,EAAcj/B,IAAd,EAAoBrY,MAApB,EAA4B,IAA5B,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,QAAD,EAAWj/B,IAAX,EAAiBrY,MAAjB,EAAyB,IAAzB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,SAAD,EAAYj/B,IAAZ,EAAkBrY,MAAlB,EAA0B,IAA1B,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,eAAD,EAAkBj/B,IAAlB,EAAwBrY,MAAxB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,KAAD,EAAQj/B,IAAR,EAAcrY,MAAd,EAAsB,IAAtB,CAAZ;AACAs3C,IAAAA,YAAY,CAAC,YAAD,EAAej/B,IAAf,EAAqBrY,MAArB,CAAZ,CA3BgC,CA6BhC;;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAACd,IAAP,CAAY,GAAZ,CAAT;AACAc,IAAAA,MAAM,GAAGA,MAAM,KAAK,EAAX,GAAgB,EAAhB,GAAqB,MAAMA,MAApC,CA/BgC,CAiChC;AACA;;AACA,QAAI,OAAOqY,IAAI,CAAC9yB,IAAZ,KAAqB,WAAzB,EAAsC;AACpC,UAAI+yD,cAAc,GAAG,IAArB,CADoC,CAEpC;AACA;;AAEA,UAAIC,YAAY,GACd,UAAU7I,kBAAkB,CAAC3mD,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAAC9yB,IAApB,CAAD,CAD9B;;AAEA,UAAIgzD,YAAY,CAAC12D,MAAb,GAAsBme,MAAM,CAACne,MAA7B,GAAsC,CAAtC,IAA2Cy2D,cAA/C,EAA+D;AAC7D;AACA;AACAt4C,QAAAA,MAAM,IAAI,CAACA,MAAM,CAAC,CAAD,CAAN,KAAc,GAAd,GAAoB,GAApB,GAA0B,GAA3B,IAAkCu4C,YAA5C;AACD,OAJD,MAIO;AACL3lD,QAAAA,MAAM,GAAG,MAAT;;AACA,YAAI,OAAOkgB,GAAP,KAAe,QAAnB,EAA6B;AAC3BovB,UAAAA,IAAI,GAAG;AAAC38C,YAAAA,IAAI,EAAE8yB,IAAI,CAAC9yB;AAAZ,WAAP;AACD,SAFD,MAEO;AAAE;AACPutB,UAAAA,GAAG,CAACvtB,IAAJ,GAAW8yB,IAAI,CAAC9yB,IAAhB;AACD;AACF;AACF,KAtD+B,CAwDhC;;;AACA,QAAI,OAAOutB,GAAP,KAAe,QAAnB,EAA6B;AAC3B,UAAIqM,KAAK,GAAGk3B,aAAa,CAACvjC,GAAD,CAAzB;AACA,aAAOsF,EAAE,CAACwb,KAAH,CAAS,aAAazU,KAAK,CAAC,CAAD,CAAlB,GAAwB,SAAxB,GAAoCA,KAAK,CAAC,CAAD,CAAzC,GAA+Cnf,MAAxD,EAAgE;AACrEgxC,QAAAA,OAAO,EAAE,IAAInd,CAAJ,CAAM;AAAC,0BAAgB;AAAjB,SAAN,CAD4D;AAErEjhC,QAAAA,MAAM,EAAEA,MAF6D;AAGrEsvC,QAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAei5C,IAAf;AAH+D,OAAhE,EAIJp4C,IAJI,CAIC,UAAU0G,QAAV,EAAoB;AAC1B0nB,QAAAA,EAAE,GAAG1nB,QAAQ,CAAC0nB,EAAd;AACAwD,QAAAA,MAAM,GAAGlrB,QAAQ,CAACkrB,MAAlB;AACA,eAAOlrB,QAAQ,CAACgxC,IAAT,EAAP;AACD,OARM,EAQJ13C,IARI,CAQC,UAAUzF,MAAV,EAAkB;AACxB,YAAI,CAAC6zB,EAAL,EAAS;AACP7zB,UAAAA,MAAM,CAACq3B,MAAP,GAAgBA,MAAhB;AACA,gBAAMkC,yBAAyB,CAACv5B,MAAD,CAA/B;AACD,SAJuB,CAKxB;;;AACAA,QAAAA,MAAM,CAAC22C,IAAP,CAAY10C,OAAZ,CAAoB,UAAUwpC,GAAV,EAAe;AACjC;AACA,cAAIA,GAAG,CAAClqC,KAAJ,IAAakqC,GAAG,CAAClqC,KAAJ,CAAU0H,KAAvB,IAAgCwiC,GAAG,CAAClqC,KAAJ,CAAU0H,KAAV,KAAoB,sBAAxD,EAAgF;AAC9E,kBAAM,IAAI3J,KAAJ,CAAUmsC,GAAG,CAAC7T,MAAd,CAAN;AACD;AACF,SALD;AAMA,eAAO53B,MAAP;AACD,OArBM,EAqBJyF,IArBI,CAqBCutD,sBAAsB,CAACh/B,IAAD,CArBvB,CAAP;AAsBD,KAjF+B,CAmFhC;;;AACA6pB,IAAAA,IAAI,GAAGA,IAAI,IAAI,EAAf;AACA/+C,IAAAA,MAAM,CAACoC,IAAP,CAAYutB,GAAZ,EAAiBxsB,OAAjB,CAAyB,UAAUZ,GAAV,EAAe;AACtC,UAAI0sB,KAAK,CAAC2C,OAAN,CAAcjC,GAAG,CAACptB,GAAD,CAAjB,CAAJ,EAA6B;AAC3Bw8C,QAAAA,IAAI,CAACx8C,GAAD,CAAJ,GAAYotB,GAAG,CAACptB,GAAD,CAAf;AACD,OAFD,MAEO;AACLw8C,QAAAA,IAAI,CAACx8C,GAAD,CAAJ,GAAYotB,GAAG,CAACptB,GAAD,CAAH,CAASP,QAAT,EAAZ;AACD;AACF,KAND;AAQA,WAAOizB,EAAE,CAACwb,KAAH,CAAS,eAAe5zB,MAAxB,EAAgC;AACrCgxC,MAAAA,OAAO,EAAE,IAAInd,CAAJ,CAAM;AAAC,wBAAgB;AAAjB,OAAN,CAD4B;AAErCjhC,MAAAA,MAAM,EAAE,MAF6B;AAGrCsvC,MAAAA,IAAI,EAAEn5C,IAAI,CAACE,SAAL,CAAei5C,IAAf;AAH+B,KAAhC,EAIJp4C,IAJI,CAIC,UAAU0G,QAAV,EAAoB;AACxB0nB,MAAAA,EAAE,GAAG1nB,QAAQ,CAAC0nB,EAAd;AACAwD,MAAAA,MAAM,GAAGlrB,QAAQ,CAACkrB,MAAlB;AACF,aAAOlrB,QAAQ,CAACgxC,IAAT,EAAP;AACD,KARM,EAQJ13C,IARI,CAQC,UAAUzF,MAAV,EAAkB;AACxB,UAAI,CAAC6zB,EAAL,EAAS;AACP7zB,QAAAA,MAAM,CAACq3B,MAAP,GAAgBA,MAAhB;AACA,cAAMkC,yBAAyB,CAACv5B,MAAD,CAA/B;AACD;;AACD,aAAOA,MAAP;AACD,KAdM,EAcJyF,IAdI,CAcCutD,sBAAsB,CAACh/B,IAAD,CAdvB,CAAP;AAeD,GAvP4E,CAyP7E;AACA;;AACA;;;AACA,WAASmgC,WAAT,CAAqBpgC,EAArB,EAAyBtF,GAAzB,EAA8BuF,IAA9B,EAAoC;AAClC,WAAO,IAAIhsB,OAAJ,CAAY,UAAU8E,OAAV,EAAmB7E,MAAnB,EAA2B;AAC5C8rB,MAAAA,EAAE,CAACqgC,MAAH,CAAU3lC,GAAV,EAAeuF,IAAf,EAAqB,UAAU3mB,GAAV,EAAemjB,GAAf,EAAoB;AACvC,YAAInjB,GAAJ,EAAS;AACP,iBAAOpF,MAAM,CAACoF,GAAD,CAAb;AACD;;AACDP,QAAAA,OAAO,CAAC0jB,GAAD,CAAP;AACD,OALD;AAMD,KAPM,CAAP;AAQD,GArQ4E,CAuQ7E;AACA;;AACA;;;AACA,WAAS6jC,iBAAT,CAA2BtgC,EAA3B,EAA+B;AAC7B,WAAO,IAAI/rB,OAAJ,CAAY,UAAU8E,OAAV,EAAmB7E,MAAnB,EAA2B;AAC5C8rB,MAAAA,EAAE,CAACugC,YAAH,CAAgB,UAAUjnD,GAAV,EAAemjB,GAAf,EAAoB;AAClC,YAAInjB,GAAJ,EAAS;AACP,iBAAOpF,MAAM,CAACoF,GAAD,CAAb;AACD;;AACDP,QAAAA,OAAO,CAAC0jB,GAAD,CAAP;AACD,OALD;AAMD,KAPM,CAAP;AAQD;;AAED,WAAS+jC,UAAT,CAAoBhzD,KAApB,EAA2B;AACzB,WAAO,UAAUq2B,MAAV,EAAkB;AACvB;AACA,UAAIA,MAAM,CAACP,MAAP,KAAkB,GAAtB,EAA2B;AACzB,eAAO91B,KAAP;AACD,OAFD,MAEO;AACL,cAAMq2B,MAAN;AACD;AACF,KAPD;AAQD,GA9R4E,CAgS7E;AACA;AACA;;;AACA,WAAS48B,gBAAT,CAA0Br/B,KAA1B,EAAiCojB,IAAjC,EAAuCkc,uBAAvC,EAAgE;AAC9D,QAAIC,SAAS,GAAG,gBAAgBv/B,KAAhC;AACA,QAAIw/B,cAAc,GAAG;AAACt4B,MAAAA,GAAG,EAAEq4B,SAAN;AAAiBxzD,MAAAA,IAAI,EAAE;AAAvB,KAArB;AACA,QAAI0zD,OAAO,GAAGH,uBAAuB,CAACz1D,GAAxB,CAA4Bm2B,KAA5B,CAAd;AACA,QAAI0/B,wBAAwB,GAAGD,OAAO,CAAC,CAAD,CAAtC;AACA,QAAIt+B,OAAO,GAAGs+B,OAAO,CAAC,CAAD,CAArB;;AAEA,aAASE,UAAT,GAAsB;AACpB,UAAI7C,QAAQ,CAAC37B,OAAD,CAAZ,EAAuB;AACrB;AACA;AACA,eAAOtuB,OAAO,CAAC8E,OAAR,CAAgB6nD,cAAhB,CAAP;AACD;;AACD,aAAOpc,IAAI,CAACxkB,EAAL,CAAQ/0B,GAAR,CAAY01D,SAAZ,EAAuBxzC,KAAvB,CAA6BqzC,UAAU,CAACI,cAAD,CAAvC,CAAP;AACD;;AAED,aAASI,eAAT,CAAyB7U,OAAzB,EAAkC;AAChC,UAAI,CAACA,OAAO,CAACh/C,IAAR,CAAa1D,MAAlB,EAA0B;AACxB;AACA,eAAOwK,OAAO,CAAC8E,OAAR,CAAgB;AAAC6pC,UAAAA,IAAI,EAAE;AAAP,SAAhB,CAAP;AACD;;AACD,aAAO4B,IAAI,CAACxkB,EAAL,CAAQ2Y,OAAR,CAAgB;AACrBxrC,QAAAA,IAAI,EAAEg/C,OAAO,CAACh/C,IADO;AAErBg5B,QAAAA,YAAY,EAAE;AAFO,OAAhB,CAAP;AAID;;AAED,aAAS86B,mBAAT,CAA6B9U,OAA7B,EAAsC+U,SAAtC,EAAiD;AAC/C,UAAIC,MAAM,GAAG,EAAb;AACA,UAAIC,OAAO,GAAG,IAAIlkC,WAAJ,EAAd;;AAEA,WAAK,IAAIne,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAG2pC,SAAS,CAACte,IAAV,CAAen5C,MAArC,EAA6CsV,CAAC,GAAGwY,GAAjD,EAAsDxY,CAAC,EAAvD,EAA2D;AACzD,YAAI24B,GAAG,GAAGwpB,SAAS,CAACte,IAAV,CAAe7jC,CAAf,CAAV;AACA,YAAI2mB,GAAG,GAAGgS,GAAG,CAAChS,GAAd;;AACA,YAAI,CAACA,GAAL,EAAU;AAAE;AACV;AACD;;AACDy7B,QAAAA,MAAM,CAACryD,IAAP,CAAY42B,GAAZ;AACA07B,QAAAA,OAAO,CAACxkC,GAAR,CAAY8I,GAAG,CAAC4C,GAAhB;AACA5C,QAAAA,GAAG,CAACmO,QAAJ,GAAe,CAACitB,wBAAwB,CAAC9yD,GAAzB,CAA6B03B,GAAG,CAAC4C,GAAjC,CAAhB;;AACA,YAAI,CAAC5C,GAAG,CAACmO,QAAT,EAAmB;AACjB,cAAIwtB,QAAQ,GAAGP,wBAAwB,CAAC71D,GAAzB,CAA6By6B,GAAG,CAAC4C,GAAjC,CAAf;;AACA,cAAI,WAAW+4B,QAAf,EAAyB;AACvB37B,YAAAA,GAAG,CAACl4B,KAAJ,GAAY6zD,QAAQ,CAAC7zD,KAArB;AACD;AACF;AACF;;AACD,UAAI8zD,OAAO,GAAG9E,cAAc,CAACsE,wBAAD,CAA5B;AACAQ,MAAAA,OAAO,CAACpzD,OAAR,CAAgB,UAAUZ,GAAV,EAAe;AAC7B,YAAI,CAAC8zD,OAAO,CAACpzD,GAAR,CAAYV,GAAZ,CAAL,EAAuB;AACrB;AACA,cAAIi0D,KAAK,GAAG;AACVj5B,YAAAA,GAAG,EAAEh7B;AADK,WAAZ;AAGA,cAAI+zD,QAAQ,GAAGP,wBAAwB,CAAC71D,GAAzB,CAA6BqC,GAA7B,CAAf;;AACA,cAAI,WAAW+zD,QAAf,EAAyB;AACvBE,YAAAA,KAAK,CAAC/zD,KAAN,GAAc6zD,QAAQ,CAAC7zD,KAAvB;AACD;;AACD2zD,UAAAA,MAAM,CAACryD,IAAP,CAAYyyD,KAAZ;AACD;AACF,OAZD;AAaApV,MAAAA,OAAO,CAACh/C,IAAR,GAAemvD,IAAI,CAACgF,OAAO,CAAC/wD,MAAR,CAAe47C,OAAO,CAACh/C,IAAvB,CAAD,CAAnB;AACAg0D,MAAAA,MAAM,CAACryD,IAAP,CAAYq9C,OAAZ;AAEA,aAAOgV,MAAP;AACD;;AAED,WAAOJ,UAAU,GAAGrvD,IAAb,CAAkB,UAAUy6C,OAAV,EAAmB;AAC1C,aAAO6U,eAAe,CAAC7U,OAAD,CAAf,CAAyBz6C,IAAzB,CAA8B,UAAUwvD,SAAV,EAAqB;AACxD,eAAOD,mBAAmB,CAAC9U,OAAD,EAAU+U,SAAV,CAA1B;AACD,OAFM,CAAP;AAGD,KAJM,CAAP;AAKD,GA3W4E,CA6W7E;AACA;;;AACA,WAASM,aAAT,CAAuBhd,IAAvB,EAA6Bkc,uBAA7B,EAAsDl+B,GAAtD,EAA2D;AACzD,QAAIi/B,QAAQ,GAAG,gBAAf;AACA,WAAOjd,IAAI,CAACxkB,EAAL,CAAQ/0B,GAAR,CAAYw2D,QAAZ,EACJt0C,KADI,CACEqzC,UAAU,CAAC;AAACl4B,MAAAA,GAAG,EAAEm5B,QAAN;AAAgBj/B,MAAAA,GAAG,EAAE;AAArB,KAAD,CADZ,EAEJ9wB,IAFI,CAEC,UAAUmsD,UAAV,EAAsB;AAC1B,UAAIxL,MAAM,GAAGmK,cAAc,CAACkE,uBAAD,CAA3B;AACA,aAAOzsD,OAAO,CAAC0Y,GAAR,CAAY0lC,MAAM,CAACv5C,GAAP,CAAW,UAAUsoB,KAAV,EAAiB;AAC7C,eAAOq/B,gBAAgB,CAACr/B,KAAD,EAAQojB,IAAR,EAAckc,uBAAd,CAAvB;AACD,OAFkB,CAAZ,EAEHhvD,IAFG,CAEE,UAAUgwD,mBAAV,EAA+B;AACtC,YAAIC,aAAa,GAAGn7B,OAAO,CAACk7B,mBAAD,CAA3B;AACA7D,QAAAA,UAAU,CAACr7B,GAAX,GAAiBA,GAAjB;AACAm/B,QAAAA,aAAa,CAAC7yD,IAAd,CAAmB+uD,UAAnB,EAHsC,CAItC;;AACA,eAAOrZ,IAAI,CAACxkB,EAAL,CAAQoV,QAAR,CAAiB;AAACjV,UAAAA,IAAI,EAAGwhC;AAAR,SAAjB,CAAP;AACD,OARM,CAAP;AASD,KAbI,CAAP;AAcD;;AAED,WAASC,QAAT,CAAkBpd,IAAlB,EAAwB;AACtB,QAAIG,QAAQ,GAAG,OAAOH,IAAP,KAAgB,QAAhB,GAA2BA,IAA3B,GAAkCA,IAAI,CAACr2C,IAAtD;AACA,QAAI0sB,KAAK,GAAGijC,gBAAgB,CAACnZ,QAAD,CAA5B;;AACA,QAAI,CAAC9pB,KAAL,EAAY;AACVA,MAAAA,KAAK,GAAGijC,gBAAgB,CAACnZ,QAAD,CAAhB,GAA6B,IAAImY,WAAJ,EAArC;AACD;;AACD,WAAOjiC,KAAP;AACD;;AAED,WAASgnC,UAAT,CAAoBrd,IAApB,EAA0B;AACxB,WAAO4X,aAAa,CAACwF,QAAQ,CAACpd,IAAD,CAAT,EAAiB,YAAY;AAC/C,aAAOsd,iBAAiB,CAACtd,IAAD,CAAxB;AACD,KAFmB,CAAb,EAAP;AAGD;;AAED,WAASsd,iBAAT,CAA2Btd,IAA3B,EAAiC;AAC/B;AACA,QAAIud,UAAJ;AACA,QAAIr8B,GAAJ;;AAEA,aAASzO,IAAT,CAAc3pB,GAAd,EAAmBE,KAAnB,EAA0B;AACxB,UAAImxD,MAAM,GAAG;AAAC1wD,QAAAA,EAAE,EAAEy3B,GAAG,CAAC4C,GAAT;AAAch7B,QAAAA,GAAG,EAAEkyC,YAAY,CAAClyC,GAAD;AAA/B,OAAb,CADwB,CAExB;AACA;;AACA,UAAI,OAAOE,KAAP,KAAiB,WAAjB,IAAgCA,KAAK,KAAK,IAA9C,EAAoD;AAClDmxD,QAAAA,MAAM,CAACnxD,KAAP,GAAegyC,YAAY,CAAChyC,KAAD,CAA3B;AACD;;AACDu0D,MAAAA,UAAU,CAACjzD,IAAX,CAAgB6vD,MAAhB;AACD;;AAED,QAAI9Z,MAAM,GAAGwZ,MAAM,CAAC7Z,IAAI,CAACK,MAAN,EAAc5tB,IAAd,CAAnB;AAEA,QAAI+qC,UAAU,GAAGxd,IAAI,CAAChiB,GAAL,IAAY,CAA7B;;AAEA,aAAS+P,aAAT,CAAuBmuB,uBAAvB,EAAgDl+B,GAAhD,EAAqD;AACnD,aAAO,YAAY;AACjB,eAAOg/B,aAAa,CAAChd,IAAD,EAAOkc,uBAAP,EAAgCl+B,GAAhC,CAApB;AACD,OAFD;AAGD;;AAED,QAAI3H,KAAK,GAAG,IAAIiiC,WAAJ,EAAZ;;AAEA,aAASmF,gBAAT,GAA4B;AAC1B,aAAOzd,IAAI,CAAC0Y,QAAL,CAAc36B,OAAd,CAAsB;AAC3BkV,QAAAA,WAAW,EAAE,IADc;AAE3BlJ,QAAAA,SAAS,EAAE,IAFgB;AAG3BpI,QAAAA,YAAY,EAAE,IAHa;AAI3BsM,QAAAA,KAAK,EAAE,UAJoB;AAK3BhQ,QAAAA,KAAK,EAAEu/B,UALoB;AAM3B3uB,QAAAA,KAAK,EAAE2qB;AANoB,OAAtB,EAOJtsD,IAPI,CAOCwvB,YAPD,CAAP;AAQD;;AAED,aAASA,YAAT,CAAsB9oB,QAAtB,EAAgC;AAC9B,UAAIyU,OAAO,GAAGzU,QAAQ,CAACyU,OAAvB;;AACA,UAAI,CAACA,OAAO,CAACpjB,MAAb,EAAqB;AACnB;AACD;;AACD,UAAIi3D,uBAAuB,GAAGwB,6BAA6B,CAACr1C,OAAD,CAA3D;AACAgO,MAAAA,KAAK,CAAC+B,GAAN,CAAU2V,aAAa,CAACmuB,uBAAD,EAA0BsB,UAA1B,CAAvB;;AACA,UAAIn1C,OAAO,CAACpjB,MAAR,GAAiBu0D,oBAArB,EAA2C;AACzC;AACD;;AACD,aAAOiE,gBAAgB,EAAvB;AACD;;AAED,aAASC,6BAAT,CAAuCr1C,OAAvC,EAAgD;AAC9C,UAAI6zC,uBAAuB,GAAG,IAAIvjC,WAAJ,EAA9B;;AACA,WAAK,IAAIpe,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAG1K,OAAO,CAACpjB,MAA9B,EAAsCsV,CAAC,GAAGwY,GAA1C,EAA+CxY,CAAC,EAAhD,EAAoD;AAClD,YAAIknB,MAAM,GAAGpZ,OAAO,CAAC9N,CAAD,CAApB;;AACA,YAAIknB,MAAM,CAACP,GAAP,CAAW4C,GAAX,CAAe,CAAf,MAAsB,GAA1B,EAA+B;AAC7By5B,UAAAA,UAAU,GAAG,EAAb;AACAr8B,UAAAA,GAAG,GAAGO,MAAM,CAACP,GAAb;;AAEA,cAAI,CAACA,GAAG,CAACmO,QAAT,EAAmB;AACjB2qB,YAAAA,MAAM,CAACha,IAAI,CAAC0Y,QAAN,EAAgBrY,MAAhB,EAAwBnf,GAAxB,CAAN;AACD;;AACDq8B,UAAAA,UAAU,CAAC5zB,IAAX,CAAgBywB,kBAAhB;AAEA,cAAIkC,wBAAwB,GAAGqB,8BAA8B,CAACJ,UAAD,CAA7D;AACArB,UAAAA,uBAAuB,CAACx1D,GAAxB,CAA4B+6B,MAAM,CAACP,GAAP,CAAW4C,GAAvC,EAA4C,CAC1Cw4B,wBAD0C,EAE1C76B,MAAM,CAAC1D,OAFmC,CAA5C;AAID;;AACDy/B,QAAAA,UAAU,GAAG/7B,MAAM,CAACzD,GAApB;AACD;;AACD,aAAOk+B,uBAAP;AACD;;AAED,aAASyB,8BAAT,CAAwCJ,UAAxC,EAAoD;AAClD,UAAIjB,wBAAwB,GAAG,IAAI3jC,WAAJ,EAA/B;AACA,UAAI2yB,OAAJ;;AACA,WAAK,IAAI/wC,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGwqC,UAAU,CAACt4D,MAAjC,EAAyCsV,CAAC,GAAGwY,GAA7C,EAAkDxY,CAAC,EAAnD,EAAuD;AACrD,YAAIqjD,eAAe,GAAGL,UAAU,CAAChjD,CAAD,CAAhC;AACA,YAAIsjD,UAAU,GAAG,CAACD,eAAe,CAAC90D,GAAjB,EAAsB80D,eAAe,CAACn0D,EAAtC,CAAjB;;AACA,YAAI8Q,CAAC,GAAG,CAAJ,IAASwgC,OAAO,CAAC6iB,eAAe,CAAC90D,GAAjB,EAAsBwiD,OAAtB,CAAP,KAA0C,CAAvD,EAA0D;AACxDuS,UAAAA,UAAU,CAACvzD,IAAX,CAAgBiQ,CAAhB,EADwD,CACpC;AACrB;;AACD+hD,QAAAA,wBAAwB,CAAC51D,GAAzB,CAA6Bk1C,iBAAiB,CAACiiB,UAAD,CAA9C,EAA4DD,eAA5D;AACAtS,QAAAA,OAAO,GAAGsS,eAAe,CAAC90D,GAA1B;AACD;;AACD,aAAOwzD,wBAAP;AACD;;AAED,WAAOmB,gBAAgB,GAAGvwD,IAAnB,CAAwB,YAAY;AACzC,aAAOmpB,KAAK,CAAC2yB,MAAN,EAAP;AACD,KAFM,EAEJ97C,IAFI,CAEC,YAAY;AAClB8yC,MAAAA,IAAI,CAAChiB,GAAL,GAAWw/B,UAAX;AACD,KAJM,CAAP;AAKD;;AAED,WAASM,UAAT,CAAoB9d,IAApB,EAA0B33B,OAA1B,EAAmCiE,OAAnC,EAA4C;AAC1C,QAAIA,OAAO,CAAC2uC,WAAR,KAAwB,CAA5B,EAA+B;AAC7B,aAAO3uC,OAAO,CAAC2uC,WAAf;AACD;;AAED,QAAI8C,WAAW,GAAGzxC,OAAO,CAACivC,KAAR,IAAiBjvC,OAAO,CAAC2uC,WAA3C;AAEA,QAAIzC,SAAS,GAAGsB,OAAO,CAAC9Z,IAAI,CAACwY,SAAN,CAAvB;AAEA,QAAIwF,MAAM,GAAG,EAAb;AACA,QAAIC,GAAG,GAAGvsC,KAAK,CAACpF,OAAO,CAAC2uC,WAAT,CAAL,GAA6BrsC,MAAM,CAACC,iBAApC,GACRvC,OAAO,CAAC2uC,WADV;AAEA5yC,IAAAA,OAAO,CAAC3e,OAAR,CAAgB,UAAUzD,CAAV,EAAa;AAC3B,UAAIi4D,IAAI,GAAGF,MAAM,CAACA,MAAM,CAAC/4D,MAAP,GAAgB,CAAjB,CAAjB;AACA,UAAIk5D,QAAQ,GAAGJ,WAAW,GAAG93D,CAAC,CAAC6C,GAAL,GAAW,IAArC,CAF2B,CAI3B;;AACA,UAAIi1D,WAAW,IAAIvoC,KAAK,CAAC2C,OAAN,CAAcgmC,QAAd,CAAnB,EAA4C;AAC1CA,QAAAA,QAAQ,GAAGA,QAAQ,CAACxyD,KAAT,CAAe,CAAf,EAAkBsyD,GAAlB,CAAX;AACD;;AAED,UAAIC,IAAI,IAAInjB,OAAO,CAACmjB,IAAI,CAACC,QAAN,EAAgBA,QAAhB,CAAP,KAAqC,CAAjD,EAAoD;AAClDD,QAAAA,IAAI,CAACv1D,IAAL,CAAU2B,IAAV,CAAe,CAACrE,CAAC,CAAC6C,GAAH,EAAQ7C,CAAC,CAACwD,EAAV,CAAf;AACAy0D,QAAAA,IAAI,CAAC36B,MAAL,CAAYj5B,IAAZ,CAAiBrE,CAAC,CAAC+C,KAAnB;AACA;AACD;;AACDg1D,MAAAA,MAAM,CAAC1zD,IAAP,CAAY;AACV3B,QAAAA,IAAI,EAAE,CAAC,CAAC1C,CAAC,CAAC6C,GAAH,EAAQ7C,CAAC,CAACwD,EAAV,CAAD,CADI;AAEV85B,QAAAA,MAAM,EAAE,CAACt9B,CAAC,CAAC+C,KAAH,CAFE;AAGVm1D,QAAAA,QAAQ,EAAEA;AAHA,OAAZ;AAKD,KAnBD;AAoBA91C,IAAAA,OAAO,GAAG,EAAV;;AACA,SAAK,IAAI9N,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGirC,MAAM,CAAC/4D,MAA7B,EAAqCsV,CAAC,GAAGwY,GAAzC,EAA8CxY,CAAC,EAA/C,EAAmD;AACjD,UAAItU,CAAC,GAAG+3D,MAAM,CAACzjD,CAAD,CAAd;AACA,UAAI6jD,SAAS,GAAGnE,SAAS,CAACja,IAAI,CAAC0Y,QAAN,EAAgBF,SAAhB,EAA2BvyD,CAAC,CAAC0C,IAA7B,EAAmC1C,CAAC,CAACs9B,MAArC,EAA6C,KAA7C,CAAzB;;AACA,UAAI66B,SAAS,CAAC1tD,KAAV,IAAmB0tD,SAAS,CAAC1tD,KAAV,YAA2B6mD,YAAlD,EAAgE;AAC9D;AACA,cAAM6G,SAAS,CAAC1tD,KAAhB;AACD;;AACD2X,MAAAA,OAAO,CAAC/d,IAAR,CAAa;AACX;AACAtB,QAAAA,KAAK,EAAEo1D,SAAS,CAAC1tD,KAAV,GAAkB,IAAlB,GAAyB0tD,SAAS,CAACjE,MAF/B;AAGXrxD,QAAAA,GAAG,EAAE7C,CAAC,CAACk4D;AAHI,OAAb;AAKD,KA7CyC,CA8C1C;;;AACA,WAAO;AAAC/f,MAAAA,IAAI,EAAEmc,YAAY,CAAClyC,OAAD,EAAUiE,OAAO,CAACuiB,KAAlB,EAAyBviB,OAAO,CAAC6jB,IAAjC;AAAnB,KAAP;AACD;;AAED,WAASkuB,SAAT,CAAmBre,IAAnB,EAAyBvkB,IAAzB,EAA+B;AAC7B,WAAOm8B,aAAa,CAACwF,QAAQ,CAACpd,IAAD,CAAT,EAAiB,YAAY;AAC/C,aAAOse,gBAAgB,CAACte,IAAD,EAAOvkB,IAAP,CAAvB;AACD,KAFmB,CAAb,EAAP;AAGD;;AAED,WAAS6iC,gBAAT,CAA0Bte,IAA1B,EAAgCvkB,IAAhC,EAAsC;AACpC,QAAI8iC,SAAJ;AACA,QAAIC,YAAY,GAAGxe,IAAI,CAACwY,SAAL,IAAkB/8B,IAAI,CAAC7yB,MAAL,KAAgB,KAArD;AACA,QAAIunC,IAAI,GAAG1U,IAAI,CAAC0U,IAAL,IAAa,CAAxB;;AACA,QAAI,OAAO1U,IAAI,CAAC9yB,IAAZ,KAAqB,WAArB,IAAoC,CAAC8yB,IAAI,CAAC9yB,IAAL,CAAU1D,MAAnD,EAA2D;AACzD;AACAw2B,MAAAA,IAAI,CAACoT,KAAL,GAAa,CAAb;AACA,aAAOpT,IAAI,CAAC9yB,IAAZ;AACD;;AAED,aAAS81D,aAAT,CAAuBC,QAAvB,EAAiC;AAC/BA,MAAAA,QAAQ,CAAC/8B,YAAT,GAAwB,IAAxB;AACA,aAAOqe,IAAI,CAACxkB,EAAL,CAAQ2Y,OAAR,CAAgBuqB,QAAhB,EAA0BxxD,IAA1B,CAA+B,UAAU+qB,GAAV,EAAe;AACnDsmC,QAAAA,SAAS,GAAGtmC,GAAG,CAAC+0B,UAAhB;AACA,eAAO/0B,GAAG,CAACmmB,IAAJ,CAAS9pC,GAAT,CAAa,UAAU7M,MAAV,EAAkB;AAEpC;AACA;AACA;;AACA;AACA,cAAI,WAAWA,MAAM,CAACy5B,GAAlB,IAAyB,OAAOz5B,MAAM,CAACy5B,GAAP,CAAWl4B,KAAlB,KAA4B,QAArD,IACFvB,MAAM,CAACy5B,GAAP,CAAWl4B,KAAX,KAAqB,IADvB,EAC6B;AAC3B,gBAAIL,IAAI,GAAGpC,MAAM,CAACoC,IAAP,CAAYlB,MAAM,CAACy5B,GAAP,CAAWl4B,KAAvB,EAA8B2gC,IAA9B,EAAX,CAD2B,CAE3B;AACA;;AACA,gBAAIg1B,YAAY,GAAG,CAAC,IAAD,EAAO,KAAP,EAAc,OAAd,CAAnB;;AACA,gBAAI,EAAEh2D,IAAI,GAAGg2D,YAAP,IAAuBh2D,IAAI,GAAGg2D,YAAhC,CAAJ,EAAmD;AACjD,qBAAOl3D,MAAM,CAACy5B,GAAP,CAAWl4B,KAAlB;AACD;AACF;;AAED,cAAI41D,iBAAiB,GAAGjiB,oBAAoB,CAACl1C,MAAM,CAACy5B,GAAP,CAAW4C,GAAZ,CAA5C;AACA,iBAAO;AACLh7B,YAAAA,GAAG,EAAE81D,iBAAiB,CAAC,CAAD,CADjB;AAELn1D,YAAAA,EAAE,EAAEm1D,iBAAiB,CAAC,CAAD,CAFhB;AAGL51D,YAAAA,KAAK,EAAG,WAAWvB,MAAM,CAACy5B,GAAlB,GAAwBz5B,MAAM,CAACy5B,GAAP,CAAWl4B,KAAnC,GAA2C;AAH9C,WAAP;AAKD,SAvBM,CAAP;AAwBD,OA1BM,CAAP;AA2BD;;AAED,aAAS61D,iBAAT,CAA2BzgB,IAA3B,EAAiC;AAC/B,UAAI0gB,YAAJ;;AACA,UAAIN,YAAJ,EAAkB;AAChBM,QAAAA,YAAY,GAAGhB,UAAU,CAAC9d,IAAD,EAAO5B,IAAP,EAAa3iB,IAAb,CAAzB;AACD,OAFD,MAEO;AACLqjC,QAAAA,YAAY,GAAG;AACb9R,UAAAA,UAAU,EAAEuR,SADC;AAEb5hC,UAAAA,MAAM,EAAEwT,IAFK;AAGbiO,UAAAA,IAAI,EAAEA;AAHO,SAAf;AAKD;AACD;;;AACA,UAAI3iB,IAAI,CAACgT,UAAT,EAAqB;AACnBqwB,QAAAA,YAAY,CAACrwB,UAAb,GAA0BuR,IAAI,CAAChiB,GAA/B;AACD;;AACD,UAAIvC,IAAI,CAACkG,YAAT,EAAuB;AACrB,YAAIksB,MAAM,GAAGiK,IAAI,CAAC1Z,IAAI,CAAC9pC,GAAL,CAASkmD,UAAT,CAAD,CAAjB;AAEA,eAAOxa,IAAI,CAAC0Y,QAAL,CAAcvkB,OAAd,CAAsB;AAC3BxrC,UAAAA,IAAI,EAAEklD,MADqB;AAE3BlsB,UAAAA,YAAY,EAAE,IAFa;AAG3BoI,UAAAA,SAAS,EAAEtO,IAAI,CAACsO,SAHW;AAI3BnI,UAAAA,WAAW,EAAEnG,IAAI,CAACmG,WAJS;AAK3B6D,UAAAA,MAAM,EAAEhK,IAAI,CAACgK;AALc,SAAtB,EAMJv4B,IANI,CAMC,UAAU6xD,UAAV,EAAsB;AAC5B,cAAIC,YAAY,GAAG,IAAIrmC,WAAJ,EAAnB;AACAomC,UAAAA,UAAU,CAAC3gB,IAAX,CAAgB10C,OAAhB,CAAwB,UAAUwpC,GAAV,EAAe;AACrC8rB,YAAAA,YAAY,CAACt4D,GAAb,CAAiBwsC,GAAG,CAACzpC,EAArB,EAAyBypC,GAAG,CAAChS,GAA7B;AACD,WAFD;AAGAkd,UAAAA,IAAI,CAAC10C,OAAL,CAAa,UAAUwpC,GAAV,EAAe;AAC1B,gBAAItW,KAAK,GAAG49B,UAAU,CAACtnB,GAAD,CAAtB;AACA,gBAAIhS,GAAG,GAAG89B,YAAY,CAACv4D,GAAb,CAAiBm2B,KAAjB,CAAV;;AACA,gBAAIsE,GAAJ,EAAS;AACPgS,cAAAA,GAAG,CAAChS,GAAJ,GAAUA,GAAV;AACD;AACF,WAND;AAOA,iBAAO49B,YAAP;AACD,SAnBM,CAAP;AAoBD,OAvBD,MAuBO;AACL,eAAOA,YAAP;AACD;AACF;;AAED,QAAI,OAAOrjC,IAAI,CAAC9yB,IAAZ,KAAqB,WAAzB,EAAsC;AACpC,UAAIA,IAAI,GAAG8yB,IAAI,CAAC9yB,IAAhB;AACA,UAAIs2D,aAAa,GAAGt2D,IAAI,CAAC2L,GAAL,CAAS,UAAUxL,GAAV,EAAe;AAC1C,YAAI41D,QAAQ,GAAG;AACbrqB,UAAAA,QAAQ,EAAGuH,iBAAiB,CAAC,CAAC9yC,GAAD,CAAD,CADf;AAEbyrC,UAAAA,MAAM,EAAKqH,iBAAiB,CAAC,CAAC9yC,GAAD,EAAM,EAAN,CAAD;AAFf,SAAf;AAIA;;AACA,YAAI2yB,IAAI,CAACgT,UAAT,EAAqB;AACnBiwB,UAAAA,QAAQ,CAACjwB,UAAT,GAAsB,IAAtB;AACD;;AACD,eAAOgwB,aAAa,CAACC,QAAD,CAApB;AACD,OAVmB,CAApB;AAWA,aAAOjvD,OAAO,CAAC0Y,GAAR,CAAY82C,aAAZ,EAA2B/xD,IAA3B,CAAgC80B,OAAhC,EAAyC90B,IAAzC,CAA8C2xD,iBAA9C,CAAP;AACD,KAdD,MAcO;AAAE;AACP,UAAIH,QAAQ,GAAG;AACb9vB,QAAAA,UAAU,EAAGnT,IAAI,CAACmT;AADL,OAAf;AAGA;;AACA,UAAInT,IAAI,CAACgT,UAAT,EAAqB;AACnBiwB,QAAAA,QAAQ,CAACjwB,UAAT,GAAsB,IAAtB;AACD;;AACD,UAAI4F,QAAJ;AACA,UAAIE,MAAJ;;AACA,UAAI,eAAe9Y,IAAnB,EAAyB;AACvB4Y,QAAAA,QAAQ,GAAG5Y,IAAI,CAAC2Y,SAAhB;AACD;;AACD,UAAI,cAAc3Y,IAAlB,EAAwB;AACtB4Y,QAAAA,QAAQ,GAAG5Y,IAAI,CAAC4Y,QAAhB;AACD;;AACD,UAAI,aAAa5Y,IAAjB,EAAuB;AACrB8Y,QAAAA,MAAM,GAAG9Y,IAAI,CAAC6Y,OAAd;AACD;;AACD,UAAI,YAAY7Y,IAAhB,EAAsB;AACpB8Y,QAAAA,MAAM,GAAG9Y,IAAI,CAAC8Y,MAAd;AACD;;AACD,UAAI,OAAOF,QAAP,KAAoB,WAAxB,EAAqC;AACnCqqB,QAAAA,QAAQ,CAACrqB,QAAT,GAAoB5Y,IAAI,CAACmT,UAAL,GAClBgN,iBAAiB,CAAC,CAACvH,QAAD,EAAW,EAAX,CAAD,CADC,GAElBuH,iBAAiB,CAAC,CAACvH,QAAD,CAAD,CAFnB;AAGD;;AACD,UAAI,OAAOE,MAAP,KAAkB,WAAtB,EAAmC;AACjC,YAAIuX,YAAY,GAAGrwB,IAAI,CAACwwB,aAAL,KAAuB,KAA1C;;AACA,YAAIxwB,IAAI,CAACmT,UAAT,EAAqB;AACnBkd,UAAAA,YAAY,GAAG,CAACA,YAAhB;AACD;;AAED4S,QAAAA,QAAQ,CAACnqB,MAAT,GAAkBqH,iBAAiB,CACjCkQ,YAAY,GAAG,CAACvX,MAAD,EAAS,EAAT,CAAH,GAAkB,CAACA,MAAD,CADG,CAAnC;AAED;;AACD,UAAI,OAAO9Y,IAAI,CAAC3yB,GAAZ,KAAoB,WAAxB,EAAqC;AACnC,YAAIo2D,QAAQ,GAAGtjB,iBAAiB,CAAC,CAACngB,IAAI,CAAC3yB,GAAN,CAAD,CAAhC;AACA,YAAIq2D,MAAM,GAAGvjB,iBAAiB,CAAC,CAACngB,IAAI,CAAC3yB,GAAN,EAAW,EAAX,CAAD,CAA9B;;AACA,YAAI41D,QAAQ,CAAC9vB,UAAb,EAAyB;AACvB8vB,UAAAA,QAAQ,CAACnqB,MAAT,GAAkB2qB,QAAlB;AACAR,UAAAA,QAAQ,CAACrqB,QAAT,GAAoB8qB,MAApB;AACD,SAHD,MAGO;AACLT,UAAAA,QAAQ,CAACrqB,QAAT,GAAoB6qB,QAApB;AACAR,UAAAA,QAAQ,CAACnqB,MAAT,GAAkB4qB,MAAlB;AACD;AACF;;AACD,UAAI,CAACX,YAAL,EAAmB;AACjB,YAAI,OAAO/iC,IAAI,CAACoT,KAAZ,KAAsB,QAA1B,EAAoC;AAClC6vB,UAAAA,QAAQ,CAAC7vB,KAAT,GAAiBpT,IAAI,CAACoT,KAAtB;AACD;;AACD6vB,QAAAA,QAAQ,CAACvuB,IAAT,GAAgBA,IAAhB;AACD;;AACD,aAAOsuB,aAAa,CAACC,QAAD,CAAb,CAAwBxxD,IAAxB,CAA6B2xD,iBAA7B,CAAP;AACD;AACF;;AAED,WAASO,eAAT,CAAyB5jC,EAAzB,EAA6B;AAC3B,WAAOA,EAAE,CAACwb,KAAH,CAAS,eAAT,EAA0B;AAC/Bod,MAAAA,OAAO,EAAE,IAAInd,CAAJ,CAAM;AAAC,wBAAgB;AAAjB,OAAN,CADsB;AAE/BjhC,MAAAA,MAAM,EAAE;AAFuB,KAA1B,EAGJ9I,IAHI,CAGC,UAAU0G,QAAV,EAAoB;AAC1B,aAAOA,QAAQ,CAACgxC,IAAT,EAAP;AACD,KALM,CAAP;AAMD;;AAED,WAASya,gBAAT,CAA0B7jC,EAA1B,EAA8B;AAC5B,WAAOA,EAAE,CAAC/0B,GAAH,CAAO,YAAYmyD,YAAnB,EAAiC1rD,IAAjC,CAAsC,UAAUy6C,OAAV,EAAmB;AAC9D,UAAI2X,WAAW,GAAG,IAAI3mC,WAAJ,EAAlB;AACApyB,MAAAA,MAAM,CAACoC,IAAP,CAAYg/C,OAAO,CAACrH,KAApB,EAA2B52C,OAA3B,CAAmC,UAAUyvD,YAAV,EAAwB;AACzD,YAAI52B,KAAK,GAAGk3B,aAAa,CAACN,YAAD,CAAzB;AACA,YAAIoG,aAAa,GAAG,aAAah9B,KAAK,CAAC,CAAD,CAAtC;AACA,YAAI4d,QAAQ,GAAG5d,KAAK,CAAC,CAAD,CAApB;AACA,YAAI+d,KAAK,GAAGgf,WAAW,CAAC74D,GAAZ,CAAgB84D,aAAhB,CAAZ;;AACA,YAAI,CAACjf,KAAL,EAAY;AACVA,UAAAA,KAAK,GAAG,IAAI5nB,WAAJ,EAAR;AACA4mC,UAAAA,WAAW,CAAC54D,GAAZ,CAAgB64D,aAAhB,EAA+Bjf,KAA/B;AACD;;AACDA,QAAAA,KAAK,CAACloB,GAAN,CAAU+nB,QAAV;AACD,OAVD;AAWA,UAAI1kB,IAAI,GAAG;AACT9yB,QAAAA,IAAI,EAAGqvD,cAAc,CAACsH,WAAD,CADZ;AAET39B,QAAAA,YAAY,EAAG;AAFN,OAAX;AAIA,aAAOnG,EAAE,CAAC2Y,OAAH,CAAW1Y,IAAX,EAAiBvuB,IAAjB,CAAsB,UAAU+qB,GAAV,EAAe;AAC1C,YAAIunC,aAAa,GAAG,EAApB;AACAvnC,QAAAA,GAAG,CAACmmB,IAAJ,CAAS10C,OAAT,CAAiB,UAAUwpC,GAAV,EAAe;AAC9B,cAAIusB,QAAQ,GAAGvsB,GAAG,CAACpqC,GAAJ,CAAQ8uB,SAAR,CAAkB,CAAlB,CAAf,CAD8B,CACO;;AACrC0nC,UAAAA,WAAW,CAAC74D,GAAZ,CAAgBysC,GAAG,CAACpqC,GAApB,EAAyBY,OAAzB,CAAiC,UAAUy2C,QAAV,EAAoB;AACnD,gBAAIgZ,YAAY,GAAGsG,QAAQ,GAAG,GAAX,GAAiBtf,QAApC;AACA;;AACA,gBAAI,CAACwH,OAAO,CAACrH,KAAR,CAAc6Y,YAAd,CAAL,EAAkC;AAChC;AACA;AACAA,cAAAA,YAAY,GAAGhZ,QAAf;AACD;;AACD,gBAAIuf,WAAW,GAAGn5D,MAAM,CAACoC,IAAP,CAAYg/C,OAAO,CAACrH,KAAR,CAAc6Y,YAAd,CAAZ,CAAlB,CARmD,CASnD;;AACA,gBAAIwG,YAAY,GAAGzsB,GAAG,CAAChS,GAAJ,IAAWgS,GAAG,CAAChS,GAAJ,CAAQof,KAAnB,IACjBpN,GAAG,CAAChS,GAAJ,CAAQof,KAAR,CAAcH,QAAd,CADF;AAEAuf,YAAAA,WAAW,CAACh2D,OAAZ,CAAoB,UAAUk2D,UAAV,EAAsB;AACxCJ,cAAAA,aAAa,CAACI,UAAD,CAAb,GACEJ,aAAa,CAACI,UAAD,CAAb,IAA6BD,YAD/B;AAED,aAHD;AAID,WAhBD;AAiBD,SAnBD;AAoBA,YAAIE,WAAW,GAAGt5D,MAAM,CAACoC,IAAP,CAAY62D,aAAZ,EAA2BnyD,MAA3B,CAChB,UAAUuyD,UAAV,EAAsB;AAAE,iBAAO,CAACJ,aAAa,CAACI,UAAD,CAArB;AAAoC,SAD5C,CAAlB;AAEA,YAAIE,eAAe,GAAGD,WAAW,CAACvrD,GAAZ,CAAgB,UAAUsrD,UAAV,EAAsB;AAC1D,iBAAOhI,aAAa,CAACwF,QAAQ,CAACwC,UAAD,CAAT,EAAuB,YAAY;AACrD,mBAAO,IAAIpkC,EAAE,CAAC7B,WAAP,CAAmBimC,UAAnB,EAA+BpkC,EAAE,CAAC4Z,MAAlC,EAA0CvN,OAA1C,EAAP;AACD,WAFmB,CAAb,EAAP;AAGD,SAJqB,CAAtB;AAKA,eAAOp4B,OAAO,CAAC0Y,GAAR,CAAY23C,eAAZ,EAA6B5yD,IAA7B,CAAkC,YAAY;AACnD,iBAAO;AAACouB,YAAAA,EAAE,EAAE;AAAL,WAAP;AACD,SAFM,CAAP;AAGD,OAhCM,CAAP;AAiCD,KAlDM,EAkDJ0gC,UAAU,CAAC;AAAC1gC,MAAAA,EAAE,EAAE;AAAL,KAAD,CAlDN,CAAP;AAmDD;;AAED,WAASykC,aAAT,CAAuBvkC,EAAvB,EAA2BtF,GAA3B,EAAgCuF,IAAhC,EAAsC;AACpC;AACA,QAAI,OAAOD,EAAE,CAACqgC,MAAV,KAAqB,UAAzB,EAAqC;AACnC,aAAOD,WAAW,CAACpgC,EAAD,EAAKtF,GAAL,EAAUuF,IAAV,CAAlB;AACD;;AACD,QAAI0G,QAAQ,CAAC3G,EAAD,CAAZ,EAAkB;AAChB,aAAOigC,SAAS,CAACjgC,EAAD,EAAKtF,GAAL,EAAUuF,IAAV,CAAhB;AACD;;AAED,QAAI,OAAOvF,GAAP,KAAe,QAAnB,EAA6B;AAC3B;AACAklC,MAAAA,oBAAoB,CAAC3/B,IAAD,EAAOvF,GAAP,CAApB;AAEAqjC,MAAAA,aAAa,CAACnhC,GAAd,CAAkB,YAAY;AAC5B,YAAI4nC,iBAAiB,GAAGvH,UAAU;AAChC;AAAej9B,QAAAA,EADiB;AAEhC;AAAe,6BAFiB;AAGhC;AAAatF,QAAAA,GAAG,CAAC5hB,GAHe;AAIhC;AAAgB4hB,QAAAA,GAAG,CAACttB,MAJY;AAKhC;AAAgB,YALgB;AAMhC;AAAmBgwD,QAAAA,YANa,CAAlC;AAOA,eAAOoH,iBAAiB,CAAC9yD,IAAlB,CAAuB,UAAU8yC,IAAV,EAAgB;AAC5C,iBAAO0X,GAAG,CAAC2F,UAAU,CAACrd,IAAD,CAAV,CAAiB9yC,IAAjB,CAAsB,YAAY;AAC3C,mBAAOmxD,SAAS,CAACre,IAAD,EAAOvkB,IAAP,CAAhB;AACD,WAFU,CAAD,EAEN,YAAY;AACd,mBAAOukB,IAAI,CAACxkB,EAAL,CAAQqM,OAAR,EAAP;AACD,WAJS,CAAV;AAKD,SANM,CAAP;AAOD,OAfD;AAgBA,aAAO0xB,aAAa,CAACvQ,MAAd,EAAP;AACD,KArBD,MAqBO;AACL;AACA,UAAImQ,YAAY,GAAGjjC,GAAnB;AACA,UAAIqM,KAAK,GAAGk3B,aAAa,CAACN,YAAD,CAAzB;AACA,UAAIoG,aAAa,GAAGh9B,KAAK,CAAC,CAAD,CAAzB;AACA,UAAI4d,QAAQ,GAAG5d,KAAK,CAAC,CAAD,CAApB;AACA,aAAO/G,EAAE,CAAC/0B,GAAH,CAAO,aAAa84D,aAApB,EAAmCryD,IAAnC,CAAwC,UAAUg0B,GAAV,EAAe;AAC5D,YAAIhL,GAAG,GAAGgL,GAAG,CAACof,KAAJ,IAAapf,GAAG,CAACof,KAAJ,CAAUH,QAAV,CAAvB;;AAEA,YAAI,CAACjqB,GAAL,EAAU;AACR;AACA,gBAAM,IAAIohC,aAAJ,CAAkB,UAAUp2B,GAAG,CAAC4C,GAAd,GAAoB,qBAApB,GACtBqc,QADI,CAAN;AAED;;AAED4Z,QAAAA,aAAa,CAAC74B,GAAD,EAAMif,QAAN,CAAb;AACAib,QAAAA,oBAAoB,CAAC3/B,IAAD,EAAOvF,GAAP,CAApB;AAEA,YAAI8pC,iBAAiB,GAAGvH,UAAU;AAChC;AAAej9B,QAAAA,EADiB;AAEhC;AAAe29B,QAAAA,YAFiB;AAGhC;AAAajjC,QAAAA,GAAG,CAAC5hB,GAHe;AAIhC;AAAgB4hB,QAAAA,GAAG,CAACttB,MAJY;AAKhC;AAAgB,aALgB;AAMhC;AAAmBgwD,QAAAA,YANa,CAAlC;AAOA,eAAOoH,iBAAiB,CAAC9yD,IAAlB,CAAuB,UAAU8yC,IAAV,EAAgB;AAC5C,cAAIvkB,IAAI,CAACwkC,KAAL,KAAe,IAAf,IAAuBxkC,IAAI,CAACwkC,KAAL,KAAe,cAA1C,EAA0D;AACxD,gBAAIxkC,IAAI,CAACwkC,KAAL,KAAe,cAAnB,EAAmC;AACjC,sCAAU,YAAY;AACpB5C,gBAAAA,UAAU,CAACrd,IAAD,CAAV;AACD,eAFD;AAGD;;AACD,mBAAOqe,SAAS,CAACre,IAAD,EAAOvkB,IAAP,CAAhB;AACD,WAPD,MAOO;AAAE;AACP,mBAAO4hC,UAAU,CAACrd,IAAD,CAAV,CAAiB9yC,IAAjB,CAAsB,YAAY;AACvC,qBAAOmxD,SAAS,CAACre,IAAD,EAAOvkB,IAAP,CAAhB;AACD,aAFM,CAAP;AAGD;AACF,SAbM,CAAP;AAcD,OAjCM,CAAP;AAkCD;AACF;;AAED,WAASykC,aAAT,CAAuBhqC,GAAvB,EAA4BuF,IAA5B,EAAkCpB,QAAlC,EAA4C;AAC1C,QAAImB,EAAE,GAAG,IAAT;;AACA,QAAI,OAAOC,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,MAAAA,QAAQ,GAAGoB,IAAX;AACAA,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,IAAAA,IAAI,GAAGA,IAAI,GAAGu/B,aAAa,CAACv/B,IAAD,CAAhB,GAAyB,EAApC;;AAEA,QAAI,OAAOvF,GAAP,KAAe,UAAnB,EAA+B;AAC7BA,MAAAA,GAAG,GAAG;AAAC5hB,QAAAA,GAAG,EAAG4hB;AAAP,OAAN;AACD;;AAED,QAAI3J,OAAO,GAAG9c,OAAO,CAAC8E,OAAR,GAAkBrH,IAAlB,CAAuB,YAAY;AAC/C,aAAO6yD,aAAa,CAACvkC,EAAD,EAAKtF,GAAL,EAAUuF,IAAV,CAApB;AACD,KAFa,CAAd;AAGA+7B,IAAAA,gBAAgB,CAACjrC,OAAD,EAAU8N,QAAV,CAAhB;AACA,WAAO9N,OAAP;AACD;;AAED,MAAI4zC,mBAAmB,GAAG1I,WAAW,CAAC,YAAY;AAChD,QAAIj8B,EAAE,GAAG,IAAT;AACA;;AACA,QAAI,OAAOA,EAAE,CAACugC,YAAV,KAA2B,UAA/B,EAA2C;AACzC,aAAOD,iBAAiB,CAACtgC,EAAD,CAAxB;AACD;;AACD,QAAI2G,QAAQ,CAAC3G,EAAD,CAAZ,EAAkB;AAChB,aAAO4jC,eAAe,CAAC5jC,EAAD,CAAtB;AACD;;AACD,WAAO6jC,gBAAgB,CAAC7jC,EAAD,CAAvB;AACD,GAVoC,CAArC;AAYA,SAAO;AACL+F,IAAAA,KAAK,EAAE2+B,aADF;AAELE,IAAAA,WAAW,EAAED;AAFR,GAAP;AAID;;AAED,IAAIE,aAAa,GAAG;AAClBC,EAAAA,IAAI,EAAE,UAAU33D,IAAV,EAAgB46B,MAAhB,EAAwB;AAC5B,WAAO20B,GAAG,CAAC30B,MAAD,CAAV;AACD,GAHiB;AAKlBg9B,EAAAA,MAAM,EAAE,UAAU53D,IAAV,EAAgB46B,MAAhB,EAAwB;AAC9B,WAAOA,MAAM,CAACt+B,MAAd;AACD,GAPiB;AASlBu7D,EAAAA,MAAM,EAAE,UAAU73D,IAAV,EAAgB46B,MAAhB,EAAwB;AAC9B;AACA;AACA,aAASk9B,MAAT,CAAgBl9B,MAAhB,EAAwB;AACtB,UAAIm9B,OAAO,GAAG,CAAd;;AACA,WAAK,IAAInmD,CAAC,GAAG,CAAR,EAAWwY,GAAG,GAAGwQ,MAAM,CAACt+B,MAA7B,EAAqCsV,CAAC,GAAGwY,GAAzC,EAA8CxY,CAAC,EAA/C,EAAmD;AACjD,YAAI0hC,GAAG,GAAG1Y,MAAM,CAAChpB,CAAD,CAAhB;AACAmmD,QAAAA,OAAO,IAAKzkB,GAAG,GAAGA,GAAlB;AACD;;AACD,aAAOykB,OAAP;AACD;;AACD,WAAO;AACLxI,MAAAA,GAAG,EAAOA,GAAG,CAAC30B,MAAD,CADR;AAELl4B,MAAAA,GAAG,EAAOgQ,IAAI,CAAChQ,GAAL,CAASvF,KAAT,CAAe,IAAf,EAAqBy9B,MAArB,CAFL;AAGLj4B,MAAAA,GAAG,EAAO+P,IAAI,CAAC/P,GAAL,CAASxF,KAAT,CAAe,IAAf,EAAqBy9B,MAArB,CAHL;AAIL1P,MAAAA,KAAK,EAAK0P,MAAM,CAACt+B,MAJZ;AAKLw7D,MAAAA,MAAM,EAAGA,MAAM,CAACl9B,MAAD;AALV,KAAP;AAOD;AA3BiB,CAApB;;AA8BA,SAASo9B,UAAT,CAAoBC,eAApB,EAAqC;AACnC,MAAI,QAAQ/1C,IAAR,CAAa+1C,eAAb,CAAJ,EAAmC;AACjC,WAAOP,aAAa,CAACC,IAArB;AACD,GAFD,MAEO,IAAI,UAAUz1C,IAAV,CAAe+1C,eAAf,CAAJ,EAAqC;AAC1C,WAAOP,aAAa,CAACE,MAArB;AACD,GAFM,MAEA,IAAI,UAAU11C,IAAV,CAAe+1C,eAAf,CAAJ,EAAqC;AAC1C,WAAOP,aAAa,CAACG,MAArB;AACD,GAFM,MAEA,IAAI,KAAK31C,IAAL,CAAU+1C,eAAV,CAAJ,EAAgC;AACrC,UAAM,IAAI75D,KAAJ,CAAU65D,eAAe,GAAG,sCAA5B,CAAN;AACD;AACF;;AAED,SAAS/G,MAAT,CAAgBxZ,MAAhB,EAAwB5tB,IAAxB,EAA8B;AAC5B;AACA,MAAI,OAAO4tB,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACp7C,MAAP,KAAkB,CAAtD,EAAyD;AACvD,QAAI47D,OAAO,GAAGxgB,MAAd;AACA,WAAO,UAAUnf,GAAV,EAAe;AACpB,aAAO2/B,OAAO,CAAC3/B,GAAD,EAAMzO,IAAN,CAAd;AACD,KAFD;AAGD,GALD,MAKO;AACL,WAAO4lC,oBAAoB,CAAChY,MAAM,CAAC93C,QAAP,EAAD,EAAoBkqB,IAApB,CAA3B;AACD;AACF;;AAED,SAASqnC,OAAT,CAAiBtB,SAAjB,EAA4B;AAC1B,MAAIoI,eAAe,GAAGpI,SAAS,CAACjwD,QAAV,EAAtB;AACA,MAAIu4D,OAAO,GAAGH,UAAU,CAACC,eAAD,CAAxB;;AACA,MAAIE,OAAJ,EAAa;AACX,WAAOA,OAAP;AACD,GAFD,MAEO;AACL,WAAOzI,oBAAoB,CAACuI,eAAD,CAA3B;AACD;AACF;;AAED,SAAS7G,aAAT,CAAuB3Z,IAAvB,EAA6BD,QAA7B,EAAuC;AACrC,MAAIjqB,GAAG,GAAGkqB,IAAI,CAACE,KAAL,IAAcF,IAAI,CAACE,KAAL,CAAWH,QAAX,CAAxB;;AACA,MAAI,OAAOjqB,GAAG,CAAC5hB,GAAX,KAAmB,QAAvB,EAAiC;AAC/B,UAAM,IAAIgjD,aAAJ,CAAkB,UAAUlX,IAAI,CAACtc,GAAf,GAAqB,4BAArB,GACtBqc,QADsB,GACX,kCADW,GAC0B,OAAOjqB,GAAG,CAAC5hB,GADvD,CAAN;AAED;AACF;;AAED,IAAIskD,YAAY,GAAG,SAAnB;AACA,IAAImI,QAAQ,GAAGnH,uBAAuB,CAAChB,YAAD,EAAeiB,MAAf,EAAuBC,OAAvB,EAAgCC,aAAhC,CAAtC;;AAEA,SAASx4B,KAAT,CAAerL,GAAf,EAAoBuF,IAApB,EAA0BpB,QAA1B,EAAoC;AAClC,SAAO0mC,QAAQ,CAACx/B,KAAT,CAAe/4B,IAAf,CAAoB,IAApB,EAA0B0tB,GAA1B,EAA+BuF,IAA/B,EAAqCpB,QAArC,CAAP;AACD;;AAED,SAAS+lC,WAAT,CAAqB/lC,QAArB,EAA+B;AAC7B,SAAO0mC,QAAQ,CAACX,WAAT,CAAqB53D,IAArB,CAA0B,IAA1B,EAAgC6xB,QAAhC,CAAP;AACD;;AAED,IAAI2mC,SAAS,GAAG;AACdz/B,EAAAA,KAAK,EAAEA,KADO;AAEd6+B,EAAAA,WAAW,EAAEA;AAFC,CAAhB;;AAKA,SAASa,UAAT,CAAoBlxB,MAApB,EAA4B;AAC1B,SAAO,MAAMllB,IAAN,CAAWklB,MAAX,CAAP;AACD;;AAED,SAASmxB,cAAT,CAAwBxrB,QAAxB,EAAkCyrB,SAAlC,EAA6CjY,QAA7C,EAAuD;AACrD,SAAO,CAACxT,QAAQ,CAAC5T,YAAV,IACA,CAAC4T,QAAQ,CAAC5T,YAAT,CAAsBonB,QAAtB,CADD,IAEAxT,QAAQ,CAAC5T,YAAT,CAAsBonB,QAAtB,EAAgCvH,MAAhC,KAA2Cwf,SAAS,CAACr/B,YAAV,CAAuBonB,QAAvB,EAAiCvH,MAFnF;AAGD;;AAED,SAASyf,iBAAT,CAA2B5lC,EAA3B,EAA+B0F,GAA/B,EAAoC;AAClC,MAAI20B,SAAS,GAAGtvD,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,CAAhB;AACA,SAAOryB,OAAO,CAAC0Y,GAAR,CAAY0tC,SAAS,CAACvhD,GAAV,CAAc,UAAU40C,QAAV,EAAoB;AACnD,WAAO1tB,EAAE,CAAC0Y,aAAH,CAAiBhT,GAAG,CAAC4C,GAArB,EAA0BolB,QAA1B,EAAoC;AAACjsB,MAAAA,GAAG,EAAEiE,GAAG,CAACyC;AAAV,KAApC,CAAP;AACD,GAFkB,CAAZ,CAAP;AAGD;;AAED,SAAS09B,mCAAT,CAA6C1pD,MAA7C,EAAqD2pD,GAArD,EAA0DpgC,GAA1D,EAA+D;AAC7D,MAAIqgC,0BAA0B,GAAGp/B,QAAQ,CAACm/B,GAAD,CAAR,IAAiB,CAACn/B,QAAQ,CAACxqB,MAAD,CAA3D;AACA,MAAIk+C,SAAS,GAAGtvD,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,CAAhB;;AAEA,MAAI,CAACy/B,0BAAL,EAAiC;AAC/B,WAAOH,iBAAiB,CAACE,GAAD,EAAMpgC,GAAN,CAAxB;AACD;;AAED,SAAOvpB,MAAM,CAAClR,GAAP,CAAWy6B,GAAG,CAAC4C,GAAf,EAAoB52B,IAApB,CAAyB,UAAUwoC,QAAV,EAAoB;AAClD,WAAOjmC,OAAO,CAAC0Y,GAAR,CAAY0tC,SAAS,CAACvhD,GAAV,CAAc,UAAU40C,QAAV,EAAoB;AACnD,UAAIgY,cAAc,CAACxrB,QAAD,EAAWxU,GAAX,EAAgBgoB,QAAhB,CAAlB,EAA6C;AAC3C,eAAOoY,GAAG,CAACptB,aAAJ,CAAkBhT,GAAG,CAAC4C,GAAtB,EAA2BolB,QAA3B,CAAP;AACD;;AAED,aAAOvxC,MAAM,CAACu8B,aAAP,CAAqBwB,QAAQ,CAAC5R,GAA9B,EAAmColB,QAAnC,CAAP;AACD,KANkB,CAAZ,CAAP;AAOD,GARM,EAQJvgC,KARI,CAQE,UAAUjY,KAAV,EAAiB;AACxB;AACA,QAAIA,KAAK,CAACouB,MAAN,KAAiB,GAArB,EAA0B;AACxB,YAAMpuB,KAAN;AACD;;AAED,WAAO0wD,iBAAiB,CAACE,GAAD,EAAMpgC,GAAN,CAAxB;AACD,GAfM,CAAP;AAgBD;;AAED,SAASsgC,iBAAT,CAA2BC,KAA3B,EAAkC;AAChC,MAAI/lC,QAAQ,GAAG,EAAf;AACAn1B,EAAAA,MAAM,CAACoC,IAAP,CAAY84D,KAAZ,EAAmB/3D,OAAnB,CAA2B,UAAUD,EAAV,EAAc;AACvC,QAAIi4D,WAAW,GAAGD,KAAK,CAACh4D,EAAD,CAAL,CAAU4oC,OAA5B;AACAqvB,IAAAA,WAAW,CAACh4D,OAAZ,CAAoB,UAAUi4D,UAAV,EAAsB;AACxCjmC,MAAAA,QAAQ,CAACpxB,IAAT,CAAc;AACZb,QAAAA,EAAE,EAAEA,EADQ;AAEZwzB,QAAAA,GAAG,EAAE0kC;AAFO,OAAd;AAID,KALD;AAMD,GARD;AAUA,SAAO;AACLhmC,IAAAA,IAAI,EAAED,QADD;AAELyN,IAAAA,IAAI,EAAE,IAFD;AAGLgE,IAAAA,MAAM,EAAE;AAHH,GAAP;AAKD,EAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASy0B,OAAT,CAAiBN,GAAjB,EAAsB3pD,MAAtB,EAA8B8pD,KAA9B,EAAqCngD,KAArC,EAA4C;AAC1CmgD,EAAAA,KAAK,GAAG7gD,KAAK,CAAC6gD,KAAD,CAAb,CAD0C,CACpB;;AAEtB,MAAII,UAAU,GAAG,EAAjB;AAAA,MACIvmC,EAAE,GAAG,IADT;;AAGA,WAASwmC,UAAT,GAAsB;AAEpB,QAAIC,WAAW,GAAGP,iBAAiB,CAACC,KAAD,CAAnC;;AAEA,QAAI,CAACM,WAAW,CAACpmC,IAAZ,CAAiB12B,MAAtB,EAA8B;AAAE;AAC9B;AACD;;AAED,WAAOq8D,GAAG,CAAC/lC,OAAJ,CAAYwmC,WAAZ,EAAyB70D,IAAzB,CAA8B,UAAU80D,eAAV,EAA2B;AAC9D;AACA,UAAI1gD,KAAK,CAAC4c,SAAV,EAAqB;AACnB,cAAM,IAAIn3B,KAAJ,CAAU,WAAV,CAAN;AACD;;AACD,aAAO0I,OAAO,CAAC0Y,GAAR,CAAY65C,eAAe,CAAC35C,OAAhB,CAAwB/T,GAAxB,CAA4B,UAAU2tD,WAAV,EAAuB;AACpE,eAAOxyD,OAAO,CAAC0Y,GAAR,CAAY85C,WAAW,CAACtmC,IAAZ,CAAiBrnB,GAAjB,CAAqB,UAAU4sB,GAAV,EAAe;AACrD,cAAIigC,SAAS,GAAGjgC,GAAG,CAAC5F,EAApB;;AAEA,cAAI4F,GAAG,CAACxwB,KAAR,EAAe;AACb;AACA;AACA4qB,YAAAA,EAAE,GAAG,KAAL;AACD;;AAED,cAAI,CAAC6lC,SAAD,IAAc,CAACA,SAAS,CAACr/B,YAA7B,EAA2C;AACzC,mBAAOq/B,SAAP;AACD;;AAED,iBAAOE,mCAAmC,CAAC1pD,MAAD,EAAS2pD,GAAT,EAAcH,SAAd,CAAnC,CACGj0D,IADH,CACQ,UAAU00B,WAAV,EAAuB;AACrB,gBAAIi0B,SAAS,GAAGtvD,MAAM,CAACoC,IAAP,CAAYw4D,SAAS,CAACr/B,YAAtB,CAAhB;AACAF,YAAAA,WAAW,CACRl4B,OADH,CACW,UAAU8mD,UAAV,EAAsBj2C,CAAtB,EAAyB;AACvB,kBAAIsnB,GAAG,GAAGs/B,SAAS,CAACr/B,YAAV,CAAuB+zB,SAAS,CAACt7C,CAAD,CAAhC,CAAV;AACA,qBAAOsnB,GAAG,CAACE,IAAX;AACA,qBAAOF,GAAG,CAAC58B,MAAX;AACA48B,cAAAA,GAAG,CAACn5B,IAAJ,GAAW8nD,UAAX;AACD,aANZ;AAQW,mBAAO2Q,SAAP;AACD,WAZpB,CAAP;AAaD,SA1BkB,CAAZ,CAAP;AA2BD,OA5BkB,CAAZ,EA8BNj0D,IA9BM,CA8BD,UAAUmb,OAAV,EAAmB;AACvBw5C,QAAAA,UAAU,GAAGA,UAAU,CAAC91D,MAAX,CAAkBi2B,OAAO,CAAC3Z,OAAD,CAAP,CAAiBhb,MAAjB,CAAwB60D,OAAxB,CAAlB,CAAb;AACD,OAhCM,CAAP;AAiCD,KAtCM,CAAP;AAuCD;;AAED,WAAS7Y,cAAT,CAAwBnoB,GAAxB,EAA6B;AAC3B,WAAOA,GAAG,CAACY,YAAJ,IAAoBv7B,MAAM,CAACoC,IAAP,CAAYu4B,GAAG,CAACY,YAAhB,EAA8B78B,MAA9B,GAAuC,CAAlE;AACD;;AAED,WAASk9D,YAAT,CAAsBjhC,GAAtB,EAA2B;AACzB,WAAOA,GAAG,CAACgN,UAAJ,IAAkBhN,GAAG,CAACgN,UAAJ,CAAejpC,MAAf,GAAwB,CAAjD;AACD;;AAED,WAASm9D,oBAAT,CAA8Br5B,GAA9B,EAAmC;AACjC;AACA;AACA,WAAOu4B,GAAG,CAACntB,OAAJ,CAAY;AACjBxrC,MAAAA,IAAI,EAAEogC,GADW;AAEjBpH,MAAAA,YAAY,EAAE,IAFG;AAGjBoI,MAAAA,SAAS,EAAE;AAHM,KAAZ,EAIJ78B,IAJI,CAIC,UAAU+qB,GAAV,EAAe;AACrB,UAAI3W,KAAK,CAAC4c,SAAV,EAAqB;AACnB,cAAM,IAAIn3B,KAAJ,CAAU,WAAV,CAAN;AACD;;AACDkxB,MAAAA,GAAG,CAACmmB,IAAJ,CAAS10C,OAAT,CAAiB,UAAUwpC,GAAV,EAAe;AAC9B,YAAIA,GAAG,CAACjK,OAAJ,IAAe,CAACiK,GAAG,CAAChS,GAApB,IAA2B,CAAC+/B,UAAU,CAAC/tB,GAAG,CAAClqC,KAAJ,CAAUi0B,GAAX,CAAtC,IACAosB,cAAc,CAACnW,GAAG,CAAChS,GAAL,CADd,IAC2BihC,YAAY,CAACjvB,GAAG,CAAChS,GAAL,CAD3C,EACsD;AACpD;AACA;AACD,SAL6B,CAO9B;;AACA;;;AACA,YAAIgS,GAAG,CAAChS,GAAJ,CAAQgN,UAAZ,EAAwB;AACtB,iBAAOgF,GAAG,CAAChS,GAAJ,CAAQgN,UAAf;AACD,SAX6B,CAa9B;;;AACA2zB,QAAAA,UAAU,CAACv3D,IAAX,CAAgB4oC,GAAG,CAAChS,GAApB;AACA,eAAOugC,KAAK,CAACvuB,GAAG,CAACzpC,EAAL,CAAZ;AACD,OAhBD;AAiBD,KAzBM,CAAP;AA0BD;;AAED,WAAS44D,kBAAT,GAA8B;AAC5B;AACA;AACA,QAAIt5B,GAAG,GAAGxiC,MAAM,CAACoC,IAAP,CAAY84D,KAAZ,EAAmBp0D,MAAnB,CAA0B,UAAU5D,EAAV,EAAc;AAChD,UAAI4oC,OAAO,GAAGovB,KAAK,CAACh4D,EAAD,CAAL,CAAU4oC,OAAxB;AACA,aAAOA,OAAO,CAACptC,MAAR,KAAmB,CAAnB,IAAwBg8D,UAAU,CAAC5uB,OAAO,CAAC,CAAD,CAAR,CAAzC;AACD,KAHS,CAAV;;AAIA,QAAItJ,GAAG,CAAC9jC,MAAJ,GAAa,CAAjB,EAAoB;AAClB,aAAOm9D,oBAAoB,CAACr5B,GAAD,CAA3B;AACD;AACF;;AAED,WAASu5B,YAAT,GAAwB;AACtB,WAAO;AAAEhnC,MAAAA,EAAE,EAACA,EAAL;AAASK,MAAAA,IAAI,EAACkmC;AAAd,KAAP;AACD;;AAED,SAAOpyD,OAAO,CAAC8E,OAAR,GACJrH,IADI,CACCm1D,kBADD,EAEJn1D,IAFI,CAEC40D,UAFD,EAGJ50D,IAHI,CAGCo1D,YAHD,CAAP;AAID;;AAED,IAAIC,kBAAkB,GAAG,CAAzB;AACA,IAAIC,UAAU,GAAG,SAAjB,EACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,uBAAuB,GAAG,CAA9B;AACA,IAAIC,UAAU,GAAG,CAAjB;;AAEA,SAASC,gBAAT,CAA0BnnC,EAA1B,EAA8B/xB,EAA9B,EAAkCm5D,UAAlC,EAA8CC,OAA9C,EAAuDC,WAAvD,EAAoE;AAClE,SAAOtnC,EAAE,CAAC/0B,GAAH,CAAOgD,EAAP,EAAWkf,KAAX,CAAiB,UAAU7T,GAAV,EAAe;AACrC,QAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,UAAItD,EAAE,CAAChL,OAAH,KAAe,MAAf,IAAyBgL,EAAE,CAAChL,OAAH,KAAe,OAA5C,EAAqD;AACnDqO,QAAAA,YAAY,CACV,GADU,EACL,yDADK,CAAZ;AAGD;;AACD,aAAO;AACLkkC,QAAAA,UAAU,EAAEF,OADP;AAEL/+B,QAAAA,GAAG,EAAEr6B,EAFA;AAGL4gC,QAAAA,OAAO,EAAE,EAHJ;AAIL24B,QAAAA,UAAU,EAAER,UAJP;AAKL76D,QAAAA,OAAO,EAAE46D;AALJ,OAAP;AAOD;;AACD,UAAMztD,GAAN;AACD,GAhBM,EAgBJ5H,IAhBI,CAgBC,UAAUg0B,GAAV,EAAe;AACrB,QAAI4hC,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB;AACD,KAHoB,CAKrB;;;AACA,QAAIgD,GAAG,CAACqP,QAAJ,KAAiBqyB,UAArB,EAAiC;AAC/B;AACD,KARoB,CAUrB;;;AACA1hC,IAAAA,GAAG,CAACmJ,OAAJ,GAAc,CAACnJ,GAAG,CAACmJ,OAAJ,IAAe,EAAhB,EAAoBh9B,MAApB,CAA2B,UAAU+Y,IAAV,EAAgB;AACvD,aAAOA,IAAI,CAAC28C,UAAL,KAAoBF,OAA3B;AACD,KAFa,CAAd,CAXqB,CAerB;;AACA3hC,IAAAA,GAAG,CAACmJ,OAAJ,CAAY7W,OAAZ,CAAoB;AAClB+c,MAAAA,QAAQ,EAAEqyB,UADQ;AAElBG,MAAAA,UAAU,EAAEF;AAFM,KAApB,EAhBqB,CAqBrB;AACA;AACA;;AACA3hC,IAAAA,GAAG,CAACmJ,OAAJ,GAAcnJ,GAAG,CAACmJ,OAAJ,CAAY1+B,KAAZ,CAAkB,CAAlB,EAAqB82D,uBAArB,CAAd;AAEAvhC,IAAAA,GAAG,CAACv5B,OAAJ,GAAc46D,kBAAd;AACArhC,IAAAA,GAAG,CAAC8hC,UAAJ,GAAiBR,UAAjB;AAEAthC,IAAAA,GAAG,CAAC6hC,UAAJ,GAAiBF,OAAjB;AACA3hC,IAAAA,GAAG,CAACqP,QAAJ,GAAeqyB,UAAf;AAEA,WAAOpnC,EAAE,CAACwI,GAAH,CAAO9C,GAAP,EAAYvY,KAAZ,CAAkB,UAAU7T,GAAV,EAAe;AACtC,UAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB;AACA,eAAO6jC,gBAAgB,CAACnnC,EAAD,EAAK/xB,EAAL,EAASm5D,UAAT,EAAqBC,OAArB,EAA8BC,WAA9B,CAAvB;AACD;;AACD,YAAMhuD,GAAN;AACD,KANM,CAAP;AAOD,GAvDM,CAAP;AAwDD;;AAED,SAASmuD,YAAT,CAAsB3B,GAAtB,EAA2B3pD,MAA3B,EAAmClO,EAAnC,EAAuCq5D,WAAvC,EAAoDrnC,IAApD,EAA0D;AACxD,OAAK6lC,GAAL,GAAWA,GAAX;AACA,OAAK3pD,MAAL,GAAcA,MAAd;AACA,OAAKlO,EAAL,GAAUA,EAAV;AACA,OAAKq5D,WAAL,GAAmBA,WAAnB;AACA,OAAKrnC,IAAL,GAAYA,IAAI,IAAI,EAApB;AACD;;AAEDwnC,YAAY,CAACx9D,SAAb,CAAuBy9D,eAAvB,GAAyC,UAAUN,UAAV,EAAsBC,OAAtB,EAA+B;AACtE,MAAI5oC,IAAI,GAAG,IAAX;AACA,SAAO,KAAKkpC,YAAL,CAAkBP,UAAlB,EAA8BC,OAA9B,EAAuC31D,IAAvC,CAA4C,YAAY;AAC7D,WAAO+sB,IAAI,CAACmpC,YAAL,CAAkBR,UAAlB,EAA8BC,OAA9B,CAAP;AACD,GAFM,CAAP;AAGD,CALD;;AAOAI,YAAY,CAACx9D,SAAb,CAAuB09D,YAAvB,GAAsC,UAAUP,UAAV,EAAsBC,OAAtB,EAA+B;AACnE,MAAI,KAAKpnC,IAAL,CAAU4nC,qBAAd,EAAqC;AACnC,WAAOV,gBAAgB,CAAC,KAAKhrD,MAAN,EAAc,KAAKlO,EAAnB,EAAuBm5D,UAAvB,EACrBC,OADqB,EACZ,KAAKC,WADO,CAAvB;AAED,GAHD,MAGO;AACL,WAAOrzD,OAAO,CAAC8E,OAAR,CAAgB,IAAhB,CAAP;AACD;AACF,CAPD;;AASA0uD,YAAY,CAACx9D,SAAb,CAAuB29D,YAAvB,GAAsC,UAAUR,UAAV,EAAsBC,OAAtB,EAA+B;AACnE,MAAI,KAAKpnC,IAAL,CAAU6nC,qBAAd,EAAqC;AACnC,QAAIrpC,IAAI,GAAG,IAAX;AACA,WAAO0oC,gBAAgB,CAAC,KAAKrB,GAAN,EAAW,KAAK73D,EAAhB,EAAoBm5D,UAApB,EACrBC,OADqB,EACZ,KAAKC,WADO,CAAhB,CAEJn6C,KAFI,CAEE,UAAU7T,GAAV,EAAe;AACpB,UAAIyuD,gBAAgB,CAACzuD,GAAD,CAApB,EAA2B;AACzBmlB,QAAAA,IAAI,CAACwB,IAAL,CAAU6nC,qBAAV,GAAkC,KAAlC;AACA,eAAO,IAAP;AACD;;AACD,YAAMxuD,GAAN;AACD,KARI,CAAP;AASD,GAXD,MAWO;AACL,WAAOrF,OAAO,CAAC8E,OAAR,CAAgB,IAAhB,CAAP;AACD;AACF,CAfD;;AAiBA,IAAIivD,WAAW,GAAG;AAChB,eAAa,UAAUC,SAAV,EAAqBC,SAArB,EAAgC;AAC3C;AACA,QAAI3oB,OAAO,CAAC0oB,SAAS,CAAClzB,QAAX,EAAqBmzB,SAAS,CAACnzB,QAA/B,CAAP,KAAoD,CAAxD,EAA2D;AACzD,aAAOmzB,SAAS,CAACnzB,QAAjB;AACD;AACD;;;AACA,WAAO,CAAP;AACD,GARe;AAShB,OAAK,UAAUkzB,SAAV,EAAqBC,SAArB,EAAgC;AACnC;AACA,WAAOC,sBAAsB,CAACD,SAAD,EAAYD,SAAZ,CAAtB,CAA6ClzB,QAApD;AACD;AAZe,CAAlB;;AAeA0yB,YAAY,CAACx9D,SAAb,CAAuBm+D,aAAvB,GAAuC,YAAY;AACjD,MAAI3pC,IAAI,GAAG,IAAX;;AAEA,MAAIA,IAAI,CAACwB,IAAL,IAAaxB,IAAI,CAACwB,IAAL,CAAU6nC,qBAAvB,IAAgD,CAACrpC,IAAI,CAACwB,IAAL,CAAU4nC,qBAA/D,EAAsF;AACpF,WAAOppC,IAAI,CAACqnC,GAAL,CAAS76D,GAAT,CAAawzB,IAAI,CAACxwB,EAAlB,EAAsByD,IAAtB,CAA2B,UAAUw2D,SAAV,EAAqB;AACrD,aAAOA,SAAS,CAACnzB,QAAV,IAAsBmyB,UAA7B;AACD,KAFM,EAEJ/5C,KAFI,CAEE,UAAU7T,GAAV,EAAe;AACtB;AACA,UAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,cAAMhqB,GAAN;AACD;;AACD,aAAO4tD,UAAP;AACD,KARM,CAAP;AASD;;AAED,SAAOzoC,IAAI,CAACtiB,MAAL,CAAYlR,GAAZ,CAAgBwzB,IAAI,CAACxwB,EAArB,EAAyByD,IAAzB,CAA8B,UAAUu2D,SAAV,EAAqB;AACxD,QAAIxpC,IAAI,CAACwB,IAAL,IAAaxB,IAAI,CAACwB,IAAL,CAAU4nC,qBAAvB,IAAgD,CAACppC,IAAI,CAACwB,IAAL,CAAU6nC,qBAA/D,EAAsF;AACpF,aAAOG,SAAS,CAAClzB,QAAV,IAAsBmyB,UAA7B;AACD;;AAED,WAAOzoC,IAAI,CAACqnC,GAAL,CAAS76D,GAAT,CAAawzB,IAAI,CAACxwB,EAAlB,EAAsByD,IAAtB,CAA2B,UAAUw2D,SAAV,EAAqB;AACrD;AACA;;AACA;AACA,UAAID,SAAS,CAAC97D,OAAV,KAAsB+7D,SAAS,CAAC/7D,OAApC,EAA6C;AAC3C,eAAO+6D,UAAP;AACD;;AAED,UAAI/6D,OAAJ;;AACA,UAAI87D,SAAS,CAAC97D,OAAd,EAAuB;AACrBA,QAAAA,OAAO,GAAG87D,SAAS,CAAC97D,OAAV,CAAkBY,QAAlB,EAAV;AACD,OAFD,MAEO;AACLZ,QAAAA,OAAO,GAAG,WAAV;AACD;;AAED,UAAIA,OAAO,IAAI67D,WAAf,EAA4B;AAC1B,eAAOA,WAAW,CAAC77D,OAAD,CAAX,CAAqB87D,SAArB,EAAgCC,SAAhC,CAAP;AACD;AACD;;;AACA,aAAOhB,UAAP;AACD,KApBM,EAoBJ,UAAU5tD,GAAV,EAAe;AAChB,UAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAf,IAAsB2kC,SAAS,CAAClzB,QAApC,EAA8C;AAC5C,eAAOtW,IAAI,CAACqnC,GAAL,CAASt9B,GAAT,CAAa;AAClBF,UAAAA,GAAG,EAAE7J,IAAI,CAACxwB,EADQ;AAElB8mC,UAAAA,QAAQ,EAAEmyB;AAFQ,SAAb,EAGJx1D,IAHI,CAGC,YAAY;AAClB,iBAAOw1D,UAAP;AACD,SALM,EAKJ,UAAU5tD,GAAV,EAAe;AAChB,cAAIyuD,gBAAgB,CAACzuD,GAAD,CAApB,EAA2B;AACzBmlB,YAAAA,IAAI,CAACwB,IAAL,CAAU6nC,qBAAV,GAAkC,KAAlC;AACA,mBAAOG,SAAS,CAAClzB,QAAjB;AACD;AACD;;;AACA,iBAAOmyB,UAAP;AACD,SAZM,CAAP;AAaD;;AACD,YAAM5tD,GAAN;AACD,KArCM,CAAP;AAsCD,GA3CM,EA2CJ6T,KA3CI,CA2CE,UAAU7T,GAAV,EAAe;AACtB,QAAIA,GAAG,CAACgqB,MAAJ,KAAe,GAAnB,EAAwB;AACtB,YAAMhqB,GAAN;AACD;;AACD,WAAO4tD,UAAP;AACD,GAhDM,CAAP;AAiDD,CAhED,EAiEA;AACA;AACA;;;AAEA,SAASiB,sBAAT,CAAgCE,MAAhC,EAAwCC,MAAxC,EAAgD;AAC9C,MAAID,MAAM,CAACd,UAAP,KAAsBe,MAAM,CAACf,UAAjC,EAA6C;AAC3C,WAAO;AACLxyB,MAAAA,QAAQ,EAAEszB,MAAM,CAACtzB,QADZ;AAELlG,MAAAA,OAAO,EAAEw5B,MAAM,CAACx5B;AAFX,KAAP;AAID;;AAED,SAAO05B,yBAAyB,CAACF,MAAM,CAACx5B,OAAR,EAAiBy5B,MAAM,CAACz5B,OAAxB,CAAhC;AACD;;AAED,SAAS05B,yBAAT,CAAmCC,aAAnC,EAAkDC,aAAlD,EAAiE;AAC/D;AACA;AACA,MAAIC,CAAC,GAAGF,aAAa,CAAC,CAAD,CAArB;AACA,MAAIG,UAAU,GAAGH,aAAa,CAACr4D,KAAd,CAAoB,CAApB,CAAjB;AACA,MAAIy4D,CAAC,GAAGH,aAAa,CAAC,CAAD,CAArB;AACA,MAAII,UAAU,GAAGJ,aAAa,CAACt4D,KAAd,CAAoB,CAApB,CAAjB;;AAEA,MAAI,CAACu4D,CAAD,IAAMD,aAAa,CAACh/D,MAAd,KAAyB,CAAnC,EAAsC;AACpC,WAAO;AACLsrC,MAAAA,QAAQ,EAAEmyB,UADL;AAELr4B,MAAAA,OAAO,EAAE;AAFJ,KAAP;AAID;;AAED,MAAIv6B,QAAQ,GAAGo0D,CAAC,CAACnB,UAAjB;AACA;;AACA,MAAIuB,YAAY,CAACx0D,QAAD,EAAWm0D,aAAX,CAAhB,EAA2C;AACzC,WAAO;AACL1zB,MAAAA,QAAQ,EAAE2zB,CAAC,CAAC3zB,QADP;AAELlG,MAAAA,OAAO,EAAE25B;AAFJ,KAAP;AAID;;AAED,MAAIj3B,QAAQ,GAAGq3B,CAAC,CAACrB,UAAjB;;AACA,MAAIuB,YAAY,CAACv3B,QAAD,EAAWo3B,UAAX,CAAhB,EAAwC;AACtC,WAAO;AACL5zB,MAAAA,QAAQ,EAAE6zB,CAAC,CAAC7zB,QADP;AAELlG,MAAAA,OAAO,EAAEg6B;AAFJ,KAAP;AAID;;AAED,SAAON,yBAAyB,CAACI,UAAD,EAAaE,UAAb,CAAhC;AACD;;AAED,SAASC,YAAT,CAAsBC,SAAtB,EAAiCl6B,OAAjC,EAA0C;AACxC,MAAIm6B,KAAK,GAAGn6B,OAAO,CAAC,CAAD,CAAnB;AACA,MAAIo6B,IAAI,GAAGp6B,OAAO,CAAC1+B,KAAR,CAAc,CAAd,CAAX;;AAEA,MAAI,CAAC44D,SAAD,IAAcl6B,OAAO,CAACplC,MAAR,KAAmB,CAArC,EAAwC;AACtC,WAAO,KAAP;AACD;;AAED,MAAIs/D,SAAS,KAAKC,KAAK,CAACzB,UAAxB,EAAoC;AAClC,WAAO,IAAP;AACD;;AAED,SAAOuB,YAAY,CAACC,SAAD,EAAYE,IAAZ,CAAnB;AACD;;AAED,SAASlB,gBAAT,CAA0BzuD,GAA1B,EAA+B;AAC7B,SAAO,OAAOA,GAAG,CAACgqB,MAAX,KAAsB,QAAtB,IAAkCzjB,IAAI,CAACqpD,KAAL,CAAW5vD,GAAG,CAACgqB,MAAJ,GAAa,GAAxB,MAAiC,CAA1E;AACD;;AAED,IAAI6lC,iBAAiB,GAAG,CAAxB;;AAEA,SAASC,OAAT,CAAiBnpC,IAAjB,EAAuBqnC,WAAvB,EAAoCpyD,KAApC,EAA2C2pB,QAA3C,EAAqD;AACnD,MAAIoB,IAAI,CAACopC,KAAL,KAAe,KAAnB,EAA0B;AACxB/B,IAAAA,WAAW,CAACrwC,IAAZ,CAAiB,OAAjB,EAA0B/hB,KAA1B;AACAoyD,IAAAA,WAAW,CAAChuC,kBAAZ;AACA;AACD;AACD;;;AACA,MAAI,OAAO2G,IAAI,CAACqpC,iBAAZ,KAAkC,UAAtC,EAAkD;AAChDrpC,IAAAA,IAAI,CAACqpC,iBAAL,GAAyBlmC,cAAzB;AACD;;AACDkkC,EAAAA,WAAW,CAACrwC,IAAZ,CAAiB,cAAjB,EAAiC/hB,KAAjC;;AACA,MAAIoyD,WAAW,CAACxhD,KAAZ,KAAsB,QAAtB,IAAkCwhD,WAAW,CAACxhD,KAAZ,KAAsB,SAA5D,EAAuE;AACrEwhD,IAAAA,WAAW,CAACrwC,IAAZ,CAAiB,QAAjB,EAA2B/hB,KAA3B;AACAoyD,IAAAA,WAAW,CAACxhD,KAAZ,GAAoB,SAApB;;AACA,QAAIyjD,UAAU,GAAG,SAASC,cAAT,GAA0B;AACzCvpC,MAAAA,IAAI,CAACwpC,gBAAL,GAAwBN,iBAAxB;AACD,KAFD;;AAGA,QAAIO,mBAAmB,GAAG,SAASC,oBAAT,GAAgC;AACxDrC,MAAAA,WAAW,CAAC3uC,cAAZ,CAA2B,QAA3B,EAAqC4wC,UAArC;AACD,KAFD;;AAGAjC,IAAAA,WAAW,CAACvuC,IAAZ,CAAiB,QAAjB,EAA2B2wC,mBAA3B;AACApC,IAAAA,WAAW,CAACvuC,IAAZ,CAAiB,QAAjB,EAA2BwwC,UAA3B;AACD;;AAEDtpC,EAAAA,IAAI,CAACwpC,gBAAL,GAAwBxpC,IAAI,CAACwpC,gBAAL,IAAyBN,iBAAjD;AACAlpC,EAAAA,IAAI,CAACwpC,gBAAL,GAAwBxpC,IAAI,CAACqpC,iBAAL,CAAuBrpC,IAAI,CAACwpC,gBAA5B,CAAxB;AACAznD,EAAAA,UAAU,CAAC6c,QAAD,EAAWoB,IAAI,CAACwpC,gBAAhB,CAAV;AACD;;AAED,SAASG,yBAAT,CAAmCC,WAAnC,EAAgD;AAC9C,SAAO9+D,MAAM,CAACoC,IAAP,CAAY08D,WAAZ,EAAyB17B,IAAzB,CAA8BoR,OAA9B,EAAuCnyC,MAAvC,CAA8C,UAAUnB,MAAV,EAAkBqB,GAAlB,EAAuB;AAC1ErB,IAAAA,MAAM,CAACqB,GAAD,CAAN,GAAcu8D,WAAW,CAACv8D,GAAD,CAAzB;AACA,WAAOrB,MAAP;AACD,GAHM,EAGJ,EAHI,CAAP;AAID,EAED;AACA;;;AACA,SAAS69D,qBAAT,CAA+BhE,GAA/B,EAAoC3pD,MAApC,EAA4C8jB,IAA5C,EAAkD;AAChD,MAAIoyB,MAAM,GAAGpyB,IAAI,CAACykB,OAAL,GAAezkB,IAAI,CAACykB,OAAL,CAAavW,IAAb,CAAkBoR,OAAlB,CAAf,GAA4C,EAAzD;AACA,MAAIwF,SAAS,GAAG9kB,IAAI,CAACpuB,MAAL,GAAcouB,IAAI,CAACpuB,MAAL,CAAY9E,QAAZ,EAAd,GAAuC,EAAvD;AACA,MAAI88D,WAAW,GAAG,EAAlB;AACA,MAAIE,cAAc,GAAI,EAAtB;AACA,MAAI/xD,QAAQ,GAAG,EAAf,CALgD,CAOhD;AACA;;AACA;;AACA,MAAIioB,IAAI,CAACjoB,QAAT,EAAmB;AACjBA,IAAAA,QAAQ,GAAGrH,IAAI,CAACE,SAAL,CAAeovB,IAAI,CAACjoB,QAApB,CAAX;AACD;;AAED,MAAIioB,IAAI,CAACpuB,MAAL,IAAeouB,IAAI,CAAC+F,YAAxB,EAAsC;AACpC6jC,IAAAA,WAAW,GAAGl5D,IAAI,CAACE,SAAL,CAAe+4D,yBAAyB,CAAC3pC,IAAI,CAAC+F,YAAN,CAAxC,CAAd;AACD;;AAED,MAAI/F,IAAI,CAACpuB,MAAL,IAAeouB,IAAI,CAACpuB,MAAL,KAAgB,OAAnC,EAA4C;AAC1Ck4D,IAAAA,cAAc,GAAG9pC,IAAI,CAACukB,IAAL,CAAUz3C,QAAV,EAAjB;AACD;;AAED,SAAOkH,OAAO,CAAC0Y,GAAR,CAAY,CAACm5C,GAAG,CAAC73D,EAAJ,EAAD,EAAWkO,MAAM,CAAClO,EAAP,EAAX,CAAZ,EAAqCyD,IAArC,CAA0C,UAAU+qB,GAAV,EAAe;AAC9D,QAAIutC,SAAS,GAAGvtC,GAAG,CAAC,CAAD,CAAH,GAASA,GAAG,CAAC,CAAD,CAAZ,GAAkBsoB,SAAlB,GAA8BglB,cAA9B,GACdF,WADc,GACAxX,MADA,GACSr6C,QADzB;AAEA,WAAO,IAAI/D,OAAJ,CAAY,UAAU8E,OAAV,EAAmB;AACpC4yB,MAAAA,SAAS,CAACq+B,SAAD,EAAYjxD,OAAZ,CAAT;AACD,KAFM,CAAP;AAGD,GANM,EAMJrH,IANI,CAMC,UAAUu4D,MAAV,EAAkB;AACxB;AACA;AACA;AACAA,IAAAA,MAAM,GAAGA,MAAM,CAAC3uD,OAAP,CAAe,KAAf,EAAsB,GAAtB,EAA2BA,OAA3B,CAAmC,KAAnC,EAA0C,GAA1C,CAAT;AACA,WAAO,YAAY2uD,MAAnB;AACD,GAZM,CAAP;AAaD;;AAED,SAASC,SAAT,CAAmBpE,GAAnB,EAAwB3pD,MAAxB,EAAgC8jB,IAAhC,EAAsCqnC,WAAtC,EAAmDr7D,MAAnD,EAA2D;AACzD,MAAIk+D,OAAO,GAAG,EAAd,CADyD,CACzB;;AAChC,MAAIC,YAAJ,CAFyD,CAEzB;;AAChC,MAAIC,YAAY,GAAG;AACjB7nC,IAAAA,GAAG,EAAE,CADY;AAEjBD,IAAAA,OAAO,EAAE,EAFQ;AAGjBpC,IAAAA,IAAI,EAAE;AAHW,GAAnB,CAHyD,CAOtD;;AACH,MAAImqC,iBAAiB,GAAG,KAAxB,CARyD,CAQzB;;AAChC,MAAIC,gBAAgB,GAAG,KAAvB,CATyD,CASzB;;AAChC,MAAIC,oBAAoB,GAAG,KAA3B,CAVyD,CAUvB;;AAClC,MAAIz1B,QAAQ,GAAG,CAAf;AACA,MAAIhC,UAAU,GAAG9S,IAAI,CAAC8S,UAAL,IAAmB9S,IAAI,CAAC+S,IAAxB,IAAgC,KAAjD;AACA,MAAI4nB,UAAU,GAAG36B,IAAI,CAAC26B,UAAL,IAAmB,GAApC;AACA,MAAI6P,aAAa,GAAGxqC,IAAI,CAACwqC,aAAL,IAAsB,EAA1C;AACA,MAAIC,cAAc,GAAG,KAArB,CAfyD,CAezB;;AAChC,MAAIhmB,OAAO,GAAGzkB,IAAI,CAACykB,OAAnB;AACA,MAAI1sC,QAAQ,GAAGioB,IAAI,CAACjoB,QAApB;AACA,MAAI2yD,KAAJ;AACA,MAAIC,YAAJ;AACA,MAAIC,WAAW,GAAG,EAAlB,CApByD,CAqBzD;;AACA,MAAIxD,OAAO,GAAGx6B,IAAI,EAAlB;AAEA5gC,EAAAA,MAAM,GAAGA,MAAM,IAAI;AACjB6zB,IAAAA,EAAE,EAAE,IADa;AAEjBgrC,IAAAA,UAAU,EAAE,IAAIzsC,IAAJ,GAAWC,WAAX,EAFK;AAGjBysC,IAAAA,SAAS,EAAE,CAHM;AAIjBC,IAAAA,YAAY,EAAE,CAJG;AAKjBC,IAAAA,kBAAkB,EAAE,CALH;AAMjBC,IAAAA,MAAM,EAAE;AANS,GAAnB;AASA,MAAI5oC,WAAW,GAAG,EAAlB;AACAglC,EAAAA,WAAW,CAAC9sB,KAAZ,CAAkBsrB,GAAlB,EAAuB3pD,MAAvB;;AAEA,WAASgvD,gBAAT,GAA4B;AAC1B,QAAIP,YAAJ,EAAkB;AAChB,aAAO32D,OAAO,CAAC8E,OAAR,EAAP;AACD;;AACD,WAAO+wD,qBAAqB,CAAChE,GAAD,EAAM3pD,MAAN,EAAc8jB,IAAd,CAArB,CAAyCvuB,IAAzC,CAA8C,UAAU+qB,GAAV,EAAe;AAClEkuC,MAAAA,KAAK,GAAGluC,GAAR;AAEA,UAAI2uC,cAAc,GAAG,EAArB;;AACA,UAAInrC,IAAI,CAACmnC,UAAL,KAAoB,KAAxB,EAA+B;AAC7BgE,QAAAA,cAAc,GAAG;AAAEtD,UAAAA,qBAAqB,EAAE,KAAzB;AAAgCD,UAAAA,qBAAqB,EAAE;AAAvD,SAAjB;AACD,OAFD,MAEO,IAAI5nC,IAAI,CAACmnC,UAAL,KAAoB,QAAxB,EAAkC;AACvCgE,QAAAA,cAAc,GAAG;AAAEtD,UAAAA,qBAAqB,EAAE,IAAzB;AAA+BD,UAAAA,qBAAqB,EAAE;AAAtD,SAAjB;AACD,OAFM,MAEA,IAAI5nC,IAAI,CAACmnC,UAAL,KAAoB,QAAxB,EAAkC;AACvCgE,QAAAA,cAAc,GAAG;AAAEtD,UAAAA,qBAAqB,EAAE,KAAzB;AAAgCD,UAAAA,qBAAqB,EAAE;AAAvD,SAAjB;AACD,OAFM,MAEA;AACLuD,QAAAA,cAAc,GAAG;AAAEtD,UAAAA,qBAAqB,EAAE,IAAzB;AAA+BD,UAAAA,qBAAqB,EAAE;AAAtD,SAAjB;AACD;;AAED+C,MAAAA,YAAY,GAAG,IAAInD,YAAJ,CAAiB3B,GAAjB,EAAsB3pD,MAAtB,EAA8BwuD,KAA9B,EAAqCrD,WAArC,EAAkD8D,cAAlD,CAAf;AACD,KAfM,CAAP;AAgBD;;AAED,WAASC,SAAT,GAAqB;AACnBR,IAAAA,WAAW,GAAG,EAAd;;AAEA,QAAIT,YAAY,CAACjqC,IAAb,CAAkB12B,MAAlB,KAA6B,CAAjC,EAAoC;AAClC;AACD;;AACD,QAAI02B,IAAI,GAAGiqC,YAAY,CAACjqC,IAAxB;AACA,QAAImrC,QAAQ,GAAG;AAACnwC,MAAAA,OAAO,EAAE8E,IAAI,CAAC9E;AAAf,KAAf;AACA,WAAOhf,MAAM,CAACi5B,QAAP,CAAgB;AAACjV,MAAAA,IAAI,EAAEA,IAAP;AAAa2V,MAAAA,SAAS,EAAE;AAAxB,KAAhB,EAAgDw1B,QAAhD,EAA0D55D,IAA1D,CAA+D,UAAU+qB,GAAV,EAAe;AACnF;AACA,UAAI6qC,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB6oC,QAAAA,mBAAmB;AACnB,cAAM,IAAIhgE,KAAJ,CAAU,WAAV,CAAN;AACD,OALkF,CAOnF;AACA;;;AACA,UAAIigE,UAAU,GAAGzgE,MAAM,CAAC4rB,MAAP,CAAc,IAAd,CAAjB;AACA8F,MAAAA,GAAG,CAACvuB,OAAJ,CAAY,UAAUuuB,GAAV,EAAe;AACzB,YAAIA,GAAG,CAACvnB,KAAR,EAAe;AACbs2D,UAAAA,UAAU,CAAC/uC,GAAG,CAACxuB,EAAL,CAAV,GAAqBwuB,GAArB;AACD;AACF,OAJD;AAMA,UAAIgvC,QAAQ,GAAG1gE,MAAM,CAACoC,IAAP,CAAYq+D,UAAZ,EAAwB/hE,MAAvC;AACAwC,MAAAA,MAAM,CAACg/D,kBAAP,IAA6BQ,QAA7B;AACAx/D,MAAAA,MAAM,CAAC++D,YAAP,IAAuB7qC,IAAI,CAAC12B,MAAL,GAAcgiE,QAArC;AAEAtrC,MAAAA,IAAI,CAACjyB,OAAL,CAAa,UAAUw3B,GAAV,EAAe;AAC1B,YAAIxwB,KAAK,GAAGs2D,UAAU,CAAC9lC,GAAG,CAAC4C,GAAL,CAAtB;;AACA,YAAIpzB,KAAJ,EAAW;AACTjJ,UAAAA,MAAM,CAACi/D,MAAP,CAAcp8D,IAAd,CAAmBoG,KAAnB,EADS,CAET;;AACA,cAAIw2D,SAAS,GAAG,CAACx2D,KAAK,CAAC/G,IAAN,IAAc,EAAf,EAAmBgE,WAAnB,EAAhB;;AACA,cAAIu5D,SAAS,KAAK,cAAd,IAAgCA,SAAS,KAAK,WAAlD,EAA+D;AAC7DpE,YAAAA,WAAW,CAACrwC,IAAZ,CAAiB,QAAjB,EAA2B7R,KAAK,CAAClQ,KAAD,CAAhC;AACD,WAFD,MAEO;AACL,kBAAMA,KAAN;AACD;AACF,SATD,MASO;AACL21D,UAAAA,WAAW,CAAC/7D,IAAZ,CAAiB42B,GAAjB;AACD;AACF,OAdD;AAgBD,KApCM,EAoCJ,UAAUpsB,GAAV,EAAe;AAChBrN,MAAAA,MAAM,CAACg/D,kBAAP,IAA6B9qC,IAAI,CAAC12B,MAAlC;AACA,YAAM6P,GAAN;AACD,KAvCM,CAAP;AAwCD;;AAED,WAASqyD,WAAT,GAAuB;AACrB,QAAIvB,YAAY,CAACl1D,KAAjB,EAAwB;AACtB,YAAM,IAAI3J,KAAJ,CAAU,mCAAV,CAAN;AACD;;AACDU,IAAAA,MAAM,CAAC8oC,QAAP,GAAkBA,QAAQ,GAAGq1B,YAAY,CAAC5nC,GAA1C;AACA,QAAIopC,SAAS,GAAGxmD,KAAK,CAACnZ,MAAD,CAArB;;AACA,QAAI4+D,WAAW,CAACphE,MAAhB,EAAwB;AACtBmiE,MAAAA,SAAS,CAACzrC,IAAV,GAAiB0qC,WAAjB,CADsB,CAEtB;;AACA;;AACA,UAAI,OAAOT,YAAY,CAACn4B,OAApB,KAAgC,QAApC,EAA8C;AAC5C25B,QAAAA,SAAS,CAAC35B,OAAV,GAAoBm4B,YAAY,CAACn4B,OAAjC;AACA,eAAOm4B,YAAY,CAACn4B,OAApB;AACD;;AACDq1B,MAAAA,WAAW,CAACrwC,IAAZ,CAAiB,QAAjB,EAA2B20C,SAA3B;AACD;;AACDtB,IAAAA,iBAAiB,GAAG,IAApB;AACA,WAAOM,YAAY,CAAClD,eAAb,CAA6B0C,YAAY,CAAC5nC,GAA1C,EACH6kC,OADG,EACM31D,IADN,CACW,YAAY;AAC5B44D,MAAAA,iBAAiB,GAAG,KAApB;AACA;;AACA,UAAIhD,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB6oC,QAAAA,mBAAmB;AACnB,cAAM,IAAIhgE,KAAJ,CAAU,WAAV,CAAN;AACD;;AACD6+D,MAAAA,YAAY,GAAG18D,SAAf;AACAm+D,MAAAA,UAAU;AACX,KAVM,EAUJ1+C,KAVI,CAUE,UAAU7T,GAAV,EAAe;AACtBwyD,MAAAA,iBAAiB,CAACxyD,GAAD,CAAjB;AACA,YAAMA,GAAN;AACD,KAbM,CAAP;AAcD;;AAED,WAASyyD,QAAT,GAAoB;AAClB,QAAIz7B,IAAI,GAAG,EAAX;AACA85B,IAAAA,YAAY,CAAC7nC,OAAb,CAAqBr0B,OAArB,CAA6B,UAAU+3B,MAAV,EAAkB;AAC7C;;AACA;AACA,UAAIA,MAAM,CAACh4B,EAAP,KAAc,QAAlB,EAA4B;AAC1B;AACD;;AACDqiC,MAAAA,IAAI,CAACrK,MAAM,CAACh4B,EAAR,CAAJ,GAAkBg4B,MAAM,CAAC1D,OAAP,CAAezpB,GAAf,CAAmB,UAAU8mB,CAAV,EAAa;AAChD,eAAOA,CAAC,CAAC6B,GAAT;AACD,OAFiB,CAAlB;AAGD,KATD;AAUA,WAAOtlB,MAAM,CAACy6B,QAAP,CAAgBtG,IAAhB,EAAsB5+B,IAAtB,CAA2B,UAAUu0D,KAAV,EAAiB;AACjD;AACA,UAAIqB,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB6oC,QAAAA,mBAAmB;AACnB,cAAM,IAAIhgE,KAAJ,CAAU,WAAV,CAAN;AACD,OALgD,CAMjD;;;AACA6+D,MAAAA,YAAY,CAACnE,KAAb,GAAqBA,KAArB;AACD,KARM,CAAP;AASD;;AAED,WAAS+F,YAAT,GAAwB;AACtB,WAAO5F,OAAO,CAACN,GAAD,EAAM3pD,MAAN,EAAciuD,YAAY,CAACnE,KAA3B,EAAkCqB,WAAlC,CAAP,CAAsD51D,IAAtD,CAA2D,UAAUu6D,GAAV,EAAe;AAC/E7B,MAAAA,YAAY,CAACl1D,KAAb,GAAqB,CAAC+2D,GAAG,CAACnsC,EAA1B;AACAmsC,MAAAA,GAAG,CAAC9rC,IAAJ,CAASjyB,OAAT,CAAiB,UAAUw3B,GAAV,EAAe;AAC9B,eAAO0kC,YAAY,CAACnE,KAAb,CAAmBvgC,GAAG,CAAC4C,GAAvB,CAAP;AACAr8B,QAAAA,MAAM,CAAC8+D,SAAP;AACAX,QAAAA,YAAY,CAACjqC,IAAb,CAAkBrxB,IAAlB,CAAuB42B,GAAvB;AACD,OAJD;AAKD,KAPM,CAAP;AAQD;;AAED,WAASwmC,cAAT,GAA0B;AACxB,QAAI5E,WAAW,CAAC5kC,SAAZ,IAAyB0nC,YAA7B,EAA2C;AACzC;AACD;;AACD,QAAID,OAAO,CAAC1gE,MAAR,KAAmB,CAAvB,EAA0B;AACxB0iE,MAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACA;AACD;;AACD/B,IAAAA,YAAY,GAAGD,OAAO,CAAC1kD,KAAR,EAAf;AACAsmD,IAAAA,QAAQ,GACLr6D,IADH,CACQs6D,YADR,EAEGt6D,IAFH,CAEQ25D,SAFR,EAGG35D,IAHH,CAGQi6D,WAHR,EAIGj6D,IAJH,CAIQw6D,cAJR,EAKG/+C,KALH,CAKS,UAAU7T,GAAV,EAAe;AACpB8yD,MAAAA,gBAAgB,CAAC,wCAAD,EAA2C9yD,GAA3C,CAAhB;AACD,KAPH;AAQD;;AAGD,WAAS6yD,mBAAT,CAA6BE,YAA7B,EAA2C;AACzC,QAAIhC,YAAY,CAAC9nC,OAAb,CAAqB94B,MAArB,KAAgC,CAApC,EAAuC;AACrC,UAAI0gE,OAAO,CAAC1gE,MAAR,KAAmB,CAAnB,IAAwB,CAAC2gE,YAA7B,EAA2C;AACzC,YAAKr3B,UAAU,IAAIzQ,WAAW,CAAC0Q,IAA3B,IAAoCu3B,gBAAxC,EAA0D;AACxDjD,UAAAA,WAAW,CAACxhD,KAAZ,GAAoB,SAApB;AACAwhD,UAAAA,WAAW,CAACrwC,IAAZ,CAAiB,QAAjB;AACD;;AACD,YAAIszC,gBAAJ,EAAsB;AACpBgB,UAAAA,mBAAmB;AACpB;AACF;;AACD;AACD;;AACD,QACEc,YAAY,IACZ9B,gBADA,IAEAF,YAAY,CAAC9nC,OAAb,CAAqB94B,MAArB,IAA+BmxD,UAHjC,EAIE;AACAuP,MAAAA,OAAO,CAACr7D,IAAR,CAAau7D,YAAb;AACAA,MAAAA,YAAY,GAAG;AACb7nC,QAAAA,GAAG,EAAE,CADQ;AAEbD,QAAAA,OAAO,EAAE,EAFI;AAGbpC,QAAAA,IAAI,EAAE;AAHO,OAAf;;AAKA,UAAImnC,WAAW,CAACxhD,KAAZ,KAAsB,SAAtB,IAAmCwhD,WAAW,CAACxhD,KAAZ,KAAsB,SAA7D,EAAwE;AACtEwhD,QAAAA,WAAW,CAACxhD,KAAZ,GAAoB,QAApB;AACAwhD,QAAAA,WAAW,CAACrwC,IAAZ,CAAiB,QAAjB;AACD;;AACDi1C,MAAAA,cAAc;AACf;AACF;;AAGD,WAASE,gBAAT,CAA0BvoC,MAA1B,EAAkCvqB,GAAlC,EAAuC;AACrC,QAAIkxD,oBAAJ,EAA0B;AACxB;AACD;;AACD,QAAI,CAAClxD,GAAG,CAACpG,OAAT,EAAkB;AAChBoG,MAAAA,GAAG,CAACpG,OAAJ,GAAc2wB,MAAd;AACD;;AACD53B,IAAAA,MAAM,CAAC6zB,EAAP,GAAY,KAAZ;AACA7zB,IAAAA,MAAM,CAACq3B,MAAP,GAAgB,UAAhB;AACA6mC,IAAAA,OAAO,GAAG,EAAV;AACAE,IAAAA,YAAY,GAAG;AACb7nC,MAAAA,GAAG,EAAE,CADQ;AAEbD,MAAAA,OAAO,EAAE,EAFI;AAGbpC,MAAAA,IAAI,EAAE;AAHO,KAAf;AAKAorC,IAAAA,mBAAmB,CAACjyD,GAAD,CAAnB;AACD;;AAGD,WAASiyD,mBAAT,CAA6Be,UAA7B,EAAyC;AACvC,QAAI9B,oBAAJ,EAA0B;AACxB;AACD;AACD;;;AACA,QAAIlD,WAAW,CAAC5kC,SAAhB,EAA2B;AACzBz2B,MAAAA,MAAM,CAACq3B,MAAP,GAAgB,WAAhB;;AACA,UAAIgnC,iBAAJ,EAAuB;AACrB;AACD;AACF;;AACDr+D,IAAAA,MAAM,CAACq3B,MAAP,GAAgBr3B,MAAM,CAACq3B,MAAP,IAAiB,UAAjC;AACAr3B,IAAAA,MAAM,CAACsgE,QAAP,GAAkB,IAAIluC,IAAJ,GAAWC,WAAX,EAAlB;AACAryB,IAAAA,MAAM,CAAC8oC,QAAP,GAAkBA,QAAlB;AACAy1B,IAAAA,oBAAoB,GAAG,IAAvB;;AAEA,QAAI8B,UAAJ,EAAgB;AACd;AACAA,MAAAA,UAAU,GAAGhnC,WAAW,CAACgnC,UAAD,CAAxB;AACAA,MAAAA,UAAU,CAACrgE,MAAX,GAAoBA,MAApB,CAHc,CAKd;;AACA,UAAIy/D,SAAS,GAAG,CAACY,UAAU,CAACn+D,IAAX,IAAmB,EAApB,EAAwBgE,WAAxB,EAAhB;;AACA,UAAIu5D,SAAS,KAAK,cAAd,IAAgCA,SAAS,KAAK,WAAlD,EAA+D;AAC7DpE,QAAAA,WAAW,CAACrwC,IAAZ,CAAiB,OAAjB,EAA0Bq1C,UAA1B;AACAhF,QAAAA,WAAW,CAAChuC,kBAAZ;AACD,OAHD,MAGO;AACL8vC,QAAAA,OAAO,CAACnpC,IAAD,EAAOqnC,WAAP,EAAoBgF,UAApB,EAAgC,YAAY;AACjDpC,UAAAA,SAAS,CAACpE,GAAD,EAAM3pD,MAAN,EAAc8jB,IAAd,EAAoBqnC,WAApB,CAAT;AACD,SAFM,CAAP;AAGD;AACF,KAfD,MAeO;AACLA,MAAAA,WAAW,CAACrwC,IAAZ,CAAiB,UAAjB,EAA6BhrB,MAA7B;AACAq7D,MAAAA,WAAW,CAAChuC,kBAAZ;AACD;AACF;;AAGD,WAASqJ,QAAT,CAAkBsD,MAAlB,EAA0BgM,OAA1B,EAAmCC,OAAnC,EAA4C;AAC1C;AACA,QAAIo1B,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB,aAAO6oC,mBAAmB,EAA1B;AACD,KAJyC,CAK1C;;AACA;;;AACA,QAAI,OAAOt5B,OAAP,KAAmB,QAAvB,EAAiC;AAC/Bo4B,MAAAA,YAAY,CAACp4B,OAAb,GAAuBA,OAAvB;AACD;;AAED,QAAIpgC,MAAM,GAAGg0B,YAAY,CAAC5F,IAAD,CAAZ,CAAmBgG,MAAnB,CAAb;;AACA,QAAI,CAACp0B,MAAL,EAAa;AACX;AACD;;AACDw4D,IAAAA,YAAY,CAAC7nC,GAAb,GAAmByD,MAAM,CAACzD,GAAP,IAAc0P,OAAjC;AACAm4B,IAAAA,YAAY,CAAC9nC,OAAb,CAAqBzzB,IAArB,CAA0Bm3B,MAA1B;AACA,4BAAU,YAAY;AACpBkmC,MAAAA,mBAAmB,CAAChC,OAAO,CAAC1gE,MAAR,KAAmB,CAAnB,IAAwB64B,WAAW,CAAC0Q,IAArC,CAAnB;AACD,KAFD;AAGD;;AAGD,WAASw5B,iBAAT,CAA2BjqC,OAA3B,EAAoC;AAClCmoC,IAAAA,cAAc,GAAG,KAAjB;AACA;;AACA,QAAIpD,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB,aAAO6oC,mBAAmB,EAA1B;AACD,KALiC,CAOlC;AACA;;;AACA,QAAIhpC,OAAO,CAAC1V,OAAR,CAAgBpjB,MAAhB,GAAyB,CAA7B,EAAgC;AAC9B64B,MAAAA,WAAW,CAACG,KAAZ,GAAoBF,OAAO,CAAC1V,OAAR,CAAgB0V,OAAO,CAAC1V,OAAR,CAAgBpjB,MAAhB,GAAyB,CAAzC,EAA4C+4B,GAAhE;AACAqpC,MAAAA,UAAU;AACVM,MAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,KAJD,MAIO;AAEL,UAAIplD,QAAQ,GAAG,YAAY;AACzB,YAAIgsB,UAAJ,EAAgB;AACdzQ,UAAAA,WAAW,CAAC0Q,IAAZ,GAAmB,IAAnB;AACA64B,UAAAA,UAAU;AACX,SAHD,MAGO;AACLtB,UAAAA,gBAAgB,GAAG,IAAnB;AACD;;AACD4B,QAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,OARD,CAFK,CAYL;;;AACA,UAAI,CAAC/B,YAAD,IAAiB7nC,OAAO,CAAC1V,OAAR,CAAgBpjB,MAAhB,KAA2B,CAAhD,EAAmD;AACjD6gE,QAAAA,iBAAiB,GAAG,IAApB;AACAM,QAAAA,YAAY,CAAClD,eAAb,CAA6BnlC,OAAO,CAACwS,QAArC,EACIsyB,OADJ,EACa31D,IADb,CACkB,YAAY;AAC5B44D,UAAAA,iBAAiB,GAAG,KAApB;AACAr+D,UAAAA,MAAM,CAAC8oC,QAAP,GAAkBA,QAAQ,GAAGxS,OAAO,CAACwS,QAArC;AACAhuB,UAAAA,QAAQ;AACT,SALD,EAMCoG,KAND,CAMO2+C,iBANP;AAOD,OATD,MASO;AACL/kD,QAAAA,QAAQ;AACT;AACF;AACF;;AAGD,WAAS0lD,cAAT,CAAwBnzD,GAAxB,EAA6B;AAC3BoxD,IAAAA,cAAc,GAAG,KAAjB;AACA;;AACA,QAAIpD,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB,aAAO6oC,mBAAmB,EAA1B;AACD;;AACDa,IAAAA,gBAAgB,CAAC,kBAAD,EAAqB9yD,GAArB,CAAhB;AACD;;AAGD,WAASuyD,UAAT,GAAsB;AACpB,QAAI,EACF,CAACnB,cAAD,IACA,CAACH,gBADD,IAEAJ,OAAO,CAAC1gE,MAAR,GAAiBghE,aAHf,CAAJ,EAIK;AACH;AACD;;AACDC,IAAAA,cAAc,GAAG,IAAjB;;AACA,aAASgC,YAAT,GAAwB;AACtBnqC,MAAAA,OAAO,CAAC6P,MAAR;AACD;;AACD,aAASzZ,cAAT,GAA0B;AACxB2uC,MAAAA,WAAW,CAAC3uC,cAAZ,CAA2B,QAA3B,EAAqC+zC,YAArC;AACD;;AAED,QAAIpF,WAAW,CAAC/zB,QAAhB,EAA0B;AAAE;AAC1B+zB,MAAAA,WAAW,CAAC3uC,cAAZ,CAA2B,QAA3B,EAAqC2uC,WAAW,CAACqF,aAAjD;;AACArF,MAAAA,WAAW,CAAC/zB,QAAZ,CAAqBnB,MAArB;AACD;;AACDk1B,IAAAA,WAAW,CAACvuC,IAAZ,CAAiB,QAAjB,EAA2B2zC,YAA3B;AAEA,QAAInqC,OAAO,GAAGujC,GAAG,CAACvjC,OAAJ,CAAYD,WAAZ,EACX/J,EADW,CACR,QADQ,EACEoK,QADF,CAAd;AAEAJ,IAAAA,OAAO,CAAC7wB,IAAR,CAAainB,cAAb,EAA6BA,cAA7B;AACA4J,IAAAA,OAAO,CAAC7wB,IAAR,CAAa86D,iBAAb,EACGr/C,KADH,CACSs/C,cADT;;AAGA,QAAIxsC,IAAI,CAACopC,KAAT,EAAgB;AACd;AACA/B,MAAAA,WAAW,CAAC/zB,QAAZ,GAAuBhR,OAAvB;AACA+kC,MAAAA,WAAW,CAACqF,aAAZ,GAA4BD,YAA5B;AACD;AACF;;AAGD,WAASE,YAAT,GAAwB;AACtBzB,IAAAA,gBAAgB,GAAGz5D,IAAnB,CAAwB,YAAY;AAClC;AACA,UAAI41D,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB6oC,QAAAA,mBAAmB;AACnB;AACD;;AACD,aAAOX,YAAY,CAACxC,aAAb,GAA6B12D,IAA7B,CAAkC,UAAU01D,UAAV,EAAsB;AAC7DryB,QAAAA,QAAQ,GAAGqyB,UAAX;AACA9kC,QAAAA,WAAW,GAAG;AACZG,UAAAA,KAAK,EAAEsS,QADK;AAEZ1B,UAAAA,KAAK,EAAEunB,UAFK;AAGZA,UAAAA,UAAU,EAAEA,UAHA;AAIZnoB,UAAAA,KAAK,EAAE,UAJK;AAKZiS,UAAAA,OAAO,EAAEA,OALG;AAMZ1sC,UAAAA,QAAQ,EAAEA,QANE;AAOZy/B,UAAAA,WAAW,EAAE,IAPD,CAOM;;AAPN,SAAd;;AASA,YAAIxX,IAAI,CAACpuB,MAAT,EAAiB;AACf,cAAI,OAAOouB,IAAI,CAACpuB,MAAZ,KAAuB,QAA3B,EAAqC;AACnC;AACAywB,YAAAA,WAAW,CAAC6D,YAAZ,GAA2B,IAA3B;AACD,WAHD,MAGO;AAAE;AACP7D,YAAAA,WAAW,CAACzwB,MAAZ,GAAqBouB,IAAI,CAACpuB,MAA1B;AACD;AACF;;AACD,YAAI,eAAeouB,IAAnB,EAAyB;AACvBqC,UAAAA,WAAW,CAACu4B,SAAZ,GAAwB56B,IAAI,CAAC46B,SAA7B;AACD;;AACD,YAAI,aAAa56B,IAAjB,EAAuB;AACrBqC,UAAAA,WAAW,CAACnH,OAAZ,GAAsB8E,IAAI,CAAC9E,OAA3B;AACD;;AACD,YAAI8E,IAAI,CAAC+F,YAAT,EAAuB;AACrB1D,UAAAA,WAAW,CAAC0D,YAAZ,GAA2B/F,IAAI,CAAC+F,YAAhC;AACD;;AACD,YAAI/F,IAAI,CAACukB,IAAT,EAAe;AACbliB,UAAAA,WAAW,CAACkiB,IAAZ,GAAmBvkB,IAAI,CAACukB,IAAxB;AACD;;AACDqnB,QAAAA,UAAU;AACX,OAhCM,CAAP;AAiCD,KAvCD,EAuCG1+C,KAvCH,CAuCS,UAAU7T,GAAV,EAAe;AACtB8yD,MAAAA,gBAAgB,CAAC,8BAAD,EAAiC9yD,GAAjC,CAAhB;AACD,KAzCD;AA0CD;AAED;;;AACA,WAASwyD,iBAAT,CAA2BxyD,GAA3B,EAAgC;AAC9BgxD,IAAAA,iBAAiB,GAAG,KAApB;AACA8B,IAAAA,gBAAgB,CAAC,sCAAD,EAAyC9yD,GAAzC,CAAhB;AACD;AAED;;;AACA,MAAIguD,WAAW,CAAC5kC,SAAhB,EAA2B;AAAE;AAC3B6oC,IAAAA,mBAAmB;AACnB;AACD;;AAED,MAAI,CAACjE,WAAW,CAACuF,eAAjB,EAAkC;AAChCvF,IAAAA,WAAW,CAACvuC,IAAZ,CAAiB,QAAjB,EAA2BwyC,mBAA3B;;AAEA,QAAI,OAAOtrC,IAAI,CAAClZ,QAAZ,KAAyB,UAA7B,EAAyC;AACvCugD,MAAAA,WAAW,CAACvuC,IAAZ,CAAiB,OAAjB,EAA0BkH,IAAI,CAAClZ,QAA/B;AACAugD,MAAAA,WAAW,CAACvuC,IAAZ,CAAiB,UAAjB,EAA6B,UAAU9sB,MAAV,EAAkB;AAC7Cg0B,QAAAA,IAAI,CAAClZ,QAAL,CAAc,IAAd,EAAoB9a,MAApB;AACD,OAFD;AAGD;;AACDq7D,IAAAA,WAAW,CAACuF,eAAZ,GAA8B,IAA9B;AACD;;AAED,MAAI,OAAO5sC,IAAI,CAACwC,KAAZ,KAAsB,WAA1B,EAAuC;AACrCmqC,IAAAA,YAAY;AACb,GAFD,MAEO;AACLzB,IAAAA,gBAAgB,GAAGz5D,IAAnB,CAAwB,YAAY;AAClC44D,MAAAA,iBAAiB,GAAG,IAApB;AACA,aAAOM,YAAY,CAAClD,eAAb,CAA6BznC,IAAI,CAACwC,KAAlC,EAAyC4kC,OAAzC,CAAP;AACD,KAHD,EAGG31D,IAHH,CAGQ,YAAY;AAClB44D,MAAAA,iBAAiB,GAAG,KAApB;AACA;;AACA,UAAIhD,WAAW,CAAC5kC,SAAhB,EAA2B;AACzB6oC,QAAAA,mBAAmB;AACnB;AACD;;AACDx2B,MAAAA,QAAQ,GAAG9U,IAAI,CAACwC,KAAhB;AACAmqC,MAAAA,YAAY;AACb,KAZD,EAYGz/C,KAZH,CAYS2+C,iBAZT;AAaD;AACF,EAED;AACA;;;AACA,uBAASgB,WAAT,EAAsB32C,oBAAtB;;AACA,SAAS22C,WAAT,GAAuB;AACrB32C,uBAAanpB,IAAb,CAAkB,IAAlB;;AACA,OAAK01B,SAAL,GAAiB,KAAjB;AACA,OAAK5c,KAAL,GAAa,SAAb;AACA,MAAI2Y,IAAI,GAAG,IAAX;AACA,MAAI1N,OAAO,GAAG,IAAI9c,OAAJ,CAAY,UAAU0qB,OAAV,EAAmBzqB,MAAnB,EAA2B;AACnDuqB,IAAAA,IAAI,CAAC1F,IAAL,CAAU,UAAV,EAAsB4F,OAAtB;AACAF,IAAAA,IAAI,CAAC1F,IAAL,CAAU,OAAV,EAAmB7kB,MAAnB;AACD,GAHa,CAAd;;AAIAuqB,EAAAA,IAAI,CAAC/sB,IAAL,GAAY,UAAUqH,OAAV,EAAmB7E,MAAnB,EAA2B;AACrC,WAAO6c,OAAO,CAACrf,IAAR,CAAaqH,OAAb,EAAsB7E,MAAtB,CAAP;AACD,GAFD;;AAGAuqB,EAAAA,IAAI,CAACtR,KAAL,GAAa,UAAUjZ,MAAV,EAAkB;AAC7B,WAAO6c,OAAO,CAAC5D,KAAR,CAAcjZ,MAAd,CAAP;AACD,GAFD,CAZqB,CAerB;AACA;;;AACAuqB,EAAAA,IAAI,CAACtR,KAAL,CAAW,YAAY,CAAE,CAAzB;AACD;;AAED2/C,WAAW,CAAC7iE,SAAZ,CAAsBmoC,MAAtB,GAA+B,YAAY;AACzC,OAAK1P,SAAL,GAAiB,IAAjB;AACA,OAAK5c,KAAL,GAAa,WAAb;AACA,OAAKmR,IAAL,CAAU,QAAV;AACD,CAJD;;AAMA61C,WAAW,CAAC7iE,SAAZ,CAAsBuwC,KAAtB,GAA8B,UAAUsrB,GAAV,EAAe3pD,MAAf,EAAuB;AACnD,MAAIsiB,IAAI,GAAG,IAAX;;AACA,MAAIA,IAAI,CAACsuC,YAAT,EAAuB;AACrB;AACD;;AACDtuC,EAAAA,IAAI,CAACsuC,YAAL,GAAoB,IAApB;;AAEA,WAAS56B,SAAT,GAAqB;AACnB1T,IAAAA,IAAI,CAAC2T,MAAL;AACD;;AACD0zB,EAAAA,GAAG,CAAC/sC,IAAJ,CAAS,WAAT,EAAsBoZ,SAAtB;AACAh2B,EAAAA,MAAM,CAAC4c,IAAP,CAAY,WAAZ,EAAyBoZ,SAAzB;;AACA,WAAS66B,OAAT,GAAmB;AACjBlH,IAAAA,GAAG,CAACntC,cAAJ,CAAmB,WAAnB,EAAgCwZ,SAAhC;AACAh2B,IAAAA,MAAM,CAACwc,cAAP,CAAsB,WAAtB,EAAmCwZ,SAAnC;AACD;;AACD1T,EAAAA,IAAI,CAAC1F,IAAL,CAAU,UAAV,EAAsBi0C,OAAtB;AACD,CAjBD;;AAmBA,SAASC,OAAT,CAAiBjtC,EAAjB,EAAqBC,IAArB,EAA2B;AACzB,MAAIitC,gBAAgB,GAAGjtC,IAAI,CAACitC,gBAA5B;;AACA,MAAI,OAAOltC,EAAP,KAAc,QAAlB,EAA4B;AAC1B,WAAO,IAAIktC,gBAAJ,CAAqBltC,EAArB,EAAyBC,IAAzB,CAAP;AACD,GAFD,MAEO;AACL,WAAOD,EAAP;AACD;AACF;;AAED,SAASmtC,gBAAT,CAA0BrH,GAA1B,EAA+B3pD,MAA/B,EAAuC8jB,IAAvC,EAA6CpB,QAA7C,EAAuD;AAErD,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiC;AAC/BA,IAAAA,IAAI,GAAG,EAAP;AACD;;AAED,MAAIA,IAAI,CAACykB,OAAL,IAAgB,CAAC1qB,KAAK,CAAC2C,OAAN,CAAcsD,IAAI,CAACykB,OAAnB,CAArB,EAAkD;AAChD,UAAMpf,WAAW,CAACX,WAAD,EACE,2CADF,CAAjB;AAED;;AAED1E,EAAAA,IAAI,CAAClZ,QAAL,GAAgB8X,QAAhB;AACAoB,EAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;AACAA,EAAAA,IAAI,CAAC8S,UAAL,GAAkB9S,IAAI,CAAC8S,UAAL,IAAmB9S,IAAI,CAAC+S,IAA1C;AACA/S,EAAAA,IAAI,CAACopC,KAAL,GAAc,WAAWppC,IAAZ,GAAoBA,IAAI,CAACopC,KAAzB,GAAiC,KAA9C;AACA;;AACAppC,EAAAA,IAAI,CAACitC,gBAAL,GAAwBjtC,IAAI,CAACitC,gBAAL,IAAyB,IAAjD;AACA,MAAIE,YAAY,GAAG,IAAIN,WAAJ,CAAgB7sC,IAAhB,CAAnB;AACA,MAAIotC,QAAQ,GAAGJ,OAAO,CAACnH,GAAD,EAAM7lC,IAAN,CAAtB;AACA,MAAIqtC,WAAW,GAAGL,OAAO,CAAC9wD,MAAD,EAAS8jB,IAAT,CAAzB;AACAiqC,EAAAA,SAAS,CAACmD,QAAD,EAAWC,WAAX,EAAwBrtC,IAAxB,EAA8BmtC,YAA9B,CAAT;AACA,SAAOA,YAAP;AACD;;AAED,uBAASG,IAAT,EAAep3C,oBAAf;;AACA,SAASq3C,IAAT,CAAc1H,GAAd,EAAmB3pD,MAAnB,EAA2B8jB,IAA3B,EAAiCpB,QAAjC,EAA2C;AACzC,MAAI,OAAOoB,IAAP,KAAgB,UAApB,EAAgC;AAC9BpB,IAAAA,QAAQ,GAAGoB,IAAX;AACAA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACD,MAAI,OAAOA,IAAP,KAAgB,WAApB,EAAiC;AAC/BA,IAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,EAAAA,IAAI,GAAG7a,KAAK,CAAC6a,IAAD,CAAZ;AACA;;AACAA,EAAAA,IAAI,CAACitC,gBAAL,GAAwBjtC,IAAI,CAACitC,gBAAL,IAAyB,IAAjD;AACApH,EAAAA,GAAG,GAAGmH,OAAO,CAACnH,GAAD,EAAM7lC,IAAN,CAAb;AACA9jB,EAAAA,MAAM,GAAG8wD,OAAO,CAAC9wD,MAAD,EAAS8jB,IAAT,CAAhB;AACA,SAAO,IAAIstC,IAAJ,CAASzH,GAAT,EAAc3pD,MAAd,EAAsB8jB,IAAtB,EAA4BpB,QAA5B,CAAP;AACD;;AAED,SAAS0uC,IAAT,CAAczH,GAAd,EAAmB3pD,MAAnB,EAA2B8jB,IAA3B,EAAiCpB,QAAjC,EAA2C;AACzC,MAAIJ,IAAI,GAAG,IAAX;AACA,OAAKgvC,QAAL,GAAgB,KAAhB;AAEA,MAAIC,QAAQ,GAAGztC,IAAI,CAACnxB,IAAL,GAAY60B,qBAAqB,CAAC,EAAD,EAAK1D,IAAL,EAAWA,IAAI,CAACnxB,IAAhB,CAAjC,GAAyDmxB,IAAxE;AACA,MAAI0tC,QAAQ,GAAG1tC,IAAI,CAAC2tC,IAAL,GAAYjqC,qBAAqB,CAAC,EAAD,EAAK1D,IAAL,EAAWA,IAAI,CAAC2tC,IAAhB,CAAjC,GAAyD3tC,IAAxE;AAEA,OAAKnxB,IAAL,GAAYq+D,gBAAgB,CAACrH,GAAD,EAAM3pD,MAAN,EAAcuxD,QAAd,CAA5B;AACA,OAAKE,IAAL,GAAYT,gBAAgB,CAAChxD,MAAD,EAAS2pD,GAAT,EAAc6H,QAAd,CAA5B;AAEA,OAAKE,UAAL,GAAkB,IAAlB;AACA,OAAKC,UAAL,GAAkB,IAAlB;;AAEA,WAASC,UAAT,CAAoB9nC,MAApB,EAA4B;AAC1BxH,IAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,MAAAA,SAAS,EAAE,MADO;AAElBuc,MAAAA,MAAM,EAAEA;AAFU,KAApB;AAID;;AACD,WAAS+nC,UAAT,CAAoB/nC,MAApB,EAA4B;AAC1BxH,IAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,MAAAA,SAAS,EAAE,MADO;AAElBuc,MAAAA,MAAM,EAAEA;AAFU,KAApB;AAID;;AACD,WAASgoC,UAAT,CAAoBvoC,GAApB,EAAyB;AACvBjH,IAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,MAAAA,SAAS,EAAE,MADO;AAElBgc,MAAAA,GAAG,EAAEA;AAFa,KAApB;AAID;;AACD,WAASwoC,UAAT,CAAoBxoC,GAApB,EAAyB;AACvBjH,IAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,MAAAA,SAAS,EAAE,MADO;AAElBgc,MAAAA,GAAG,EAAEA;AAFa,KAApB;AAID;;AACD,WAASmoC,UAAT,GAAsB;AACpBpvC,IAAAA,IAAI,CAACovC,UAAL,GAAkB,IAAlB;AACA;;AACA,QAAIpvC,IAAI,CAACqvC,UAAT,EAAqB;AACnBrvC,MAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV;AACD;AACF;;AACD,WAAS62C,UAAT,GAAsB;AACpBrvC,IAAAA,IAAI,CAACqvC,UAAL,GAAkB,IAAlB;AACA;;AACA,QAAIrvC,IAAI,CAACovC,UAAT,EAAqB;AACnBpvC,MAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV;AACD;AACF;;AACD,WAASk3C,UAAT,GAAsB;AACpB1vC,IAAAA,IAAI,CAACovC,UAAL,GAAkB,KAAlB;AACA;;AACA,QAAIpvC,IAAI,CAACqvC,UAAT,EAAqB;AACnBrvC,MAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,QAAAA,SAAS,EAAE;AADO,OAApB;AAGD;AACF;;AACD,WAAS0kD,UAAT,GAAsB;AACpB3vC,IAAAA,IAAI,CAACqvC,UAAL,GAAkB,KAAlB;AACA;;AACA,QAAIrvC,IAAI,CAACovC,UAAT,EAAqB;AACnBpvC,MAAAA,IAAI,CAACxH,IAAL,CAAU,QAAV,EAAoB;AAClBvN,QAAAA,SAAS,EAAE;AADO,OAApB;AAGD;AACF;;AAED,MAAI2kD,OAAO,GAAG,EAAd;;AAEA,WAASC,SAAT,CAAmB1/D,IAAnB,EAAyB;AAAE;AACzB,WAAO,UAAUoH,KAAV,EAAiBtF,IAAjB,EAAuB;AAC5B,UAAI69D,QAAQ,GAAGv4D,KAAK,KAAK,QAAV,KACZtF,IAAI,KAAKq9D,UAAT,IAAuBr9D,IAAI,KAAKs9D,UADpB,CAAf;AAEA,UAAIQ,QAAQ,GAAGx4D,KAAK,KAAK,QAAV,KACZtF,IAAI,KAAKw9D,UAAT,IAAuBx9D,IAAI,KAAKu9D,UADpB,CAAf;AAEA,UAAIQ,QAAQ,GAAGz4D,KAAK,KAAK,QAAV,KACZtF,IAAI,KAAKo9D,UAAT,IAAuBp9D,IAAI,KAAKm9D,UADpB,CAAf;AAEA,UAAIa,QAAQ,GAAG14D,KAAK,KAAK,QAAV,KACZtF,IAAI,KAAK09D,UAAT,IAAuB19D,IAAI,KAAKy9D,UADpB,CAAf;;AAGA,UAAII,QAAQ,IAAIC,QAAZ,IAAwBC,QAAxB,IAAoCC,QAAxC,EAAkD;AAChD,YAAI,EAAE14D,KAAK,IAAIq4D,OAAX,CAAJ,EAAyB;AACvBA,UAAAA,OAAO,CAACr4D,KAAD,CAAP,GAAiB,EAAjB;AACD;;AACDq4D,QAAAA,OAAO,CAACr4D,KAAD,CAAP,CAAepH,IAAf,IAAuB,IAAvB;;AACA,YAAI7D,MAAM,CAACoC,IAAP,CAAYkhE,OAAO,CAACr4D,KAAD,CAAnB,EAA4BvM,MAA5B,KAAuC,CAA3C,EAA8C;AAC5C;AACAg1B,UAAAA,IAAI,CAACnF,kBAAL,CAAwBtjB,KAAxB;AACD;AACF;AACF,KApBD;AAqBD;;AAED,MAAIiqB,IAAI,CAAC+S,IAAT,EAAe;AACb,SAAKlkC,IAAL,CAAUypB,EAAV,CAAa,UAAb,EAAyBkG,IAAI,CAACmvC,IAAL,CAAUx7B,MAAV,CAAiB5+B,IAAjB,CAAsBirB,IAAI,CAACmvC,IAA3B,CAAzB;AACA,SAAKA,IAAL,CAAUr1C,EAAV,CAAa,UAAb,EAAyBkG,IAAI,CAAC3vB,IAAL,CAAUsjC,MAAV,CAAiB5+B,IAAjB,CAAsBirB,IAAI,CAAC3vB,IAA3B,CAAzB;AACD;;AAED,WAAS6/D,cAAT,CAAwB9nC,EAAxB,EAA4B7wB,KAA5B,EAAmC2hB,QAAnC,EAA6C;AAC3C,QAAIkP,EAAE,CAACrP,SAAH,CAAaxhB,KAAb,EAAoBmB,OAApB,CAA4BwgB,QAA5B,KAAyC,CAAC,CAA9C,EAAiD;AAC/CkP,MAAAA,EAAE,CAACtO,EAAH,CAAMviB,KAAN,EAAa2hB,QAAb;AACD;AACF;;AAED,OAAKY,EAAL,CAAQ,aAAR,EAAuB,UAAUviB,KAAV,EAAiB;AACtC,QAAIA,KAAK,KAAK,QAAd,EAAwB;AACtB24D,MAAAA,cAAc,CAAClwC,IAAI,CAACmvC,IAAN,EAAY,QAAZ,EAAsBG,UAAtB,CAAd;AACAY,MAAAA,cAAc,CAAClwC,IAAI,CAAC3vB,IAAN,EAAY,QAAZ,EAAsBk/D,UAAtB,CAAd;AACD,KAHD,MAGO,IAAIh4D,KAAK,KAAK,QAAd,EAAwB;AAC7B24D,MAAAA,cAAc,CAAClwC,IAAI,CAACmvC,IAAN,EAAY,QAAZ,EAAsBM,UAAtB,CAAd;AACAS,MAAAA,cAAc,CAAClwC,IAAI,CAAC3vB,IAAN,EAAY,QAAZ,EAAsBm/D,UAAtB,CAAd;AACD,KAHM,MAGA,IAAIj4D,KAAK,KAAK,QAAd,EAAwB;AAC7B24D,MAAAA,cAAc,CAAClwC,IAAI,CAACmvC,IAAN,EAAY,QAAZ,EAAsBQ,UAAtB,CAAd;AACAO,MAAAA,cAAc,CAAClwC,IAAI,CAAC3vB,IAAN,EAAY,QAAZ,EAAsBq/D,UAAtB,CAAd;AACD,KAHM,MAGA,IAAIn4D,KAAK,KAAK,QAAd,EAAwB;AAC7B24D,MAAAA,cAAc,CAAClwC,IAAI,CAACmvC,IAAN,EAAY,QAAZ,EAAsBE,UAAtB,CAAd;AACAa,MAAAA,cAAc,CAAClwC,IAAI,CAAC3vB,IAAN,EAAY,QAAZ,EAAsB++D,UAAtB,CAAd;AACD;AACF,GAdD;AAgBA,OAAKt1C,EAAL,CAAQ,gBAAR,EAA0B,UAAUviB,KAAV,EAAiB;AACzC,QAAIA,KAAK,KAAK,QAAd,EAAwB;AACtByoB,MAAAA,IAAI,CAACmvC,IAAL,CAAUj1C,cAAV,CAAyB,QAAzB,EAAmCo1C,UAAnC;AACAtvC,MAAAA,IAAI,CAAC3vB,IAAL,CAAU6pB,cAAV,CAAyB,QAAzB,EAAmCq1C,UAAnC;AACD,KAHD,MAGO,IAAIh4D,KAAK,KAAK,QAAd,EAAwB;AAC7ByoB,MAAAA,IAAI,CAACmvC,IAAL,CAAUj1C,cAAV,CAAyB,QAAzB,EAAmCu1C,UAAnC;AACAzvC,MAAAA,IAAI,CAAC3vB,IAAL,CAAU6pB,cAAV,CAAyB,QAAzB,EAAmCs1C,UAAnC;AACD,KAHM,MAGA,IAAIj4D,KAAK,KAAK,QAAd,EAAwB;AAC7ByoB,MAAAA,IAAI,CAACmvC,IAAL,CAAUj1C,cAAV,CAAyB,QAAzB,EAAmCy1C,UAAnC;AACA3vC,MAAAA,IAAI,CAAC3vB,IAAL,CAAU6pB,cAAV,CAAyB,QAAzB,EAAmCw1C,UAAnC;AACD,KAHM,MAGA,IAAIn4D,KAAK,KAAK,QAAd,EAAwB;AAC7ByoB,MAAAA,IAAI,CAACmvC,IAAL,CAAUj1C,cAAV,CAAyB,QAAzB,EAAmCm1C,UAAnC;AACArvC,MAAAA,IAAI,CAAC3vB,IAAL,CAAU6pB,cAAV,CAAyB,QAAzB,EAAmCk1C,UAAnC;AACD;AACF,GAdD;AAgBA,OAAKD,IAAL,CAAUr1C,EAAV,CAAa,gBAAb,EAA+B+1C,SAAS,CAAC,MAAD,CAAxC;AACA,OAAKx/D,IAAL,CAAUypB,EAAV,CAAa,gBAAb,EAA+B+1C,SAAS,CAAC,MAAD,CAAxC;AAEA,MAAIv9C,OAAO,GAAG9c,OAAO,CAAC0Y,GAAR,CAAY,CACxB,KAAK7d,IADmB,EAExB,KAAK8+D,IAFmB,CAAZ,EAGXl8D,IAHW,CAGN,UAAUktB,IAAV,EAAgB;AACtB,QAAIgwC,GAAG,GAAG;AACR9/D,MAAAA,IAAI,EAAE8vB,IAAI,CAAC,CAAD,CADF;AAERgvC,MAAAA,IAAI,EAAEhvC,IAAI,CAAC,CAAD;AAFF,KAAV;AAIAH,IAAAA,IAAI,CAACxH,IAAL,CAAU,UAAV,EAAsB23C,GAAtB;;AACA,QAAI/vC,QAAJ,EAAc;AACZA,MAAAA,QAAQ,CAAC,IAAD,EAAO+vC,GAAP,CAAR;AACD;;AACDnwC,IAAAA,IAAI,CAACnF,kBAAL;AACA,WAAOs1C,GAAP;AACD,GAda,EAcX,UAAUt1D,GAAV,EAAe;AAChBmlB,IAAAA,IAAI,CAAC2T,MAAL;;AACA,QAAIvT,QAAJ,EAAc;AACZ;AACA;AACAA,MAAAA,QAAQ,CAACvlB,GAAD,CAAR;AACD,KAJD,MAIO;AACL;AACA;AACA;AACAmlB,MAAAA,IAAI,CAACxH,IAAL,CAAU,OAAV,EAAmB3d,GAAnB;AACD;;AACDmlB,IAAAA,IAAI,CAACnF,kBAAL;;AACA,QAAIuF,QAAJ,EAAc;AACZ;AACA,YAAMvlB,GAAN;AACD;AACF,GA/Ba,CAAd;;AAiCA,OAAK5H,IAAL,GAAY,UAAUm9D,OAAV,EAAmBv1D,GAAnB,EAAwB;AAClC,WAAOyX,OAAO,CAACrf,IAAR,CAAam9D,OAAb,EAAsBv1D,GAAtB,CAAP;AACD,GAFD;;AAIA,OAAK6T,KAAL,GAAa,UAAU7T,GAAV,EAAe;AAC1B,WAAOyX,OAAO,CAAC5D,KAAR,CAAc7T,GAAd,CAAP;AACD,GAFD;AAGD;;AAEDi0D,IAAI,CAACtjE,SAAL,CAAemoC,MAAf,GAAwB,YAAY;AAClC,MAAI,CAAC,KAAKq7B,QAAV,EAAoB;AAClB,SAAKA,QAAL,GAAgB,IAAhB;AACA,SAAK3+D,IAAL,CAAUsjC,MAAV;AACA,SAAKw7B,IAAL,CAAUx7B,MAAV;AACD;AACF,CAND;;AAQA,SAAS08B,WAAT,CAAqBn8B,OAArB,EAA8B;AAC5BA,EAAAA,OAAO,CAACu3B,SAAR,GAAoBiD,gBAApB;AACAx6B,EAAAA,OAAO,CAAC66B,IAAR,GAAeA,IAAf;AAEAziE,EAAAA,MAAM,CAACC,cAAP,CAAsB2nC,OAAO,CAAC1oC,SAA9B,EAAyC,WAAzC,EAAsD;AACpDgB,IAAAA,GAAG,EAAE,YAAY;AACf,UAAIwzB,IAAI,GAAG,IAAX;;AACA,UAAI,OAAO,KAAKswC,gBAAZ,KAAiC,WAArC,EAAkD;AAChD,aAAKA,gBAAL,GAAwB;AACtBv6B,UAAAA,IAAI,EAAE,UAAUw6B,KAAV,EAAiB/uC,IAAjB,EAAuBpB,QAAvB,EAAiC;AACrC,mBAAOJ,IAAI,CAACN,WAAL,CAAiB+rC,SAAjB,CAA2B8E,KAA3B,EAAkCvwC,IAAlC,EAAwCwB,IAAxC,EAA8CpB,QAA9C,CAAP;AACD,WAHqB;AAItB2E,UAAAA,EAAE,EAAE,UAAUwrC,KAAV,EAAiB/uC,IAAjB,EAAuBpB,QAAvB,EAAiC;AACnC,mBAAOJ,IAAI,CAACN,WAAL,CAAiB+rC,SAAjB,CAA2BzrC,IAA3B,EAAiCuwC,KAAjC,EAAwC/uC,IAAxC,EAA8CpB,QAA9C,CAAP;AACD;AANqB,SAAxB;AAQD;;AACD,aAAO,KAAKkwC,gBAAZ;AACD;AAdmD,GAAtD;;AAiBAp8B,EAAAA,OAAO,CAAC1oC,SAAR,CAAkBujE,IAAlB,GAAyB,UAAUrrC,MAAV,EAAkBlC,IAAlB,EAAwBpB,QAAxB,EAAkC;AACzD,WAAO,KAAKV,WAAL,CAAiBqvC,IAAjB,CAAsB,IAAtB,EAA4BrrC,MAA5B,EAAoClC,IAApC,EAA0CpB,QAA1C,CAAP;AACD,GAFD;AAGD;;AAED8T,OAAO,CAAC0J,MAAR,CAAeoa,QAAf,EACGpa,MADH,CACUsf,WADV,EAEGtf,MAFH,CAEUmpB,SAFV,EAGGnpB,MAHH,CAGUyyB,WAHV,GAKA;;eAEen8B;;;;;;;;;;ACphUf;;AACA;;;;;;AAEA,IAAMtb,OAAO,GAAG,IAAI43C,YAAJ,EAAhB;AACA,IAAMC,MAAM,GAAG73C,OAAO,CAAC83C,mBAAR,EAAf;AACA,IAAMC,aAAa,GAAG,IAAIC,gBAAJ,CAAqBH,MAArB,EAA6B,EAA7B,CAAtB;AACA,IAAMI,KAAK,GAAG,IAAIzzB,gBAAJ,CAAU,sBAAV,CAAd,EACA;AACA;;AACAqzB,MAAM,CAACK,OAAP,CAAel4C,OAAO,CAACm4C,WAAvB;;AAEAJ,aAAa,CAACz3B,UAAd,GAA2B,UAAS83B,QAAT,EAAmBplC,IAAnB,EAAyB;AACnD3+B,EAAAA,OAAO,CAACD,GAAR,CAAY,gBAAZ;AACA+vC,EAAAA,KAAK,mCAAmC;AAAChhC,IAAAA,MAAM,EAAC,MAAR;AAAgBsvC,IAAAA,IAAI,EAAEzf;AAAtB,GAAnC,CAAL,CACE34B,IADF,CACOhG,OAAO,CAACD,GADf;AAEA,CAJD;;IAMMikE,WAmBL,kBAAaC,aAAb,EAA4B;AAAA;;AAAA;;AAAA,OAlB5BC,QAkB4B,GAlBjB,CAkBiB;AAAA,OAjB5BC,SAiB4B,GAjBhB;AACXC,IAAAA,QAAQ,EAAE;AACT3hE,MAAAA,IAAI,EAAE,GADG;AAET4hE,MAAAA,cAAc,EAAE,CAFP;AAGTC,MAAAA,YAAY,EAAE;AAHL,KADC;AAMXC,IAAAA,SAAS,EAAE;AACV9hE,MAAAA,IAAI,EAAE,GADI;AAEV4hE,MAAAA,cAAc,EAAE,CAFN;AAGVC,MAAAA,YAAY,EAAE;AAHJ,KANA;AAWXE,IAAAA,QAAQ,EAAE,GAXC;AAYXC,IAAAA,UAAU,EAAE;AAZD,GAiBgB;AAAA,OAH5BC,WAG4B,GAHd,IAAIh7D,WAAJ,EAGc;AAAA,OAF5Bi7D,IAE4B,GAFrB,IAAIC,eAAJ,CAAS,gBAAT,CAEqB;;AAAA,OAD5BX,aAC4B,GADZ,YAAM,CAAE,CACI;;AAC3B,OAAKA,aAAL,GAAqBA,aAArB;AACA,OAAKU,IAAL,CAAU93C,EAAV,CAAa,YAAb,EAA2B,UAACg4C,IAAD,EAAU;AACpC,IAAA,KAAI,CAACX,QAAL;;AAEA,QAAG,KAAI,CAACA,QAAL,GAAgB,CAAnB,EAAsB;AACrBY,MAAAA,KAAK,CAAC,6BAAD,CAAL;AACA;AACA,KANmC,CAQpC;;;AACA,IAAA,KAAI,CAACH,IAAL,CAAU93C,EAAV,CAAa,MAAb,EAAqB,UAACk4C,SAAD,EAAe;AACnCA,MAAAA,SAAS,CAACjwD,MAAV;AACAiwD,MAAAA,SAAS,CAACl4C,EAAV,CAAa,QAAb,EAAuB,UAAC5kB,MAAD,EAAY;AAClC,YAAMk0B,MAAM,GAAGxQ,OAAO,CAACq5C,uBAAR,CAAgC/8D,MAAhC,CAAf;AACA,YAAMg9D,QAAQ,GAAGt5C,OAAO,CAACu5C,qBAAR,EAAjB;AAEA/oC,QAAAA,MAAM,CAAC0nC,OAAP,CAAeoB,QAAf;AACAA,QAAAA,QAAQ,CAACpB,OAAT,CAAiBL,MAAjB,EAAyB,CAAzB,EAA4B,KAAI,CAACU,QAAL,GAAgB,CAA5C;;AACA,YAAG,KAAI,CAACA,QAAL,IAAiB,CAApB,EAAuB;AACtB,cAAGR,aAAa,CAACyB,WAAd,EAAH,EAAgC;AAC/BnlE,YAAAA,OAAO,CAACD,GAAR,CAAY,qBAAZ;AACA2jE,YAAAA,aAAa,CAAC0B,eAAd;AACA;;AACDplE,UAAAA,OAAO,CAACD,GAAR,CAAY,WAAZ;AACA2jE,UAAAA,aAAa,CAAC2B,cAAd;AACA;AACD,OAdD;AAeA,KAjBD;AAkBA,GA3BD;AA4BA,OAAKV,IAAL,CAAU93C,EAAV,CAAa,cAAb,EAA6B,YAAM;AAClC,IAAA,KAAI,CAACq3C,QAAL;AACAlkE,IAAAA,OAAO,CAACD,GAAR,CAAY,qBAAZ;AACA2jE,IAAAA,aAAa,CAAC0B,eAAd;AACA,GAJD;AAKAxB,EAAAA,KAAK,CAACrkE,GAAN,CAAU,MAAV,EAAkByG,IAAlB,CAAuB,UAACg0B,GAAD,EAAS;AAC/B,IAAA,KAAI,CAACmqC,SAAL,GAAiBnqC,GAAjB;AACA,GAFD;AAGA4pC,EAAAA,KAAK,CAAC/sC,OAAN,GAAgBhK,EAAhB,CAAmB,QAAnB,EAA6B,YAAM;AAClC+2C,IAAAA,KAAK,CAACrkE,GAAN,CAAU,MAAV,EAAkByG,IAAlB,CAAuB,UAACg0B,GAAD,EAAS;AAC/B,MAAA,KAAI,CAACmqC,SAAL,GAAiBnqC,GAAjB;;AACA,MAAA,KAAI,CAACiqC,aAAL;AACA,KAHD;AAIA,GALD;AAMAT,EAAAA,MAAM,CAACK,OAAP,CAAel4C,OAAO,CAACm4C,WAAvB;AACA;;AAEK,IAAMwB,KAAK,GAAG,IAAItB,QAAJ,EAAd;;AACP9lE,MAAM,CAAConE,KAAP,GAAeA,KAAf;;;;ACpFA;;;ACAA,IAAIC,UAAU,GAAG,4BAAjB;AAEA,IAAIC,SAAS,GAAGxvD,MAAM,CAACyvD,MAAP,CAAcC,MAA9B;;AAEA,SAASA,MAAT,CAAgBC,UAAhB,EAA4B;AAC1BH,EAAAA,SAAS,CAAClkE,IAAV,CAAe,IAAf,EAAqBqkE,UAArB;AACA,OAAKC,GAAL,GAAW;AACTpkE,IAAAA,IAAI,EAAEwU,MAAM,CAACyvD,MAAP,CAAcI,OADX;AAETC,IAAAA,gBAAgB,EAAE,EAFT;AAGTC,IAAAA,iBAAiB,EAAE,EAHV;AAITC,IAAAA,MAAM,EAAE,UAAUC,EAAV,EAAc;AACpB,WAAKH,gBAAL,CAAsB1iE,IAAtB,CAA2B6iE,EAAE,IAAI,YAAY,CAAE,CAA/C;AACD,KANQ;AAOTC,IAAAA,OAAO,EAAE,UAAUD,EAAV,EAAc;AACrB,WAAKF,iBAAL,CAAuB3iE,IAAvB,CAA4B6iE,EAA5B;AACD;AATQ,GAAX;AAYAjwD,EAAAA,MAAM,CAACyvD,MAAP,CAAcI,OAAd,GAAwB,IAAxB;AACD;;AAED7vD,MAAM,CAACyvD,MAAP,CAAcC,MAAd,GAAuBA,MAAvB;AACA,IAAIS,aAAJ,EAAmBC,cAAnB;AAEA,IAAIrhC,MAAM,GAAG/uB,MAAM,CAACyvD,MAAP,CAAc1gC,MAA3B;;AACA,IAAI,CAAC,CAACA,MAAD,IAAW,CAACA,MAAM,CAACshC,eAApB,KAAwC,OAAOC,SAAP,KAAqB,WAAjE,EAA8E;AAC5E,MAAIC,QAAQ,GAAG,MAA4BC,QAAQ,CAACD,QAApD;AACA,MAAI/wD,QAAQ,GAAGgxD,QAAQ,CAAChxD,QAAT,KAAsB,QAAtB,GAAiC,KAAjC,GAAyC,IAAxD;AACA,MAAIixD,EAAE,GAAG,IAAIH,SAAJ,CAAc9wD,QAAQ,GAAG,KAAX,GAAmB+wD,QAAnB,GAA8B,GAA9B,aAA2D,GAAzE,CAAT;;AACAE,EAAAA,EAAE,CAACC,SAAH,GAAe,UAASp8D,KAAT,EAAgB;AAC7B67D,IAAAA,aAAa,GAAG,EAAhB;AACAC,IAAAA,cAAc,GAAG,EAAjB;AAEA,QAAI5kE,IAAI,GAAGyD,IAAI,CAACC,KAAL,CAAWoF,KAAK,CAAC9I,IAAjB,CAAX;;AAEA,QAAIA,IAAI,CAAC0B,IAAL,KAAc,QAAlB,EAA4B;AAC1B,UAAIyjE,OAAO,GAAG,KAAd;AACAnlE,MAAAA,IAAI,CAAColE,MAAL,CAAYpkE,OAAZ,CAAoB,UAASqkE,KAAT,EAAgB;AAClC,YAAI,CAACA,KAAK,CAACC,KAAX,EAAkB;AAChB,cAAIC,SAAS,GAAGC,cAAc,CAAC1nC,MAAM,CAAC2nC,aAAR,EAAuBJ,KAAK,CAACtkE,EAA7B,CAA9B;;AACA,cAAIwkE,SAAJ,EAAe;AACbJ,YAAAA,OAAO,GAAG,IAAV;AACD;AACF;AACF,OAPD,EAF0B,CAW1B;;AACAA,MAAAA,OAAO,GAAGA,OAAO,IAAInlE,IAAI,CAAColE,MAAL,CAAYtrD,KAAZ,CAAkB,UAASurD,KAAT,EAAgB;AACrD,eAAOA,KAAK,CAAC3jE,IAAN,KAAe,KAAf,IAAwB2jE,KAAK,CAACK,SAAN,CAAgBC,EAA/C;AACD,OAFoB,CAArB;;AAIA,UAAIR,OAAJ,EAAa;AACX3mE,QAAAA,OAAO,CAAConE,KAAR;AAEA5lE,QAAAA,IAAI,CAAColE,MAAL,CAAYpkE,OAAZ,CAAoB,UAAUqkE,KAAV,EAAiB;AACnCQ,UAAAA,QAAQ,CAAC/nC,MAAM,CAAC2nC,aAAR,EAAuBJ,KAAvB,CAAR;AACD,SAFD;AAIAT,QAAAA,cAAc,CAAC5jE,OAAf,CAAuB,UAAUorD,CAAV,EAAa;AAClC0Z,UAAAA,YAAY,CAAC1Z,CAAC,CAAC,CAAD,CAAF,EAAOA,CAAC,CAAC,CAAD,CAAR,CAAZ;AACD,SAFD;AAGD,OAVD,MAUO;AACL1vD,QAAAA,MAAM,CAACsoE,QAAP,CAAgBe,MAAhB;AACD;AACF;;AAED,QAAI/lE,IAAI,CAAC0B,IAAL,KAAc,QAAlB,EAA4B;AAC1BujE,MAAAA,EAAE,CAACtnD,KAAH;;AACAsnD,MAAAA,EAAE,CAACe,OAAH,GAAa,YAAY;AACvBhB,QAAAA,QAAQ,CAACe,MAAT;AACD,OAFD;AAGD;;AAED,QAAI/lE,IAAI,CAAC0B,IAAL,KAAc,gBAAlB,EAAoC;AAClClD,MAAAA,OAAO,CAACD,GAAR,CAAY,2BAAZ;AAEA0nE,MAAAA,kBAAkB;AACnB;;AAED,QAAIjmE,IAAI,CAAC0B,IAAL,KAAc,OAAlB,EAA2B;AACzBlD,MAAAA,OAAO,CAACwJ,KAAR,CAAc,kBAAkBhI,IAAI,CAACgI,KAAL,CAAWhC,OAA7B,GAAuC,IAAvC,GAA8ChG,IAAI,CAACgI,KAAL,CAAW4rC,KAAvE;AAEAqyB,MAAAA,kBAAkB;AAElB,UAAIC,OAAO,GAAGC,kBAAkB,CAACnmE,IAAD,CAAhC;AACAkV,MAAAA,QAAQ,CAAC0nC,IAAT,CAAcwpB,WAAd,CAA0BF,OAA1B;AACD;AACF,GA1DD;AA2DD;;AAED,SAASD,kBAAT,GAA8B;AAC5B,MAAIC,OAAO,GAAGhxD,QAAQ,CAACmxD,cAAT,CAAwBtC,UAAxB,CAAd;;AACA,MAAImC,OAAJ,EAAa;AACXA,IAAAA,OAAO,CAAC58B,MAAR;AACD;AACF;;AAED,SAAS68B,kBAAT,CAA4BnmE,IAA5B,EAAkC;AAChC,MAAIkmE,OAAO,GAAGhxD,QAAQ,CAACoxD,aAAT,CAAuB,KAAvB,CAAd;AACAJ,EAAAA,OAAO,CAACnlE,EAAR,GAAagjE,UAAb,CAFgC,CAIhC;;AACA,MAAI/9D,OAAO,GAAGkP,QAAQ,CAACoxD,aAAT,CAAuB,KAAvB,CAAd;AACA,MAAIC,UAAU,GAAGrxD,QAAQ,CAACoxD,aAAT,CAAuB,KAAvB,CAAjB;AACAtgE,EAAAA,OAAO,CAACwgE,SAAR,GAAoBxmE,IAAI,CAACgI,KAAL,CAAWhC,OAA/B;AACAugE,EAAAA,UAAU,CAACC,SAAX,GAAuBxmE,IAAI,CAACgI,KAAL,CAAW4rC,KAAlC;AAEAsyB,EAAAA,OAAO,CAACO,SAAR,GACE,2NACE,mFADF,GAEE,yEAFF,GAGE,qEAHF,GAG0EzgE,OAAO,CAACygE,SAHlF,GAG8F,QAH9F,GAIE,OAJF,GAIYF,UAAU,CAACE,SAJvB,GAImC,QAJnC,GAKA,QANF;AASA,SAAOP,OAAP;AAED;;AAED,SAASQ,UAAT,CAAoBzC,MAApB,EAA4BljE,EAA5B,EAAgC;AAC9B,MAAI4lE,OAAO,GAAG1C,MAAM,CAAC0C,OAArB;;AACA,MAAI,CAACA,OAAL,EAAc;AACZ,WAAO,EAAP;AACD;;AAED,MAAIC,OAAO,GAAG,EAAd;AACA,MAAI7zB,CAAJ,EAAOnuC,CAAP,EAAUiiE,GAAV;;AAEA,OAAK9zB,CAAL,IAAU4zB,OAAV,EAAmB;AACjB,SAAK/hE,CAAL,IAAU+hE,OAAO,CAAC5zB,CAAD,CAAP,CAAW,CAAX,CAAV,EAAyB;AACvB8zB,MAAAA,GAAG,GAAGF,OAAO,CAAC5zB,CAAD,CAAP,CAAW,CAAX,EAAcnuC,CAAd,CAAN;;AACA,UAAIiiE,GAAG,KAAK9lE,EAAR,IAAe+rB,KAAK,CAAC2C,OAAN,CAAco3C,GAAd,KAAsBA,GAAG,CAACA,GAAG,CAACtqE,MAAJ,GAAa,CAAd,CAAH,KAAwBwE,EAAjE,EAAsE;AACpE6lE,QAAAA,OAAO,CAAChlE,IAAR,CAAamxC,CAAb;AACD;AACF;AACF;;AAED,MAAIkxB,MAAM,CAAC1gC,MAAX,EAAmB;AACjBqjC,IAAAA,OAAO,GAAGA,OAAO,CAACvjE,MAAR,CAAeqjE,UAAU,CAACzC,MAAM,CAAC1gC,MAAR,EAAgBxiC,EAAhB,CAAzB,CAAV;AACD;;AAED,SAAO6lE,OAAP;AACD;;AAED,SAASf,QAAT,CAAkB5B,MAAlB,EAA0BoB,KAA1B,EAAiC;AAC/B,MAAIsB,OAAO,GAAG1C,MAAM,CAAC0C,OAArB;;AACA,MAAI,CAACA,OAAL,EAAc;AACZ;AACD;;AAED,MAAIA,OAAO,CAACtB,KAAK,CAACtkE,EAAP,CAAP,IAAqB,CAACkjE,MAAM,CAAC1gC,MAAjC,EAAyC;AACvC,QAAIkhC,EAAE,GAAG,IAAIj8C,QAAJ,CAAa,SAAb,EAAwB,QAAxB,EAAkC,SAAlC,EAA6C68C,KAAK,CAACK,SAAN,CAAgBC,EAA7D,CAAT;AACAN,IAAAA,KAAK,CAACC,KAAN,GAAc,CAACqB,OAAO,CAACtB,KAAK,CAACtkE,EAAP,CAAtB;AACA4lE,IAAAA,OAAO,CAACtB,KAAK,CAACtkE,EAAP,CAAP,GAAoB,CAAC0jE,EAAD,EAAKY,KAAK,CAACyB,IAAX,CAApB;AACD,GAJD,MAIO,IAAI7C,MAAM,CAAC1gC,MAAX,EAAmB;AACxBsiC,IAAAA,QAAQ,CAAC5B,MAAM,CAAC1gC,MAAR,EAAgB8hC,KAAhB,CAAR;AACD;AACF;;AAED,SAASG,cAAT,CAAwBvB,MAAxB,EAAgCljE,EAAhC,EAAoC;AAClC,MAAI4lE,OAAO,GAAG1C,MAAM,CAAC0C,OAArB;;AACA,MAAI,CAACA,OAAL,EAAc;AACZ;AACD;;AAED,MAAI,CAACA,OAAO,CAAC5lE,EAAD,CAAR,IAAgBkjE,MAAM,CAAC1gC,MAA3B,EAAmC;AACjC,WAAOiiC,cAAc,CAACvB,MAAM,CAAC1gC,MAAR,EAAgBxiC,EAAhB,CAArB;AACD;;AAED,MAAI4jE,aAAa,CAAC5jE,EAAD,CAAjB,EAAuB;AACrB;AACD;;AACD4jE,EAAAA,aAAa,CAAC5jE,EAAD,CAAb,GAAoB,IAApB;AAEA,MAAI4nD,MAAM,GAAGsb,MAAM,CAAC8C,KAAP,CAAahmE,EAAb,CAAb;AAEA6jE,EAAAA,cAAc,CAAChjE,IAAf,CAAoB,CAACqiE,MAAD,EAASljE,EAAT,CAApB;;AAEA,MAAI4nD,MAAM,IAAIA,MAAM,CAACyb,GAAjB,IAAwBzb,MAAM,CAACyb,GAAP,CAAWE,gBAAX,CAA4B/nE,MAAxD,EAAgE;AAC9D,WAAO,IAAP;AACD;;AAED,SAAOmqE,UAAU,CAAC5oC,MAAM,CAAC2nC,aAAR,EAAuB1kE,EAAvB,CAAV,CAAqCgE,IAArC,CAA0C,UAAUhE,EAAV,EAAc;AAC7D,WAAOykE,cAAc,CAAC1nC,MAAM,CAAC2nC,aAAR,EAAuB1kE,EAAvB,CAArB;AACD,GAFM,CAAP;AAGD;;AAED,SAAS+kE,YAAT,CAAsB7B,MAAtB,EAA8BljE,EAA9B,EAAkC;AAChC,MAAI4nD,MAAM,GAAGsb,MAAM,CAAC8C,KAAP,CAAahmE,EAAb,CAAb;AACAkjE,EAAAA,MAAM,CAACI,OAAP,GAAiB,EAAjB;;AACA,MAAI1b,MAAJ,EAAY;AACVA,IAAAA,MAAM,CAACyb,GAAP,CAAWpkE,IAAX,GAAkBikE,MAAM,CAACI,OAAzB;AACD;;AAED,MAAI1b,MAAM,IAAIA,MAAM,CAACyb,GAAjB,IAAwBzb,MAAM,CAACyb,GAAP,CAAWG,iBAAX,CAA6BhoE,MAAzD,EAAiE;AAC/DosD,IAAAA,MAAM,CAACyb,GAAP,CAAWG,iBAAX,CAA6BvjE,OAA7B,CAAqC,UAAU7D,EAAV,EAAc;AACjDA,MAAAA,EAAE,CAAC8mE,MAAM,CAACI,OAAR,CAAF;AACD,KAFD;AAGD;;AAED,SAAOJ,MAAM,CAAC8C,KAAP,CAAahmE,EAAb,CAAP;AACAkjE,EAAAA,MAAM,CAACljE,EAAD,CAAN;AAEA4nD,EAAAA,MAAM,GAAGsb,MAAM,CAAC8C,KAAP,CAAahmE,EAAb,CAAT;;AACA,MAAI4nD,MAAM,IAAIA,MAAM,CAACyb,GAAjB,IAAwBzb,MAAM,CAACyb,GAAP,CAAWE,gBAAX,CAA4B/nE,MAAxD,EAAgE;AAC9DosD,IAAAA,MAAM,CAACyb,GAAP,CAAWE,gBAAX,CAA4BtjE,OAA5B,CAAoC,UAAU7D,EAAV,EAAc;AAChDA,MAAAA,EAAE;AACH,KAFD;;AAGA,WAAO,IAAP;AACD;AACF","file":"masterIndex.9fde829a.js","sourceRoot":"..","sourcesContent":["var binaryFeatures = {};\r\nbinaryFeatures.useBlobBuilder = (function () {\r\n  try {\r\n    new Blob([]);\r\n    return false;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nbinaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function () {\r\n  try {\r\n    return (new Blob([new Uint8Array([])])).size === 0;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nmodule.exports.binaryFeatures = binaryFeatures;\r\nvar BlobBuilder = module.exports.BlobBuilder;\r\nif (typeof window !== 'undefined') {\r\n  BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\r\n    window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\r\n}\r\n\r\nfunction BufferBuilder () {\r\n  this._pieces = [];\r\n  this._parts = [];\r\n}\r\n\r\nBufferBuilder.prototype.append = function (data) {\r\n  if (typeof data === 'number') {\r\n    this._pieces.push(data);\r\n  } else {\r\n    this.flush();\r\n    this._parts.push(data);\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.flush = function () {\r\n  if (this._pieces.length > 0) {\r\n    var buf = new Uint8Array(this._pieces);\r\n    if (!binaryFeatures.useArrayBufferView) {\r\n      buf = buf.buffer;\r\n    }\r\n    this._parts.push(buf);\r\n    this._pieces = [];\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.getBuffer = function () {\r\n  this.flush();\r\n  if (binaryFeatures.useBlobBuilder) {\r\n    var builder = new BlobBuilder();\r\n    for (var i = 0, ii = this._parts.length; i < ii; i++) {\r\n      builder.append(this._parts[i]);\r\n    }\r\n    return builder.getBlob();\r\n  } else {\r\n    return new Blob(this._parts);\r\n  }\r\n};\r\n\r\nmodule.exports.BufferBuilder = BufferBuilder;\r\n","var BufferBuilder = require('./bufferbuilder').BufferBuilder;\r\nvar binaryFeatures = require('./bufferbuilder').binaryFeatures;\r\n\r\nvar BinaryPack = {\r\n  unpack: function (data) {\r\n    var unpacker = new Unpacker(data);\r\n    return unpacker.unpack();\r\n  },\r\n  pack: function (data) {\r\n    var packer = new Packer();\r\n    packer.pack(data);\r\n    var buffer = packer.getBuffer();\r\n    return buffer;\r\n  }\r\n};\r\n\r\nmodule.exports = BinaryPack;\r\n\r\nfunction Unpacker (data) {\r\n  // Data is ArrayBuffer\r\n  this.index = 0;\r\n  this.dataBuffer = data;\r\n  this.dataView = new Uint8Array(this.dataBuffer);\r\n  this.length = this.dataBuffer.byteLength;\r\n}\r\n\r\nUnpacker.prototype.unpack = function () {\r\n  var type = this.unpack_uint8();\r\n  if (type < 0x80) {\r\n    return type;\r\n  } else if ((type ^ 0xe0) < 0x20) {\r\n    return (type ^ 0xe0) - 0x20;\r\n  }\r\n\r\n  var size;\r\n  if ((size = type ^ 0xa0) <= 0x0f) {\r\n    return this.unpack_raw(size);\r\n  } else if ((size = type ^ 0xb0) <= 0x0f) {\r\n    return this.unpack_string(size);\r\n  } else if ((size = type ^ 0x90) <= 0x0f) {\r\n    return this.unpack_array(size);\r\n  } else if ((size = type ^ 0x80) <= 0x0f) {\r\n    return this.unpack_map(size);\r\n  }\r\n\r\n  switch (type) {\r\n    case 0xc0:\r\n      return null;\r\n    case 0xc1:\r\n      return undefined;\r\n    case 0xc2:\r\n      return false;\r\n    case 0xc3:\r\n      return true;\r\n    case 0xca:\r\n      return this.unpack_float();\r\n    case 0xcb:\r\n      return this.unpack_double();\r\n    case 0xcc:\r\n      return this.unpack_uint8();\r\n    case 0xcd:\r\n      return this.unpack_uint16();\r\n    case 0xce:\r\n      return this.unpack_uint32();\r\n    case 0xcf:\r\n      return this.unpack_uint64();\r\n    case 0xd0:\r\n      return this.unpack_int8();\r\n    case 0xd1:\r\n      return this.unpack_int16();\r\n    case 0xd2:\r\n      return this.unpack_int32();\r\n    case 0xd3:\r\n      return this.unpack_int64();\r\n    case 0xd4:\r\n      return undefined;\r\n    case 0xd5:\r\n      return undefined;\r\n    case 0xd6:\r\n      return undefined;\r\n    case 0xd7:\r\n      return undefined;\r\n    case 0xd8:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_string(size);\r\n    case 0xd9:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_string(size);\r\n    case 0xda:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_raw(size);\r\n    case 0xdb:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_raw(size);\r\n    case 0xdc:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_array(size);\r\n    case 0xdd:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_array(size);\r\n    case 0xde:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_map(size);\r\n    case 0xdf:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_map(size);\r\n  }\r\n};\r\n\r\nUnpacker.prototype.unpack_uint8 = function () {\r\n  var byte = this.dataView[this.index] & 0xff;\r\n  this.index++;\r\n  return byte;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint16 = function () {\r\n  var bytes = this.read(2);\r\n  var uint16 =\r\n    ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\r\n  this.index += 2;\r\n  return uint16;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint32 = function () {\r\n  var bytes = this.read(4);\r\n  var uint32 =\r\n    ((bytes[0] * 256 +\r\n      bytes[1]) * 256 +\r\n      bytes[2]) * 256 +\r\n    bytes[3];\r\n  this.index += 4;\r\n  return uint32;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint64 = function () {\r\n  var bytes = this.read(8);\r\n  var uint64 =\r\n    ((((((bytes[0] * 256 +\r\n      bytes[1]) * 256 +\r\n      bytes[2]) * 256 +\r\n      bytes[3]) * 256 +\r\n      bytes[4]) * 256 +\r\n      bytes[5]) * 256 +\r\n      bytes[6]) * 256 +\r\n    bytes[7];\r\n  this.index += 8;\r\n  return uint64;\r\n};\r\n\r\nUnpacker.prototype.unpack_int8 = function () {\r\n  var uint8 = this.unpack_uint8();\r\n  return (uint8 < 0x80) ? uint8 : uint8 - (1 << 8);\r\n};\r\n\r\nUnpacker.prototype.unpack_int16 = function () {\r\n  var uint16 = this.unpack_uint16();\r\n  return (uint16 < 0x8000) ? uint16 : uint16 - (1 << 16);\r\n};\r\n\r\nUnpacker.prototype.unpack_int32 = function () {\r\n  var uint32 = this.unpack_uint32();\r\n  return (uint32 < Math.pow(2, 31)) ? uint32\r\n    : uint32 - Math.pow(2, 32);\r\n};\r\n\r\nUnpacker.prototype.unpack_int64 = function () {\r\n  var uint64 = this.unpack_uint64();\r\n  return (uint64 < Math.pow(2, 63)) ? uint64\r\n    : uint64 - Math.pow(2, 64);\r\n};\r\n\r\nUnpacker.prototype.unpack_raw = function (size) {\r\n  if (this.length < this.index + size) {\r\n    throw new Error('BinaryPackFailure: index is out of range' +\r\n      ' ' + this.index + ' ' + size + ' ' + this.length);\r\n  }\r\n  var buf = this.dataBuffer.slice(this.index, this.index + size);\r\n  this.index += size;\r\n\r\n  // buf = util.bufferToString(buf);\r\n\r\n  return buf;\r\n};\r\n\r\nUnpacker.prototype.unpack_string = function (size) {\r\n  var bytes = this.read(size);\r\n  var i = 0;\r\n  var str = '';\r\n  var c;\r\n  var code;\r\n\r\n  while (i < size) {\r\n    c = bytes[i];\r\n    if (c < 128) {\r\n      str += String.fromCharCode(c);\r\n      i++;\r\n    } else if ((c ^ 0xc0) < 32) {\r\n      code = ((c ^ 0xc0) << 6) | (bytes[i + 1] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 2;\r\n    } else {\r\n      code = ((c & 15) << 12) | ((bytes[i + 1] & 63) << 6) |\r\n        (bytes[i + 2] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 3;\r\n    }\r\n  }\r\n\r\n  this.index += size;\r\n  return str;\r\n};\r\n\r\nUnpacker.prototype.unpack_array = function (size) {\r\n  var objects = new Array(size);\r\n  for (var i = 0; i < size; i++) {\r\n    objects[i] = this.unpack();\r\n  }\r\n  return objects;\r\n};\r\n\r\nUnpacker.prototype.unpack_map = function (size) {\r\n  var map = {};\r\n  for (var i = 0; i < size; i++) {\r\n    var key = this.unpack();\r\n    var value = this.unpack();\r\n    map[key] = value;\r\n  }\r\n  return map;\r\n};\r\n\r\nUnpacker.prototype.unpack_float = function () {\r\n  var uint32 = this.unpack_uint32();\r\n  var sign = uint32 >> 31;\r\n  var exp = ((uint32 >> 23) & 0xff) - 127;\r\n  var fraction = (uint32 & 0x7fffff) | 0x800000;\r\n  return (sign === 0 ? 1 : -1) *\r\n    fraction * Math.pow(2, exp - 23);\r\n};\r\n\r\nUnpacker.prototype.unpack_double = function () {\r\n  var h32 = this.unpack_uint32();\r\n  var l32 = this.unpack_uint32();\r\n  var sign = h32 >> 31;\r\n  var exp = ((h32 >> 20) & 0x7ff) - 1023;\r\n  var hfrac = (h32 & 0xfffff) | 0x100000;\r\n  var frac = hfrac * Math.pow(2, exp - 20) +\r\n    l32 * Math.pow(2, exp - 52);\r\n  return (sign === 0 ? 1 : -1) * frac;\r\n};\r\n\r\nUnpacker.prototype.read = function (length) {\r\n  var j = this.index;\r\n  if (j + length <= this.length) {\r\n    return this.dataView.subarray(j, j + length);\r\n  } else {\r\n    throw new Error('BinaryPackFailure: read index out of range');\r\n  }\r\n};\r\n\r\nfunction Packer () {\r\n  this.bufferBuilder = new BufferBuilder();\r\n}\r\n\r\nPacker.prototype.getBuffer = function () {\r\n  return this.bufferBuilder.getBuffer();\r\n};\r\n\r\nPacker.prototype.pack = function (value) {\r\n  var type = typeof (value);\r\n  if (type === 'string') {\r\n    this.pack_string(value);\r\n  } else if (type === 'number') {\r\n    if (Math.floor(value) === value) {\r\n      this.pack_integer(value);\r\n    } else {\r\n      this.pack_double(value);\r\n    }\r\n  } else if (type === 'boolean') {\r\n    if (value === true) {\r\n      this.bufferBuilder.append(0xc3);\r\n    } else if (value === false) {\r\n      this.bufferBuilder.append(0xc2);\r\n    }\r\n  } else if (type === 'undefined') {\r\n    this.bufferBuilder.append(0xc0);\r\n  } else if (type === 'object') {\r\n    if (value === null) {\r\n      this.bufferBuilder.append(0xc0);\r\n    } else {\r\n      var constructor = value.constructor;\r\n      if (constructor == Array) {\r\n        this.pack_array(value);\r\n      } else if (constructor == Blob || constructor == File || value instanceof Blob || value instanceof File) {\r\n        this.pack_bin(value);\r\n      } else if (constructor == ArrayBuffer) {\r\n        if (binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value));\r\n        } else {\r\n          this.pack_bin(value);\r\n        }\r\n      } else if ('BYTES_PER_ELEMENT' in value) {\r\n        if (binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value.buffer));\r\n        } else {\r\n          this.pack_bin(value.buffer);\r\n        }\r\n      } else if ((constructor == Object) || (constructor.toString().startsWith('class'))) {\r\n        this.pack_object(value);\r\n      } else if (constructor == Date) {\r\n        this.pack_string(value.toString());\r\n      } else if (typeof value.toBinaryPack === 'function') {\r\n        this.bufferBuilder.append(value.toBinaryPack());\r\n      } else {\r\n        throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\r\n      }\r\n    }\r\n  } else {\r\n    throw new Error('Type \"' + type + '\" not yet supported');\r\n  }\r\n  this.bufferBuilder.flush();\r\n};\r\n\r\nPacker.prototype.pack_bin = function (blob) {\r\n  var length = blob.length || blob.byteLength || blob.size;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0xa0 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xda);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdb);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(blob);\r\n};\r\n\r\nPacker.prototype.pack_string = function (str) {\r\n  var length = utf8Length(str);\r\n\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0xb0 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xd8);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xd9);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(str);\r\n};\r\n\r\nPacker.prototype.pack_array = function (ary) {\r\n  var length = ary.length;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0x90 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xdc);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdd);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  for (var i = 0; i < length; i++) {\r\n    this.pack(ary[i]);\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_integer = function (num) {\r\n  if (num >= -0x20 && num <= 0x7f) {\r\n    this.bufferBuilder.append(num & 0xff);\r\n  } else if (num >= 0x00 && num <= 0xff) {\r\n    this.bufferBuilder.append(0xcc);\r\n    this.pack_uint8(num);\r\n  } else if (num >= -0x80 && num <= 0x7f) {\r\n    this.bufferBuilder.append(0xd0);\r\n    this.pack_int8(num);\r\n  } else if (num >= 0x0000 && num <= 0xffff) {\r\n    this.bufferBuilder.append(0xcd);\r\n    this.pack_uint16(num);\r\n  } else if (num >= -0x8000 && num <= 0x7fff) {\r\n    this.bufferBuilder.append(0xd1);\r\n    this.pack_int16(num);\r\n  } else if (num >= 0x00000000 && num <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xce);\r\n    this.pack_uint32(num);\r\n  } else if (num >= -0x80000000 && num <= 0x7fffffff) {\r\n    this.bufferBuilder.append(0xd2);\r\n    this.pack_int32(num);\r\n  } else if (num >= -0x8000000000000000 && num <= 0x7FFFFFFFFFFFFFFF) {\r\n    this.bufferBuilder.append(0xd3);\r\n    this.pack_int64(num);\r\n  } else if (num >= 0x0000000000000000 && num <= 0xFFFFFFFFFFFFFFFF) {\r\n    this.bufferBuilder.append(0xcf);\r\n    this.pack_uint64(num);\r\n  } else {\r\n    throw new Error('Invalid integer');\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_double = function (num) {\r\n  var sign = 0;\r\n  if (num < 0) {\r\n    sign = 1;\r\n    num = -num;\r\n  }\r\n  var exp = Math.floor(Math.log(num) / Math.LN2);\r\n  var frac0 = num / Math.pow(2, exp) - 1;\r\n  var frac1 = Math.floor(frac0 * Math.pow(2, 52));\r\n  var b32 = Math.pow(2, 32);\r\n  var h32 = (sign << 31) | ((exp + 1023) << 20) |\r\n    (frac1 / b32) & 0x0fffff;\r\n  var l32 = frac1 % b32;\r\n  this.bufferBuilder.append(0xcb);\r\n  this.pack_int32(h32);\r\n  this.pack_int32(l32);\r\n};\r\n\r\nPacker.prototype.pack_object = function (obj) {\r\n  var keys = Object.keys(obj);\r\n  var length = keys.length;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0x80 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xde);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdf);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  for (var prop in obj) {\r\n    if (obj.hasOwnProperty(prop)) {\r\n      this.pack(prop);\r\n      this.pack(obj[prop]);\r\n    }\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_uint8 = function (num) {\r\n  this.bufferBuilder.append(num);\r\n};\r\n\r\nPacker.prototype.pack_uint16 = function (num) {\r\n  this.bufferBuilder.append(num >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_uint32 = function (num) {\r\n  var n = num & 0xffffffff;\r\n  this.bufferBuilder.append((n & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((n & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((n & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_uint64 = function (num) {\r\n  var high = num / Math.pow(2, 32);\r\n  var low = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((low & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_int8 = function (num) {\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_int16 = function (num) {\r\n  this.bufferBuilder.append((num & 0xff00) >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_int32 = function (num) {\r\n  this.bufferBuilder.append((num >>> 24) & 0xff);\r\n  this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((num & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_int64 = function (num) {\r\n  var high = Math.floor(num / Math.pow(2, 32));\r\n  var low = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((low & 0x000000ff));\r\n};\r\n\r\nfunction _utf8Replace (m) {\r\n  var code = m.charCodeAt(0);\r\n\r\n  if (code <= 0x7ff) return '00';\r\n  if (code <= 0xffff) return '000';\r\n  if (code <= 0x1fffff) return '0000';\r\n  if (code <= 0x3ffffff) return '00000';\r\n  return '000000';\r\n}\r\n\r\nfunction utf8Length (str) {\r\n  if (str.length > 600) {\r\n    // Blob method faster for large strings\r\n    return (new Blob([str])).size;\r\n  } else {\r\n    return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\r\n  }\r\n}\r\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        cb(modifiedEvent);\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  const {navigator} = window;\n\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\nexport function fixNegotiationNeeded(window) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (pc.signalingState !== 'stable') {\n      return;\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params)) {\n            params.encodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(\n              sender.setParameters(params)\n              .catch(() => {})\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track) {\n        const stream = arguments[1];\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (!this._localStreams.includes(stream)) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in window.RTCPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for Chrome < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter = adapterFactory({window});\nexport default adapter;\n","import webRTCAdapter from \"webrtc-adapter\";\n\nexport { webRTCAdapter };\n","import { webRTCAdapter } from './adapter';\n\nexport const Supports = new class {\n  readonly isIOS = ['iPad', 'iPhone', 'iPod'].includes(navigator.platform);\n  readonly supportedBrowsers = ['firefox', 'chrome', 'safari'];\n\n  readonly minFirefoxVersion = 59;\n  readonly minChromeVersion = 72;\n  readonly minSafariVersion = 605;\n\n  isWebRTCSupported(): boolean {\n    return typeof RTCPeerConnection !== 'undefined';\n  };\n\n  isBrowserSupported(): boolean {\n    const browser = this.getBrowser();\n    const version = this.getVersion();\n\n    const validBrowser = this.supportedBrowsers.includes(browser);\n\n    if (!validBrowser) return false;\n\n    if (browser === 'chrome') return version >= this.minChromeVersion;\n    if (browser === 'firefox') return version >= this.minFirefoxVersion;\n    if (browser === 'safari') return !this.isIOS && version >= this.minSafariVersion;\n\n    return false;\n  }\n\n  getBrowser(): string {\n    return webRTCAdapter.browserDetails.browser;\n  }\n\n  getVersion(): number {\n    return webRTCAdapter.browserDetails.version || 0;\n  }\n\n  isUnifiedPlanSupported(): boolean {\n    const browser = this.getBrowser();\n    const version = webRTCAdapter.browserDetails.version || 0;\n\n    if (browser === 'chrome' && version < 72) return false;\n    if (browser === 'firefox' && version >= 59) return true;\n    if (!window.RTCRtpTransceiver || !('currentDirection' in RTCRtpTransceiver.prototype)) return false;\n\n    let tempPc: RTCPeerConnection;\n    let supported = false;\n\n    try {\n      tempPc = new RTCPeerConnection();\n      tempPc.addTransceiver('audio');\n      supported = true;\n    } catch (e) { }\n    finally {\n      if (tempPc) {\n        tempPc.close();\n      }\n    }\n\n    return supported;\n  }\n\n  toString(): string {\n    return `Supports: \n    browser:${this.getBrowser()} \n    version:${this.getVersion()} \n    isIOS:${this.isIOS} \n    isWebRTCSupported:${this.isWebRTCSupported()} \n    isBrowserSupported:${this.isBrowserSupported()} \n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`;\n  }\n}","import * as BinaryPack from \"peerjs-js-binarypack\";\nimport { Supports } from './supports';\nimport { UtilSupportsObj } from '..';\n\nconst DEFAULT_CONFIG = {\n  iceServers: [\n    { urls: \"stun:stun.l.google.com:19302\" },\n    { urls: \"turn:0.peerjs.com:3478\", username: \"peerjs\", credential: \"peerjsp\" }\n  ],\n  sdpSemantics: \"unified-plan\"\n};\n\nexport const util = new class {\n  noop(): void { }\n\n  readonly CLOUD_HOST = \"0.peerjs.com\";\n  readonly CLOUD_PORT = 443;\n\n  // Browsers that need chunking:\n  readonly chunkedBrowsers = { Chrome: 1, chrome: 1 };\n  readonly chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n  // Returns browser-agnostic default config\n  readonly defaultConfig = DEFAULT_CONFIG;\n\n  readonly browser = Supports.getBrowser();\n  readonly browserVersion = Supports.getVersion();\n\n  // Lists which features are supported\n  readonly supports = (function () {\n    const supported: UtilSupportsObj = {\n      browser: Supports.isBrowserSupported(),\n      webRTC: Supports.isWebRTCSupported(),\n      audioVideo: false,\n      data: false,\n      binaryBlob: false,\n      reliable: false,\n    };\n\n    if (!supported.webRTC) return supported;\n\n    let pc: RTCPeerConnection;\n\n    try {\n      pc = new RTCPeerConnection(DEFAULT_CONFIG);\n\n      supported.audioVideo = true;\n\n      let dc: RTCDataChannel;\n\n      try {\n        dc = pc.createDataChannel(\"_PEERJSTEST\", { ordered: true });\n        supported.data = true;\n        supported.reliable = !!dc.ordered;\n\n        // Binary test\n        try {\n          dc.binaryType = \"blob\";\n          supported.binaryBlob = !Supports.isIOS;\n        } catch (e) {\n        }\n      } catch (e) {\n      } finally {\n        if (dc) {\n          dc.close();\n        }\n      }\n    } catch (e) {\n    } finally {\n      if (pc) {\n        pc.close();\n      }\n    }\n\n    return supported;\n  })();\n\n  // Ensure alphanumeric ids\n  validateId(id: string): boolean {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n  }\n\n  pack = BinaryPack.pack;\n  unpack = BinaryPack.unpack;\n\n  // Binary stuff\n\n  private _dataCount: number = 1;\n\n  chunk(blob: Blob): { __peerData: number, n: number, total: number, data: Blob }[] {\n    const chunks = [];\n    const size = blob.size;\n    const total = Math.ceil(size / util.chunkedMTU);\n\n    let index = 0;\n    let start = 0;\n\n    while (start < size) {\n      const end = Math.min(size, start + util.chunkedMTU);\n      const b = blob.slice(start, end);\n\n      const chunk = {\n        __peerData: this._dataCount,\n        n: index,\n        data: b,\n        total,\n      };\n\n      chunks.push(chunk);\n\n      start = end;\n      index++;\n    }\n\n    this._dataCount++;\n\n    return chunks;\n  }\n\n  blobToArrayBuffer(blob: Blob, cb: (arg: ArrayBuffer | null) => void): FileReader {\n    const fr = new FileReader();\n\n    fr.onload = function (evt) {\n      if (evt.target) {\n        cb(evt.target.result as ArrayBuffer);\n      }\n    };\n\n    fr.readAsArrayBuffer(blob);\n\n    return fr;\n  }\n\n  binaryStringToArrayBuffer(binary: string): ArrayBuffer | SharedArrayBuffer {\n    const byteArray = new Uint8Array(binary.length);\n\n    for (let i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n\n    return byteArray.buffer;\n  }\n\n  randomToken(): string {\n    return Math.random()\n      .toString(36)\n      .substr(2);\n  }\n\n  isSecure(): boolean {\n    return location.protocol === \"https:\";\n  }\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","const LOG_PREFIX = 'PeerJS: ';\n\n/*\nPrints log messages depending on the debug level passed in. Defaults to 0.\n0  Prints no logs.\n1  Prints only errors.\n2  Prints errors and warnings.\n3  Prints all logs.\n*/\nexport enum LogLevel {\n    Disabled,\n    Errors,\n    Warnings,\n    All\n}\n\nclass Logger {\n    private _logLevel = LogLevel.Disabled;\n\n    get logLevel(): LogLevel { return this._logLevel; }\n\n    set logLevel(logLevel: LogLevel) { this._logLevel = logLevel; }\n\n    log(...args: any[]) {\n        if (this._logLevel >= LogLevel.All) {\n            this._print(LogLevel.All, ...args);\n        }\n    }\n\n    warn(...args: any[]) {\n        if (this._logLevel >= LogLevel.Warnings) {\n            this._print(LogLevel.Warnings, ...args);\n        }\n    }\n\n    error(...args: any[]) {\n        if (this._logLevel >= LogLevel.Errors) {\n            this._print(LogLevel.Errors, ...args);\n        }\n    }\n\n    setLogFunction(fn: (logLevel: LogLevel, ..._: any[]) => void): void {\n        this._print = fn;\n    }\n\n    private _print(logLevel: LogLevel, ...rest: any[]): void {\n        const copy = [LOG_PREFIX, ...rest];\n\n        for (let i in copy) {\n            if (copy[i] instanceof Error) {\n                copy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n\n            }\n        }\n\n        if (logLevel >= LogLevel.All) {\n            console.log(...copy);\n        } else if (logLevel >= LogLevel.Warnings) {\n            console.warn(\"WARNING\", ...copy);\n        } else if (logLevel >= LogLevel.Errors) {\n            console.error(\"ERROR\", ...copy);\n        }\n    }\n}\n\nexport default new Logger();","export enum ConnectionEventType {\n  Open = \"open\",\n  Stream = \"stream\",\n  Data = \"data\",\n  Close = \"close\",\n  Error = \"error\",\n  IceStateChanged = \"iceStateChanged\"\n}\n\nexport enum ConnectionType {\n  Data = \"data\",\n  Media = \"media\"\n}\n\nexport enum PeerEventType {\n  Open = \"open\",\n  Close = \"close\",\n  Connection = \"connection\",\n  Call = \"call\",\n  Disconnected = \"disconnected\",\n  Error = \"error\"\n}\n\nexport enum PeerErrorType {\n  BrowserIncompatible = \"browser-incompatible\",\n  Disconnected = \"disconnected\",\n  InvalidID = \"invalid-id\",\n  InvalidKey = \"invalid-key\",\n  Network = \"network\",\n  PeerUnavailable = \"peer-unavailable\",\n  SslUnavailable = \"ssl-unavailable\",\n  ServerError = \"server-error\",\n  SocketError = \"socket-error\",\n  SocketClosed = \"socket-closed\",\n  UnavailableID = \"unavailable-id\",\n  WebRTC = \"webrtc\"\n}\n\nexport enum SerializationType {\n  Binary = \"binary\",\n  BinaryUTF8 = \"binary-utf8\",\n  JSON = \"json\"\n}\n\nexport enum SocketEventType {\n  Message = \"message\",\n  Disconnected = \"disconnected\",\n  Error = \"error\",\n  Close = \"close\"\n}\n\nexport enum ServerMessageType {\n  Heartbeat = \"HEARTBEAT\",\n  Candidate = \"CANDIDATE\",\n  Offer = \"OFFER\",\n  Answer = \"ANSWER\",\n  Open = \"OPEN\", // The connection to the server is open.\n  Error = \"ERROR\", // Server error.\n  IdTaken = \"ID-TAKEN\", // The selected ID is taken.\n  InvalidKey = \"INVALID-KEY\", // The given API key cannot be found.\n  Leave = \"LEAVE\", // Another peer has closed its connection to this peer.\n  Expire = \"EXPIRE\" // The offer sent to a peer has expired without response.\n\n}","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\nimport { SocketEventType, ServerMessageType } from \"./enums\";\n\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nexport class Socket extends EventEmitter {\n  private _disconnected = false;\n  private _id?: string;\n  private _messagesQueue: Array<any> = [];\n  private _wsUrl: string;\n  private _socket?: WebSocket;\n  private _wsPingTimer: any;\n\n  constructor(\n    secure: any,\n    host: string,\n    port: number,\n    path: string,\n    key: string,\n    private readonly pingInterval: number = 5000,\n  ) {\n    super();\n\n    const wsProtocol = secure ? \"wss://\" : \"ws://\";\n\n    this._wsUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n  }\n\n  /** Check in with ID or get one from server. */\n  start(id: string, token: string): void {\n    this._id = id;\n\n    this._wsUrl += \"&id=\" + id + \"&token=\" + token;\n\n    this._startWebSocket();\n  }\n\n  /** Start up websocket communications. */\n  private _startWebSocket(): void {\n    if (this._socket) {\n      return;\n    }\n\n    this._socket = new WebSocket(this._wsUrl);\n\n    this._socket.onmessage = (event) => {\n      let data;\n\n      try {\n        data = JSON.parse(event.data);\n        logger.log(\"Server message received:\", data);\n      } catch (e) {\n        logger.log(\"Invalid server message\", event.data);\n        return;\n      }\n\n      this.emit(SocketEventType.Message, data);\n    };\n\n    this._socket.onclose = (event) => {\n      logger.log(\"Socket closed.\", event);\n\n      this._disconnected = true;\n      clearTimeout(this._wsPingTimer);\n\n      this.emit(SocketEventType.Disconnected);\n    };\n\n    // Take care of the queue of connections if necessary and make sure Peer knows\n    // socket is open.\n    this._socket.onopen = () => {\n      if (this._disconnected) return;\n\n      this._sendQueuedMessages();\n\n      logger.log(\"Socket open\");\n\n      this._scheduleHeartbeat();\n    };\n  }\n\n  private _scheduleHeartbeat(): void {\n    this._wsPingTimer = setTimeout(() => {\n      this._sendHeartbeat();\n    }, this.pingInterval);\n  }\n\n  private _sendHeartbeat(): void {\n    if (!this._wsOpen()) {\n      logger.log(`Cannot send heartbeat, because socket closed`);\n      return;\n    }\n\n    const message = JSON.stringify({ type: ServerMessageType.Heartbeat });\n\n    this._socket!.send(message);\n\n    this._scheduleHeartbeat();\n  }\n\n  /** Is the websocket currently open? */\n  private _wsOpen(): boolean {\n    return !!this._socket && this._socket.readyState === 1;\n  }\n\n  /** Send queued messages. */\n  private _sendQueuedMessages(): void {\n    //Create copy of queue and clear it,\n    //because send method push the message back to queue if smth will go wrong\n    const copiedQueue = [...this._messagesQueue];\n    this._messagesQueue = [];\n\n    for (const message of copiedQueue) {\n      this.send(message);\n    }\n  }\n\n  /** Exposed send for DC & Peer. */\n  send(data: any): void {\n    if (this._disconnected) {\n      return;\n    }\n\n    // If we didn't get an ID yet, we can't yet send anything so we should queue\n    // up these messages.\n    if (!this._id) {\n      this._messagesQueue.push(data);\n      return;\n    }\n\n    if (!data.type) {\n      this.emit(SocketEventType.Error, \"Invalid message\");\n      return;\n    }\n\n    if (!this._wsOpen()) {\n      return;\n    }\n\n    const message = JSON.stringify(data);\n\n    this._socket!.send(message);\n  }\n\n  close(): void {\n    if (!this._disconnected && !!this._socket) {\n      this._socket.close();\n      this._disconnected = true;\n      clearTimeout(this._wsPingTimer);\n    }\n  }\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport { ConnectionType, PeerErrorType, ConnectionEventType, ServerMessageType } from \"./enums\";\nimport { BaseConnection } from \"./baseconnection\";\n\n/**\n * Manages all negotiations between Peers.\n */\nexport class Negotiator {\n  constructor(readonly connection: BaseConnection) { }\n\n  /** Returns a PeerConnection object set up correctly (for data, media). */\n  startConnection(options: any) {\n    const peerConnection = this._startPeerConnection();\n\n    // Set the connection's PC.\n    this.connection.peerConnection = peerConnection;\n\n    if (this.connection.type === ConnectionType.Media && options._stream) {\n      this._addTracksToConnection(options._stream, peerConnection);\n    }\n\n    // What do we need to do now?\n    if (options.originator) {\n      if (this.connection.type === ConnectionType.Data) {\n        const dataConnection = <DataConnection>this.connection;\n\n        const config: RTCDataChannelInit = { ordered: !!options.reliable };\n\n        const dataChannel = peerConnection.createDataChannel(\n          dataConnection.label,\n          config\n        );\n        dataConnection.initialize(dataChannel);\n      }\n\n      this._makeOffer();\n    } else {\n      this.handleSDP(\"OFFER\", options.sdp);\n    }\n  }\n\n  /** Start a PC. */\n  private _startPeerConnection(): RTCPeerConnection {\n    logger.log(\"Creating RTCPeerConnection.\");\n\n    const peerConnection = new RTCPeerConnection(this.connection.provider.options.config);\n\n    this._setupListeners(peerConnection);\n\n    return peerConnection;\n  }\n\n  /** Set up various WebRTC listeners. */\n  private _setupListeners(\n    peerConnection: RTCPeerConnection\n  ) {\n    const peerId = this.connection.peer;\n    const connectionId = this.connection.connectionId;\n    const connectionType = this.connection.type;\n    const provider = this.connection.provider;\n\n    // ICE CANDIDATES.\n    logger.log(\"Listening for ICE candidates.\");\n\n    peerConnection.onicecandidate = (evt) => {\n      if (!evt.candidate || !evt.candidate.candidate) return;\n\n      logger.log(`Received ICE candidates for ${peerId}:`, evt.candidate);\n\n      provider.socket.send({\n        type: ServerMessageType.Candidate,\n        payload: {\n          candidate: evt.candidate,\n          type: connectionType,\n          connectionId: connectionId\n        },\n        dst: peerId\n      });\n    };\n\n    peerConnection.oniceconnectionstatechange = () => {\n      switch (peerConnection.iceConnectionState) {\n        case \"failed\":\n          logger.log(\n            \"iceConnectionState is failed, closing connections to \" +\n            peerId\n          );\n          this.connection.emit(\n            ConnectionEventType.Error,\n            new Error(\"Negotiation of connection to \" + peerId + \" failed.\")\n          );\n          this.connection.close();\n          break;\n        case \"closed\":\n          logger.log(\n            \"iceConnectionState is closed, closing connections to \" +\n            peerId\n          );\n          this.connection.emit(\n            ConnectionEventType.Error,\n            new Error(\"Connection to \" + peerId + \" closed.\")\n          );\n          this.connection.close();\n          break;\n        case \"disconnected\":\n          logger.log(\n            \"iceConnectionState is disconnected, closing connections to \" +\n            peerId\n          );\n          this.connection.emit(\n            ConnectionEventType.Error,\n            new Error(\"Connection to \" + peerId + \" disconnected.\")\n          );\n          this.connection.close();\n          break;\n        case \"completed\":\n          peerConnection.onicecandidate = util.noop;\n          break;\n      }\n\n      this.connection.emit(ConnectionEventType.IceStateChanged, peerConnection.iceConnectionState);\n    };\n\n    // DATACONNECTION.\n    logger.log(\"Listening for data channel\");\n    // Fired between offer and answer, so options should already be saved\n    // in the options hash.\n    peerConnection.ondatachannel = (evt) => {\n      logger.log(\"Received data channel\");\n\n      const dataChannel = evt.channel;\n      const connection = <DataConnection>(\n        provider.getConnection(peerId, connectionId)\n      );\n\n      connection.initialize(dataChannel);\n    };\n\n    // MEDIACONNECTION.\n    logger.log(\"Listening for remote stream\");\n\n    peerConnection.ontrack = (evt) => {\n      logger.log(\"Received remote stream\");\n\n      const stream = evt.streams[0];\n      const connection = provider.getConnection(peerId, connectionId);\n\n      if (connection.type === ConnectionType.Media) {\n        const mediaConnection = <MediaConnection>connection;\n\n        this._addStreamToMediaConnection(stream, mediaConnection);\n      }\n    };\n  }\n\n  cleanup(): void {\n    logger.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n\n    const peerConnection = this.connection.peerConnection;\n\n    if (!peerConnection) {\n      return;\n    }\n\n    this.connection.peerConnection = null;\n\n    //unsubscribe from all PeerConnection's events\n    peerConnection.onicecandidate = peerConnection.oniceconnectionstatechange = peerConnection.ondatachannel = peerConnection.ontrack = () => { };\n\n    const peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n    let dataChannelNotClosed = false;\n\n    if (this.connection.type === ConnectionType.Data) {\n      const dataConnection = <DataConnection>this.connection;\n      const dataChannel = dataConnection.dataChannel;\n\n      if (dataChannel) {\n        dataChannelNotClosed = !!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n      }\n    }\n\n    if (peerConnectionNotClosed || dataChannelNotClosed) {\n      peerConnection.close();\n    }\n  }\n\n  private async _makeOffer(): Promise<void> {\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      const offer = await peerConnection.createOffer(\n        this.connection.options.constraints\n      );\n\n      logger.log(\"Created offer.\");\n\n      if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === 'function') {\n        offer.sdp = this.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n      }\n\n      try {\n        await peerConnection.setLocalDescription(offer);\n\n        logger.log(\"Set localDescription:\", offer, `for:${this.connection.peer}`);\n\n        let payload: any = {\n          sdp: offer,\n          type: this.connection.type,\n          connectionId: this.connection.connectionId,\n          metadata: this.connection.metadata,\n          browser: util.browser\n        };\n\n        if (this.connection.type === ConnectionType.Data) {\n          const dataConnection = <DataConnection>this.connection;\n\n          payload = {\n            ...payload,\n            label: dataConnection.label,\n            reliable: dataConnection.reliable,\n            serialization: dataConnection.serialization\n          };\n        }\n\n        provider.socket.send({\n          type: ServerMessageType.Offer,\n          payload,\n          dst: this.connection.peer\n        });\n      } catch (err) {\n        // TODO: investigate why _makeOffer is being called from the answer\n        if (\n          err !=\n          \"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"\n        ) {\n          provider.emitError(PeerErrorType.WebRTC, err);\n          logger.log(\"Failed to setLocalDescription, \", err);\n        }\n      }\n    } catch (err_1) {\n      provider.emitError(PeerErrorType.WebRTC, err_1);\n      logger.log(\"Failed to createOffer, \", err_1);\n    }\n  }\n\n  private async _makeAnswer(): Promise<void> {\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      const answer = await peerConnection.createAnswer();\n      logger.log(\"Created answer.\");\n\n      if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === 'function') {\n        answer.sdp = this.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n      }\n\n      try {\n        await peerConnection.setLocalDescription(answer);\n\n        logger.log(`Set localDescription:`, answer, `for:${this.connection.peer}`);\n\n        provider.socket.send({\n          type: ServerMessageType.Answer,\n          payload: {\n            sdp: answer,\n            type: this.connection.type,\n            connectionId: this.connection.connectionId,\n            browser: util.browser\n          },\n          dst: this.connection.peer\n        });\n      } catch (err) {\n        provider.emitError(PeerErrorType.WebRTC, err);\n        logger.log(\"Failed to setLocalDescription, \", err);\n      }\n    } catch (err_1) {\n      provider.emitError(PeerErrorType.WebRTC, err_1);\n      logger.log(\"Failed to create answer, \", err_1);\n    }\n  }\n\n  /** Handle an SDP. */\n  async handleSDP(\n    type: string,\n    sdp: any\n  ): Promise<void> {\n    sdp = new RTCSessionDescription(sdp);\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    logger.log(\"Setting remote description\", sdp);\n\n    const self = this;\n\n    try {\n      await peerConnection.setRemoteDescription(sdp);\n      logger.log(`Set remoteDescription:${type} for:${this.connection.peer}`);\n      if (type === \"OFFER\") {\n        await self._makeAnswer();\n      }\n    } catch (err) {\n      provider.emitError(PeerErrorType.WebRTC, err);\n      logger.log(\"Failed to setRemoteDescription, \", err);\n    }\n  }\n\n  /** Handle a candidate. */\n  async handleCandidate(ice: any): Promise<void> {\n    logger.log(`handleCandidate:`, ice);\n\n    const candidate = ice.candidate;\n    const sdpMLineIndex = ice.sdpMLineIndex;\n    const sdpMid = ice.sdpMid;\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      await peerConnection.addIceCandidate(\n        new RTCIceCandidate({\n          sdpMid: sdpMid,\n          sdpMLineIndex: sdpMLineIndex,\n          candidate: candidate\n        })\n      );\n      logger.log(`Added ICE candidate for:${this.connection.peer}`);\n    } catch (err) {\n      provider.emitError(PeerErrorType.WebRTC, err);\n      logger.log(\"Failed to handleCandidate, \", err);\n    }\n  }\n\n  private _addTracksToConnection(\n    stream: MediaStream,\n    peerConnection: RTCPeerConnection\n  ): void {\n    logger.log(`add tracks from stream ${stream.id} to peer connection`);\n\n    if (!peerConnection.addTrack) {\n      return logger.error(\n        `Your browser does't support RTCPeerConnection#addTrack. Ignored.`\n      );\n    }\n\n    stream.getTracks().forEach(track => {\n      peerConnection.addTrack(track, stream);\n    });\n  }\n\n  private _addStreamToMediaConnection(\n    stream: MediaStream,\n    mediaConnection: MediaConnection\n  ): void {\n    logger.log(\n      `add stream ${stream.id} to media connection ${\n      mediaConnection.connectionId\n      }`\n    );\n\n    mediaConnection.addStream(stream);\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport { Peer } from \"./peer\";\nimport { ServerMessage } from \"./servermessage\";\nimport { ConnectionType } from \"./enums\";\n\nexport abstract class BaseConnection extends EventEmitter {\n  protected _open = false;\n\n  readonly metadata: any;\n  connectionId: string;\n\n  peerConnection: RTCPeerConnection;\n\n  abstract get type(): ConnectionType;\n\n  get open() {\n    return this._open;\n  }\n\n  constructor(\n    readonly peer: string,\n    public provider: Peer,\n    readonly options: any\n  ) {\n    super();\n\n    this.metadata = options.metadata;\n  }\n\n  abstract close(): void;\n\n  abstract handleMessage(message: ServerMessage): void;\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, ConnectionEventType, ServerMessageType } from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { AnswerOption } from \"..\";\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nexport class MediaConnection extends BaseConnection {\n  private static readonly ID_PREFIX = \"mc_\";\n\n  private _negotiator: Negotiator;\n  private _localStream: MediaStream;\n  private _remoteStream: MediaStream;\n\n  get type() {\n    return ConnectionType.Media;\n  }\n\n  get localStream(): MediaStream { return this._localStream; }\n  get remoteStream(): MediaStream { return this._remoteStream; }\n\n  constructor(peerId: string, provider: Peer, options: any) {\n    super(peerId, provider, options);\n\n    this._localStream = this.options._stream;\n    this.connectionId =\n      this.options.connectionId ||\n      MediaConnection.ID_PREFIX + util.randomToken();\n\n    this._negotiator = new Negotiator(this);\n\n    if (this._localStream) {\n      this._negotiator.startConnection({\n        _stream: this._localStream,\n        originator: true\n      });\n    }\n  }\n\n  addStream(remoteStream) {\n    logger.log(\"Receiving stream\", remoteStream);\n\n    this._remoteStream = remoteStream;\n    super.emit(ConnectionEventType.Stream, remoteStream); // Should we call this `open`?\n  }\n\n  handleMessage(message: ServerMessage): void {\n    const type = message.type;\n    const payload = message.payload;\n\n    switch (message.type) {\n      case ServerMessageType.Answer:\n        // Forward to negotiator\n        this._negotiator.handleSDP(type, payload.sdp);\n        this._open = true;\n        break;\n      case ServerMessageType.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        logger.warn(`Unrecognized message type:${type} from peer:${this.peer}`);\n        break;\n    }\n  }\n\n  answer(stream: MediaStream, options: AnswerOption = {}): void {\n    if (this._localStream) {\n      logger.warn(\n        \"Local stream already exists on this MediaConnection. Are you answering a call twice?\"\n      );\n      return;\n    }\n\n    this._localStream = stream;\n\n    if (options && options.sdpTransform) {\n      this.options.sdpTransform = options.sdpTransform;\n    }\n\n    this._negotiator.startConnection({ ...this.options._payload, _stream: stream });\n    // Retrieve lost messages stored because PeerConnection not set up.\n    const messages = this.provider._getMessages(this.connectionId);\n\n    for (let message of messages) {\n      this.handleMessage(message);\n    }\n\n    this._open = true;\n  }\n\n  /**\n   * Exposed functionality for users.\n   */\n\n  /** Allows user to close connection. */\n  close(): void {\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n\n    this._localStream = null;\n    this._remoteStream = null;\n\n    if (this.provider) {\n      this.provider._removeConnection(this);\n\n      this.provider = null;\n    }\n\n    if (this.options && this.options._stream) {\n      this.options._stream = null;\n    }\n\n    if (!this.open) {\n      return;\n    }\n\n    this._open = false;\n\n    super.emit(ConnectionEventType.Close);\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\n\nexport class EncodingQueue extends EventEmitter {\n  readonly fileReader: FileReader = new FileReader();\n\n  private _queue: Blob[] = [];\n  private _processing: boolean = false;\n\n  constructor() {\n    super();\n\n    this.fileReader.onload = (evt) => {\n      this._processing = false;\n\n      if (evt.target) {\n        this.emit('done', evt.target.result as ArrayBuffer);\n      }\n\n      this.doNextTask();\n    };\n\n    this.fileReader.onerror = (evt) => {\n      logger.error(`EncodingQueue error:`, evt);\n      this._processing = false;\n      this.destroy();\n      this.emit('error', evt);\n    }\n  }\n\n  get queue(): Blob[] {\n    return this._queue;\n  }\n\n  get size(): number {\n    return this.queue.length;\n  }\n\n  get processing(): boolean {\n    return this._processing;\n  }\n\n  enque(blob: Blob): void {\n    this.queue.push(blob);\n\n    if (this.processing) return;\n\n    this.doNextTask();\n  }\n\n  destroy(): void {\n    this.fileReader.abort();\n    this._queue = [];\n  }\n\n  private doNextTask(): void {\n    if (this.size === 0) return;\n    if (this.processing) return;\n\n    this._processing = true;\n\n    this.fileReader.readAsArrayBuffer(this.queue.shift());\n  }\n}","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport {\n  ConnectionType,\n  ConnectionEventType,\n  SerializationType,\n  ServerMessageType\n} from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { EncodingQueue } from './encodingQueue';\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nexport class DataConnection extends BaseConnection {\n  private static readonly ID_PREFIX = \"dc_\";\n  private static readonly MAX_BUFFERED_AMOUNT = 8 * 1024 * 1024;\n\n  private _negotiator: Negotiator;\n  readonly label: string;\n  readonly serialization: SerializationType;\n  readonly reliable: boolean;\n\n  get type() {\n    return ConnectionType.Data;\n  }\n\n  private _buffer: any[] = [];\n  private _bufferSize = 0;\n  private _buffering = false;\n  private _chunkedData: {\n    [id: number]: {\n      data: Blob[],\n      count: number,\n      total: number\n    }\n  } = {};\n\n  private _peerBrowser: any;\n  private _dc: RTCDataChannel;\n  private _encodingQueue = new EncodingQueue();\n\n  get dataChannel(): RTCDataChannel {\n    return this._dc;\n  }\n\n  get bufferSize(): number { return this._bufferSize; }\n\n  constructor(peerId: string, provider: Peer, options: any) {\n    super(peerId, provider, options);\n\n    this.connectionId =\n      this.options.connectionId || DataConnection.ID_PREFIX + util.randomToken();\n\n    this.label = this.options.label || this.connectionId;\n    this.serialization = this.options.serialization || SerializationType.Binary;\n    this.reliable = !!this.options.reliable;\n\n    if (this.options._payload) {\n      this._peerBrowser = this.options._payload.browser;\n    }\n\n    this._encodingQueue.on('done', (ab: ArrayBuffer) => {\n      this._bufferedSend(ab);\n    });\n\n    this._encodingQueue.on('error', () => {\n      logger.error(`DC#${this.connectionId}: Error occured in encoding from blob to arraybuffer, close DC`);\n      this.close();\n    });\n\n    this._negotiator = new Negotiator(this);\n\n    this._negotiator.startConnection(\n      this.options._payload || {\n        originator: true\n      }\n    );\n  }\n\n  /** Called by the Negotiator when the DataChannel is ready. */\n  initialize(dc: RTCDataChannel): void {\n    this._dc = dc;\n    this._configureDataChannel();\n  }\n\n  private _configureDataChannel(): void {\n    if (!util.supports.binaryBlob || util.supports.reliable) {\n      this.dataChannel.binaryType = \"arraybuffer\";\n    }\n\n    this.dataChannel.onopen = () => {\n      logger.log(`DC#${this.connectionId} dc connection success`);\n      this._open = true;\n      this.emit(ConnectionEventType.Open);\n    };\n\n    this.dataChannel.onmessage = (e) => {\n      logger.log(`DC#${this.connectionId} dc onmessage:`, e.data);\n      this._handleDataMessage(e);\n    };\n\n    this.dataChannel.onclose = () => {\n      logger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n      this.close();\n    };\n  }\n\n  // Handles a DataChannel message.\n  private _handleDataMessage({ data }: { data: Blob | ArrayBuffer | string }): void {\n    const datatype = data.constructor;\n\n    const isBinarySerialization = this.serialization === SerializationType.Binary ||\n      this.serialization === SerializationType.BinaryUTF8;\n\n    let deserializedData: any = data;\n\n    if (isBinarySerialization) {\n      if (datatype === Blob) {\n        // Datatype should never be blob\n        util.blobToArrayBuffer(data as Blob, (ab) => {\n          const unpackedData = util.unpack(ab);\n          this.emit(ConnectionEventType.Data, unpackedData);\n        });\n        return;\n      } else if (datatype === ArrayBuffer) {\n        deserializedData = util.unpack(data as ArrayBuffer);\n      } else if (datatype === String) {\n        // String fallback for binary data for browsers that don't support binary yet\n        const ab = util.binaryStringToArrayBuffer(data as string);\n        deserializedData = util.unpack(ab);\n      }\n    } else if (this.serialization === SerializationType.JSON) {\n      deserializedData = JSON.parse(data as string);\n    }\n\n    // Check if we've chunked--if so, piece things back together.\n    // We're guaranteed that this isn't 0.\n    if (deserializedData.__peerData) {\n      this._handleChunk(deserializedData);\n      return;\n    }\n\n    super.emit(ConnectionEventType.Data, deserializedData);\n  }\n\n  private _handleChunk(data: { __peerData: number, n: number, total: number, data: Blob }): void {\n    const id = data.__peerData;\n    const chunkInfo = this._chunkedData[id] || {\n      data: [],\n      count: 0,\n      total: data.total\n    };\n\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count++;\n    this._chunkedData[id] = chunkInfo;\n\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n\n      // We've received all the chunks--time to construct the complete data.\n      const data = new Blob(chunkInfo.data);\n      this._handleDataMessage({ data });\n    }\n  }\n\n  /**\n   * Exposed functionality for users.\n   */\n\n  /** Allows user to close connection. */\n  close(): void {\n    this._buffer = [];\n    this._bufferSize = 0;\n    this._chunkedData = {};\n\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n\n    if (this.provider) {\n      this.provider._removeConnection(this);\n\n      this.provider = null;\n    }\n\n    if (this.dataChannel) {\n      this.dataChannel.onopen = null;\n      this.dataChannel.onmessage = null;\n      this.dataChannel.onclose = null;\n      this._dc = null;\n    }\n\n    if (this._encodingQueue) {\n      this._encodingQueue.destroy();\n      this._encodingQueue.removeAllListeners();\n      this._encodingQueue = null;\n    }\n\n    if (!this.open) {\n      return;\n    }\n\n    this._open = false;\n\n    super.emit(ConnectionEventType.Close);\n  }\n\n  /** Allows user to send data. */\n  send(data: any, chunked: boolean): void {\n    if (!this.open) {\n      super.emit(\n        ConnectionEventType.Error,\n        new Error(\n          \"Connection is not open. You should listen for the `open` event before sending messages.\"\n        )\n      );\n      return;\n    }\n\n    if (this.serialization === SerializationType.JSON) {\n      this._bufferedSend(JSON.stringify(data));\n    } else if (\n      this.serialization === SerializationType.Binary ||\n      this.serialization === SerializationType.BinaryUTF8\n    ) {\n      const blob = util.pack(data);\n\n      if (!chunked && blob.size > util.chunkedMTU) {\n        this._sendChunks(blob);\n        return;\n      }\n\n      if (!util.supports.binaryBlob) {\n        // We only do this if we really need to (e.g. blobs are not supported),\n        // because this conversion is costly.\n        this._encodingQueue.enque(blob);\n      } else {\n        this._bufferedSend(blob);\n      }\n    } else {\n      this._bufferedSend(data);\n    }\n  }\n\n  private _bufferedSend(msg: any): void {\n    if (this._buffering || !this._trySend(msg)) {\n      this._buffer.push(msg);\n      this._bufferSize = this._buffer.length;\n    }\n  }\n\n  // Returns true if the send succeeds.\n  private _trySend(msg: any): boolean {\n    if (!this.open) {\n      return false;\n    }\n\n    if (this.dataChannel.bufferedAmount > DataConnection.MAX_BUFFERED_AMOUNT) {\n      this._buffering = true;\n      setTimeout(() => {\n        this._buffering = false;\n        this._tryBuffer();\n      }, 50);\n\n      return false;\n    }\n\n    try {\n      this.dataChannel.send(msg);\n    } catch (e) {\n      logger.error(`DC#:${this.connectionId} Error when sending:`, e);\n      this._buffering = true;\n\n      this.close();\n\n      return false;\n    }\n\n    return true;\n  }\n\n  // Try to send the first message in the buffer.\n  private _tryBuffer(): void {\n    if (!this.open) {\n      return;\n    }\n\n    if (this._buffer.length === 0) {\n      return;\n    }\n\n    const msg = this._buffer[0];\n\n    if (this._trySend(msg)) {\n      this._buffer.shift();\n      this._bufferSize = this._buffer.length;\n      this._tryBuffer();\n    }\n  }\n\n  private _sendChunks(blob: Blob): void {\n    const blobs = util.chunk(blob);\n    logger.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);\n\n    for (let blob of blobs) {\n      this.send(blob, true);\n    }\n  }\n\n  handleMessage(message: ServerMessage): void {\n    const payload = message.payload;\n\n    switch (message.type) {\n      case ServerMessageType.Answer:\n        this._peerBrowser = payload.browser;\n\n        // Forward to negotiator\n        this._negotiator.handleSDP(message.type, payload.sdp);\n        break;\n      case ServerMessageType.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        logger.warn(\n          \"Unrecognized message type:\",\n          message.type,\n          \"from peer:\",\n          this.peer\n        );\n        break;\n    }\n  }\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\n\nexport class API {\n  constructor(private readonly _options: any) { }\n\n  private _buildUrl(method: string): string {\n    const protocol = this._options.secure ? \"https://\" : \"http://\";\n    let url =\n      protocol +\n      this._options.host +\n      \":\" +\n      this._options.port +\n      this._options.path +\n      this._options.key +\n      \"/\" +\n      method;\n    const queryString = \"?ts=\" + new Date().getTime() + \"\" + Math.random();\n    url += queryString;\n\n    return url;\n  }\n\n  /** Get a unique ID from the server via XHR and initialize with it. */\n  async retrieveId(): Promise<string> {\n    const url = this._buildUrl(\"id\");\n\n    try {\n      const response = await fetch(url);\n\n      if (response.status !== 200) {\n        throw new Error(`Error. Status:${response.status}`);\n      }\n\n      return response.text();\n    } catch (error) {\n      logger.error(\"Error retrieving ID\", error);\n\n      let pathError = \"\";\n\n      if (\n        this._options.path === \"/\" &&\n        this._options.host !== util.CLOUD_HOST\n      ) {\n        pathError =\n          \" If you passed in a `path` to your self-hosted PeerServer, \" +\n          \"you'll also need to pass in that same path when creating a new \" +\n          \"Peer.\";\n      }\n\n      throw new Error(\"Could not get an ID from the server.\" + pathError);\n    }\n  }\n\n  /** @deprecated */\n  async listAllPeers(): Promise<any[]> {\n    const url = this._buildUrl(\"peers\");\n\n    try {\n      const response = await fetch(url);\n\n      if (response.status !== 200) {\n        if (response.status === 401) {\n          let helpfulError = \"\";\n\n          if (this._options.host === util.CLOUD_HOST) {\n            helpfulError =\n              \"It looks like you're using the cloud server. You can email \" +\n              \"team@peerjs.com to enable peer listing for your API key.\";\n          } else {\n            helpfulError =\n              \"You need to enable `allow_discovery` on your self-hosted \" +\n              \"PeerServer to use this feature.\";\n          }\n\n          throw new Error(\"It doesn't look like you have permission to list peers IDs. \" +\n            helpfulError);\n        }\n\n        throw new Error(`Error. Status:${response.status}`);\n      }\n\n      return response.json();\n    } catch (error) {\n      logger.error(\"Error retrieving list peers\", error);\n\n      throw new Error(\"Could not get list peers from the server.\" + error);\n    }\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport { util } from \"./util\";\nimport logger, { LogLevel } from \"./logger\";\nimport { Socket } from \"./socket\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport {\n  ConnectionType,\n  PeerErrorType,\n  PeerEventType,\n  SocketEventType,\n  ServerMessageType\n} from \"./enums\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { API } from \"./api\";\nimport { PeerConnectOption, PeerJSOption } from \"..\";\n\nclass PeerOptions implements PeerJSOption {\n  debug?: LogLevel; // 1: Errors, 2: Warnings, 3: All logs\n  host?: string;\n  port?: number;\n  path?: string;\n  key?: string;\n  token?: string;\n  config?: any;\n  secure?: boolean;\n  pingInterval?: number;\n  logFunction?: (logLevel: LogLevel, ...rest: any[]) => void;\n}\n\n/**\n * A peer who can initiate connections with other peers.\n */\nexport class Peer extends EventEmitter {\n  private static readonly DEFAULT_KEY = \"peerjs\";\n\n  private readonly _options: PeerOptions;\n  private _id: string;\n  private _lastServerId: string;\n  private _api: API;\n\n  // States.\n  private _destroyed = false; // Connections have been killed\n  private _disconnected = false; // Connection to PeerServer killed but P2P connections still active\n  private _open = false; // Sockets and such are not yet open.\n  private readonly _connections: Map<string, BaseConnection[]> = new Map(); // All connections for this peer.\n  private readonly _lostMessages: Map<string, ServerMessage[]> = new Map(); // src => [list of messages]\n\n  private _socket: Socket;\n\n  get id() {\n    return this._id;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get open() {\n    return this._open;\n  }\n\n  get socket() {\n    return this._socket;\n  }\n\n  /**\n   * @deprecated \n   * Return type will change from Object to Map<string,[]> \n   */\n  get connections(): Object {\n    const plainConnections = Object.create(null);\n\n    for (let [k, v] of this._connections) {\n      plainConnections[k] = v;\n    }\n\n    return plainConnections;\n  }\n\n  get destroyed() {\n    return this._destroyed;\n  }\n  get disconnected() {\n    return this._disconnected;\n  }\n\n  constructor(id?: string | PeerOptions, options?: PeerOptions) {\n    super();\n\n    let userId: string | undefined;\n\n    // Deal with overloading\n    if (id && id.constructor == Object) {\n      options = id as PeerOptions;\n    } else if (id) {\n      userId = id.toString();\n    }\n\n    // Configurize options\n    options = {\n      debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n      host: util.CLOUD_HOST,\n      port: util.CLOUD_PORT,\n      path: \"/\",\n      key: Peer.DEFAULT_KEY,\n      token: util.randomToken(),\n      config: util.defaultConfig,\n      ...options\n    };\n    this._options = options;\n\n    // Detect relative URL host.\n    if (this._options.host === \"/\") {\n      this._options.host = window.location.hostname;\n    }\n\n    // Set path correctly.\n    if (this._options.path) {\n      if (this._options.path[0] !== \"/\") {\n        this._options.path = \"/\" + this._options.path;\n      }\n      if (this._options.path[this._options.path.length - 1] !== \"/\") {\n        this._options.path += \"/\";\n      }\n    }\n\n    // Set whether we use SSL to same as current host\n    if (this._options.secure === undefined && this._options.host !== util.CLOUD_HOST) {\n      this._options.secure = util.isSecure();\n    } else if (this._options.host == util.CLOUD_HOST) {\n      this._options.secure = true;\n    }\n    // Set a custom log function if present\n    if (this._options.logFunction) {\n      logger.setLogFunction(this._options.logFunction);\n    }\n\n    logger.logLevel = this._options.debug || 0;\n\n    // Sanity checks\n    // Ensure WebRTC supported\n    if (!util.supports.audioVideo && !util.supports.data) {\n      this._delayedAbort(\n        PeerErrorType.BrowserIncompatible,\n        \"The current browser does not support WebRTC\"\n      );\n      return;\n    }\n    // Ensure alphanumeric id\n    if (!!userId && !util.validateId(userId)) {\n      this._delayedAbort(PeerErrorType.InvalidID, `ID \"${userId}\" is invalid`);\n      return;\n    }\n\n    this._api = new API(options);\n\n    // Start the server connection\n    this._initializeServerConnection();\n\n    if (userId) {\n      this._initialize(userId);\n    } else {\n      this._api.retrieveId()\n        .then(id => this._initialize(id))\n        .catch(error => this._abort(PeerErrorType.ServerError, error));\n    }\n  }\n\n  // Initialize the 'socket' (which is actually a mix of XHR streaming and\n  // websockets.)\n  private _initializeServerConnection(): void {\n    this._socket = new Socket(\n      this._options.secure,\n      this._options.host,\n      this._options.port,\n      this._options.path,\n      this._options.key,\n      this._options.pingInterval\n    );\n\n    this.socket.on(SocketEventType.Message, data => {\n      this._handleMessage(data);\n    });\n\n    this.socket.on(SocketEventType.Error, error => {\n      this._abort(PeerErrorType.SocketError, error);\n    });\n\n    this.socket.on(SocketEventType.Disconnected, () => {\n      // If we haven't explicitly disconnected, emit error and disconnect.\n      if (!this.disconnected) {\n        this.emitError(PeerErrorType.Network, \"Lost connection to server.\");\n        this.disconnect();\n      }\n    });\n\n    this.socket.on(SocketEventType.Close, () => {\n      // If we haven't explicitly disconnected, emit error.\n      if (!this.disconnected) {\n        this._abort(\n          PeerErrorType.SocketClosed,\n          \"Underlying socket is already closed.\"\n        );\n      }\n    });\n  }\n\n  /** Initialize a connection with the server. */\n  private _initialize(id: string): void {\n    this._id = id;\n    this.socket.start(this.id, this._options.token);\n  }\n\n  /** Handles messages from the server. */\n  private _handleMessage(message: ServerMessage): void {\n    const type = message.type;\n    const payload = message.payload;\n    const peerId = message.src;\n\n    switch (type) {\n      case ServerMessageType.Open: // The connection to the server is open.\n        this.emit(PeerEventType.Open, this.id);\n        this._open = true;\n        break;\n      case ServerMessageType.Error: // Server error.\n        this._abort(PeerErrorType.ServerError, payload.msg);\n        break;\n      case ServerMessageType.IdTaken: // The selected ID is taken.\n        this._abort(PeerErrorType.UnavailableID, `ID \"${this.id}\" is taken`);\n        break;\n      case ServerMessageType.InvalidKey: // The given API key cannot be found.\n        this._abort(\n          PeerErrorType.InvalidKey,\n          `API KEY \"${this._options.key}\" is invalid`\n        );\n        break;\n      case ServerMessageType.Leave: // Another peer has closed its connection to this peer.\n        logger.log(\"Received leave message from\", peerId);\n        this._cleanupPeer(peerId);\n        this._connections.delete(peerId);\n        break;\n      case ServerMessageType.Expire: // The offer sent to a peer has expired without response.\n        this.emitError(\n          PeerErrorType.PeerUnavailable,\n          \"Could not connect to peer \" + peerId\n        );\n        break;\n      case ServerMessageType.Offer: {\n        // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n        const connectionId = payload.connectionId;\n        let connection = this.getConnection(peerId, connectionId);\n\n        if (connection) {\n          connection.close();\n          logger.warn(\"Offer received for existing Connection ID:\", connectionId);\n        }\n\n        // Create a new connection.\n        if (payload.type === ConnectionType.Media) {\n          connection = new MediaConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          this._addConnection(peerId, connection);\n          this.emit(PeerEventType.Call, connection);\n        } else if (payload.type === ConnectionType.Data) {\n          connection = new DataConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          this._addConnection(peerId, connection);\n          this.emit(PeerEventType.Connection, connection);\n        } else {\n          logger.warn(\"Received malformed connection type:\", payload.type);\n          return;\n        }\n\n        // Find messages.\n        const messages = this._getMessages(connectionId);\n        for (let message of messages) {\n          connection.handleMessage(message);\n        }\n\n        break;\n      }\n      default: {\n        if (!payload) {\n          logger.warn(\n            `You received a malformed message from ${peerId} of type ${type}`\n          );\n          return;\n        }\n\n        const connectionId = payload.connectionId;\n        const connection = this.getConnection(peerId, connectionId);\n\n        if (connection && connection.peerConnection) {\n          // Pass it on.\n          connection.handleMessage(message);\n        } else if (connectionId) {\n          // Store for possible later use\n          this._storeMessage(connectionId, message);\n        } else {\n          logger.warn(\"You received an unrecognized message:\", message);\n        }\n        break;\n      }\n    }\n  }\n\n  /** Stores messages without a set up connection, to be claimed later. */\n  private _storeMessage(connectionId: string, message: ServerMessage): void {\n    if (!this._lostMessages.has(connectionId)) {\n      this._lostMessages.set(connectionId, []);\n    }\n\n    this._lostMessages.get(connectionId).push(message);\n  }\n\n  /** Retrieve messages from lost message store */\n  //TODO Change it to private\n  public _getMessages(connectionId: string): ServerMessage[] {\n    const messages = this._lostMessages.get(connectionId);\n\n    if (messages) {\n      this._lostMessages.delete(connectionId);\n      return messages;\n    }\n\n    return [];\n  }\n\n  /**\n   * Returns a DataConnection to the specified peer. See documentation for a\n   * complete list of options.\n   */\n  connect(peer: string, options: PeerConnectOption = {}): DataConnection {\n    if (this.disconnected) {\n      logger.warn(\n        \"You cannot connect to a new Peer because you called \" +\n        \".disconnect() on this Peer and ended your connection with the \" +\n        \"server. You can create a new Peer to reconnect, or call reconnect \" +\n        \"on this peer if you believe its ID to still be available.\"\n      );\n      this.emitError(\n        PeerErrorType.Disconnected,\n        \"Cannot connect to new Peer after disconnecting from server.\"\n      );\n      return;\n    }\n\n    const dataConnection = new DataConnection(peer, this, options);\n    this._addConnection(peer, dataConnection);\n    return dataConnection;\n  }\n\n  /**\n   * Returns a MediaConnection to the specified peer. See documentation for a\n   * complete list of options.\n   */\n  call(peer: string, stream: MediaStream, options: any = {}): MediaConnection {\n    if (this.disconnected) {\n      logger.warn(\n        \"You cannot connect to a new Peer because you called \" +\n        \".disconnect() on this Peer and ended your connection with the \" +\n        \"server. You can create a new Peer to reconnect.\"\n      );\n      this.emitError(\n        PeerErrorType.Disconnected,\n        \"Cannot connect to new Peer after disconnecting from server.\"\n      );\n      return;\n    }\n\n    if (!stream) {\n      logger.error(\n        \"To call a peer, you must provide a stream from your browser's `getUserMedia`.\"\n      );\n      return;\n    }\n\n    options._stream = stream;\n\n    const mediaConnection = new MediaConnection(peer, this, options);\n    this._addConnection(peer, mediaConnection);\n    return mediaConnection;\n  }\n\n  /** Add a data/media connection to this peer. */\n  private _addConnection(peerId: string, connection: BaseConnection): void {\n    logger.log(\n      `add connection ${connection.type}:${connection.connectionId}\n       to peerId:${peerId}`\n    );\n\n    if (!this._connections.has(peerId)) {\n      this._connections.set(peerId, []);\n    }\n    this._connections.get(peerId).push(connection);\n  }\n\n  //TODO should be private\n  _removeConnection(connection: BaseConnection): void {\n    const connections = this._connections.get(connection.peer);\n\n    if (connections) {\n      const index = connections.indexOf(connection);\n\n      if (index !== -1) {\n        connections.splice(index, 1);\n      }\n    }\n\n    //remove from lost messages\n    this._lostMessages.delete(connection.connectionId);\n  }\n\n  /** Retrieve a data/media connection for this peer. */\n  getConnection(peerId: string, connectionId: string): null | BaseConnection {\n    const connections = this._connections.get(peerId);\n    if (!connections) {\n      return null;\n    }\n\n    for (let connection of connections) {\n      if (connection.connectionId === connectionId) {\n        return connection;\n      }\n    }\n\n    return null;\n  }\n\n  private _delayedAbort(type: PeerErrorType, message): void {\n    setTimeout(() => {\n      this._abort(type, message);\n    }, 0);\n  }\n\n  /**\n   * Emits an error message and destroys the Peer.\n   * The Peer is not destroyed if it's in a disconnected state, in which case\n   * it retains its disconnected state and its existing connections.\n   */\n  private _abort(type: PeerErrorType, message): void {\n    logger.error(\"Aborting!\");\n\n    this.emitError(type, message);\n\n    if (!this._lastServerId) {\n      this.destroy();\n    } else {\n      this.disconnect();\n    }\n  }\n\n  /** Emits a typed error message. */\n  emitError(type: PeerErrorType, err): void {\n    logger.error(\"Error:\", err);\n\n    if (typeof err === \"string\") {\n      err = new Error(err);\n    }\n\n    err.type = type;\n\n    this.emit(PeerEventType.Error, err);\n  }\n\n  /**\n   * Destroys the Peer: closes all active connections as well as the connection\n   *  to the server.\n   * Warning: The peer can no longer create or accept connections after being\n   *  destroyed.\n   */\n  destroy(): void {\n    if (!this.destroyed) {\n      this._cleanup();\n      this.disconnect();\n      this._destroyed = true;\n    }\n  }\n\n  /** Disconnects every connection on this peer. */\n  private _cleanup(): void {\n    for (let peerId of this._connections.keys()) {\n      this._cleanupPeer(peerId);\n      this._connections.delete(peerId);\n    }\n\n    this.emit(PeerEventType.Close);\n  }\n\n  /** Closes all connections to this peer. */\n  private _cleanupPeer(peerId: string): void {\n    const connections = this._connections.get(peerId);\n\n    if (!connections) return;\n\n    for (let connection of connections) {\n      connection.close();\n    }\n  }\n\n  /**\n   * Disconnects the Peer's connection to the PeerServer. Does not close any\n   *  active connections.\n   * Warning: The peer can no longer create or accept connections after being\n   *  disconnected. It also cannot reconnect to the server.\n   */\n  disconnect(): void {\n    setTimeout(() => {\n      if (!this.disconnected) {\n        this._disconnected = true;\n        this._open = false;\n        if (this.socket) {\n          this.socket.close();\n        }\n\n        this.emit(PeerEventType.Disconnected, this.id);\n        this._lastServerId = this.id;\n        this._id = null;\n      }\n    }, 0);\n  }\n\n  /** Attempts to reconnect with the same ID. */\n  reconnect(): void {\n    if (this.disconnected && !this.destroyed) {\n      logger.log(\n        \"Attempting reconnection to server with ID \" + this._lastServerId\n      );\n      this._disconnected = false;\n      this._initializeServerConnection();\n      this._initialize(this._lastServerId);\n    } else if (this.destroyed) {\n      throw new Error(\n        \"This peer cannot reconnect to the server. It has already been destroyed.\"\n      );\n    } else if (!this.disconnected && !this.open) {\n      // Do nothing. We're still connecting the first time.\n      logger.error(\n        \"In a hurry? We're still trying to make the initial connection!\"\n      );\n    } else {\n      throw new Error(\n        \"Peer \" +\n        this.id +\n        \" cannot reconnect because it is not disconnected from the server!\"\n      );\n    }\n  }\n\n  /**\n   * Get a list of available peer IDs. If you're running your own server, you'll\n   * want to set allow_discovery: true in the PeerServer options. If you're using\n   * the cloud server, email team@peerjs.com to get the functionality enabled for\n   * your key.\n   */\n  listAllPeers(cb = (_: any[]) => { }): void {\n    this._api.listAllPeers()\n      .then(peers => cb(peers))\n      .catch(error => this._abort(PeerErrorType.ServerError, error));\n  }\n}\n","import { util } from \"./util\";\nimport { Peer } from \"./peer\";\n\nexport const peerjs = {\n  Peer,\n  util\n};\n\nexport default Peer;\n\n(<any>window).peerjs = peerjs;\n/** @deprecated Should use peerjs namespace */\n(<any>window).Peer = Peer;\n","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import immediate from 'immediate';\nimport uuidV4 from 'uuid';\nimport Md5 from 'spark-md5';\nimport vuvuzela from 'vuvuzela';\nimport getArguments from 'argsarray';\nimport inherits from 'inherits';\nimport { EventEmitter } from 'events';\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev$$1 = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev$$1] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev$$1});\n    }\n    return rev$$1;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      immediate(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev$$1,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev$$1;\n    rev$$1 = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev$$1) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev$$1,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev$$1) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev$$1 = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev$$1);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev$$1);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev$$1) {\n      addToMissing(id, rev$$1);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev$$1) {\n      if (height[rev$$1] > maxHeight) {\n        candidates.push(rev$$1);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev$$1 = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev$$1) !== -1) {\n        revs.push(rev$$1);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      /* istanbul ignore if */\n      if (!path) {\n        err = new Error('invalid rev tree');\n        err.docId = id;\n        return cb(err);\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev$$1) {\n            return rev$$1.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev$$1) {\n          pos--;\n          return {\n            rev: pos + '-' + rev$$1.id,\n            status: rev$$1.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.1.1\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n//#7458: execute function mergeAndedSelectors on nested $and\nfunction mergeAndedSelectorsNested(obj) {\n    for (var prop in obj) {\n        if (Array.isArray(obj)) {\n            for (var i in obj) {\n                if (obj[i]['$and']) {\n                    obj[i] = mergeAndedSelectors(obj[i]['$and']);\n                }\n            }\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            mergeAndedSelectorsNested(value); // <- recursive call\n        }\n    }\n    return obj;\n}\n\n//#7458: determine id $and is present in selector (at any level)\nfunction isAndInSelector(obj, isAnd) {\n    for (var prop in obj) {\n        if (prop === '$and') {\n            isAnd = true;\n        }\n        var value = obj[prop];\n        if (typeof value === 'object') {\n            isAnd = isAndInSelector(value, isAnd); // <- recursive call\n        }\n    }\n    return isAnd;\n}\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n    //#7458: if $and is present in selector (at any level) merge nested $and\n    if (isAndInSelector(result, false)) {\n        result = mergeAndedSelectorsNested(result);\n        if ('$and' in result) {\n            result = mergeAndedSelectors(result['$and']);\n        }\n        wasAnded = true;\n    }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  // is matcher an object, if so continue recursion\n  if (typeof matcher === 'object') {\n    return Object.keys(matcher).every(function (userOperator) {\n      var userValue = matcher[userOperator];\n      return match(userOperator, doc, userValue, parsedField, docFieldValue);\n    });\n  }\n\n  // no more depth, No need to recurse further\n  return matcher === docFieldValue;\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev$$1) {\n  if (!/^\\d+-./.test(rev$$1)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev$$1.indexOf('-');\n  var left = rev$$1.substring(0, idx);\n  var right = rev$$1.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev$$1) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev$$1;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending  no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      immediate(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev$$1 = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev$$1;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev$$1;\n      if (!opts.rev) {\n        rev$$1 = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev$$1 = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev$$1;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev$$1 = pos + '-' + revHash;\n        if (revs.indexOf(rev$$1) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return immediate(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc && doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    options.credentials = 'include';\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  immediate(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).catch(function () {\n      return {};\n    }).then(function (result) {\n      // Bad response or missing `uuid` should not prevent ID generation.\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      var url = path.substring(0, 1) === '/' ?\n        genUrl(host, path.substring(1)) :\n        genDBUrl(host, path);\n      return ourFetch(url, options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev$$1 = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev$$1;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev$$1,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev$$1;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev$$1, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev$$1;\n      rev$$1 = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev$$1) {\n      url += '?rev=' + rev$$1;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        immediate(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      immediate(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      immediate(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              immediate(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev$$1) {\n  return /^1-/.test(rev$$1);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate$$1) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate$$1 ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    immediate(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\n// Pull from src because pouchdb-node/pouchdb-browser themselves\n\nexport default PouchDB;\n","import Peer from 'peerjs';\r\nimport Pouch from 'pouchdb'\r\n\r\nconst context = new AudioContext()\r\nconst merger = context.createChannelMerger()\r\nconst audioRecorder = new WebAudioRecorder(merger, {})\r\nconst pouch = new Pouch('pouchity pouch pouch')\r\n//const dest = context.createMediaStreamDestination()\r\n//merger.connect(dest)\r\nmerger.connect(context.destination)\r\n\r\naudioRecorder.onComplete = function(recorder, blob) {\r\n\tconsole.log('uploading blob')\r\n\tfetch(`https://example.com/upload.php`, {method:\"POST\", body: blob})\r\n\t\t.then(console.log)\r\n}\r\n\r\nclass AppStore {\r\n\tnumPeers = 0\r\n\tcouchData = {\r\n\t\tleftUser: {\r\n\t\t\tname: '?',\r\n\t\t\tratingAudience: 0,\r\n\t\t\tratingWatson: 0\r\n\t\t},\r\n\t\trightUser: {\r\n\t\t\tname: '?',\r\n\t\t\tratingAudience: 0,\r\n\t\t\tratingWatson: 0\r\n\t\t},\r\n\t\tsongName: '?',\r\n\t\tkaraokeUrl: '?'\r\n\t}\r\n\taudioStream = new MediaStream()\r\n\tpeer = new Peer('imdacaptainnow')\r\n\tonPouchUpdate = () => {}\r\n\tconstructor (onPouchUpdate) {\r\n\t\tthis.onPouchUpdate = onPouchUpdate\r\n\t\tthis.peer.on('connection', (conn) => {\r\n\t\t\tthis.numPeers++\r\n\t\t\t\r\n\t\t\tif(this.numPeers > 2) {\r\n\t\t\t\talert('too many peers connected :(')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t// wait for a call\r\n\t\t\tthis.peer.on('call', (mediaConn) => {\r\n\t\t\t\tmediaConn.answer()\r\n\t\t\t\tmediaConn.on('stream', (stream) => {\r\n\t\t\t\t\tconst source = context.createMediaStreamSource(stream)\r\n\t\t\t\t\tconst splitter = context.createChannelSplitter()\r\n\t\t\t\t\t\r\n\t\t\t\t\tsource.connect(splitter)\r\n\t\t\t\t\tsplitter.connect(merger, 0, this.numPeers - 1)\r\n\t\t\t\t\tif(this.numPeers == 2) {\r\n\t\t\t\t\t\tif(audioRecorder.isRecording()) {\r\n\t\t\t\t\t\t\tconsole.log('cancelled recording')\r\n\t\t\t\t\t\t\taudioRecorder.cancelRecording()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconsole.log('recording')\r\n\t\t\t\t\t\taudioRecorder.startRecording()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t\tthis.peer.on('disconnected', () => {\r\n\t\t\tthis.numPeers--\r\n\t\t\tconsole.log('cancelled recording')\r\n\t\t\taudioRecorder.cancelRecording()\r\n\t\t})\r\n\t\tpouch.get('game').then((doc) => {\r\n\t\t\tthis.couchData = doc\r\n\t\t})\r\n\t\tpouch.changes().on('change', () => {\r\n\t\t\tpouch.get('game').then((doc) => {\r\n\t\t\t\tthis.couchData = doc\r\n\t\t\t\tthis.onPouchUpdate()\r\n\t\t\t})\r\n\t\t})\r\n\t\tmerger.connect(context.destination)\r\n\t}\r\n}\r\nexport const store = new AppStore()\r\nwindow.store = store","import { store } from './MasterStore'","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else {\n        window.location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}